"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[9514],{28453(e,n,l){l.d(n,{R:()=>i,x:()=>a});var r=l(96540);const s={},t=r.createContext(s);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(t.Provider,{value:n},e.children)}},53236(e,n,l){l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"laravel-url/deep-diving/events","title":"Events","description":"Laravel URL provides a comprehensive event system that fires domain events for all URL operations. These events allow you to hook into the URL management lifecycle and perform additional actions when URLs are created, changed, matched, or when resources need to be generated.","source":"@site/packages/laravel-url/deep-diving/events.md","sourceDirName":"laravel-url/deep-diving","slug":"/laravel-url/deep-diving/events","permalink":"/packages/laravel-url/deep-diving/events","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-url/deep-diving/events.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"sidebar_label":"Events"},"sidebar":"packagesSidebar","previous":{"title":"Url","permalink":"/packages/laravel-url/deep-diving/models/url"},"next":{"title":"SlugExistRule","permalink":"/packages/laravel-url/deep-diving/slug-exist-rule"}}');var s=l(74848),t=l(28453),i=l(28774);const a={sidebar_position:4,sidebar_label:"Events"},c="Events",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Event Structure",id:"event-structure",level:2},{value:"Base Event Structure",id:"base-event-structure",level:3},{value:"Available Events",id:"available-events",level:2},{value:"URL Events",id:"url-events",level:3},{value:"Listening to Events",id:"listening-to-events",level:2},{value:"Method 1: Event Listeners in Service Provider",id:"method-1-event-listeners-in-service-provider",level:3},{value:"Method 2: Using Event Facade",id:"method-2-using-event-facade",level:3},{value:"Method 3: Using Event Subscribers",id:"method-3-using-event-subscribers",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Cache Invalidation on URL Changes",id:"example-1-cache-invalidation-on-url-changes",level:3},{value:"Example 2: Audit Logging",id:"example-2-audit-logging",level:3},{value:"Example 3: Search Index Updates",id:"example-3-search-index-updates",level:3},{value:"Example 4: Sitemap Generation",id:"example-4-sitemap-generation",level:3},{value:"Example 5: Analytics Tracking",id:"example-5-analytics-tracking",level:3},{value:"Example 6: Fallback Route Handling",id:"example-6-fallback-route-handling",level:3},{value:"Example 7: Resource Generation",id:"example-7-resource-generation",level:3},{value:"Example 8: Complete Event Listener Setup",id:"example-8-complete-event-listener-setup",level:3},{value:"Event Timing",id:"event-timing",level:2},{value:"UrlChanged",id:"urlchanged",level:3},{value:"UrlMatched",id:"urlmatched",level:3},{value:"UrlableResourceEvent",id:"urlableresourceevent",level:3},{value:"Queued Events",id:"queued-events",level:2},{value:"Event Payload Details",id:"event-payload-details",level:2},{value:"UrlChanged",id:"urlchanged-1",level:3},{value:"UrlMatched",id:"urlmatched-1",level:3},{value:"UrlableResourceEvent",id:"urlableresourceevent-1",level:3},{value:"When to Use Events",id:"when-to-use-events",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"events",children:"Events"})}),"\n",(0,s.jsx)(n.p,{children:"Laravel URL provides a comprehensive event system that fires domain events for all URL operations. These events allow you to hook into the URL management lifecycle and perform additional actions when URLs are created, changed, matched, or when resources need to be generated."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The event system in Laravel URL:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fires automatically"})," during URL operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Provides model and URL data"})," in event payloads"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Uses DomainEvent interface"})," for consistency"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Supports event listeners"})," for custom logic"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Enables event-driven architecture"})," for URL management"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"event-structure",children:"Event Structure"}),"\n",(0,s.jsx)(n.p,{children:"All events in Laravel URL:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Implement ",(0,s.jsx)(n.code,{children:"JobMetric\\EventSystem\\Contracts\\DomainEvent"})," (where applicable)"]}),"\n",(0,s.jsxs)(n.li,{children:["Are ",(0,s.jsx)(n.code,{children:"readonly"})," classes for immutability (where applicable)"]}),"\n",(0,s.jsx)(n.li,{children:"Contain model and URL information"}),"\n",(0,s.jsxs)(n.li,{children:["Provide a stable ",(0,s.jsx)(n.code,{children:"key()"})," method (where applicable)"]}),"\n",(0,s.jsxs)(n.li,{children:["Include metadata via ",(0,s.jsx)(n.code,{children:"definition()"})," method (where applicable)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"base-event-structure",children:"Base Event Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"readonly class UrlChanged implements DomainEvent\n{\n    public function __construct(\n        public Model $model,\n        public ?string $old,\n        public string $new,\n        public int $version\n    ) {}\n\n    public static function key(): string\n    {\n        return 'url.changed';\n    }\n\n    public static function definition(): DomainEventDefinition\n    {\n        return new DomainEventDefinition(\n            self::key(),\n            'url::base.entity_names.url',\n            'url::base.events.url_changed.title',\n            'url::base.events.url_changed.description',\n            'fas fa-link',\n            ['url', 'routing', 'seo']\n        );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"available-events",children:"Available Events"}),"\n",(0,s.jsx)(n.h3,{id:"url-events",children:"URL Events"}),"\n",(0,s.jsx)(n.p,{children:"Events fired for URL operations."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Event Class"}),(0,s.jsx)(n.th,{children:"Event Key"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Payload"}),(0,s.jsx)(n.th,{children:"Triggered When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UrlChanged"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"url.changed"})}),(0,s.jsx)(n.td,{children:"Fired after a URL is created or changed"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Model $model, ?string $old, string $new, int $version"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"HasUrl::dispatchSlug()"}),", ",(0,s.jsx)(n.code,{children:"HasUrl::rebuildUrl()"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UrlMatched"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"url.matched"})}),(0,s.jsx)(n.td,{children:"Fired when fallback route matches an active URL"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Request $request, Url $url, Model $urlable, ?string $collection"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FullUrlController::__invoke()"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UrlableResourceEvent"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"urlable.resource"})}),(0,s.jsx)(n.td,{children:"Fired when resource representation is needed"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mixed $urlable"})}),(0,s.jsxs)(n.td,{children:["Accessing ",(0,s.jsx)(n.code,{children:"slugable_resource"})," or ",(0,s.jsx)(n.code,{children:"urlable_resource"})]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Namespace:"})," ",(0,s.jsx)(n.code,{children:"JobMetric\\Url\\Events\\*"})]}),"\n",(0,s.jsx)(n.h2,{id:"listening-to-events",children:"Listening to Events"}),"\n",(0,s.jsx)(n.h3,{id:"method-1-event-listeners-in-service-provider",children:"Method 1: Event Listeners in Service Provider"}),"\n",(0,s.jsx)(n.p,{children:"Register event listeners in a service provider:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Providers;\n\nuse Illuminate\\Foundation\\Support\\Providers\\EventServiceProvider as ServiceProvider;\nuse JobMetric\\Url\\Events\\UrlChanged;\nuse JobMetric\\Url\\Events\\UrlMatched;\nuse JobMetric\\Url\\Events\\UrlableResourceEvent;\n\nclass EventServiceProvider extends ServiceProvider\n{\n    protected $listen = [\n        UrlChanged::class => [\n            \\App\\Listeners\\Url\\LogUrlChanged::class,\n            \\App\\Listeners\\Url\\InvalidateUrlCache::class,\n            \\App\\Listeners\\Url\\UpdateSearchIndex::class,\n            \\App\\Listeners\\Url\\RegenerateSitemap::class,\n            \\App\\Listeners\\Url\\TrackUrlAnalytics::class,\n        ],\n        UrlMatched::class => [\n            \\App\\Listeners\\Url\\HandleUrlMatch::class,\n            \\App\\Listeners\\Url\\LogUrlAccess::class,\n        ],\n        UrlableResourceEvent::class => [\n            \\App\\Listeners\\Url\\GenerateUrlableResource::class,\n        ],\n    ];\n\n    public function boot(): void\n    {\n        parent::boot();\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"method-2-using-event-facade",children:"Method 2: Using Event Facade"}),"\n",(0,s.jsx)(n.p,{children:"Listen to events using the Event facade:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Support\\Facades\\Event;\nuse JobMetric\\Url\\Events\\UrlChanged;\n\nEvent::listen(UrlChanged::class, function (UrlChanged $event) {\n    $model = $event->model;\n    $old = $event->old;\n    $new = $event->new;\n    $version = $event->version;\n    \n    // Perform actions\n    Log::info('URL changed', [\n        'model' => get_class($model),\n        'model_id' => $model->id,\n        'old_url' => $old,\n        'new_url' => $new,\n        'version' => $version,\n    ]);\n    \n    Cache::tags([get_class($model)])->flush();\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"method-3-using-event-subscribers",children:"Method 3: Using Event Subscribers"}),"\n",(0,s.jsx)(n.p,{children:"Create event subscribers for multiple events:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse Illuminate\\Events\\Dispatcher;\nuse JobMetric\\Url\\Events\\UrlChanged;\nuse JobMetric\\Url\\Events\\UrlMatched;\nuse JobMetric\\Url\\Events\\UrlableResourceEvent;\n\nclass UrlEventSubscriber\n{\n    public function handleUrlChanged(UrlChanged $event): void\n    {\n        $model = $event->model;\n        $old = $event->old;\n        $new = $event->new;\n        \n        Log::info('URL changed', [\n            'model' => get_class($model),\n            'model_id' => $model->id,\n            'old_url' => $old,\n            'new_url' => $new,\n        ]);\n    }\n\n    public function handleUrlMatched(UrlMatched $event): void\n    {\n        $url = $event->url;\n        $urlable = $event->urlable;\n        \n        Log::info('URL matched', [\n            'url_id' => $url->id,\n            'full_url' => $url->full_url,\n            'model' => get_class($urlable),\n            'model_id' => $urlable->id,\n        ]);\n    }\n\n    public function handleUrlableResource(UrlableResourceEvent $event): void\n    {\n        $urlable = $event->urlable;\n        \n        if ($urlable instanceof Product) {\n            $event->resource = new ProductResource($urlable);\n        }\n    }\n\n    public function subscribe(Dispatcher $events): void\n    {\n        $events->listen(\n            UrlChanged::class,\n            [UrlEventSubscriber::class, 'handleUrlChanged']\n        );\n\n        $events->listen(\n            UrlMatched::class,\n            [UrlEventSubscriber::class, 'handleUrlMatched']\n        );\n\n        $events->listen(\n            UrlableResourceEvent::class,\n            [UrlEventSubscriber::class, 'handleUrlableResource']\n        );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Register the subscriber:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Providers;\n\nuse App\\Listeners\\UrlEventSubscriber;\nuse Illuminate\\Foundation\\Support\\Providers\\EventServiceProvider as ServiceProvider;\n\nclass EventServiceProvider extends ServiceProvider\n{\n    protected $subscribe = [\n        UrlEventSubscriber::class,\n    ];\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,s.jsx)(n.h3,{id:"example-1-cache-invalidation-on-url-changes",children:"Example 1: Cache Invalidation on URL Changes"}),"\n",(0,s.jsx)(n.p,{children:"Invalidate cache when URLs are modified:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'namespace App\\Listeners\\Url;\n\nuse Illuminate\\Support\\Facades\\Cache;\nuse JobMetric\\Url\\Events\\UrlChanged;\n\nclass InvalidateUrlCache\n{\n    public function handle(UrlChanged $event): void\n    {\n        $model = $event->model;\n        $old = $event->old;\n        $new = $event->new;\n\n        // Invalidate specific URL cache\n        if ($old) {\n            Cache::forget("url:{$old}");\n            Cache::forget("page:{$old}");\n        }\n        \n        Cache::forget("url:{$new}");\n        Cache::forget("page:{$new}");\n        \n        // Invalidate all URLs cache for this model\n        Cache::forget("urls.{$model->getMorphClass()}.{$model->id}");\n\n        // Clear tagged cache\n        Cache::tags([get_class($model)])->flush();\n        Cache::tags(["url_{$model->getMorphClass()}_{$model->id}"])->flush();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-2-audit-logging",children:"Example 2: Audit Logging"}),"\n",(0,s.jsx)(n.p,{children:"Log all URL operations for audit trail:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Url;\n\nuse App\\Models\\AuditLog;\nuse Illuminate\\Support\\Facades\\Auth;\nuse JobMetric\\Url\\Events\\UrlChanged;\nuse JobMetric\\Url\\Events\\UrlMatched;\n\nclass AuditUrlOperations\n{\n    public function handleUrlChanged(UrlChanged $event): void\n    {\n        $this->logAudit('changed', $event->model, [\n            'old_url' => $event->old,\n            'new_url' => $event->new,\n            'version' => $event->version,\n        ]);\n    }\n\n    public function handleUrlMatched(UrlMatched $event): void\n    {\n        $this->logAudit('matched', $event->urlable, [\n            'url_id' => $event->url->id,\n            'full_url' => $event->url->full_url,\n            'collection' => $event->collection,\n        ]);\n    }\n\n    protected function logAudit(string $action, $model, array $data): void\n    {\n        AuditLog::create([\n            'user_id' => Auth::id(),\n            'action' => \"url.{$action}\",\n            'model_type' => get_class($model),\n            'model_id' => $model->id,\n            'data' => $data,\n            'ip_address' => request()->ip(),\n        ]);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-3-search-index-updates",children:"Example 3: Search Index Updates"}),"\n",(0,s.jsx)(n.p,{children:"Update search index when URLs change:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Url;\n\nuse App\\Services\\SearchService;\nuse JobMetric\\Url\\Events\\UrlChanged;\n\nclass UpdateSearchIndex\n{\n    public function handle(UrlChanged $event): void\n    {\n        $model = $event->model;\n        $old = $event->old;\n        $new = $event->new;\n        \n        // Update search index with new URL\n        SearchService::index($model, [\n            'url' => $new,\n            'old_url' => $old,\n            'version' => $event->version,\n        ]);\n        \n        // If old URL exists, update redirects\n        if ($old) {\n            SearchService::updateRedirect($old, $new);\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-4-sitemap-generation",children:"Example 4: Sitemap Generation"}),"\n",(0,s.jsx)(n.p,{children:"Regenerate sitemap when URLs change:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Url;\n\nuse App\\Services\\SitemapService;\nuse JobMetric\\Url\\Events\\UrlChanged;\n\nclass RegenerateSitemap\n{\n    public function __construct(\n        protected SitemapService $sitemap\n    ) {}\n\n    public function handle(UrlChanged $event): void\n    {\n        $model = $event->model;\n        $new = $event->new;\n        \n        // Regenerate sitemap for this model type\n        $this->sitemap->regenerate(get_class($model));\n        \n        // Add new URL to sitemap\n        $this->sitemap->add($new, [\n            'lastmod' => now(),\n            'changefreq' => 'weekly',\n            'priority' => 0.8,\n        ]);\n        \n        // Remove old URL if exists\n        if ($event->old) {\n            $this->sitemap->remove($event->old);\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-5-analytics-tracking",children:"Example 5: Analytics Tracking"}),"\n",(0,s.jsx)(n.p,{children:"Track URL changes for analytics:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Url;\n\nuse App\\Services\\AnalyticsService;\nuse JobMetric\\Url\\Events\\UrlChanged;\nuse JobMetric\\Url\\Events\\UrlMatched;\n\nclass TrackUrlAnalytics\n{\n    public function __construct(\n        protected AnalyticsService $analytics\n    ) {}\n\n    public function handleUrlChanged(UrlChanged $event): void\n    {\n        $model = $event->model;\n        \n        $this->analytics->track('url.changed', [\n            'model_type' => get_class($model),\n            'model_id' => $model->id,\n            'old_url' => $event->old,\n            'new_url' => $event->new,\n            'version' => $event->version,\n        ]);\n    }\n\n    public function handleUrlMatched(UrlMatched $event): void\n    {\n        $url = $event->url;\n        $urlable = $event->urlable;\n        \n        $this->analytics->track('url.matched', [\n            'url_id' => $url->id,\n            'full_url' => $url->full_url,\n            'model_type' => get_class($urlable),\n            'model_id' => $urlable->id,\n            'collection' => $event->collection,\n        ]);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-6-fallback-route-handling",children:"Example 6: Fallback Route Handling"}),"\n",(0,s.jsx)(n.p,{children:"Handle unmatched URLs with custom logic:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Url;\n\nuse JobMetric\\Url\\Events\\UrlMatched;\n\nclass HandleUrlMatch\n{\n    public function handle(UrlMatched $event): void\n    {\n        $model = $event->urlable;\n        $request = $event->request;\n\n        // Handle different model types\n        if ($model instanceof Product) {\n            $event->response = view('products.show', [\n                'product' => $model,\n            ]);\n        } elseif ($model instanceof Category) {\n            $event->response = view('categories.show', [\n                'category' => $model,\n            ]);\n        } elseif ($model instanceof Page) {\n            $event->response = view('pages.show', [\n                'page' => $model,\n            ]);\n        }\n\n        // Handle API requests\n        if ($request->wantsJson()) {\n            $event->response = response()->json([\n                'url' => $event->url->full_url,\n                'model' => $model->toArray(),\n            ]);\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-7-resource-generation",children:"Example 7: Resource Generation"}),"\n",(0,s.jsx)(n.p,{children:"Transform models into API resources:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Url;\n\nuse App\\Http\\Resources\\ProductResource;\nuse App\\Http\\Resources\\CategoryResource;\nuse App\\Http\\Resources\\PageResource;\nuse JobMetric\\Url\\Events\\UrlableResourceEvent;\n\nclass GenerateUrlableResource\n{\n    public function handle(UrlableResourceEvent $event): void\n    {\n        $urlable = $event->urlable;\n\n        if ($urlable instanceof Product) {\n            $event->resource = new ProductResource($urlable);\n        } elseif ($urlable instanceof Category) {\n            $event->resource = new CategoryResource($urlable);\n        } elseif ($urlable instanceof Page) {\n            $event->resource = new PageResource($urlable);\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-8-complete-event-listener-setup",children:"Example 8: Complete Event Listener Setup"}),"\n",(0,s.jsx)(n.p,{children:"Complete setup for all URL events:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Providers;\n\nuse App\\Listeners\\Url\\AuditUrlOperations;\nuse App\\Listeners\\Url\\GenerateUrlableResource;\nuse App\\Listeners\\Url\\HandleUrlMatch;\nuse App\\Listeners\\Url\\InvalidateUrlCache;\nuse App\\Listeners\\Url\\RegenerateSitemap;\nuse App\\Listeners\\Url\\TrackUrlAnalytics;\nuse App\\Listeners\\Url\\UpdateSearchIndex;\nuse Illuminate\\Foundation\\Support\\Providers\\EventServiceProvider as ServiceProvider;\nuse JobMetric\\Url\\Events\\UrlChanged;\nuse JobMetric\\Url\\Events\\UrlMatched;\nuse JobMetric\\Url\\Events\\UrlableResourceEvent;\n\nclass EventServiceProvider extends ServiceProvider\n{\n    protected $listen = [\n        // After URL change\n        UrlChanged::class => [\n            AuditUrlOperations::class,\n            InvalidateUrlCache::class,\n            UpdateSearchIndex::class,\n            RegenerateSitemap::class,\n            TrackUrlAnalytics::class,\n        ],\n\n        // After URL match\n        UrlMatched::class => [\n            HandleUrlMatch::class,\n            AuditUrlOperations::class,\n            TrackUrlAnalytics::class,\n        ],\n\n        // Resource generation\n        UrlableResourceEvent::class => [\n            GenerateUrlableResource::class,\n        ],\n    ];\n\n    public function boot(): void\n    {\n        parent::boot();\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"event-timing",children:"Event Timing"}),"\n",(0,s.jsx)(n.h3,{id:"urlchanged",children:"UrlChanged"}),"\n",(0,s.jsxs)(n.p,{children:["Fired ",(0,s.jsx)(n.strong,{children:"after"})," the URL is saved to database:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Execution order:\n// 1. Validate slug and URL\n// 2. Check for conflicts\n// 3. Create or update URL record\n// 4. Save to database\n// 5. Fire UrlChanged \u2190 Event fired here\n// 6. Return model instance\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": This event fires for both new URLs and updates to existing URLs."]}),"\n",(0,s.jsx)(n.h3,{id:"urlmatched",children:"UrlMatched"}),"\n",(0,s.jsxs)(n.p,{children:["Fired ",(0,s.jsx)(n.strong,{children:"when"})," the fallback route matches an active URL:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Execution order:\n// 1. Find matching URL in database\n// 2. Load related model\n// 3. Fire UrlMatched \u2190 Event fired here\n// 4. Return response (set by listener)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important Notes"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The URL is ",(0,s.jsx)(n.strong,{children:"matched"})," before ",(0,s.jsx)(n.code,{children:"UrlMatched"})," fires"]}),"\n",(0,s.jsxs)(n.li,{children:["You can access ",(0,s.jsx)(n.strong,{children:"matched URL and model"})," in listeners"]}),"\n",(0,s.jsxs)(n.li,{children:["Response ",(0,s.jsx)(n.strong,{children:"must be set"})," by a listener"]}),"\n",(0,s.jsx)(n.li,{children:"If no listener sets response, default behavior applies"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"urlableresourceevent",children:"UrlableResourceEvent"}),"\n",(0,s.jsxs)(n.p,{children:["Fired ",(0,s.jsx)(n.strong,{children:"when"})," resource representation is needed:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Execution order:\n// 1. Access slugable_resource or urlable_resource\n// 2. Fire UrlableResourceEvent \u2190 Event fired here\n// 3. Return resource (set by listener)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important Notes"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Event fires ",(0,s.jsx)(n.strong,{children:"lazily"})," when resource is accessed"]}),"\n",(0,s.jsxs)(n.li,{children:["Resource ",(0,s.jsx)(n.strong,{children:"must be set"})," by a listener"]}),"\n",(0,s.jsx)(n.li,{children:"If no listener sets resource, null is returned"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"queued-events",children:"Queued Events"}),"\n",(0,s.jsx)(n.p,{children:"You can queue events for asynchronous processing:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Url;\n\nuse Illuminate\\Contracts\\Queue\\ShouldQueue;\nuse JobMetric\\Url\\Events\\UrlChanged;\n\nclass ProcessUrlAsync implements ShouldQueue\n{\n    public function handle(UrlChanged $event): void\n    {\n        $model = $event->model;\n        $new = $event->new;\n        \n        // Heavy processing that doesn't block the request\n        $this->updateSearchIndex($model, $new);\n        $this->regenerateSitemap($model);\n        $this->syncWithExternalService($model, $new);\n    }\n\n    protected function updateSearchIndex($model, $url): void\n    {\n        // Update search index\n    }\n\n    protected function regenerateSitemap($model): void\n    {\n        // Regenerate sitemap\n    }\n\n    protected function syncWithExternalService($model, $url): void\n    {\n        // Sync with external API\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"event-payload-details",children:"Event Payload Details"}),"\n",(0,s.jsx)(n.h3,{id:"urlchanged-1",children:"UrlChanged"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"readonly class UrlChanged implements DomainEvent\n{\n    public function __construct(\n        public Model $model,      // Model instance\n        public ?string $old,      // Previous URL (null on create)\n        public string $new,       // New active URL\n        public int $version       // Version number of new URL\n    ) {}\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Available Properties"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$model"}),": The model instance that received the URL change"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$old"}),": The previous URL (null on first creation)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$new"}),": The new active URL"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$version"}),": The version number of the new URL"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example Payload"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$event->model;        // Product instance\n$event->old;          // '/shop/laptops/macbook-pro-13' or null\n$event->new;          // '/shop/laptops/macbook-pro-14'\n$event->version;      // 2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"urlmatched-1",children:"UrlMatched"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class UrlMatched\n{\n    public Request $request;      // Incoming HTTP request\n    public Url $url;             // Matched Url model instance\n    public Model $urlable;       // Related model instance\n    public ?string $collection;  // Optional collection name\n    public mixed $response = null;  // Response to return (set by listener)\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Available Properties"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$request"}),": The incoming HTTP request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$url"}),": The matched ",(0,s.jsx)(n.code,{children:"Url"})," model instance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$urlable"}),": The related model instance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$collection"}),": Optional collection name"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$response"}),": Response to return (must be set by listener)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example Payload"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$event->request;      // Request instance\n$event->url;          // Url model instance\n$event->urlable;      // Product instance\n$event->collection;   // 'products' or null\n$event->response;     // null (set by listener)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"urlableresourceevent-1",children:"UrlableResourceEvent"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class UrlableResourceEvent\n{\n    public mixed $urlable;       // Model instance needing resource\n    public mixed $resource = null;  // Resource representation (set by listener)\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Available Properties"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$urlable"}),": The model instance that needs a resource"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$resource"}),": The resource representation (must be set by listener)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example Payload"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$event->urlable;      // Product instance\n$event->resource;     // null (set by listener)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use-events",children:"When to Use Events"}),"\n",(0,s.jsx)(n.p,{children:"Use events when you need to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache Management"}),": Invalidate or update cached URLs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Search Indexing"}),": Update search index when URLs change"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sitemap Generation"}),": Regenerate sitemaps on URL changes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics"}),": Track URL operations for analytics"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Audit Logging"}),": Log URL changes for compliance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fallback Routing"}),": Handle unmatched URLs with custom logic"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resource Transformation"}),": Transform models into API resources"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SEO Optimization"}),": Track URL changes for SEO purposes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Integration"}),": Integrate with external services"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Side Effects"}),": Perform side effects without coupling"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(i.A,{to:"/packages/laravel-url/deep-diving/has-url",children:"HasUrl"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(i.A,{to:"/packages/laravel-url/deep-diving/full-url-controller",children:"FullUrlController"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(i.A,{to:"/packages/laravel-url/deep-diving/models/url",children:"Url Model"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(i.A,{to:"/packages/laravel-url/deep-diving/models/slug",children:"Slug Model"}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);