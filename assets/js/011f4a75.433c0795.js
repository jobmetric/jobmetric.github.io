"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[7622],{1620(e,n,l){l.r(n),l.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"laravel-flow/deep-diving/has-flow","title":"HasFlow Trait","description":"The HasFlow trait is a simplified version of HasWorkflow that directly binds a model to a specific flow by ID. This trait is perfect for projects where a model has only one flow and you don\'t need complex flow selection logic.","source":"@site/packages/laravel-flow/deep-diving/has-flow.md","sourceDirName":"laravel-flow/deep-diving","slug":"/laravel-flow/deep-diving/has-flow","permalink":"/packages/laravel-flow/deep-diving/has-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/has-flow.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"HasFlow"},"sidebar":"packagesSidebar","previous":{"title":"Showcase","permalink":"/packages/laravel-flow/showcase"},"next":{"title":"HasWorkflow","permalink":"/packages/laravel-flow/deep-diving/has-workflow"}}');var s=l(4848),i=l(8453);const r={sidebar_position:1,sidebar_label:"HasFlow"},d="HasFlow Trait",t={},c=[{value:"When to Use HasFlow",id:"when-to-use-hasflow",level:2},{value:"HasFlow vs HasWorkflow",id:"hasflow-vs-hasworkflow",level:2},{value:"Namespace",id:"namespace",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Status Column",id:"status-column",level:3},{value:"Flow ID Resolution",id:"flow-id-resolution",level:3},{value:"Flow ID Resolution Methods",id:"flow-id-resolution-methods",level:2},{value:"Method 1: Override flowId()",id:"method-1-override-flowid",level:3},{value:"Method 2: Use flow_id Attribute",id:"method-2-use-flow_id-attribute",level:3},{value:"Method 3: Use Configuration",id:"method-3-use-configuration",level:3},{value:"How HasFlow Works",id:"how-hasflow-works",level:2},{value:"Internal Implementation",id:"internal-implementation",level:3},{value:"Automatic Flow Binding",id:"automatic-flow-binding",level:2},{value:"Lifecycle Events",id:"lifecycle-events",level:3},{value:"Understanding resolveFlow()",id:"understanding-resolveflow",level:3},{value:"Working with Bound Flows",id:"working-with-bound-flows",level:2},{value:"Get Bound Flow",id:"get-bound-flow",level:3},{value:"Bind Flow",id:"bind-flow",level:3},{value:"Rebind Flow",id:"rebind-flow",level:3},{value:"Unbind Flow",id:"unbind-flow",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"Advanced Example with Dynamic Flow ID",id:"advanced-example-with-dynamic-flow-id",level:2},{value:"Real-World Scenarios",id:"real-world-scenarios",level:2},{value:"Scenario 1: Simple Order Processing",id:"scenario-1-simple-order-processing",level:3},{value:"Scenario 2: Content Approval",id:"scenario-2-content-approval",level:3},{value:"Scenario 3: Dynamic Flow Based on Model Attribute",id:"scenario-3-dynamic-flow-based-on-model-attribute",level:3},{value:"Scenario 4: Configuration-Based Flow",id:"scenario-4-configuration-based-flow",level:3},{value:"Testing and Debugging",id:"testing-and-debugging",level:2},{value:"Testing Flow ID Resolution",id:"testing-flow-id-resolution",level:3},{value:"Debugging Flow Binding",id:"debugging-flow-binding",level:3},{value:"Testing bindFlow with ID",id:"testing-bindflow-with-id",level:3},{value:"Verifying Flow Exists",id:"verifying-flow-exists",level:3},{value:"Common Issues",id:"common-issues",level:3},{value:"Understanding the Internal Mechanism",id:"understanding-the-internal-mechanism",level:2},{value:"Relationship with HasWorkflow",id:"relationship-with-hasworkflow",level:3},{value:"How forceFlowIdResolver Works",id:"how-forceflowidresolver-works",level:3},{value:"Why onlyActive and evaluateRollout are Disabled",id:"why-onlyactive-and-evaluaterollout-are-disabled",level:3},{value:"Overriding buildFlowPicker in HasFlow",id:"overriding-buildflowpicker-in-hasflow",level:3},{value:"flowSubjectCollection Support",id:"flowsubjectcollection-support",level:3},{value:"Differences from HasWorkflow",id:"differences-from-hasworkflow",level:2},{value:"Why HasFlow Disables Some Features",id:"why-hasflow-disables-some-features",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Eager Loading",id:"eager-loading",level:3},{value:"Flow ID Resolution",id:"flow-id-resolution-1",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Flow Not Binding",id:"flow-not-binding",level:3},{value:"Flow ID Not Found",id:"flow-id-not-found",level:3},{value:"Flow ID Returns Null",id:"flow-id-returns-null",level:3},{value:"Binding Flow Manually After Creation",id:"binding-flow-manually-after-creation",level:3},{value:"Error Handling in bindFlow()",id:"error-handling-in-bindflow",level:3},{value:"Status Column Missing",id:"status-column-missing",level:3},{value:"Status Management",id:"status-management",level:2},{value:"Current Status Value",id:"current-status-value",level:3},{value:"Status Enum Support",id:"status-enum-support",level:3},{value:"Database Setup",id:"database-setup",level:2},{value:"Migration Example",id:"migration-example",level:3},{value:"Flow Setup",id:"flow-setup",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"hasflow-trait",children:"HasFlow Trait"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"HasFlow"})," trait is a simplified version of ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," that directly binds a model to a specific flow by ID. This trait is perfect for projects where a model has only one flow and you don't need complex flow selection logic."]}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use-hasflow",children:"When to Use HasFlow"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Use ",(0,s.jsx)(n.code,{children:"HasFlow"})," when you have:"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Single flow per model"}),": One workflow for each model type"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fixed flow assignment"}),": Flow ID is known and doesn't change dynamically"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Simple requirements"}),": No need for complex selection logic based on scope, collection, or rollout"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Straightforward projects"}),": 90% of typical use cases fit this pattern"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example scenarios:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Simple order processing with one workflow"}),"\n",(0,s.jsx)(n.li,{children:"Basic content approval with a single workflow"}),"\n",(0,s.jsx)(n.li,{children:"Standard document workflows"}),"\n",(0,s.jsx)(n.li,{children:"Projects where workflow complexity is minimal"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"hasflow-vs-hasworkflow",children:"HasFlow vs HasWorkflow"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Choose ",(0,s.jsx)(n.code,{children:"HasFlow"})," if:"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You have a single, fixed flow per model type"}),"\n",(0,s.jsx)(n.li,{children:"Flow selection is simple and doesn't change"}),"\n",(0,s.jsx)(n.li,{children:"You prefer explicit flow ID assignment"}),"\n",(0,s.jsx)(n.li,{children:"Your project is straightforward with minimal workflow complexity"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Choose ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," if:"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You have multiple flows for the same model type"}),"\n",(0,s.jsx)(n.li,{children:"Flow selection depends on dynamic criteria (user, collection, environment, etc.)"}),"\n",(0,s.jsx)(n.li,{children:"You need advanced features like rollout percentages or active windows"}),"\n",(0,s.jsx)(n.li,{children:"Your workflow requirements are complex and may change over time"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For most simple projects (90% of use cases), ",(0,s.jsx)(n.code,{children:"HasFlow"})," is recommended. For complex scenarios with multiple flows and dynamic selection, use ",(0,s.jsx)(n.code,{children:"HasWorkflow"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\HasFlow\n"})}),"\n",(0,s.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,s.jsx)(n.p,{children:"To use the HasFlow trait, simply add it to your model:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasFlow;\n\nclass Order extends Model\n{\n    use HasFlow;\n\n    protected $fillable = [\n        'user_id',\n        'status',\n    ];\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsx)(n.h3,{id:"status-column",children:"Status Column"}),"\n",(0,s.jsxs)(n.p,{children:["Your model ",(0,s.jsx)(n.strong,{children:"must"})," have a ",(0,s.jsx)(n.code,{children:"status"})," column in the database table, just like ",(0,s.jsx)(n.code,{children:"HasWorkflow"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Migration example\nSchema::create('orders', function (Blueprint $table) {\n    $table->id();\n    $table->string('status')->nullable();\n    // ... other columns\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"flow-id-resolution",children:"Flow ID Resolution"}),"\n",(0,s.jsx)(n.p,{children:"You need to provide a way for the trait to get the Flow ID. There are several options:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Override ",(0,s.jsx)(n.code,{children:"flowId()"})," method"]})," (recommended)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Use ",(0,s.jsx)(n.code,{children:"flow_id"})," attribute"]})," (if your table has this column)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use configuration"})," (for global flows)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"flow-id-resolution-methods",children:"Flow ID Resolution Methods"}),"\n",(0,s.jsx)(n.h3,{id:"method-1-override-flowid",children:"Method 1: Override flowId()"}),"\n",(0,s.jsxs)(n.p,{children:["The recommended approach is to override the ",(0,s.jsx)(n.code,{children:"flowId()"})," method:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasFlow;\n\n    protected function flowId(): ?int\n    {\n        // Return a fixed flow ID\n        return 1;\n        \n        // Or from config\n        return config('flows.order_flow_id');\n        \n        // Or based on model attribute\n        return $this->getAttribute('workflow_id');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"method-2-use-flow_id-attribute",children:"Method 2: Use flow_id Attribute"}),"\n",(0,s.jsxs)(n.p,{children:["If your model has a ",(0,s.jsx)(n.code,{children:"flow_id"})," attribute, it will be used automatically:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Migration\nSchema::create('orders', function (Blueprint $table) {\n    $table->id();\n    $table->unsignedBigInteger('flow_id')->nullable();\n    $table->string('status')->nullable();\n});\n\n// Model\nclass Order extends Model\n{\n    use HasFlow;\n    \n    // flowId() will automatically use the flow_id attribute\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," If you use ",(0,s.jsx)(n.code,{children:"flow_id"})," as an attribute but don't want it saved to the database, you can handle it in model events:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasFlow;\n\n    private ?int $flowIdTemp = null;\n\n    protected static function boot(): void\n    {\n        parent::boot();\n\n        static::creating(function (self $model): void {\n            $flowId = $model->getAttribute('flow_id');\n            if ($flowId !== null) {\n                $model->flowIdTemp = (int) $flowId;\n                unset($model->attributes['flow_id']);\n            }\n        });\n\n        static::saved(function (self $model): void {\n            if ($model->flowIdTemp !== null) {\n                $model->setAttribute('flow_id', $model->flowIdTemp);\n                $model->flowIdTemp = null;\n            }\n        });\n    }\n\n    protected function flowId(): ?int\n    {\n        if ($this->flowIdTemp !== null) {\n            return $this->flowIdTemp;\n        }\n\n        return $this->getAttribute('flow_id');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"method-3-use-configuration",children:"Method 3: Use Configuration"}),"\n",(0,s.jsx)(n.p,{children:"You can also use Laravel's configuration system:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// config/flows.php\nreturn [\n    'order_flow_id' => 1,\n];\n\n// Model\nclass Order extends Model\n{\n    use HasFlow;\n\n    protected function flowId(): ?int\n    {\n        return config('flows.order_flow_id');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"how-hasflow-works",children:"How HasFlow Works"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HasFlow"})," is built on top of ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," and simplifies flow selection by using a direct Flow ID resolver instead of complex picker logic. Here's how it works:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Uses HasWorkflow internally"}),": All ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," functionality is available"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Overrides ",(0,s.jsx)(n.code,{children:"buildFlowPicker()"})]}),": Uses ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver()"})," to directly resolve Flow by ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Disables complex features"}),": Sets ",(0,s.jsx)(n.code,{children:"onlyActive(false)"})," and ",(0,s.jsx)(n.code,{children:"evaluateRollout(false)"})," since we're binding by ID directly"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Simplifies selection"}),": No need for subject scope, environment, channel, or rollout logic"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"internal-implementation",children:"Internal Implementation"}),"\n",(0,s.jsxs)(n.p,{children:["When you use ",(0,s.jsx)(n.code,{children:"HasFlow"}),", it:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Internally, HasFlow does this:\nprotected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    // Set basic configuration\n    $builder->subjectType(static::class)\n        ->subjectCollection($this->flowSubjectCollection())\n        ->onlyActive(false)        // Disabled - we bind by ID directly\n        ->evaluateRollout(false)    // Disabled - no rollout needed\n        ->timeNow(Carbon::now('UTC'))\n        ->orderByDefault();\n\n    // Use forceFlowIdResolver to directly get Flow by ID\n    $builder->forceFlowIdResolver(function ($model) {\n        return $model->resolveFlow()?->getKey();\n    });\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," bypasses all the complex selection logic and directly returns the Flow ID from your ",(0,s.jsx)(n.code,{children:"flowId()"})," method."]}),"\n",(0,s.jsx)(n.h2,{id:"automatic-flow-binding",children:"Automatic Flow Binding"}),"\n",(0,s.jsxs)(n.p,{children:["When a model using ",(0,s.jsx)(n.code,{children:"HasFlow"})," is created, the trait automatically:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Calls ",(0,s.jsx)(n.code,{children:"flowId()"})," to get the Flow ID"]}),"\n",(0,s.jsx)(n.li,{children:"Resolves the Flow model from the database"}),"\n",(0,s.jsxs)(n.li,{children:["Uses ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," to bypass complex picker logic"]}),"\n",(0,s.jsxs)(n.li,{children:["Binds the flow to the model via the ",(0,s.jsx)(n.code,{children:"flow_uses"})," table"]}),"\n",(0,s.jsx)(n.li,{children:"Sets the initial status if the flow has a START state"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order = Order::create([\n    'user_id' => 1,\n    'status' => null, // Will be set automatically if flow has START state\n]);\n\n// Flow is automatically bound\n$boundFlow = $order->boundFlow();\n"})}),"\n",(0,s.jsx)(n.h3,{id:"lifecycle-events",children:"Lifecycle Events"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HasFlow"})," uses the same lifecycle events as ",(0,s.jsx)(n.code,{children:"HasWorkflow"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"creating"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Calls ",(0,s.jsx)(n.code,{children:"flowId()"})," to get Flow ID"]}),"\n",(0,s.jsxs)(n.li,{children:["Calls ",(0,s.jsx)(n.code,{children:"resolveFlow()"})," to find Flow model"]}),"\n",(0,s.jsxs)(n.li,{children:["Uses ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," to bypass picker logic"]}),"\n",(0,s.jsxs)(n.li,{children:["Stores Flow ID in ",(0,s.jsx)(n.code,{children:"selectedFlowIdForBinding"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"created"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Uses stored ",(0,s.jsx)(n.code,{children:"selectedFlowIdForBinding"})," or calls ",(0,s.jsx)(n.code,{children:"resolveFlow()"})," again"]}),"\n",(0,s.jsx)(n.li,{children:"Creates FlowUse record if Flow was found"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The difference is that ",(0,s.jsx)(n.code,{children:"HasFlow"})," uses ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," instead of the complex FlowPicker logic."]}),"\n",(0,s.jsx)(n.h3,{id:"understanding-resolveflow",children:"Understanding resolveFlow()"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"resolveFlow()"})," method is called internally to convert Flow ID to Flow model:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Inside HasFlow\nprotected function resolveFlow(): ?Flow\n{\n    $flowId = $this->flowId(); // Get ID from your method\n    if ($flowId !== null) {\n        return Flow::query()->find($flowId); // Find Flow model\n    }\n    return null;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This method:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Calls your ",(0,s.jsx)(n.code,{children:"flowId()"})," method"]}),"\n",(0,s.jsx)(n.li,{children:"Queries the database for the Flow"}),"\n",(0,s.jsxs)(n.li,{children:["Returns ",(0,s.jsx)(n.code,{children:"null"})," if Flow ID is null or Flow doesn't exist"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," If ",(0,s.jsx)(n.code,{children:"resolveFlow()"})," returns ",(0,s.jsx)(n.code,{children:"null"}),", no binding will be created (no error thrown)."]}),"\n",(0,s.jsx)(n.h2,{id:"working-with-bound-flows",children:"Working with Bound Flows"}),"\n",(0,s.jsxs)(n.p,{children:["All methods from ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," are available in ",(0,s.jsx)(n.code,{children:"HasFlow"})," since it uses ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," internally:"]}),"\n",(0,s.jsx)(n.h3,{id:"get-bound-flow",children:"Get Bound Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order = Order::find(1);\n\n// Get bound flow (lazy loading)\n$flow = $order->boundFlow();\n\n// Eager load for better performance\n$order = Order::withFlow()->find(1);\n$flow = $order->boundFlow();\n"})}),"\n",(0,s.jsx)(n.h3,{id:"bind-flow",children:"Bind Flow"}),"\n",(0,s.jsx)(n.p,{children:"Manually bind a specific flow (accepts Flow instance or ID):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n\n$order = Order::find(1);\n\n// Bind by Flow instance\n$flow = Flow::show($flowId)->getData();\n$order->bindFlow($flow);\n\n// Bind by Flow ID (HasFlow specific feature)\n$order->bindFlow(1);\n\n// With custom timestamp\n$order->bindFlow(1, Carbon::now()->subDays(1));\n"})}),"\n",(0,s.jsx)(n.h3,{id:"rebind-flow",children:"Rebind Flow"}),"\n",(0,s.jsxs)(n.p,{children:["Re-pick and rebind a flow. This will call ",(0,s.jsx)(n.code,{children:"flowId()"})," again and rebind:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Rebind will use the flowId() method again\n$flow = $order->rebindFlow();\n\n// With custom tuner (though less useful in HasFlow)\n$flow = $order->rebindFlow(function ($builder) {\n    // Note: forceFlowIdResolver will still bypass most of this\n    $builder->environment('staging');\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How it works:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Creates a new ",(0,s.jsx)(n.code,{children:"FlowPickerBuilder"})," with your ",(0,s.jsx)(n.code,{children:"buildFlowPicker()"})," configuration"]}),"\n",(0,s.jsx)(n.li,{children:"Applies the tuner callback if provided"}),"\n",(0,s.jsxs)(n.li,{children:["Uses ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," to get Flow ID from ",(0,s.jsx)(n.code,{children:"flowId()"})]}),"\n",(0,s.jsx)(n.li,{children:"Finds and binds the Flow"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Since ",(0,s.jsx)(n.code,{children:"HasFlow"})," uses ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"}),", the tuner callback has limited effect. Most builder options are bypassed. If you need to customize rebinding logic, consider using ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," instead."]}),"\n",(0,s.jsx)(n.h3,{id:"unbind-flow",children:"Unbind Flow"}),"\n",(0,s.jsx)(n.p,{children:"Remove the flow binding:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order->unbindFlow();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsx)(n.p,{children:"Here's a complete example of using HasFlow:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasFlow;\nuse App\\Enums\\OrderStatus;\n\nclass Order extends Model\n{\n    use HasFlow;\n\n    protected $fillable = [\n        'user_id',\n        'status',\n        'total',\n    ];\n\n    protected $casts = [\n        'status' => OrderStatus::class,\n        'total' => 'decimal:2',\n    ];\n\n    protected function flowId(): ?int\n    {\n        // Return the flow ID for orders\n        // This could come from config, database, or be hardcoded\n        return config('flows.order_flow_id', 1);\n    }\n}\n\n// Usage\n$order = Order::create([\n    'user_id' => 1,\n    'total' => 100.00,\n]);\n\n// Flow is automatically bound\n$flow = $order->boundFlow();\n\n// Get current status\n$status = $order->flowCurrentStatusValue();\n\n// Execute a transition\nuse JobMetric\\Flow\\Facades\\FlowTransition;\n\nFlowTransition::runner('start_processing', $order);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced-example-with-dynamic-flow-id",children:"Advanced Example with Dynamic Flow ID"}),"\n",(0,s.jsx)(n.p,{children:"If you need to select flow based on model attributes but still want simplicity:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasFlow;\n\n    protected $fillable = [\n        'user_id',\n        'order_type', // 'premium' or 'standard'\n        'status',\n    ];\n\n    protected function flowId(): ?int\n    {\n        // Select flow based on order type\n        $orderType = $this->getAttribute('order_type');\n        \n        return match($orderType) {\n            'premium' => config('flows.premium_order_flow_id'),\n            'standard' => config('flows.standard_order_flow_id'),\n            default => config('flows.default_order_flow_id'),\n        };\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," If your flow selection logic becomes more complex (involving environment, channel, rollout, etc.), consider switching to ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," instead."]}),"\n",(0,s.jsx)(n.h2,{id:"real-world-scenarios",children:"Real-World Scenarios"}),"\n",(0,s.jsx)(n.h3,{id:"scenario-1-simple-order-processing",children:"Scenario 1: Simple Order Processing"}),"\n",(0,s.jsx)(n.p,{children:"Single workflow for all orders:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasFlow;\n\n    protected function flowId(): ?int\n    {\n        return config('flows.order_flow_id', 1);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Create the flow once\n$flow = Flow::store([\n    'subject_type' => Order::class,\n    'version' => 1,\n])->getData();\n\n// Store in config\nconfig(['flows.order_flow_id' => $flow->id]);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"scenario-2-content-approval",children:"Scenario 2: Content Approval"}),"\n",(0,s.jsx)(n.p,{children:"Single workflow for content approval:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Article extends Model\n{\n    use HasFlow;\n\n    protected function flowId(): ?int\n    {\n        // All articles use the same approval workflow\n        return 1; // Hardcoded flow ID\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"scenario-3-dynamic-flow-based-on-model-attribute",children:"Scenario 3: Dynamic Flow Based on Model Attribute"}),"\n",(0,s.jsx)(n.p,{children:"Select flow based on a simple attribute:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasFlow;\n\n    protected $fillable = [\n        'order_type', // 'premium' or 'standard'\n        'status',\n    ];\n\n    protected function flowId(): ?int\n    {\n        $orderType = $this->getAttribute('order_type');\n        \n        return match($orderType) {\n            'premium' => config('flows.premium_order_flow_id'),\n            'standard' => config('flows.standard_order_flow_id'),\n            default => config('flows.default_order_flow_id'),\n        };\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"When to switch to HasWorkflow:"})}),"\n",(0,s.jsx)(n.p,{children:"If you need to add:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Environment-based selection"}),"\n",(0,s.jsx)(n.li,{children:"Channel-based selection"}),"\n",(0,s.jsx)(n.li,{children:"Rollout percentages"}),"\n",(0,s.jsx)(n.li,{children:"Active time windows"}),"\n",(0,s.jsx)(n.li,{children:"Subject scope partitioning"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Then switch to ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," instead."]}),"\n",(0,s.jsx)(n.h3,{id:"scenario-4-configuration-based-flow",children:"Scenario 4: Configuration-Based Flow"}),"\n",(0,s.jsx)(n.p,{children:"Flow ID from configuration file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// config/flows.php\nreturn [\n    'order_flow_id' => env('ORDER_FLOW_ID', 1),\n    'invoice_flow_id' => env('INVOICE_FLOW_ID', 2),\n];\n\n// Model\nclass Order extends Model\n{\n    use HasFlow;\n\n    protected function flowId(): ?int\n    {\n        return config('flows.order_flow_id');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This allows easy flow management via environment variables."}),"\n",(0,s.jsx)(n.h2,{id:"testing-and-debugging",children:"Testing and Debugging"}),"\n",(0,s.jsx)(n.h3,{id:"testing-flow-id-resolution",children:"Testing Flow ID Resolution"}),"\n",(0,s.jsxs)(n.p,{children:["Test that ",(0,s.jsx)(n.code,{children:"flowId()"})," returns the correct value:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order = Order::make(['user_id' => 1]);\n\n// Test flowId() method\n$flowId = $order->flowId();\nassert($flowId === 1, 'Flow ID should be 1');\n\n// Test resolveFlow()\n$flow = $order->resolveFlow();\nassert($flow !== null, 'Flow should be found');\nassert($flow->id === 1, 'Flow ID should match');\n"})}),"\n",(0,s.jsx)(n.h3,{id:"debugging-flow-binding",children:"Debugging Flow Binding"}),"\n",(0,s.jsx)(n.p,{children:"Check if flow binding is working:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order = Order::create([...]);\n\n// Check if flow was bound\nif ($order->boundFlow()) {\n    logger()->info('Flow bound', [\n        'flow_id' => $order->boundFlow()->id,\n    ]);\n} else {\n    logger()->warning('No flow bound', [\n        'order_id' => $order->id,\n        'flow_id_from_method' => $order->flowId(),\n    ]);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing-bindflow-with-id",children:"Testing bindFlow with ID"}),"\n",(0,s.jsxs)(n.p,{children:["Test that ",(0,s.jsx)(n.code,{children:"bindFlow()"})," accepts Flow ID:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order = Order::create([...]);\n\n// Test binding by ID\ntry {\n    $order->bindFlow(1);\n    assert($order->boundFlow()->id === 1, 'Flow should be bound');\n} catch (LogicException $e) {\n    // Flow ID doesn't exist\n    logger()->error('Flow not found', ['flow_id' => 1]);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"verifying-flow-exists",children:"Verifying Flow Exists"}),"\n",(0,s.jsx)(n.p,{children:"Before using a Flow ID, verify it exists:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n\n$flowId = config('flows.order_flow_id');\n$flow = Flow::show($flowId);\n\nif (!$flow->isSuccess()) {\n    throw new \\Exception(\"Flow with ID {$flowId} does not exist\");\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Issue: flowId() returns null"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Check your flowId() implementation\nprotected function flowId(): ?int\n{\n    $id = config('flows.order_flow_id');\n    \n    // Add logging for debugging\n    if (config('app.debug')) {\n        logger()->debug('Flow ID resolution', [\n            'config_value' => $id,\n            'model_id' => $this->id,\n        ]);\n    }\n    \n    return $id;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Issue: Flow not found"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Verify flow exists in database\n$flowId = $order->flowId();\n$flow = Flow::query()->find($flowId);\n\nif (!$flow) {\n    // Flow doesn't exist - create it or update flowId()\n    logger()->error('Flow not found', ['flow_id' => $flowId]);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"understanding-the-internal-mechanism",children:"Understanding the Internal Mechanism"}),"\n",(0,s.jsx)(n.h3,{id:"relationship-with-hasworkflow",children:"Relationship with HasWorkflow"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HasFlow"})," is essentially a simplified wrapper around ",(0,s.jsx)(n.code,{children:"HasWorkflow"}),". It:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Uses HasWorkflow trait"}),": All ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," methods are available"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Overrides buildFlowPicker()"}),": Replaces complex picker logic with direct ID resolution"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Uses forceFlowIdResolver"}),": Bypasses all selection criteria and directly returns Flow ID"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"how-forceflowidresolver-works",children:"How forceFlowIdResolver Works"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," is a special callback that, when set, bypasses all FlowPicker logic:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Inside HasFlow::buildFlowPicker()\n$builder->forceFlowIdResolver(function (Model $model): ?int {\n    $flow = $model->resolveFlow(); // Calls flowId() and finds Flow\n    return $flow?->getKey(); // Returns Flow ID directly\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," is set:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"All other selection criteria (environment, channel, rollout, etc.) are ignored"}),"\n",(0,s.jsx)(n.li,{children:"The FlowPicker directly uses the returned Flow ID"}),"\n",(0,s.jsx)(n.li,{children:"No complex querying or filtering happens"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"why-onlyactive-and-evaluaterollout-are-disabled",children:"Why onlyActive and evaluateRollout are Disabled"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"HasFlow::buildFlowPicker()"}),", you'll notice:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"->onlyActive(false)        // Disabled\n->evaluateRollout(false)   // Disabled\n"})}),"\n",(0,s.jsx)(n.p,{children:"These are disabled because:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Direct ID binding"}),": You're explicitly choosing a Flow by ID, so active status checks aren't needed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Simplified logic"}),": No need to check rollout percentages when you know the exact Flow ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),": Faster resolution without additional checks"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you need these features, you should use ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," instead."]}),"\n",(0,s.jsx)(n.h3,{id:"overriding-buildflowpicker-in-hasflow",children:"Overriding buildFlowPicker in HasFlow"}),"\n",(0,s.jsxs)(n.p,{children:["While ",(0,s.jsx)(n.code,{children:"HasFlow"})," provides a simplified ",(0,s.jsx)(n.code,{children:"buildFlowPicker()"}),", you can still override it if needed:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasFlow;\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        // Call parent to set up forceFlowIdResolver\n        parent::buildFlowPicker($builder);\n\n        // You can still add custom logic if needed\n        // But remember: forceFlowIdResolver will bypass most of it\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Since ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," bypasses most selection logic, customizing ",(0,s.jsx)(n.code,{children:"buildFlowPicker()"})," in ",(0,s.jsx)(n.code,{children:"HasFlow"})," is rarely needed. If you find yourself needing to customize it extensively, consider using ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," instead."]}),"\n",(0,s.jsx)(n.h3,{id:"flowsubjectcollection-support",children:"flowSubjectCollection Support"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HasFlow"})," includes ",(0,s.jsx)(n.code,{children:"flowSubjectCollection()"})," for compatibility with ",(0,s.jsx)(n.code,{children:"HasWorkflow"}),", but it's not used in flow selection (since we bind by ID directly):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasFlow;\n\n    protected $fillable = [\n        'collection',\n        'status',\n    ];\n\n    // This is available but not used for flow selection\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('collection');\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," While ",(0,s.jsx)(n.code,{children:"flowSubjectCollection()"})," is available, it doesn't affect flow selection in ",(0,s.jsx)(n.code,{children:"HasFlow"})," because ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})," bypasses collection-based filtering. If you need collection-based flow selection, use ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," instead."]}),"\n",(0,s.jsx)(n.h2,{id:"differences-from-hasworkflow",children:"Differences from HasWorkflow"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"HasFlow"}),(0,s.jsx)(n.th,{children:"HasWorkflow"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Flow Selection"}),(0,s.jsxs)(n.td,{children:["Direct by ID via ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})]}),(0,s.jsx)(n.td,{children:"Complex picker with multiple criteria"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Subject Scope"}),(0,s.jsx)(n.td,{children:"Not used"}),(0,s.jsx)(n.td,{children:"Supported"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Subject Collection"}),(0,s.jsx)(n.td,{children:"Supported (for compatibility)"}),(0,s.jsx)(n.td,{children:"Supported"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Environment"}),(0,s.jsx)(n.td,{children:"Not used"}),(0,s.jsx)(n.td,{children:"Supported"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Channel"}),(0,s.jsx)(n.td,{children:"Not used"}),(0,s.jsx)(n.td,{children:"Supported"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Rollout Percentage"}),(0,s.jsxs)(n.td,{children:["Disabled (",(0,s.jsx)(n.code,{children:"evaluateRollout(false)"}),")"]}),(0,s.jsx)(n.td,{children:"Supported"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Active Window"}),(0,s.jsxs)(n.td,{children:["Disabled (",(0,s.jsx)(n.code,{children:"onlyActive(false)"}),")"]}),(0,s.jsx)(n.td,{children:"Supported"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Flow Picker"}),(0,s.jsxs)(n.td,{children:["Uses ",(0,s.jsx)(n.code,{children:"forceFlowIdResolver"})]}),(0,s.jsx)(n.td,{children:"Uses full FlowPicker logic"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Complexity"}),(0,s.jsx)(n.td,{children:"Simple"}),(0,s.jsx)(n.td,{children:"Advanced"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Use Case"}),(0,s.jsx)(n.td,{children:"Single flow per model"}),(0,s.jsx)(n.td,{children:"Multiple flows per model"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Base Trait"}),(0,s.jsx)(n.td,{children:"Built on HasWorkflow"}),(0,s.jsx)(n.td,{children:"Standalone"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"why-hasflow-disables-some-features",children:"Why HasFlow Disables Some Features"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HasFlow"})," sets ",(0,s.jsx)(n.code,{children:"onlyActive(false)"})," and ",(0,s.jsx)(n.code,{children:"evaluateRollout(false)"})," because:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Direct ID binding"}),": When you specify a Flow ID directly, you don't need active window checks"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Simplified logic"}),": No need for rollout percentages when binding by ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),": Faster flow resolution without complex picker logic"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Explicit control"}),": You control which flow to use via ",(0,s.jsx)(n.code,{children:"flowId()"})," method"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you need these features, use ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," instead."]}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"eager-loading",children:"Eager Loading"}),"\n",(0,s.jsxs)(n.p,{children:["Since ",(0,s.jsx)(n.code,{children:"HasFlow"})," uses ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," internally, you can use the same eager loading:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good: Eager load flows\n$orders = Order::withFlow()->get();\n\n// \u274c Bad: N+1 queries\n$orders = Order::all();\nforeach ($orders as $order) {\n    $flow = $order->boundFlow(); // Query for each order\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"flow-id-resolution-1",children:"Flow ID Resolution"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"flowId()"})," method is called during model creation. Make sure it's efficient:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good: Simple, fast\nprotected function flowId(): ?int\n{\n    return config('flows.order_flow_id');\n}\n\n// \u26a0\ufe0f Acceptable: Database lookup (cache if possible)\nprotected function flowId(): ?int\n{\n    return Cache::remember('order_flow_id', 3600, function () {\n        return Flow::where('subject_type', static::class)\n            ->where('is_default', true)\n            ->value('id');\n    });\n}\n\n// \u274c Bad: Complex logic in flowId()\nprotected function flowId(): ?int\n{\n    // Avoid heavy computations here\n    // This runs during every model creation\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Use ",(0,s.jsx)(n.code,{children:"flowId()"})," method"]})," for clean, maintainable code"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Store flow IDs in configuration"})," for easy management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Use ",(0,s.jsx)(n.code,{children:"withFlow()"})," scope"]})," when loading multiple models"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Override ",(0,s.jsx)(n.code,{children:"flowId()"})]})," rather than using attributes when possible"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Keep ",(0,s.jsx)(n.code,{children:"flowId()"})," simple"]})," - avoid heavy computations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Consider ",(0,s.jsx)(n.code,{children:"HasWorkflow"})]})," if your requirements become complex"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache flow IDs"})," if they come from database lookups"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"flow-not-binding",children:"Flow Not Binding"}),"\n",(0,s.jsx)(n.p,{children:"If a flow is not being bound:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Check that ",(0,s.jsx)(n.code,{children:"flowId()"})," returns a valid Flow ID"]}),"\n",(0,s.jsx)(n.li,{children:"Verify the flow exists in the database"}),"\n",(0,s.jsxs)(n.li,{children:["Ensure the flow's ",(0,s.jsx)(n.code,{children:"subject_type"})," matches your model class"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"flow-id-not-found",children:"Flow ID Not Found"}),"\n",(0,s.jsx)(n.p,{children:"If you get an error about flow not found:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Error: Flow with ID 1 not found.\n\n// Solution: Ensure the flow exists\nuse JobMetric\\Flow\\Facades\\Flow;\n\n$flow = Flow::show(1);\nif (!$flow->isSuccess()) {\n    // Flow doesn't exist, create it or use a different ID\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," If ",(0,s.jsx)(n.code,{children:"flowId()"})," returns ",(0,s.jsx)(n.code,{children:"null"})," or the Flow doesn't exist, no error is thrown. The model will be created without a flow binding. This is by design to allow models to exist without workflows."]}),"\n",(0,s.jsx)(n.h3,{id:"flow-id-returns-null",children:"Flow ID Returns Null"}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"flowId()"})," returns ",(0,s.jsx)(n.code,{children:"null"}),", no binding is created:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"protected function flowId(): ?int\n{\n    // If this returns null, no flow binding is created\n    // No error is thrown - this is intentional\n    return null;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This is useful when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Flow hasn't been created yet"}),"\n",(0,s.jsx)(n.li,{children:"You want to bind flows manually later"}),"\n",(0,s.jsx)(n.li,{children:"Some models shouldn't have workflows"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"binding-flow-manually-after-creation",children:"Binding Flow Manually After Creation"}),"\n",(0,s.jsx)(n.p,{children:"If a model was created without a flow binding, you can bind it later:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order = Order::create([...]); // No flow binding\n\n// Bind flow later\n$order->bindFlow(1); // Or $order->bindFlow($flow)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"error-handling-in-bindflow",children:"Error Handling in bindFlow()"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"bindFlow()"})," method throws exceptions for invalid inputs:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"try {\n    // Invalid Flow ID\n    $order->bindFlow(999); // Throws LogicException if Flow doesn't exist\n    \n    // Invalid type\n    $order->bindFlow('invalid'); // Throws LogicException\n} catch (LogicException $e) {\n    // Handle error\n    logger()->error('Failed to bind flow', ['error' => $e->getMessage()]);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"status-column-missing",children:"Status Column Missing"}),"\n",(0,s.jsxs)(n.p,{children:["Same as ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," - ensure your model has a ",(0,s.jsx)(n.code,{children:"status"})," column:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"Schema::table('orders', function (Blueprint $table) {\n    $table->string('status')->nullable();\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"status-management",children:"Status Management"}),"\n",(0,s.jsxs)(n.p,{children:["Since ",(0,s.jsx)(n.code,{children:"HasFlow"})," uses ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," internally, all status management methods are available:"]}),"\n",(0,s.jsx)(n.h3,{id:"current-status-value",children:"Current Status Value"}),"\n",(0,s.jsx)(n.p,{children:"Get the current status as a scalar value (handles enum casting):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$order = Order::find(1);\n\n// Returns the status value (works with enums too)\n$status = $order->flowCurrentStatusValue();\n// Returns: 'pending', 'processing', etc.\n"})}),"\n",(0,s.jsx)(n.h3,{id:"status-enum-support",children:"Status Enum Support"}),"\n",(0,s.jsx)(n.p,{children:"The trait automatically detects if your status column uses an enum:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use App\\Enums\\OrderStatus;\n\nclass Order extends Model\n{\n    use HasFlow;\n\n    protected $casts = [\n        'status' => OrderStatus::class,\n    ];\n}\n\n// Get enum class\n$enumClass = $order->flowStatusEnumClass();\n// Returns: OrderStatus::class\n\n// Get enum values\n$values = $order->flowStatusEnumValues();\n// Returns: ['pending', 'processing', 'shipped', 'delivered']\n"})}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.code,{children:"HasWorkflow"})," documentation for detailed enum handling information."]}),"\n",(0,s.jsx)(n.h2,{id:"database-setup",children:"Database Setup"}),"\n",(0,s.jsx)(n.h3,{id:"migration-example",children:"Migration Example"}),"\n",(0,s.jsxs)(n.p,{children:["Here's a complete migration example for a model using ",(0,s.jsx)(n.code,{children:"HasFlow"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Database\\Migrations\\Migration;\nuse Illuminate\\Database\\Schema\\Blueprint;\nuse Illuminate\\Support\\Facades\\Schema;\n\nreturn new class extends Migration\n{\n    public function up(): void\n    {\n        Schema::create('orders', function (Blueprint $table) {\n            $table->id();\n            $table->foreignId('user_id')->constrained();\n            $table->string('status')->nullable(); // Required for HasFlow\n            $table->decimal('total', 10, 2);\n            $table->timestamps();\n            \n            // Optional: If you want to store flow_id in the table\n            // (though not recommended - use flowId() method instead)\n            // $table->unsignedBigInteger('flow_id')->nullable();\n        });\n    }\n\n    public function down(): void\n    {\n        Schema::dropIfExists('orders');\n    }\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," The ",(0,s.jsx)(n.code,{children:"status"})," column is required. The ",(0,s.jsx)(n.code,{children:"flow_id"})," column is optional and only needed if you want to use the attribute-based flow ID resolution."]}),"\n",(0,s.jsx)(n.h3,{id:"flow-setup",children:"Flow Setup"}),"\n",(0,s.jsxs)(n.p,{children:["Before using ",(0,s.jsx)(n.code,{children:"HasFlow"}),", create the flow:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n\n$flow = Flow::store([\n    'subject_type' => Order::class,\n    'version' => 1,\n    'status' => true,\n])->getData();\n\n// Use this flow ID in your flowId() method\n// Or store it in config: config(['flows.order_flow_id' => $flow->id]);\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453(e,n,l){l.d(n,{R:()=>r,x:()=>d});var o=l(6540);const s={},i=o.createContext(s);function r(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);