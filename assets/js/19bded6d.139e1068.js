"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[8774],{7032(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"laravel-flow/deep-diving/requests/store-flow-state-request","title":"StoreFlowStateRequest","description":"Form request class for validating FlowState creation data. This request handles validation for creating new workflow states with multi-language support, status validation, and visual configuration.","source":"@site/packages/laravel-flow/deep-diving/requests/store-flow-state-request.md","sourceDirName":"laravel-flow/deep-diving/requests","slug":"/laravel-flow/deep-diving/requests/store-flow-state-request","permalink":"/packages/laravel-flow/deep-diving/requests/store-flow-state-request","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/requests/store-flow-state-request.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"sidebar_label":"StoreFlowStateRequest"},"sidebar":"packagesSidebar","previous":{"title":"SetRolloutRequest","permalink":"/packages/laravel-flow/deep-diving/requests/set-rollout-request"},"next":{"title":"UpdateFlowStateRequest","permalink":"/packages/laravel-flow/deep-diving/requests/update-flow-state-request"}}');var s=t(4848),l=t(8453);const a={sidebar_position:6,sidebar_label:"StoreFlowStateRequest"},r="StoreFlowStateRequest",d={},o=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Validation Rules",id:"validation-rules",level:2},{value:"Required Fields",id:"required-fields",level:3},{value:"Optional Fields",id:"optional-fields",level:3},{value:"Normalization",id:"normalization",level:2},{value:"Status Validation",id:"status-validation",level:2},{value:"Translation Validation",id:"translation-validation",level:2},{value:"Name Uniqueness",id:"name-uniqueness",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic State Creation",id:"basic-state-creation",level:3},{value:"Complete Request Data",id:"complete-request-data",level:3},{value:"Minimal Request Data",id:"minimal-request-data",level:3},{value:"Terminal State",id:"terminal-state",level:3},{value:"With Status Validation",id:"with-status-validation",level:3},{value:"Context Management",id:"context-management",level:2},{value:"Static Methods",id:"static-methods",level:2},{value:"normalize()",id:"normalize",level:3},{value:"rulesFor()",id:"rulesfor",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Validation Errors",id:"validation-errors",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"storeflowstaterequest",children:"StoreFlowStateRequest"})}),"\n",(0,s.jsx)(n.p,{children:"Form request class for validating FlowState creation data. This request handles validation for creating new workflow states with multi-language support, status validation, and visual configuration."}),"\n",(0,s.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"JobMetric\\Flow\\Http\\Requests\\FlowState\\StoreFlowStateRequest"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"StoreFlowStateRequest"})," validates incoming data when creating a new FlowState entity. It ensures:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Required fields are present"}),"\n",(0,s.jsx)(n.li,{children:"Flow ID exists and is valid"}),"\n",(0,s.jsx)(n.li,{children:"Multi-language translations are valid"}),"\n",(0,s.jsx)(n.li,{children:"Status value is valid for the flow's driver"}),"\n",(0,s.jsx)(n.li,{children:"Visual configuration (color, icon, position) is correct"}),"\n",(0,s.jsx)(n.li,{children:"Translation uniqueness within the flow"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"validation-rules",children:"Validation Rules"}),"\n",(0,s.jsx)(n.h3,{id:"required-fields",children:"Required Fields"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Rule"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"flow_id"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|integer|exists:flows,id"})}),(0,s.jsx)(n.td,{children:"ID of the parent flow"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|array"})}),(0,s.jsx)(n.td,{children:"Multi-language translation data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation.{locale}"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|array"})}),(0,s.jsx)(n.td,{children:"Translation data for each active locale"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation.{locale}.name"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|string"})}),(0,s.jsx)(n.td,{children:"State name in each locale (must be unique within flow)"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"optional-fields",children:"Optional Fields"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Rule"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"status"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"present|nullable|CheckStatusInDriverRule"})}),(0,s.jsx)(n.td,{children:"Status value (validated against flow's driver)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"config"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|array"})}),(0,s.jsx)(n.td,{children:"Custom configuration array"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"color"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|nullable|hex_color"})}),(0,s.jsx)(n.td,{children:"Hex color code for visualization"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"icon"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|nullable|string"})}),(0,s.jsx)(n.td,{children:"Icon identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"position"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|array|required_array_keys:x,y"})}),(0,s.jsx)(n.td,{children:"Position coordinates"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"position.x"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"numeric"})}),(0,s.jsx)(n.td,{children:"X coordinate"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"position.y"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"numeric"})}),(0,s.jsx)(n.td,{children:"Y coordinate"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"is_terminal"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|boolean"})}),(0,s.jsx)(n.td,{children:"Whether this is a terminal/end state"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation.{locale}.description"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|string"})}),(0,s.jsx)(n.td,{children:"Optional description in each locale"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"normalization",children:"Normalization"}),"\n",(0,s.jsxs)(n.p,{children:["The request includes a static ",(0,s.jsx)(n.code,{children:"normalize()"})," method that applies default values:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$normalized = StoreFlowStateRequest::normalize($data, ['flow_id' => 1]);\n\n// Applies defaults:\n// - is_terminal: false (if not provided)\n// - config: [] (if not provided or invalid)\n// - color: Based on is_terminal (end/middle state default)\n// - icon: Based on is_terminal (end/middle state default)\n// - position: Based on is_terminal (end/middle state default)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"status-validation",children:"Status Validation"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"status"})," field uses ",(0,s.jsx)(n.code,{children:"CheckStatusInDriverRule"})," to validate that the status value is valid for the flow's driver:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// If flow uses OrderStatus enum\n// Valid status values are checked against enum values\n'status' => 'pending', // \u2705 Valid if OrderStatus::PENDING exists\n'status' => 'invalid', // \u274c Invalid if not in enum\n"})}),"\n",(0,s.jsx)(n.h2,{id:"translation-validation",children:"Translation Validation"}),"\n",(0,s.jsx)(n.h3,{id:"name-uniqueness",children:"Name Uniqueness"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"translation.{locale}.name"})," field is validated for uniqueness within the same flow:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Checks if a state with the same name already exists in the same flow and locale"}),"\n",(0,s.jsx)(n.li,{children:"Prevents duplicate state names within a flow"}),"\n",(0,s.jsx)(n.li,{children:"Trims whitespace before validation"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,s.jsx)(n.h3,{id:"basic-state-creation",children:"Basic State Creation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Http\\Requests\\FlowState\\StoreFlowStateRequest;\nuse JobMetric\\Flow\\Facades\\FlowState;\n\npublic function store(StoreFlowStateRequest $request)\n{\n    $validated = $request->validated();\n    \n    $state = FlowState::store($validated['flow_id'], $validated);\n    \n    return response()->json($state, 201);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"complete-request-data",children:"Complete Request Data"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$requestData = [\n    'flow_id' => 1,\n    'translation' => [\n        'en' => [\n            'name' => 'Pending Review',\n            'description' => 'Order is pending review',\n        ],\n        'fa' => [\n            'name' => '\u062f\u0631 \u0627\u0646\u062a\u0638\u0627\u0631 \u0628\u0631\u0631\u0633\u06cc',\n            'description' => '\u0633\u0641\u0627\u0631\u0634 \u062f\u0631 \u0627\u0646\u062a\u0638\u0627\u0631 \u0628\u0631\u0631\u0633\u06cc \u0627\u0633\u062a',\n        ],\n    ],\n    'status' => 'pending',\n    'is_terminal' => false,\n    'color' => '#3B82F6',\n    'icon' => 'fas fa-clock',\n    'position' => [\n        'x' => 100,\n        'y' => 200,\n    ],\n    'config' => [\n        'notify_user' => true,\n        'auto_advance' => false,\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"minimal-request-data",children:"Minimal Request Data"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$requestData = [\n    'flow_id' => 1,\n    'translation' => [\n        'en' => ['name' => 'Processing'],\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"terminal-state",children:"Terminal State"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$requestData = [\n    'flow_id' => 1,\n    'translation' => [\n        'en' => ['name' => 'Completed'],\n    ],\n    'is_terminal' => true,\n    'status' => 'completed',\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"with-status-validation",children:"With Status Validation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// If flow uses OrderStatus enum with values: pending, processing, completed\n$requestData = [\n    'flow_id' => 1,\n    'translation' => [\n        'en' => ['name' => 'Processing'],\n    ],\n    'status' => 'processing', // \u2705 Valid\n    // 'status' => 'invalid', // \u274c Invalid\n];\n"})}),"\n",(0,s.jsx)(n.h2,{id:"context-management",children:"Context Management"}),"\n",(0,s.jsxs)(n.p,{children:["The request supports external context injection via ",(0,s.jsx)(n.code,{children:"setContext()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$request = new StoreFlowStateRequest();\n$request->setContext(['flow_id' => 123]);\n"})}),"\n",(0,s.jsx)(n.p,{children:"This allows validation to use the flow_id from context if not provided in input."}),"\n",(0,s.jsx)(n.h2,{id:"static-methods",children:"Static Methods"}),"\n",(0,s.jsx)(n.h3,{id:"normalize",children:"normalize()"}),"\n",(0,s.jsx)(n.p,{children:"Normalizes input data with safe defaults:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$data = [\n    'flow_id' => 1,\n    'translation' => ['en' => ['name' => 'State']],\n    'is_terminal' => true,\n];\n\n$context = ['flow_id' => 1];\n\n$normalized = StoreFlowStateRequest::normalize($data, $context);\n\n// Returns:\n// [\n//     'flow_id' => 1,\n//     'translation' => [...],\n//     'is_terminal' => true,\n//     'config' => [],\n//     'color' => config('workflow.state.end.color'),\n//     'icon' => config('workflow.state.end.icon'),\n//     'position' => ['x' => ..., 'y' => ...],\n// ]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"rulesfor",children:"rulesFor()"}),"\n",(0,s.jsx)(n.p,{children:"Provides programmatic validation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$input = [\n    'flow_id' => 1,\n    'translation' => ['en' => ['name' => 'State']],\n];\n\n$context = ['flow_id' => 1];\n\n$rules = StoreFlowStateRequest::rulesFor($input, $context);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.h3,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "message": "The given data was invalid.",\n    "errors": {\n        "flow_id": [\n            "The selected flow id is invalid."\n        ],\n        "translation.en.name": [\n            "A state with this name already exists in this flow."\n        ],\n        "status": [\n            "The status value is not valid for this flow\'s driver."\n        ]\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Always Provide Flow ID"}),": Ensure flow_id is valid and exists"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good\n'flow_id' => 1, // Valid flow ID\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use Valid Status Values"}),": Ensure status matches flow's driver enum"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good - Check enum values first\n$validStatuses = OrderStatus::values();\n'status' => $validStatuses[0],\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Set Appropriate Visuals"}),": Use meaningful colors and icons"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good\n'color' => '#3B82F6', // Blue for processing\n'icon' => 'fas fa-cog',\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Normalize Before Validation"}),": Use normalize() for consistent data"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$normalized = StoreFlowStateRequest::normalize($data, $context);\n$request->merge($normalized);\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-state",children:"FlowState Service"})," - Learn about state management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/update-flow-state-request",children:"UpdateFlowStateRequest"})," - State update validation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule",children:"CheckStatusInDriverRule"})," - Status validation rule"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>r});var i=t(6540);const s={},l=i.createContext(s);function a(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);