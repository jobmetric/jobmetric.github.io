"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[8505],{28453(e,n,t){t.d(n,{R:()=>r,x:()=>s});var a=t(96540);const i={},l=a.createContext(i);function r(e){const n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(l.Provider,{value:n},e.children)}},54559(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"laravel-unit-converter/deep-diving/exceptions/unit-type-cannot-change-default-value","title":"UnitTypeCannotChangeDefaultValueException","description":"Thrown when attempting to change the base unit\'s value from 1 to a different value through the update operation.","source":"@site/packages/laravel-unit-converter/deep-diving/exceptions/unit-type-cannot-change-default-value.md","sourceDirName":"laravel-unit-converter/deep-diving/exceptions","slug":"/laravel-unit-converter/deep-diving/exceptions/unit-type-cannot-change-default-value","permalink":"/packages/laravel-unit-converter/deep-diving/exceptions/unit-type-cannot-change-default-value","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-unit-converter/deep-diving/exceptions/unit-type-cannot-change-default-value.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"sidebar_label":"UnitTypeCannotChangeDefaultValueException"},"sidebar":"packagesSidebar","previous":{"title":"UnitTypeUseDefaultValueException","permalink":"/packages/laravel-unit-converter/deep-diving/exceptions/unit-type-use-default-value"},"next":{"title":"CannotDeleteDefaultValueException","permalink":"/packages/laravel-unit-converter/deep-diving/exceptions/cannot-delete-default-value"}}');var i=t(74848),l=t(28453);const r={sidebar_position:6,sidebar_label:"UnitTypeCannotChangeDefaultValueException"},s="UnitTypeCannotChangeDefaultValueException",o={},d=[{value:"Namespace",id:"namespace",level:2},{value:"HTTP Status Code",id:"http-status-code",level:2},{value:"Constructor",id:"constructor",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Understanding the Protection",id:"understanding-the-protection",level:2},{value:"Example: Why This Protection Matters",id:"example-why-this-protection-matters",level:3},{value:"When Is It Thrown?",id:"when-is-it-thrown",level:2},{value:"Example: Invalid Update Attempt",id:"example-invalid-update-attempt",level:3},{value:"What You CAN Update on a Base Unit",id:"what-you-can-update-on-a-base-unit",level:3},{value:"Handling the Exception",id:"handling-the-exception",level:2},{value:"In Controllers",id:"in-controllers",level:3},{value:"In Form Validation",id:"in-form-validation",level:3},{value:"The Correct Way to Change Base Units",id:"the-correct-way-to-change-base-units",level:2},{value:"What changeDefaultValue() Does",id:"what-changedefaultvalue-does",level:3},{value:"Prevention",id:"prevention",level:2},{value:"1. Check If Unit Is Base Before Update",id:"1-check-if-unit-is-base-before-update",level:3},{value:"2. UI Indication",id:"2-ui-indication",level:3},{value:"3. Disable Value Field for Base Units",id:"3-disable-value-field-for-base-units",level:3},{value:"Related Exceptions",id:"related-exceptions",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"unittypecannotchangedefaultvalueexception",children:"UnitTypeCannotChangeDefaultValueException"})}),"\n",(0,i.jsx)(n.p,{children:"Thrown when attempting to change the base unit's value from 1 to a different value through the update operation."}),"\n",(0,i.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"JobMetric\\UnitConverter\\Exceptions\\UnitTypeCannotChangeDefaultValueException\n"})}),"\n",(0,i.jsx)(n.h2,{id:"http-status-code",children:"HTTP Status Code"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"400 Bad Request"})}),"\n",(0,i.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function __construct(\n    int $code = 400,\n    ?Throwable $previous = null\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$code"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:"HTTP status code (default: 400)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$previous"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Throwable|null"})}),(0,i.jsx)(n.td,{children:"Previous exception for chaining"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"understanding-the-protection",children:"Understanding the Protection"}),"\n",(0,i.jsxs)(n.p,{children:["The base unit (with ",(0,i.jsx)(n.code,{children:"value = 1"}),") is protected from direct value modifications because:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["It serves as the ",(0,i.jsx)(n.strong,{children:"reference point"})," for all other units in the type"]}),"\n",(0,i.jsxs)(n.li,{children:["Changing its value would ",(0,i.jsx)(n.strong,{children:"break all existing conversions"})]}),"\n",(0,i.jsxs)(n.li,{children:["All stored values in ",(0,i.jsx)(n.code,{children:"unit_relations"})," would become ",(0,i.jsx)(n.strong,{children:"incorrect"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-why-this-protection-matters",children:"Example: Why This Protection Matters"}),"\n",(0,i.jsx)(n.p,{children:"Consider the weight type with gram as base:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Gram: ",(0,i.jsx)(n.code,{children:"value = 1"})," (base)"]}),"\n",(0,i.jsxs)(n.li,{children:["Kilogram: ",(0,i.jsx)(n.code,{children:"value = 1000"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["A product has ",(0,i.jsx)(n.code,{children:"weight = 2500"})," stored with unit_id = gram."]}),"\n",(0,i.jsxs)(n.p,{children:["If you could change gram's value to ",(0,i.jsx)(n.code,{children:"0.001"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The stored value ",(0,i.jsx)(n.code,{children:"2500"})," would now mean 2.5 grams instead of 2500 grams"]}),"\n",(0,i.jsx)(n.li,{children:"All historical data would be corrupted"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"when-is-it-thrown",children:"When Is It Thrown?"}),"\n",(0,i.jsx)(n.p,{children:"This exception is thrown when you try to update a base unit and change its value from 1."}),"\n",(0,i.jsx)(n.h3,{id:"example-invalid-update-attempt",children:"Example: Invalid Update Attempt"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n// Gram is the base unit (value = 1)\n$gram = UnitConverter::findUnitByCode('g');\n\n// Trying to change its value - WRONG!\nUnitConverter::update($gram->id, [\n    'value' => 0.001,  // Error! Cannot change base unit value\n]);\n// Throws: UnitTypeCannotChangeDefaultValueException\n"})}),"\n",(0,i.jsx)(n.h3,{id:"what-you-can-update-on-a-base-unit",children:"What You CAN Update on a Base Unit"}),"\n",(0,i.jsx)(n.p,{children:"You can update other properties without changing the value:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n$gram = UnitConverter::findUnitByCode('g');\n\n// These updates are allowed\nUnitConverter::update($gram->id, [\n    'status' => false,  // OK - disable the unit\n]);\n\nUnitConverter::update($gram->id, [\n    'translation' => [  // OK - update translations\n        'en' => ['name' => 'Gram (updated)', 'code' => 'g'],\n    ],\n]);\n\n// Even including value = 1 is OK (not changing it)\nUnitConverter::update($gram->id, [\n    'value' => 1,  // OK - same value\n    'translation' => [...],\n]);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"handling-the-exception",children:"Handling the Exception"}),"\n",(0,i.jsx)(n.h3,{id:"in-controllers",children:"In Controllers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Exceptions\\UnitTypeCannotChangeDefaultValueException;\nuse JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\nclass UnitController extends Controller\n{\n    public function update(Request $request, int $id)\n    {\n        try {\n            $response = UnitConverter::update($id, $request->all());\n            return response()->json($response->data);\n        } catch (UnitTypeCannotChangeDefaultValueException $e) {\n            return response()->json([\n                'error' => 'cannot_modify_base_unit',\n                'message' => $e->getMessage(),\n                'hint' => 'Use changeDefaultValue() to change the base unit to a different unit.',\n            ], 400);\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"in-form-validation",children:"In Form Validation"}),"\n",(0,i.jsx)(n.p,{children:"Prevent the issue in validation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Models\\Unit;\n\nclass UpdateUnitRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        return [\n            'value' => 'sometimes|numeric|min:0',\n            'status' => 'sometimes|boolean',\n            'translation' => 'sometimes|array',\n        ];\n    }\n    \n    public function withValidator($validator): void\n    {\n        $validator->after(function ($validator) {\n            if (!$this->has('value')) {\n                return;\n            }\n            \n            $unit = Unit::find($this->route('id'));\n            \n            if ($unit && (float) $unit->value === 1.0 && (float) $this->value !== 1.0) {\n                $validator->errors()->add(\n                    'value',\n                    'Cannot change the value of a base unit. Use changeDefaultValue() instead.'\n                );\n            }\n        });\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"the-correct-way-to-change-base-units",children:"The Correct Way to Change Base Units"}),"\n",(0,i.jsxs)(n.p,{children:["If you need a different unit to be the base, use ",(0,i.jsx)(n.code,{children:"changeDefaultValue()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n// Current state:\n// - Gram: value = 1 (base)\n// - Kilogram: value = 1000\n// - Ton: value = 1000000\n\n// Make Kilogram the new base\n$kilogram = UnitConverter::findUnitByCode('kg');\nUnitConverter::changeDefaultValue($kilogram->id);\n\n// New state (all values recalculated):\n// - Gram: value = 0.001\n// - Kilogram: value = 1 (new base)\n// - Ton: value = 1000\n"})}),"\n",(0,i.jsx)(n.h3,{id:"what-changedefaultvalue-does",children:"What changeDefaultValue() Does"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Gets the target unit's current value (e.g., 1000 for kilogram)"}),"\n",(0,i.jsx)(n.li,{children:"Divides all units' values by this pivot value"}),"\n",(0,i.jsxs)(n.li,{children:["The target unit becomes ",(0,i.jsx)(n.code,{children:"value = 1"})]}),"\n",(0,i.jsx)(n.li,{children:"All other units are proportionally adjusted"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Before: Gram (1), Kilogram (1000), Ton (1000000)\n// Pivot = 1000 (kilogram's value)\n// After: Gram (1/1000 = 0.001), Kilogram (1000/1000 = 1), Ton (1000000/1000 = 1000)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"prevention",children:"Prevention"}),"\n",(0,i.jsx)(n.h3,{id:"1-check-if-unit-is-base-before-update",children:"1. Check If Unit Is Base Before Update"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Models\\Unit;\nuse JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\nfunction updateUnitSafely(int $unitId, array $data): mixed\n{\n    if (isset($data['value'])) {\n        $unit = Unit::find($unitId);\n        \n        if ($unit && (float) $unit->value === 1.0 && (float) $data['value'] !== 1.0) {\n            // Remove value from update or throw custom error\n            unset($data['value']);\n            // Or: throw new \\InvalidArgumentException('Cannot change base unit value');\n        }\n    }\n    \n    return UnitConverter::update($unitId, $data);\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-ui-indication",children:"2. UI Indication"}),"\n",(0,i.jsx)(n.p,{children:"In your admin panel, clearly indicate which unit is the base:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// In your view/API\n$units = Unit::where('type', 'weight')->get()->map(function ($unit) {\n    return [\n        'id' => $unit->id,\n        'name' => $unit->name,\n        'value' => $unit->value,\n        'is_base' => (float) $unit->value === 1.0,\n        'value_editable' => (float) $unit->value !== 1.0,\n    ];\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-disable-value-field-for-base-units",children:"3. Disable Value Field for Base Units"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// Frontend example\nfunction isValueEditable(unit) {\n    return unit.value !== 1;\n}\n\n// In form\n<input \n    type="number" \n    v-model="unit.value"\n    :disabled="!isValueEditable(unit)"\n    :title="isValueEditable(unit) ? \'\' : \'Base unit value cannot be changed\'"\n/>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"related-exceptions",children:"Related Exceptions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./unit-type-default-value",children:"UnitTypeDefaultValueException"})," - When first unit doesn't have value = 1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./unit-type-use-default-value",children:"UnitTypeUseDefaultValueException"})," - When creating duplicate base unit"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./cannot-delete-default-value",children:"CannotDeleteDefaultValueException"})," - When trying to delete base unit"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);