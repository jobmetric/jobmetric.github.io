"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[4972],{9216(e,n,t){t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"laravel-unit-converter/deep-diving/events/unit-update-event","title":"UnitUpdateEvent","description":"Dispatched after an existing unit has been successfully updated in the database.","source":"@site/packages/laravel-unit-converter/deep-diving/events/unit-update-event.md","sourceDirName":"laravel-unit-converter/deep-diving/events","slug":"/laravel-unit-converter/deep-diving/events/unit-update-event","permalink":"/packages/laravel-unit-converter/deep-diving/events/unit-update-event","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-unit-converter/deep-diving/events/unit-update-event.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"UnitUpdateEvent"},"sidebar":"packagesSidebar","previous":{"title":"UnitStoreEvent","permalink":"/packages/laravel-unit-converter/deep-diving/events/unit-store-event"},"next":{"title":"UnitDeleteEvent","permalink":"/packages/laravel-unit-converter/deep-diving/events/unit-delete-event"}}');var a=t(74848),s=t(28453);const d={sidebar_position:2,sidebar_label:"UnitUpdateEvent"},c="UnitUpdateEvent",r={},l=[{value:"Namespace",id:"namespace",level:2},{value:"Event Key",id:"event-key",level:2},{value:"Class Definition",id:"class-definition",level:2},{value:"Properties",id:"properties",level:2},{value:"When Is It Dispatched?",id:"when-is-it-dispatched",level:2},{value:"Accessing Event Data",id:"accessing-event-data",level:2},{value:"Tracking Changes",id:"tracking-changes",level:2},{value:"Registering Listeners",id:"registering-listeners",level:2},{value:"Using EventServiceProvider",id:"using-eventserviceprovider",level:3},{value:"Using Closure",id:"using-closure",level:3},{value:"Example Listeners",id:"example-listeners",level:2},{value:"Audit Trail",id:"audit-trail",level:3},{value:"Sync to External System",id:"sync-to-external-system",level:3},{value:"Cache Invalidation",id:"cache-invalidation",level:3},{value:"Notify on Status Change",id:"notify-on-status-change",level:3},{value:"Recalculate Dependent Data",id:"recalculate-dependent-data",level:3},{value:"Queued Listeners",id:"queued-listeners",level:2},{value:"Event Definition",id:"event-definition",level:2},{value:"Related Events",id:"related-events",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"unitupdateevent",children:"UnitUpdateEvent"})}),"\n",(0,a.jsx)(n.p,{children:"Dispatched after an existing unit has been successfully updated in the database."}),"\n",(0,a.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"JobMetric\\UnitConverter\\Events\\UnitUpdateEvent\n"})}),"\n",(0,a.jsx)(n.h2,{id:"event-key",children:"Event Key"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"unit.updated\n"})}),"\n",(0,a.jsx)(n.h2,{id:"class-definition",children:"Class Definition"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"readonly class UnitUpdateEvent implements DomainEvent\n{\n    public function __construct(\n        public Unit $unit,\n        public array $data\n    ) {\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Property"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"$unit"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"Unit"})}),(0,a.jsx)(n.td,{children:"The updated Unit model instance (with new values)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"$data"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"array"})}),(0,a.jsx)(n.td,{children:"The data array used for the update"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"when-is-it-dispatched",children:"When Is It Dispatched?"}),"\n",(0,a.jsxs)(n.p,{children:["This event is dispatched by the ",(0,a.jsx)(n.code,{children:"UnitConverter::update()"})," method after:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Input data has been validated"}),"\n",(0,a.jsx)(n.li,{children:"The unit record has been updated in the database"}),"\n",(0,a.jsx)(n.li,{children:"Translations have been updated (if provided)"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n$response = UnitConverter::update($unitId, [\n    'value' => 1001.5,\n    'status' => false,\n    'translation' => [\n        'en' => ['name' => 'Kilogram (updated)'],\n    ],\n]);\n\n// UnitUpdateEvent is dispatched here with:\n// - $unit: The updated Unit model (refreshed from DB)\n// - $data: The update array above\n"})}),"\n",(0,a.jsx)(n.h2,{id:"accessing-event-data",children:"Accessing Event Data"}),"\n",(0,a.jsx)(n.p,{children:"In your listener, you can access both the updated unit and the change data:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass HandleUnitUpdate\n{\n    public function handle(UnitUpdateEvent $event): void\n    {\n        // Access the updated unit (current state)\n        $unit = $event->unit;\n        \n        echo $unit->id;        // e.g., 5\n        echo $unit->type;      // e.g., 'weight'\n        echo $unit->value;     // e.g., 1001.5 (new value)\n        echo $unit->status;    // e.g., false (new status)\n        \n        // Access the update data (what was changed)\n        $data = $event->data;\n        \n        // Check what was updated\n        if (isset($data['value'])) {\n            echo \"Value was updated to: {$data['value']}\";\n        }\n        \n        if (isset($data['status'])) {\n            echo \"Status was updated to: \" . ($data['status'] ? 'active' : 'inactive');\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"tracking-changes",children:"Tracking Changes"}),"\n",(0,a.jsx)(n.p,{children:"To track what changed, you can use Eloquent's dirty tracking before the event, or compare in your listener:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass TrackUnitChanges\n{\n    public function handle(UnitUpdateEvent $event): void\n    {\n        $unit = $event->unit;\n        $updateData = $event->data;\n        \n        $changes = [];\n        \n        // Check each possible field\n        foreach (['value', 'status', 'type'] as $field) {\n            if (array_key_exists($field, $updateData)) {\n                $changes[$field] = $updateData[$field];\n            }\n        }\n        \n        if (!empty($changes)) {\n            \\Log::info(\"Unit {$unit->id} updated\", [\n                'unit_id' => $unit->id,\n                'changes' => $changes,\n            ]);\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"registering-listeners",children:"Registering Listeners"}),"\n",(0,a.jsx)(n.h3,{id:"using-eventserviceprovider",children:"Using EventServiceProvider"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// app/Providers/EventServiceProvider.php\n\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\nuse App\\Listeners\\LogUnitUpdate;\nuse App\\Listeners\\SyncUnitChanges;\nuse App\\Listeners\\InvalidateUnitCache;\n\nprotected $listen = [\n    UnitUpdateEvent::class => [\n        LogUnitUpdate::class,\n        SyncUnitChanges::class,\n        InvalidateUnitCache::class,\n    ],\n];\n"})}),"\n",(0,a.jsx)(n.h3,{id:"using-closure",children:"Using Closure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:'use Illuminate\\Support\\Facades\\Event;\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nEvent::listen(UnitUpdateEvent::class, function (UnitUpdateEvent $event) {\n    \\Log::info("Unit updated: {$event->unit->id}");\n});\n'})}),"\n",(0,a.jsx)(n.h2,{id:"example-listeners",children:"Example Listeners"}),"\n",(0,a.jsx)(n.h3,{id:"audit-trail",children:"Audit Trail"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse App\\Models\\AuditLog;\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass LogUnitUpdate\n{\n    public function handle(UnitUpdateEvent $event): void\n    {\n        AuditLog::create([\n            'action' => 'unit.updated',\n            'model_type' => 'Unit',\n            'model_id' => $event->unit->id,\n            'user_id' => auth()->id(),\n            'data' => [\n                'changes' => $event->data,\n                'current_state' => [\n                    'type' => $event->unit->type,\n                    'value' => $event->unit->value,\n                    'status' => $event->unit->status,\n                ],\n            ],\n            'ip_address' => request()->ip(),\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"sync-to-external-system",children:"Sync to External System"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse App\\Services\\ExternalApiService;\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass SyncUnitChanges\n{\n    public function __construct(\n        private ExternalApiService $api\n    ) {\n    }\n\n    public function handle(UnitUpdateEvent $event): void\n    {\n        $this->api->updateUnit($event->unit->id, [\n            'type' => $event->unit->type,\n            'value' => $event->unit->value,\n            'status' => $event->unit->status,\n            'updated_at' => $event->unit->updated_at->toIso8601String(),\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"cache-invalidation",children:"Cache Invalidation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse Illuminate\\Support\\Facades\\Cache;\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass InvalidateUnitCache\n{\n    public function handle(UnitUpdateEvent $event): void\n    {\n        $unit = $event->unit;\n        \n        // Clear specific unit cache\n        Cache::forget(\"unit:{$unit->id}\");\n        \n        // Clear type-specific cache\n        Cache::forget(\"units:type:{$unit->type}\");\n        \n        // Clear all units cache\n        Cache::forget('units:all');\n        \n        // If value changed, clear conversion caches\n        if (isset($event->data['value'])) {\n            Cache::tags(['conversions', $unit->type])->flush();\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"notify-on-status-change",children:"Notify on Status Change"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse App\\Notifications\\UnitStatusChanged;\nuse Illuminate\\Support\\Facades\\Notification;\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass NotifyOnStatusChange\n{\n    public function handle(UnitUpdateEvent $event): void\n    {\n        // Only notify if status was changed\n        if (!isset($event->data['status'])) {\n            return;\n        }\n        \n        $unit = $event->unit;\n        $newStatus = $unit->status ? 'activated' : 'deactivated';\n        \n        // Notify users who use this unit\n        $affectedUsers = $this->getUsersUsingUnit($unit->id);\n        \n        Notification::send($affectedUsers, new UnitStatusChanged(\n            $unit,\n            $newStatus\n        ));\n    }\n    \n    private function getUsersUsingUnit(int $unitId): Collection\n    {\n        // Logic to find users affected by this unit\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"recalculate-dependent-data",children:"Recalculate Dependent Data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse App\\Jobs\\RecalculateProductWeights;\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass RecalculateOnValueChange\n{\n    public function handle(UnitUpdateEvent $event): void\n    {\n        // Only recalculate if value changed\n        if (!isset($event->data['value'])) {\n            return;\n        }\n        \n        // Dispatch job to recalculate all products using this unit\n        RecalculateProductWeights::dispatch($event->unit->id);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"queued-listeners",children:"Queued Listeners"}),"\n",(0,a.jsx)(n.p,{children:"For heavy operations, use queued listeners:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse Illuminate\\Contracts\\Queue\\ShouldQueue;\nuse JobMetric\\UnitConverter\\Events\\UnitUpdateEvent;\n\nclass SyncUnitToDataWarehouse implements ShouldQueue\n{\n    public $queue = 'sync';\n\n    public function handle(UnitUpdateEvent $event): void\n    {\n        // Sync to data warehouse\n        DataWarehouse::upsert('units', [\n            'id' => $event->unit->id,\n            'type' => $event->unit->type,\n            'value' => $event->unit->value,\n            'status' => $event->unit->status,\n            'synced_at' => now(),\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"event-definition",children:"Event Definition"}),"\n",(0,a.jsxs)(n.p,{children:["The event implements ",(0,a.jsx)(n.code,{children:"DomainEvent"})," interface:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"public static function definition(): DomainEventDefinition\n{\n    return new DomainEventDefinition(\n        key: 'unit.updated',\n        entityName: 'unit-converter::base.entity_names.unit',\n        title: 'unit-converter::base.events.unit_updated.title',\n        description: 'unit-converter::base.events.unit_updated.description',\n        icon: 'fas fa-edit',\n        tags: ['unit', 'storage', 'management']\n    );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related-events",children:"Related Events"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./unit-store-event",children:"UnitStoreEvent"})," - Dispatched when a unit is created"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./unit-delete-event",children:"UnitDeleteEvent"})," - Dispatched when a unit is deleted"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},28453(e,n,t){t.d(n,{R:()=>d,x:()=>c});var i=t(96540);const a={},s=i.createContext(a);function d(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);