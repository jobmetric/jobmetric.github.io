"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[3207],{8167(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"laravel-translation/deep-diving/rules/translation-field-exist-rule","title":"TranslationFieldExistRule","description":"TranslationFieldExistRule is a validation rule that ensures a translated field value is unique per locale across records of a given model that uses the HasTranslation trait. It is aware of the package\'s versioning semantics and supports optional scoping (by parent constraints) and update-safe exclusions (by current object id).","source":"@site/packages/laravel-translation/deep-diving/rules/translation-field-exist-rule.md","sourceDirName":"laravel-translation/deep-diving/rules","slug":"/laravel-translation/deep-diving/rules/translation-field-exist-rule","permalink":"/packages/laravel-translation/deep-diving/rules/translation-field-exist-rule","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-translation/deep-diving/rules/translation-field-exist-rule.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"TranslationFieldExistRule"},"sidebar":"packagesSidebar","previous":{"title":"Events","permalink":"/packages/laravel-translation/deep-diving/events"},"next":{"title":"Laravel Event System","permalink":"/packages/laravel-event-system/"}}');var r=s(4848),t=s(8453);const a={sidebar_position:1,sidebar_label:"TranslationFieldExistRule"},l="TranslationFieldExistRule",o={},d=[{value:"When to Use TranslationFieldExistRule",id:"when-to-use-translationfieldexistrule",level:2},{value:"Key Behavior",id:"key-behavior",level:2},{value:"Constructor",id:"constructor",level:2},{value:"Typical Usage in a FormRequest",id:"typical-usage-in-a-formrequest",level:2},{value:"Update Flow (Exclude Current Record)",id:"update-flow-exclude-current-record",level:2},{value:"With Parent Scoping",id:"with-parent-scoping",level:2},{value:"Versioning Awareness (What It Means)",id:"versioning-awareness-what-it-means",level:2},{value:"Customizing the Error Message",id:"customizing-the-error-message",level:2},{value:"End\u2011to\u2011End Validator Example",id:"endtoend-validator-example",level:2},{value:"Summary",id:"summary",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"translationfieldexistrule",children:"TranslationFieldExistRule"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"TranslationFieldExistRule"})," is a validation rule that ensures a translated ",(0,r.jsx)(n.strong,{children:"field value is unique per locale"})," across records of a given model that uses the ",(0,r.jsx)(n.code,{children:"HasTranslation"})," trait. It is aware of the package's versioning semantics and supports optional scoping (by parent constraints) and update-safe exclusions (by current object id)."]}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use-translationfieldexistrule",children:"When to Use TranslationFieldExistRule"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Use ",(0,r.jsx)(n.code,{children:"TranslationFieldExistRule"})," when you need:"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unique translations per locale"}),": Ensure that a translated field value is unique within a specific locale"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Form validation"}),": Validate translation uniqueness in form requests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Update-safe validation"}),": Exclude the current record when updating translations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Scoped uniqueness"}),": Enforce uniqueness within specific parent relationships or constraints"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Version-aware validation"}),": Respect versioning semantics when checking for conflicts"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example scenarios:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensuring product names are unique per locale in an e-commerce system"}),"\n",(0,r.jsx)(n.li,{children:"Validating that blog post slugs are unique within each language"}),"\n",(0,r.jsx)(n.li,{children:"Checking category names are unique per locale within a parent category"}),"\n",(0,r.jsx)(n.li,{children:"Validating unique titles for news articles in each language"}),"\n",(0,r.jsx)(n.li,{children:"Ensuring course names are unique per locale in an educational platform"}),"\n",(0,r.jsx)(n.li,{children:"Validating unique property titles per locale in a real estate system"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["This guide focuses on how to ",(0,r.jsx)(n.strong,{children:"use"})," the rule and what ",(0,r.jsx)(n.strong,{children:"outputs"})," you can expect from the validator. No database setup or tests are covered here."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"key-behavior",children:"Key Behavior"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Uniqueness Target"}),": ",(0,r.jsx)(n.code,{children:"(model_type, locale, field_name, value)"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Versioning-Aware"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Versioning ON"})," (model\u2019s ",(0,r.jsx)(n.code,{children:"usesTranslationVersioning()"})," returns true): checks ",(0,r.jsx)(n.strong,{children:"active"})," rows only (those not soft\u2011deleted)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Versioning OFF"}),": checks ",(0,r.jsx)(n.code,{children:"version = 1"})," and ",(0,r.jsx)(n.code,{children:"deleted_at IS NULL"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Update\u2011Safe Exclusion"}),": Pass the current record id to ignore its own row."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Optional Parent Scoping"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"parent_id"})," (exact match on the parent table\u2019s ",(0,r.jsx)(n.code,{children:"parent_id"})," column when provided and not ",(0,r.jsx)(n.code,{children:"-1"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"parent_where"})," (associative array of additional column/value filters on the parent table)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Translation\\Rules\\TranslationFieldExistRule;\n\n/**\n * @param class-string $class_name      // Parent model FQCN (must use HasTranslation)\n * @param string       $field_name      // Translated field key (e.g., \"title\")\n * @param string|null  $locale          // Locale (defaults to app()->getLocale())\n * @param int|null     $object_id       // Current parent id to exclude (for updates)\n * @param int|null     $parent_id       // Optional: constrain \"<parent_table>.parent_id\" (use -1 to ignore)\n * @param array        $parent_where    // Optional: additional constraints on parent table, e.g. ['status' => 'published']\n * @param string       $field_name_trans// i18n key to render a human-friendly field name in the error message\n */\npublic function __construct(\n    string  $class_name,\n    string  $field_name = 'title',\n    ?string $locale = null,\n    ?int    $object_id = null,\n    ?int    $parent_id = -1,\n    array   $parent_where = [],\n    string  $field_name_trans = 'translation::base.rule.default_field'\n)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"typical-usage-in-a-formrequest",children:"Typical Usage in a FormRequest"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Translation\\Rules\\TranslationFieldExistRule;\n\nclass StorePostRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        $locale = 'en'; // or dynamic from payload\n        return [\n            'translation.en.title' => [\n                'required',\n                'string',\n                new TranslationFieldExistRule(\n                    \\App\\Models\\Post::class,\n                    'title',\n                    $locale,\n                    null,        // object_id (null on create)\n                    -1,          // parent_id (ignore)\n                    []           // parent_where\n                ),\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected Output (on conflict)"})," \u2013 Validator errors example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "errors": {\n    "translation.en.title": [\n      "The translation field already exists." // (message may vary by your i18n key)\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"update-flow-exclude-current-record",children:"Update Flow (Exclude Current Record)"}),"\n",(0,r.jsxs)(n.p,{children:["When updating a record, pass the current ",(0,r.jsx)(n.strong,{children:"object id"})," to exclude it from the uniqueness check."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"new TranslationFieldExistRule(\n    \\App\\Models\\Post::class,\n    'title',\n    'fa',\n    $post->id, // exclude current record\n    -1,\n    []\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected Behavior:"})," The existing value for the current record does ",(0,r.jsx)(n.strong,{children:"not"})," trigger a conflict; conflicting values from ",(0,r.jsx)(n.strong,{children:"other"})," records do."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"with-parent-scoping",children:"With Parent Scoping"}),"\n",(0,r.jsx)(n.p,{children:"If your model needs scoping by a parent relationship (e.g., a child belongs to a category), you can pass:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"specific"})," ",(0,r.jsx)(n.code,{children:"parent_id"})," (any value other than ",(0,r.jsx)(n.code,{children:"-1"})," will enable a constraint on ",(0,r.jsx)(n.code,{children:"<parent_table>.parent_id"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Additional ",(0,r.jsx)(n.code,{children:"parent_where"})," constraints as an associative array."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"new TranslationFieldExistRule(\n    \\App\\Models\\Post::class,\n    'title',\n    'en',\n    null,\n    5, // parent_id: only check within parent_id = 5\n    ['status' => 'published']\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected Output (conflict case):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "errors": {\n    "translation.en.title": [\n      "The translation field already exists."\n    ]\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["If no conflict exists ",(0,r.jsx)(n.strong,{children:"within the scoped subset"}),", the rule passes."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"versioning-awareness-what-it-means",children:"Versioning Awareness (What It Means)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If the parent model\u2019s ",(0,r.jsx)(n.code,{children:"usesTranslationVersioning()"})," returns ",(0,r.jsx)(n.strong,{children:"true"}),", then only ",(0,r.jsx)(n.strong,{children:"active"})," (non\u2011deleted) rows are considered conflicts. This aligns with \u201clatest active per (locale, field)\u201d semantics."]}),"\n",(0,r.jsxs)(n.li,{children:["Otherwise (versioning ",(0,r.jsx)(n.strong,{children:"off"}),"), the rule checks for conflicts on ",(0,r.jsx)(n.code,{children:"version = 1"})," with ",(0,r.jsx)(n.code,{children:"deleted_at"})," null."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This keeps your validations consistent with how your application treats active vs historical translations."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"customizing-the-error-message",children:"Customizing the Error Message"}),"\n",(0,r.jsx)(n.p,{children:"The rule uses this translation key by default for the field label in the message:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"translation::base.rule.default_field"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["And uses ",(0,r.jsx)(n.code,{children:"translation::base.rule.exist"})," for the main message. You can pass a custom label key for the field via the constructor\u2019s last parameter:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"new TranslationFieldExistRule(\n    \\App\\Models\\Post::class,\n    'title',\n    'en',\n    null,\n    -1,\n    [],\n    'validation.attributes.title' // field name label\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected Error Message (illustrative):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"The \u201cTitle\u201d translation already exists.\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"(The exact string depends on your language files.)"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"endtoend-validator-example",children:"End\u2011to\u2011End Validator Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Support\\Facades\\Validator;\nuse JobMetric\\Translation\\Rules\\TranslationFieldExistRule;\n\n$payload = [\n    'translation' => [\n        'en' => ['title' => 'Hello World']\n    ]\n];\n\n$rules = [\n    'translation.en.title' => [\n        'required',\n        'string',\n        new TranslationFieldExistRule(\\App\\Models\\Post::class, 'title', 'en')\n    ],\n];\n\n$validator = Validator::make($payload, $rules);\n\nif ($validator->fails()) {\n    // Expected output example\n    print_r($validator->errors()->toArray());\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected Output (on conflict):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Array\n(\n    [translation.en.title] => Array\n        (\n            [0] => The translation field already exists.\n        )\n)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected Output (when passes):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Array\n(\n)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"TranslationFieldExistRule"})," gives you a precise, versioning\u2011aware uniqueness check for translated fields:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Works per locale and field"}),"\n",(0,r.jsx)(n.li,{children:"Safe for update flows (exclude current id)"}),"\n",(0,r.jsx)(n.li,{children:"Optional parent scoping and additional constraints"}),"\n",(0,r.jsx)(n.li,{children:"Customizable error labels via i18n keys"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Use it inside your FormRequests or manual validators to keep your translated attributes consistent and conflict\u2011free."}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-translation/deep-diving/has-translation",children:"HasTranslation"})," - Core trait for multilingual models"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-translation/deep-diving/requests/translation-array-request",children:"TranslationArrayRequest"})," - Form request trait that uses this rule"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-translation/deep-diving/requests/multi-translation-array-request",children:"MultiTranslationArrayRequest"})," - Multi-locale form request trait"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-translation/deep-diving/requests/translation-type-object-request",children:"TranslationTypeObjectRequest"})," - Typeify-based form request trait"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-translation/deep-diving/requests/multi-translation-type-object-request",children:"MultiTranslationTypeObjectRequest"})," - Multi-locale Typeify form request trait"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);