"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[5760],{8453(e,s,l){l.d(s,{R:()=>o,x:()=>d});var n=l(6540);const r={},i=n.createContext(r);function o(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(i.Provider,{value:s},e.children)}},9509(e,s,l){l.r(s),l.d(s,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"laravel-flow/deep-diving/resources/flow-use-resource","title":"FlowUseResource","description":"JSON resource class for transforming FlowUse models into structured API responses. This resource provides a consistent format for flow usage tracking data with conditional relation loading.","source":"@site/packages/laravel-flow/deep-diving/resources/flow-use-resource.md","sourceDirName":"laravel-flow/deep-diving/resources","slug":"/laravel-flow/deep-diving/resources/flow-use-resource","permalink":"/packages/laravel-flow/deep-diving/resources/flow-use-resource","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/resources/flow-use-resource.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"sidebar_label":"FlowUseResource"},"sidebar":"packagesSidebar","previous":{"title":"FlowInstanceResource","permalink":"/packages/laravel-flow/deep-diving/resources/flow-instance-resource"},"next":{"title":"Events","permalink":"/packages/laravel-flow/deep-diving/events"}}');var r=l(4848),i=l(8453);const o={sidebar_position:6,sidebar_label:"FlowUseResource"},d="FlowUseResource",a={},c=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Base Properties",id:"base-properties",level:2},{value:"Conditional Properties",id:"conditional-properties",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"With Relations",id:"with-relations",level:3},{value:"In Collections",id:"in-collections",level:3},{value:"In API Responses",id:"in-api-responses",level:3},{value:"Response Examples",id:"response-examples",level:2},{value:"Basic Response",id:"basic-response",level:3},{value:"With Relations",id:"with-relations-1",level:3},{value:"Relation Loading",id:"relation-loading",level:2},{value:"Eager Loading Relations",id:"eager-loading-relations",level:3},{value:"Selective Loading",id:"selective-loading",level:3},{value:"Nested Relations",id:"nested-relations",level:3},{value:"Morph Relations",id:"morph-relations",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Tracking Flow Usage",id:"tracking-flow-usage",level:3},{value:"Flow Analytics",id:"flow-analytics",level:3},{value:"Usage History",id:"usage-history",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function t(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"flowuseresource",children:"FlowUseResource"})}),"\n",(0,r.jsx)(s.p,{children:"JSON resource class for transforming FlowUse models into structured API responses. This resource provides a consistent format for flow usage tracking data with conditional relation loading."}),"\n",(0,r.jsx)(s.h2,{id:"namespace",children:"Namespace"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.code,{children:"JobMetric\\Flow\\Http\\Resources\\FlowUseResource"})}),"\n",(0,r.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"FlowUseResource"})," transforms FlowUse model instances into structured JSON responses. It includes:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Core usage properties"}),"\n",(0,r.jsx)(s.li,{children:"Flow information"}),"\n",(0,r.jsx)(s.li,{children:"Flowable entity information"}),"\n",(0,r.jsx)(s.li,{children:"ISO 8601 formatted timestamps"}),"\n",(0,r.jsx)(s.li,{children:"Conditional relation loading"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"base-properties",children:"Base Properties"}),"\n",(0,r.jsx)(s.p,{children:"The resource always includes these properties:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Property"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"id"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"int"})}),(0,r.jsx)(s.td,{children:"FlowUse ID"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"flow_id"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"int"})}),(0,r.jsx)(s.td,{children:"Flow ID that was used"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"flowable_type"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"Model class name of the entity that used the flow"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"flowable_id"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"int"})}),(0,r.jsx)(s.td,{children:"ID of the entity that used the flow"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"used_at"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"ISO 8601 formatted usage date"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"conditional-properties",children:"Conditional Properties"}),"\n",(0,r.jsx)(s.p,{children:"These properties are only included when their relations are loaded:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Property"}),(0,r.jsx)(s.th,{children:"Relation"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"flow"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"flow"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"object"})}),(0,r.jsx)(s.td,{children:"FlowResource for the flow that was used"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"flowable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"flowable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"mixed"})}),(0,r.jsx)(s.td,{children:"Flowable entity resource or default context"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,r.jsx)(s.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"use JobMetric\\Flow\\Http\\Resources\\FlowUseResource;\nuse JobMetric\\Flow\\Models\\FlowUse;\n\n$flowUse = FlowUse::find(1);\n\nreturn FlowUseResource::make($flowUse);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"with-relations",children:"With Relations"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"$flowUse = FlowUse::with([\n    'flow',\n    'flowable',\n])->find(1);\n\nreturn FlowUseResource::make($flowUse);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"in-collections",children:"In Collections"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"$flowUses = FlowUse::with('flow')->get();\n\nreturn FlowUseResource::collection($flowUses);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"in-api-responses",children:"In API Responses"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"public function show($id)\n{\n    $flowUse = FlowUse::query()\n        ->with(['flow', 'flowable'])\n        ->findOrFail($id);\n\n    return new FlowUseResource($flowUse);\n}\n"})}),"\n",(0,r.jsx)(s.h2,{id:"response-examples",children:"Response Examples"}),"\n",(0,r.jsx)(s.h3,{id:"basic-response",children:"Basic Response"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n    "id": 1,\n    "flow_id": 1,\n    "flowable_type": "App\\\\Models\\\\Order",\n    "flowable_id": 123,\n    "used_at": "2024-01-01T00:00:00.000000Z"\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"with-relations-1",children:"With Relations"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n    "id": 1,\n    "flow_id": 1,\n    "flowable_type": "App\\\\Models\\\\Order",\n    "flowable_id": 123,\n    "used_at": "2024-01-01T00:00:00.000000Z",\n    "flow": {\n        "id": 1,\n        "subject_type": "App\\\\Models\\\\Order",\n        "version": 1,\n        "is_default": true,\n        // ... FlowResource fields\n    },\n    "flowable": {\n        "id": 123,\n        "order_number": "ORD-001",\n        "status": "processing",\n        // ... Order resource fields\n    }\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"relation-loading",children:"Relation Loading"}),"\n",(0,r.jsx)(s.h3,{id:"eager-loading-relations",children:"Eager Loading Relations"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Load all relations\n$flowUse = FlowUse::with([\n    'flow',\n    'flowable',\n])->find(1);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"selective-loading",children:"Selective Loading"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Load only flow\n$flowUse = FlowUse::with('flow')->find(1);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"nested-relations",children:"Nested Relations"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Load nested relations\n$flowUse = FlowUse::with([\n    'flow.states',\n    'flowable',\n])->find(1);\n"})}),"\n",(0,r.jsx)(s.h2,{id:"morph-relations",children:"Morph Relations"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"flowable"})," property uses a morph relation. The resource will:"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Use ",(0,r.jsx)(s.code,{children:"flowable_resource"})," if available"]}),"\n",(0,r.jsxs)(s.li,{children:["Otherwise, use ",(0,r.jsx)(s.code,{children:"resource_morph_default_context"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"This allows custom resource transformation for different morph types."}),"\n",(0,r.jsx)(s.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsx)(s.h3,{id:"tracking-flow-usage",children:"Tracking Flow Usage"}),"\n",(0,r.jsx)(s.p,{children:"Track which entities have used which flows:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Get all flows used by an order\n$flowUses = FlowUse::where('flowable_type', Order::class)\n    ->where('flowable_id', $orderId)\n    ->with('flow')\n    ->get();\n\nreturn FlowUseResource::collection($flowUses);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"flow-analytics",children:"Flow Analytics"}),"\n",(0,r.jsx)(s.p,{children:"Analyze flow usage patterns:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Get all uses of a specific flow\n$flowUses = FlowUse::where('flow_id', $flowId)\n    ->with('flowable')\n    ->get();\n\nreturn FlowUseResource::collection($flowUses);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"usage-history",children:"Usage History"}),"\n",(0,r.jsx)(s.p,{children:"Track usage history for entities:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Get usage history for an order\n$history = FlowUse::where('flowable_type', Order::class)\n    ->where('flowable_id', $orderId)\n    ->with(['flow', 'flowable'])\n    ->orderBy('used_at', 'desc')\n    ->get();\n\nreturn FlowUseResource::collection($history);\n"})}),"\n",(0,r.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Load Relations When Needed"}),": Only load relations you need"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// \u2705 Good\nFlowUse::with('flow')->get();\n\n// \u274c Bad - Load unnecessary relations\nFlowUse::with(['flow', 'flow.states', 'flow.transitions', 'flowable'])->get();\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Handle Morph Types"}),": Flowable type can vary"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"if ($flowUse->flowable_type === Order::class) {\n    // Handle order-specific logic\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Use for Analytics"}),": Track flow usage for analytics"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"$usageCount = FlowUse::where('flow_id', $flowId)\n    ->where('used_at', '>=', now()->subDays(30))\n    ->count();\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-resource",children:"FlowResource"})," - Flow resource"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/packages/laravel-flow/deep-diving/services/flow",children:"Flow Service"})," - Flow management"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/packages/laravel-flow/deep-diving/has-workflow",children:"HasWorkflow"})," - Workflow integration"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/packages/laravel-flow/deep-diving/has-flow",children:"HasFlow"})," - Simple flow binding"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}}}]);