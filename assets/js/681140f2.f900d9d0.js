"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[3543],{8453(e,n,s){s.d(n,{R:()=>i,x:()=>r});var l=s(6540);const a={},t=l.createContext(a);function i(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),l.createElement(t.Provider,{value:n},e.children)}},9502(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"laravel-flow/deep-diving/rules/check-status-in-driver-rule","title":"CheckStatusInDriverRule","description":"The CheckStatusInDriverRule is a Laravel validation rule that ensures a given status value is allowed for the subject model bound to a Flow. It validates that the status value exists in the model\'s status enum values, which are detected through the HasWorkflow trait.","source":"@site/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule.md","sourceDirName":"laravel-flow/deep-diving/rules","slug":"/laravel-flow/deep-diving/rules/check-status-in-driver-rule","permalink":"/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"CheckStatusInDriverRule"},"sidebar":"packagesSidebar","previous":{"title":"RestrictionResult","permalink":"/packages/laravel-flow/deep-diving/support/restriction-result"},"next":{"title":"Events","permalink":"/packages/laravel-flow/deep-diving/events"}}');var a=s(4848),t=s(8453);const i={sidebar_position:1,sidebar_label:"CheckStatusInDriverRule"},r="CheckStatusInDriverRule",d={},o=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"When to Use",id:"when-to-use",level:2},{value:"Constructor",id:"constructor",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Validation Process",id:"validation-process",level:3},{value:"Status Enum Detection",id:"status-enum-detection",level:3},{value:"Value Matching",id:"value-matching",level:3},{value:"Usage in Form Requests",id:"usage-in-form-requests",level:2},{value:"StoreFlowStateRequest",id:"storeflowstaterequest",level:3},{value:"UpdateFlowStateRequest",id:"updateflowstaterequest",level:3},{value:"Validation Scenarios",id:"validation-scenarios",level:2},{value:"Valid Status Values",id:"valid-status-values",level:3},{value:"Invalid Status Values",id:"invalid-status-values",level:3},{value:"Null and Empty Values",id:"null-and-empty-values",level:3},{value:"Error Messages",id:"error-messages",level:2},{value:"Flow Not Found",id:"flow-not-found",level:3},{value:"Invalid Subject Model",id:"invalid-subject-model",level:3},{value:"Model Must Use HasWorkflow",id:"model-must-use-hasworkflow",level:3},{value:"Status Column Missing",id:"status-column-missing",level:3},{value:"Status Enum Error",id:"status-enum-error",level:3},{value:"Status Enum Missing",id:"status-enum-missing",level:3},{value:"Invalid Status Value",id:"invalid-status-value",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Basic Usage in Form Request",id:"example-1-basic-usage-in-form-request",level:3},{value:"Example 2: Dynamic Flow ID Resolution",id:"example-2-dynamic-flow-id-resolution",level:3},{value:"Example 3: Conditional Validation",id:"example-3-conditional-validation",level:3},{value:"Example 4: Custom Error Handling",id:"example-4-custom-error-handling",level:3},{value:"Model Requirements",id:"model-requirements",level:2},{value:"Required Setup",id:"required-setup",level:3},{value:"Status Enum Detection",id:"status-enum-detection-1",level:3},{value:"Edge Cases and Behavior",id:"edge-cases-and-behavior",level:2},{value:"Case Sensitivity",id:"case-sensitivity",level:3},{value:"Whitespace Handling",id:"whitespace-handling",level:3},{value:"Type Coercion",id:"type-coercion",level:3},{value:"Null and Empty Values",id:"null-and-empty-values-1",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Flow Not Found",id:"flow-not-found-1",level:3},{value:"Invalid Subject Model",id:"invalid-subject-model-1",level:3},{value:"Model Without HasWorkflow",id:"model-without-hasworkflow",level:3},{value:"Invalid Status Value",id:"invalid-status-value-1",level:3},{value:"Testing",id:"testing",level:2},{value:"Unit Test Example",id:"unit-test-example",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Integration with FlowState Service",id:"integration-with-flowstate-service",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"checkstatusindriverrule",children:"CheckStatusInDriverRule"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"CheckStatusInDriverRule"})," is a Laravel validation rule that ensures a given status value is allowed for the subject model bound to a Flow. It validates that the status value exists in the model's status enum values, which are detected through the ",(0,a.jsx)(n.code,{children:"HasWorkflow"})," trait."]}),"\n",(0,a.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\Rules\\CheckStatusInDriverRule\n"})}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"This validation rule is used when creating or updating Flow States to ensure that the provided status value is valid for the Flow's subject model. It:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Loads the Flow by ID and resolves its subject model class"}),"\n",(0,a.jsxs)(n.li,{children:["Ensures the subject model uses the ",(0,a.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,a.jsxs)(n.li,{children:["Detects status enum values from the model using ",(0,a.jsx)(n.code,{children:"HasWorkflow"})," helpers"]}),"\n",(0,a.jsx)(n.li,{children:"Validates the incoming status value exists among those enum values"}),"\n",(0,a.jsx)(n.li,{children:"Provides clear error messages for various failure scenarios"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,a.jsx)(n.p,{children:"This rule is primarily used in:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"FlowState Creation"}),": Validating status when creating new flow states"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"FlowState Updates"}),": Validating status when updating existing flow states"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Form Requests"}),": Ensuring status values match the model's enum"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,a.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Rules\\CheckStatusInDriverRule;\n\n$rule = new CheckStatusInDriverRule($flowId);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"int $flowId"}),": The Flow ID used to resolve the subject model class"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,a.jsx)(n.h3,{id:"validation-process",children:"Validation Process"}),"\n",(0,a.jsx)(n.p,{children:"The rule follows this validation process:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Null/Empty Check"}),": If value is ",(0,a.jsx)(n.code,{children:"null"})," or empty string, validation passes (allows optional status)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Flow Lookup"}),": Loads the Flow from database using the provided Flow ID"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Subject Model Resolution"}),": Extracts ",(0,a.jsx)(n.code,{children:"subject_type"})," from the Flow"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Model Validation"}),": Ensures the subject class exists and extends ",(0,a.jsx)(n.code,{children:"Model"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Trait Check"}),": Verifies the model uses ",(0,a.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enum Detection"}),": Calls ",(0,a.jsx)(n.code,{children:"flowStatusEnumValues()"})," on the model instance"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Value Matching"}),": Checks if the provided value matches any enum value (strict or stringified)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"status-enum-detection",children:"Status Enum Detection"}),"\n",(0,a.jsxs)(n.p,{children:["The rule uses ",(0,a.jsx)(n.code,{children:"HasWorkflow::flowStatusEnumValues()"})," to detect allowed status values:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Inside the rule\n$subject = new $subjectClass();\n$allowed = $subject->flowStatusEnumValues();\n"})}),"\n",(0,a.jsx)(n.p,{children:"This method:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Detects the status column name from model configuration"}),"\n",(0,a.jsx)(n.li,{children:"Resolves the enum class from the status column"}),"\n",(0,a.jsx)(n.li,{children:"Returns array of enum values"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"value-matching",children:"Value Matching"}),"\n",(0,a.jsx)(n.p,{children:"The rule performs flexible matching:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Strict matching\nin_array($value, $allowed, true)\n\n// Stringified matching (for form submissions)\nin_array((string)$value, array_map('strval', $allowed), true)\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Supported Value Types:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["String values (e.g., ",(0,a.jsx)(n.code,{children:"'pending'"}),", ",(0,a.jsx)(n.code,{children:"'shipped'"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Enum instances (e.g., ",(0,a.jsx)(n.code,{children:"OrderStatus::PENDING"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Numeric strings (e.g., ",(0,a.jsx)(n.code,{children:"'1'"}),", ",(0,a.jsx)(n.code,{children:"'2'"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Boolean values (converted to ",(0,a.jsx)(n.code,{children:"'1'"})," or ",(0,a.jsx)(n.code,{children:"'0'"}),")"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"usage-in-form-requests",children:"Usage in Form Requests"}),"\n",(0,a.jsx)(n.h3,{id:"storeflowstaterequest",children:"StoreFlowStateRequest"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests\\FlowState;\n\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Flow\\Rules\\CheckStatusInDriverRule;\n\nclass StoreFlowStateRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        $flowId = $this->input('flow_id');\n\n        return [\n            'flow_id' => 'required|exists:flows,id',\n            'status' => [\n                'present',\n                'nullable',\n                new CheckStatusInDriverRule($flowId),\n            ],\n            // ... other rules\n        ];\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"updateflowstaterequest",children:"UpdateFlowStateRequest"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests\\FlowState;\n\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Flow\\Rules\\CheckStatusInDriverRule;\n\nclass UpdateFlowStateRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        $flow = $this->route('flowState')->flow;\n        $flowId = $flow->id;\n\n        return [\n            'status' => [\n                'present',\n                'nullable',\n                new CheckStatusInDriverRule($flowId),\n            ],\n            // ... other rules\n        ];\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"validation-scenarios",children:"Validation Scenarios"}),"\n",(0,a.jsx)(n.h3,{id:"valid-status-values",children:"Valid Status Values"}),"\n",(0,a.jsx)(n.p,{children:"The rule accepts status values that match the model's enum:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Model with status enum\nclass Order extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = ['status'];\n\n    // Status enum: pending, processing, shipped, delivered\n}\n\n// Valid status values\n'pending'      // \u2705 Valid\n'processing'   // \u2705 Valid\n'shipped'      // \u2705 Valid\n'delivered'    // \u2705 Valid\n"})}),"\n",(0,a.jsx)(n.h3,{id:"invalid-status-values",children:"Invalid Status Values"}),"\n",(0,a.jsx)(n.p,{children:"The rule rejects values not in the enum:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"'invalid_status'  // \u274c Not in enum\n'PENDING'         // \u274c Case-sensitive (unless enum has it)\n' pending'         // \u274c Whitespace\n'1'                // \u274c Numeric string (unless enum has it)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"null-and-empty-values",children:"Null and Empty Values"}),"\n",(0,a.jsx)(n.p,{children:"Null and empty strings pass validation (allows optional status):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"null   // \u2705 Passes (optional)\n''     // \u2705 Passes (optional)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"error-messages",children:"Error Messages"}),"\n",(0,a.jsx)(n.p,{children:"The rule provides specific error messages for different failure scenarios:"}),"\n",(0,a.jsx)(n.h3,{id:"flow-not-found",children:"Flow Not Found"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"trans('workflow::base.validation.flow_not_found')\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Triggered when:"})," Flow ID doesn't exist in database"]}),"\n",(0,a.jsx)(n.h3,{id:"invalid-subject-model",children:"Invalid Subject Model"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"trans('workflow::base.validation.subject_model_invalid')\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Triggered when:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"subject_type"})," is not a string"]}),"\n",(0,a.jsx)(n.li,{children:"Class doesn't exist"}),"\n",(0,a.jsxs)(n.li,{children:["Class doesn't extend ",(0,a.jsx)(n.code,{children:"Model"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"model-must-use-hasworkflow",children:"Model Must Use HasWorkflow"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"trans('workflow::base.validation.model_must_use_has_workflow', [\n    'model' => $subjectClass\n])\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Triggered when:"})," Subject model doesn't use ",(0,a.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,a.jsx)(n.h3,{id:"status-column-missing",children:"Status Column Missing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"trans('workflow::base.validation.status_column_missing')\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Triggered when:"})," Model doesn't have a status column configured"]}),"\n",(0,a.jsx)(n.h3,{id:"status-enum-error",children:"Status Enum Error"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"trans('workflow::base.validation.status_enum_error')\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Triggered when:"})," Error occurs while detecting enum values"]}),"\n",(0,a.jsx)(n.h3,{id:"status-enum-missing",children:"Status Enum Missing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"trans('workflow::base.validation.status_enum_missing')\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Triggered when:"})," No enum values are detected"]}),"\n",(0,a.jsx)(n.h3,{id:"invalid-status-value",children:"Invalid Status Value"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"trans('workflow::base.validation.check_status_in_driver', [\n    'status' => implode(', ', $allowedString),\n])\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Triggered when:"})," Provided status value doesn't match any enum value"]}),"\n",(0,a.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,a.jsx)(n.h3,{id:"example-1-basic-usage-in-form-request",children:"Example 1: Basic Usage in Form Request"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests\\FlowState;\n\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Flow\\Rules\\CheckStatusInDriverRule;\n\nclass StoreFlowStateRequest extends FormRequest\n{\n    public function authorize(): bool\n    {\n        return true;\n    }\n\n    public function rules(): array\n    {\n        $flowId = $this->input('flow_id');\n\n        return [\n            'flow_id' => 'required|exists:flows,id',\n            'translation' => 'required|array',\n            'status' => [\n                'present',\n                'nullable',\n                new CheckStatusInDriverRule($flowId),\n            ],\n            'config' => 'sometimes|array',\n            'color' => 'sometimes|nullable|hex_color',\n            'icon' => 'sometimes|nullable|string',\n            'is_terminal' => 'sometimes|boolean',\n        ];\n    }\n\n    public function messages(): array\n    {\n        return [\n            'flow_id.required' => 'Flow ID is required',\n            'flow_id.exists' => 'Selected flow does not exist',\n            'status.*' => 'Invalid status value for this flow',\n        ];\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-2-dynamic-flow-id-resolution",children:"Example 2: Dynamic Flow ID Resolution"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"class UpdateFlowStateRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        // Get flow ID from route model binding\n        $flowState = $this->route('flowState');\n        $flowId = $flowState->flow_id;\n\n        return [\n            'status' => [\n                'sometimes',\n                'nullable',\n                new CheckStatusInDriverRule($flowId),\n            ],\n            // ... other rules\n        ];\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-3-conditional-validation",children:"Example 3: Conditional Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"class StoreFlowStateRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        $flowId = $this->input('flow_id');\n        $rules = [\n            'flow_id' => 'required|exists:flows,id',\n        ];\n\n        // Only validate status if provided\n        if ($this->has('status')) {\n            $rules['status'] = [\n                'required',\n                new CheckStatusInDriverRule($flowId),\n            ];\n        }\n\n        return $rules;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-4-custom-error-handling",children:"Example 4: Custom Error Handling"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Validation\\ValidationException;\nuse JobMetric\\Flow\\Rules\\CheckStatusInDriverRule;\n\ntry {\n    $request->validate([\n        'status' => new CheckStatusInDriverRule($flowId),\n    ]);\n} catch (ValidationException $e) {\n    // Custom error handling\n    if ($e->errors()['status'][0] === trans('workflow::base.validation.flow_not_found')) {\n        // Handle flow not found\n    } elseif ($e->errors()['status'][0] === trans('workflow::base.validation.check_status_in_driver')) {\n        // Handle invalid status\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"model-requirements",children:"Model Requirements"}),"\n",(0,a.jsx)(n.h3,{id:"required-setup",children:"Required Setup"}),"\n",(0,a.jsx)(n.p,{children:"For the rule to work, your model must:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Use HasWorkflow Trait:"})}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\HasWorkflow;\n\nclass Order extends Model\n{\n    use HasWorkflow;\n}\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Have Status Column:"})}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Migration\nSchema::create('orders', function (Blueprint $table) {\n    $table->id();\n    $table->string('status')->nullable();\n    // ...\n});\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Configure Status Enum:"})}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"class Order extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = ['status'];\n\n    // Status enum is detected automatically from the status column\n    // Or configure explicitly in HasWorkflow trait\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"status-enum-detection-1",children:"Status Enum Detection"}),"\n",(0,a.jsx)(n.p,{children:"The rule automatically detects status enum values using:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$model = new Order();\n$allowedStatuses = $model->flowStatusEnumValues();\n"})}),"\n",(0,a.jsx)(n.p,{children:"This method:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Looks for status column configuration"}),"\n",(0,a.jsx)(n.li,{children:"Resolves enum class from column definition"}),"\n",(0,a.jsx)(n.li,{children:"Returns array of enum values"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"edge-cases-and-behavior",children:"Edge Cases and Behavior"}),"\n",(0,a.jsx)(n.h3,{id:"case-sensitivity",children:"Case Sensitivity"}),"\n",(0,a.jsxs)(n.p,{children:["Status values are ",(0,a.jsx)(n.strong,{children:"case-sensitive"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Enum: ['pending', 'processing']\n'pending'    // \u2705 Valid\n'PENDING'    // \u274c Invalid (case mismatch)\n'Pending'    // \u274c Invalid (case mismatch)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"whitespace-handling",children:"Whitespace Handling"}),"\n",(0,a.jsx)(n.p,{children:"Whitespace in values causes validation failure:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"'pending'     // \u2705 Valid\n' pending'    // \u274c Invalid (leading space)\n'pending '    // \u274c Invalid (trailing space)\n' pending '   // \u274c Invalid (both)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"type-coercion",children:"Type Coercion"}),"\n",(0,a.jsx)(n.p,{children:"The rule performs type coercion for matching:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Enum: [OrderStatus::PENDING, OrderStatus::PROCESSING]\n\n'pending'           // \u2705 Valid (string match)\nOrderStatus::PENDING // \u2705 Valid (strict match)\n1                    // \u274c Invalid (unless enum has numeric value)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"null-and-empty-values-1",children:"Null and Empty Values"}),"\n",(0,a.jsx)(n.p,{children:"Null and empty strings always pass (allows optional status):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"null  // \u2705 Always passes\n''    // \u2705 Always passes\n"})}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsx)(n.h3,{id:"flow-not-found-1",children:"Flow Not Found"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$rule = new CheckStatusInDriverRule(999); // Non-existent flow\n$rule->validate('status', 'pending', function ($message) {\n    // $message = trans('workflow::base.validation.flow_not_found')\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"invalid-subject-model-1",children:"Invalid Subject Model"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Flow with invalid subject_type\n$flow = Flow::create([\n    'subject_type' => 'NonExistentClass',\n    // ...\n]);\n\n$rule = new CheckStatusInDriverRule($flow->id);\n$rule->validate('status', 'pending', function ($message) {\n    // $message = trans('workflow::base.validation.subject_model_invalid')\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"model-without-hasworkflow",children:"Model Without HasWorkflow"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Flow with model that doesn't use HasWorkflow\n$flow = Flow::create([\n    'subject_type' => \\App\\Models\\User::class, // User doesn't use HasWorkflow\n    // ...\n]);\n\n$rule = new CheckStatusInDriverRule($flow->id);\n$rule->validate('status', 'pending', function ($message) {\n    // $message = trans('workflow::base.validation.model_must_use_has_workflow', ['model' => User::class])\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"invalid-status-value-1",children:"Invalid Status Value"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Valid statuses: ['pending', 'processing', 'shipped']\n$rule = new CheckStatusInDriverRule($flow->id);\n$rule->validate('status', 'invalid', function ($message) {\n    // $message = trans('workflow::base.validation.check_status_in_driver', [\n    //     'status' => 'pending, processing, shipped'\n    // ])\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,a.jsx)(n.h3,{id:"unit-test-example",children:"Unit Test Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace Tests\\Unit\\Rules;\n\nuse App\\Models\\Order;\nuse App\\Models\\Flow;\nuse JobMetric\\Flow\\Rules\\CheckStatusInDriverRule;\nuse Tests\\TestCase;\n\nclass CheckStatusInDriverRuleTest extends TestCase\n{\n    public function test_validates_status_against_enum(): void\n    {\n        $flow = Flow::factory()->create([\n            'subject_type' => Order::class,\n        ]);\n\n        $rule = new CheckStatusInDriverRule($flow->id);\n        $failCalled = false;\n\n        // Valid status\n        $rule->validate('status', 'pending', function ($message) use (&$failCalled) {\n            $failCalled = true;\n        });\n\n        $this->assertFalse($failCalled);\n    }\n\n    public function test_rejects_invalid_status(): void\n    {\n        $flow = Flow::factory()->create([\n            'subject_type' => Order::class,\n        ]);\n\n        $rule = new CheckStatusInDriverRule($flow->id);\n        $failMessage = null;\n\n        // Invalid status\n        $rule->validate('status', 'invalid_status', function ($message) use (&$failMessage) {\n            $failMessage = $message;\n        });\n\n        $this->assertNotNull($failMessage);\n    }\n\n    public function test_allows_null_value(): void\n    {\n        $flow = Flow::factory()->create([\n            'subject_type' => Order::class,\n        ]);\n\n        $rule = new CheckStatusInDriverRule($flow->id);\n        $failCalled = false;\n\n        $rule->validate('status', null, function ($message) use (&$failCalled) {\n            $failCalled = true;\n        });\n\n        $this->assertFalse($failCalled);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Always Provide Flow ID"}),": Ensure Flow ID is valid before creating the rule"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// \u2705 Good\n$flowId = $request->input('flow_id');\n$request->validate([\n    'flow_id' => 'required|exists:flows,id',\n    'status' => new CheckStatusInDriverRule($flowId),\n]);\n\n// \u274c Bad\n$rule = new CheckStatusInDriverRule($request->input('flow_id')); // May be null\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use with Present/Nullable"}),": Combine with ",(0,a.jsx)(n.code,{children:"present"})," and ",(0,a.jsx)(n.code,{children:"nullable"})," for optional status"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"'status' => [\n    'present',\n    'nullable',\n    new CheckStatusInDriverRule($flowId),\n]\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Handle Errors Gracefully"}),": Provide user-friendly error messages"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"try {\n    $request->validate($rules);\n} catch (ValidationException $e) {\n    return back()->withErrors($e->errors());\n}\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache Flow Lookups"}),": If validating multiple fields, cache the Flow instance"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$flow = Flow::findOrFail($flowId);\n$rules = [\n    'status' => new CheckStatusInDriverRule($flow->id),\n    // Other rules using $flow\n];\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"integration-with-flowstate-service",children:"Integration with FlowState Service"}),"\n",(0,a.jsxs)(n.p,{children:["The rule is automatically used in ",(0,a.jsx)(n.code,{children:"FlowState"})," service when creating/updating states:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\FlowState;\n\n// Creating a state - status is validated automatically\nFlowState::store($flowId, [\n    'status' => 'pending', // Validated by CheckStatusInDriverRule\n    'translation' => [...],\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-state",children:"FlowState Service"})," - Learn about flow state management"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-workflow",children:"HasWorkflow Trait"})," - Learn about workflow integration"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow",children:"Flow Service"})," - Learn about flow management"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}}}]);