"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[7552],{28453(e,n,i){i.d(n,{R:()=>l,x:()=>s});var a=i(96540);const o={},t=a.createContext(o);function l(e){const n=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),a.createElement(t.Provider,{value:n},e.children)}},43795(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"laravel-location/deep-diving/has-location","title":"HasLocation Trait","description":"The HasLocation trait provides location attachment capabilities for Eloquent models.","source":"@site/packages/laravel-location/deep-diving/has-location.md","sourceDirName":"laravel-location/deep-diving","slug":"/laravel-location/deep-diving/has-location","permalink":"/packages/laravel-location/deep-diving/has-location","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-location/deep-diving/has-location.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"HasLocation"},"sidebar":"packagesSidebar","previous":{"title":"Showcase","permalink":"/packages/laravel-location/showcase"},"next":{"title":"HasAddress","permalink":"/packages/laravel-location/deep-diving/has-address"}}');var o=i(74848),t=i(28453);const l={sidebar_position:1,sidebar_label:"HasLocation"},s="HasLocation Trait",c={},d=[{value:"Namespace",id:"namespace",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Choosing the mode (single vs multiple)",id:"choosing-the-mode-single-vs-multiple",level:2},{value:"Quick Start (single mode)",id:"quick-start-single-mode",level:2},{value:"Quick Start (multiple mode)",id:"quick-start-multiple-mode",level:2},{value:"APIs",id:"apis",level:2},{value:"attachLocation(int $locationId)",id:"attachlocationint-locationid",level:3},{value:"attachLocationByData(array $locationData)",id:"attachlocationbydataarray-locationdata",level:3},{value:"detachLocation(?int $locationId = null)",id:"detachlocationint-locationid--null",level:3},{value:"detachAllLocations()",id:"detachalllocations",level:3},{value:"syncLocations(array $locationIds)",id:"synclocationsarray-locationids",level:3},{value:"hasLocation(int $locationId)",id:"haslocationint-locationid",level:3},{value:"Notes &amp; best practices",id:"notes--best-practices",level:2},{value:"Eager loading patterns",id:"eager-loading-patterns",level:2},{value:"Single mode",id:"single-mode",level:3},{value:"Multiple mode",id:"multiple-mode",level:3},{value:"Prefer attach by data",id:"prefer-attach-by-data",level:2}];function r(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"haslocation-trait",children:"HasLocation Trait"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"HasLocation"})," trait provides ",(0,o.jsx)(n.strong,{children:"location attachment"})," capabilities for Eloquent models."]}),"\n",(0,o.jsx)(n.p,{children:"It supports two modes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Single"}),": one location per model (via ",(0,o.jsx)(n.code,{children:"MorphOne"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Multiple"}),": many locations per model (via ",(0,o.jsx)(n.code,{children:"MorphMany"}),")"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["It also guarantees that ",(0,o.jsx)(n.code,{children:"Location"})," records are ",(0,o.jsx)(n.strong,{children:"unique"})," and should ",(0,o.jsx)(n.strong,{children:"never be deleted"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"JobMetric\\Location\\HasLocation\n"})}),"\n",(0,o.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"HasLocation"})," stores the relationship through ",(0,o.jsx)(n.code,{children:"LocationRelation"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Single mode: ",(0,o.jsx)(n.code,{children:"locationRelation() : MorphOne"})]}),"\n",(0,o.jsxs)(n.li,{children:["Multiple mode: ",(0,o.jsx)(n.code,{children:"locationRelations() : MorphMany"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The actual ",(0,o.jsx)(n.code,{children:"Location"})," record represents a ",(0,o.jsx)(n.strong,{children:"unique combination"})," of:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"country_id"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"province_id"})," (nullable)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"city_id"})," (nullable)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"district_id"})," (nullable)"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["When you attach by data, it uses ",(0,o.jsx)(n.code,{children:"Location::firstOrCreate()"})," to avoid duplicates."]}),"\n",(0,o.jsx)(n.h2,{id:"choosing-the-mode-single-vs-multiple",children:"Choosing the mode (single vs multiple)"}),"\n",(0,o.jsxs)(n.p,{children:["By default, the trait uses ",(0,o.jsx)(n.strong,{children:"single"})," mode."]}),"\n",(0,o.jsx)(n.p,{children:"To enable multiple mode on a model, add:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"protected string $locationMode = 'multiple';\n"})}),"\n",(0,o.jsx)(n.p,{children:"Valid values:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"'single'"})," (default)"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"'multiple'"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"quick-start-single-mode",children:"Quick Start (single mode)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Location\\HasLocation;\n\nclass Address extends Model\n{\n    use HasLocation;\n\n    protected string $locationMode = 'single';\n}\n\n$address = Address::find(1);\n\n// Attach by an existing Location id\n$address->attachLocation($locationId);\n\n// Attach by data (creates the Location if missing)\n$address->attachLocationByData([\n    'country_id' => 1,\n    'province_id' => 10,\n    'city_id' => 120,\n    'district_id' => 900,\n]);\n\n// Read accessors (single mode only)\n$address->location; // Location|null\n$address->country;  // Country|null\n$address->province; // Province|null\n$address->city;     // City|null\n$address->district; // District|null\n"})}),"\n",(0,o.jsx)(n.h2,{id:"quick-start-multiple-mode",children:"Quick Start (multiple mode)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Location\\HasLocation;\n\nclass GeoArea extends Model\n{\n    use HasLocation;\n\n    protected string $locationMode = 'multiple';\n}\n\n$geoArea = GeoArea::find(1);\n\n$geoArea->attachLocation($locationId);\n$geoArea->attachLocationByData([\n    'country_id' => 1,\n    'province_id' => 10,\n]);\n\n// Accessor (multiple mode only)\n$geoArea->locations; // Collection<Location>\n\n// Derived accessors (multiple mode only)\n$geoArea->countries;\n$geoArea->provinces;\n$geoArea->cities;\n$geoArea->districts;\n"})}),"\n",(0,o.jsx)(n.h2,{id:"apis",children:"APIs"}),"\n",(0,o.jsx)(n.h3,{id:"attachlocationint-locationid",children:"attachLocation(int $locationId)"}),"\n",(0,o.jsx)(n.p,{children:"Attach an existing location id:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Single mode: replaces existing relation (if any)"}),"\n",(0,o.jsx)(n.li,{children:"Multiple mode: creates a new relation if not already attached"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"attachlocationbydataarray-locationdata",children:"attachLocationByData(array $locationData)"}),"\n",(0,o.jsxs)(n.p,{children:["Creates or reuses a unique ",(0,o.jsx)(n.code,{children:"Location"})," record and attaches it to the model."]}),"\n",(0,o.jsx)(n.h3,{id:"detachlocationint-locationid--null",children:"detachLocation(?int $locationId = null)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Single mode: detaches the single relation"}),"\n",(0,o.jsx)(n.li,{children:"Multiple mode: detaches the specified location id (required)"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"detachalllocations",children:"detachAllLocations()"}),"\n",(0,o.jsx)(n.p,{children:"Multiple mode only."}),"\n",(0,o.jsx)(n.h3,{id:"synclocationsarray-locationids",children:"syncLocations(array $locationIds)"}),"\n",(0,o.jsx)(n.p,{children:"Multiple mode only. Detaches all and attaches the provided ids."}),"\n",(0,o.jsx)(n.h3,{id:"haslocationint-locationid",children:"hasLocation(int $locationId)"}),"\n",(0,o.jsx)(n.p,{children:"Checks if this model has the given location attached."}),"\n",(0,o.jsx)(n.h2,{id:"notes--best-practices",children:"Notes & best practices"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Eager load for performance"}),": for multiple mode, eager load ",(0,o.jsx)(n.code,{children:"locationRelations.location"})," when querying."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Locations are immutable"}),": ",(0,o.jsx)(n.code,{children:"Location"})," records are not intended to be updated or deleted."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"eager-loading-patterns",children:"Eager loading patterns"}),"\n",(0,o.jsx)(n.h3,{id:"single-mode",children:"Single mode"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"Address::query()\n    ->with(['locationRelation.location.country', 'locationRelation.location.province'])\n    ->first();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"multiple-mode",children:"Multiple mode"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"GeoArea::query()\n    ->with(['locationRelations.location'])\n    ->first();\n"})}),"\n",(0,o.jsx)(n.h2,{id:"prefer-attach-by-data",children:"Prefer attach by data"}),"\n",(0,o.jsxs)(n.p,{children:["When you have (country/province/city/district) ids, prefer ",(0,o.jsx)(n.code,{children:"attachLocationByData()"})," instead of manually resolving a ",(0,o.jsx)(n.code,{children:"Location"})," id:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$model->attachLocationByData([\n    'country_id' => 1,\n    'province_id' => 10,\n    'city_id' => 120,\n    'district_id' => 900,\n]);\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This guarantees uniqueness via ",(0,o.jsx)(n.code,{children:"Location::firstOrCreate()"})," and avoids duplicates."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(r,{...e})}):r(e)}}}]);