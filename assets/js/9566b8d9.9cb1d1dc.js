"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[4350],{6643(e,i,n){n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"laravel-flow/deep-diving/requests/store-flow-task-request","title":"StoreFlowTaskRequest","description":"Form request class for validating FlowTask creation data. This request handles dynamic validation based on the selected task driver, including driver-specific configuration validation.","source":"@site/packages/laravel-flow/deep-diving/requests/store-flow-task-request.md","sourceDirName":"laravel-flow/deep-diving/requests","slug":"/laravel-flow/deep-diving/requests/store-flow-task-request","permalink":"/packages/laravel-flow/deep-diving/requests/store-flow-task-request","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/requests/store-flow-task-request.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"sidebar_label":"StoreFlowTaskRequest"},"sidebar":"packagesSidebar","previous":{"title":"UpdateFlowStateRequest","permalink":"/packages/laravel-flow/deep-diving/requests/update-flow-state-request"},"next":{"title":"UpdateFlowTaskRequest","permalink":"/packages/laravel-flow/deep-diving/requests/update-flow-task-request"}}');var r=n(4848),l=n(8453);const a={sidebar_position:8,sidebar_label:"StoreFlowTaskRequest"},t="StoreFlowTaskRequest",d={},o=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:2},{value:"Validation Rules",id:"validation-rules",level:2},{value:"Required Fields",id:"required-fields",level:3},{value:"Optional Fields",id:"optional-fields",level:3},{value:"Driver Validation",id:"driver-validation",level:2},{value:"Dynamic Config Validation",id:"dynamic-config-validation",level:2},{value:"Context Management",id:"context-management",level:2},{value:"Static Rules Method",id:"static-rules-method",level:2},{value:"rulesFor()",id:"rulesfor",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic Task Creation",id:"basic-task-creation",level:3},{value:"Complete Request Data",id:"complete-request-data",level:3},{value:"Minimal Request Data",id:"minimal-request-data",level:3},{value:"With Driver-Specific Config",id:"with-driver-specific-config",level:3},{value:"Cross-Field Validation",id:"cross-field-validation",level:2},{value:"Transition Validation",id:"transition-validation",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Validation Errors",id:"validation-errors",level:3},{value:"Driver-Specific Errors",id:"driver-specific-errors",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"storeflowtaskrequest",children:"StoreFlowTaskRequest"})}),"\n",(0,r.jsx)(i.p,{children:"Form request class for validating FlowTask creation data. This request handles dynamic validation based on the selected task driver, including driver-specific configuration validation."}),"\n",(0,r.jsx)(i.h2,{id:"namespace",children:"Namespace"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"JobMetric\\Flow\\Http\\Requests\\FlowTask\\StoreFlowTaskRequest"})}),"\n",(0,r.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"StoreFlowTaskRequest"})," validates incoming data when creating a new FlowTask entity. It ensures:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Required fields are present"}),"\n",(0,r.jsx)(i.li,{children:"Flow transition ID exists and is valid"}),"\n",(0,r.jsx)(i.li,{children:"Driver class exists and is registered"}),"\n",(0,r.jsx)(i.li,{children:"Driver-specific configuration is valid"}),"\n",(0,r.jsx)(i.li,{children:"Dynamic form validation from driver's form definition"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"key-features",children:"Key Features"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Dynamic Validation"}),": Rules are generated based on the selected driver"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Driver Registration Check"}),": Validates that driver is registered in FlowTaskRegistry"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Form Builder Integration"}),": Uses driver's form definition for config validation"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Context Support"}),": Supports external context injection"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"validation-rules",children:"Validation Rules"}),"\n",(0,r.jsx)(i.h3,{id:"required-fields",children:"Required Fields"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Field"}),(0,r.jsx)(i.th,{children:"Rule"}),(0,r.jsx)(i.th,{children:"Description"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"flow_transition_id"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"required|integer|exists:flow_transitions,id"})}),(0,r.jsx)(i.td,{children:"ID of the parent transition"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"driver"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"required|string"})}),(0,r.jsx)(i.td,{children:"Fully qualified driver class name"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsxs)(i.td,{children:[(0,r.jsx)(i.code,{children:"driver"})," (custom)"]}),(0,r.jsx)(i.td,{children:"Class exists, extends AbstractTaskDriver, registered"}),(0,r.jsx)(i.td,{children:"Driver validation checks"})]})]})]}),"\n",(0,r.jsx)(i.h3,{id:"optional-fields",children:"Optional Fields"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Field"}),(0,r.jsx)(i.th,{children:"Rule"}),(0,r.jsx)(i.th,{children:"Description"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"config"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"sometimes|array"})}),(0,r.jsx)(i.td,{children:"Driver-specific configuration"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"config.*"})}),(0,r.jsx)(i.td,{children:"Dynamic rules from driver's form"}),(0,r.jsx)(i.td,{children:"Validated based on driver's form definition"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"ordering"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"sometimes|nullable|integer|min:0"})}),(0,r.jsx)(i.td,{children:"Task execution order"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"status"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"sometimes|boolean"})}),(0,r.jsx)(i.td,{children:"Active/inactive status"})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"driver-validation",children:"Driver Validation"}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"driver"})," field is validated with custom rules:"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Class Exists"}),": The class must exist"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// \u2705 Valid\n'driver' => 'App\\FlowTasks\\SendEmailTask'\n\n// \u274c Invalid\n'driver' => 'App\\FlowTasks\\NonExistentTask'\n"})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Extends AbstractTaskDriver"}),": Must extend the base driver class"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// \u2705 Valid\nclass SendEmailTask extends AbstractTaskDriver { }\n\n// \u274c Invalid\nclass SendEmailTask { }\n"})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Registered in Registry"}),": Must be registered in FlowTaskRegistry"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// \u2705 Valid - Registered\nFlowTaskRegistry::register(SendEmailTask::class);\n\n// \u274c Invalid - Not registered\n// Driver not registered\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"dynamic-config-validation",children:"Dynamic Config Validation"}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"config"})," field is validated based on the driver's form definition:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// If driver defines form:\npublic function form(): array\n{\n    return [\n        'recipient' => ['required', 'email'],\n        'subject' => ['required', 'string', 'max:255'],\n        'template' => ['required', 'string'],\n    ];\n}\n\n// Then config is validated as:\n'config.recipient' => 'required|email',\n'config.subject' => 'required|string|max:255',\n'config.template' => 'required|string',\n"})}),"\n",(0,r.jsx)(i.h2,{id:"context-management",children:"Context Management"}),"\n",(0,r.jsx)(i.p,{children:"The request supports external context injection:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"$request = new StoreFlowTaskRequest();\n$request->setContext(['flow_id' => 123]);\n"})}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"flow_id"})," is automatically extracted from the transition and stored in context."]}),"\n",(0,r.jsx)(i.h2,{id:"static-rules-method",children:"Static Rules Method"}),"\n",(0,r.jsx)(i.h3,{id:"rulesfor",children:"rulesFor()"}),"\n",(0,r.jsx)(i.p,{children:"Provides programmatic validation:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"$input = [\n    'flow_transition_id' => 1,\n    'driver' => 'App\\FlowTasks\\SendEmailTask',\n    'config' => [\n        'recipient' => 'user@example.com',\n    ],\n];\n\n$context = [];\n\n$rules = StoreFlowTaskRequest::rulesFor($input, $context);\n"})}),"\n",(0,r.jsx)(i.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,r.jsx)(i.h3,{id:"basic-task-creation",children:"Basic Task Creation"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"use JobMetric\\Flow\\Http\\Requests\\FlowTask\\StoreFlowTaskRequest;\nuse JobMetric\\Flow\\Facades\\FlowTask;\n\npublic function store(StoreFlowTaskRequest $request)\n{\n    $validated = $request->validated();\n    \n    $task = FlowTask::store(\n        $validated['flow_transition_id'],\n        $validated\n    );\n    \n    return response()->json($task, 201);\n}\n"})}),"\n",(0,r.jsx)(i.h3,{id:"complete-request-data",children:"Complete Request Data"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"$requestData = [\n    'flow_transition_id' => 1,\n    'driver' => 'App\\FlowTasks\\SendEmailTask',\n    'config' => [\n        'recipient' => 'user@example.com',\n        'subject' => 'Order Confirmation',\n        'template' => 'order-confirmation',\n    ],\n    'ordering' => 1,\n    'status' => true,\n];\n"})}),"\n",(0,r.jsx)(i.h3,{id:"minimal-request-data",children:"Minimal Request Data"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"$requestData = [\n    'flow_transition_id' => 1,\n    'driver' => 'App\\FlowTasks\\LogTask',\n    // config is optional if driver doesn't require it\n];\n"})}),"\n",(0,r.jsx)(i.h3,{id:"with-driver-specific-config",children:"With Driver-Specific Config"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// For a validation task\n$requestData = [\n    'flow_transition_id' => 1,\n    'driver' => 'App\\FlowTasks\\ValidateOrderTask',\n    'config' => [\n        'min_amount' => 100,\n        'required_fields' => ['customer_name', 'address'],\n    ],\n];\n"})}),"\n",(0,r.jsx)(i.h2,{id:"cross-field-validation",children:"Cross-Field Validation"}),"\n",(0,r.jsxs)(i.p,{children:["The request includes custom validation in ",(0,r.jsx)(i.code,{children:"withValidator()"}),":"]}),"\n",(0,r.jsx)(i.h3,{id:"transition-validation",children:"Transition Validation"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Verifies transition exists"}),"\n",(0,r.jsxs)(i.li,{children:["Extracts ",(0,r.jsx)(i.code,{children:"flow_id"})," from transition and stores in context"]}),"\n",(0,r.jsx)(i.li,{children:"Ensures transition belongs to a valid flow"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// Automatically validates:\n// - Transition exists\n// - Flow exists\n// - Stores flow_id in context\n"})}),"\n",(0,r.jsx)(i.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(i.h3,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n    "message": "The given data was invalid.",\n    "errors": {\n        "flow_transition_id": [\n            "The selected flow transition id is invalid."\n        ],\n        "driver": [\n            "The driver class does not exist."\n        ],\n        "config.recipient": [\n            "The config.recipient field is required."\n        ]\n    }\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"driver-specific-errors",children:"Driver-Specific Errors"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n    "errors": {\n        "driver": [\n            "The driver is not registered in FlowTaskRegistry."\n        ],\n        "config.email": [\n            "The config.email must be a valid email address."\n        ]\n    }\n}\n'})}),"\n",(0,r.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Register Drivers First"}),": Ensure drivers are registered before creating tasks"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// \u2705 Good - Register in service provider\nFlowTaskRegistry::register(SendEmailTask::class);\n"})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Use Fully Qualified Class Names"}),": Always use complete namespace"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// \u2705 Good\n'driver' => 'App\\FlowTasks\\SendEmailTask'\n\n// \u274c Bad\n'driver' => 'SendEmailTask'\n"})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Validate Config Structure"}),": Match config to driver's form definition"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// \u2705 Good - Matches form\n'config' => [\n    'recipient' => 'user@example.com',\n    'subject' => 'Test',\n]\n"})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Set Appropriate Ordering"}),": Use ordering to control execution sequence"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// \u2705 Good\n'ordering' => 1, // First task\n'ordering' => 2, // Second task\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/packages/laravel-flow/deep-diving/services/flow-task",children:"FlowTask Service"})," - Task management"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/packages/laravel-flow/deep-diving/requests/update-flow-task-request",children:"UpdateFlowTaskRequest"})," - Task update validation"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-task-resource",children:"FlowTaskResource"})," - Task JSON resource"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/packages/laravel-flow/deep-diving/support/flow-task-registry",children:"FlowTaskRegistry"})," - Driver registration"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/packages/laravel-flow/deep-diving/make-task",children:"MakeTask Command"})," - Creating task drivers"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/packages/laravel-flow/deep-diving/events",children:"Events"})," - Task lifecycle events"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,i,n){n.d(i,{R:()=>a,x:()=>t});var s=n(6540);const r={},l=s.createContext(r);function a(e){const i=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function t(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(l.Provider,{value:i},e.children)}}}]);