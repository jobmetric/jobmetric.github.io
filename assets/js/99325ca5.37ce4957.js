"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[3284],{7583(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"laravel-unit-converter/deep-diving/events/unit-store-event","title":"UnitStoreEvent","description":"Dispatched after a new unit has been successfully created and stored in the database.","source":"@site/packages/laravel-unit-converter/deep-diving/events/unit-store-event.md","sourceDirName":"laravel-unit-converter/deep-diving/events","slug":"/laravel-unit-converter/deep-diving/events/unit-store-event","permalink":"/packages/laravel-unit-converter/deep-diving/events/unit-store-event","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-unit-converter/deep-diving/events/unit-store-event.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"UnitStoreEvent"},"sidebar":"packagesSidebar","previous":{"title":"Models","permalink":"/packages/laravel-unit-converter/deep-diving/models"},"next":{"title":"UnitUpdateEvent","permalink":"/packages/laravel-unit-converter/deep-diving/events/unit-update-event"}}');var s=t(74848),r=t(28453);const a={sidebar_position:1,sidebar_label:"UnitStoreEvent"},l="UnitStoreEvent",d={},c=[{value:"Namespace",id:"namespace",level:2},{value:"Event Key",id:"event-key",level:2},{value:"Class Definition",id:"class-definition",level:2},{value:"Properties",id:"properties",level:2},{value:"When Is It Dispatched?",id:"when-is-it-dispatched",level:2},{value:"Accessing Event Data",id:"accessing-event-data",level:2},{value:"Registering Listeners",id:"registering-listeners",level:2},{value:"Using EventServiceProvider",id:"using-eventserviceprovider",level:3},{value:"Using Closure",id:"using-closure",level:3},{value:"Using Attribute (Laravel 11+)",id:"using-attribute-laravel-11",level:3},{value:"Example Listeners",id:"example-listeners",level:2},{value:"Audit Logging",id:"audit-logging",level:3},{value:"Cache Invalidation",id:"cache-invalidation",level:3},{value:"External API Sync",id:"external-api-sync",level:3},{value:"Admin Notification",id:"admin-notification",level:3},{value:"Queued Listeners",id:"queued-listeners",level:2},{value:"Event Definition",id:"event-definition",level:2},{value:"Related Events",id:"related-events",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"unitstoreevent",children:"UnitStoreEvent"})}),"\n",(0,s.jsx)(n.p,{children:"Dispatched after a new unit has been successfully created and stored in the database."}),"\n",(0,s.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"JobMetric\\UnitConverter\\Events\\UnitStoreEvent\n"})}),"\n",(0,s.jsx)(n.h2,{id:"event-key",children:"Event Key"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"unit.stored\n"})}),"\n",(0,s.jsx)(n.h2,{id:"class-definition",children:"Class Definition"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"readonly class UnitStoreEvent implements DomainEvent\n{\n    public function __construct(\n        public Unit $unit,\n        public array $data\n    ) {\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"$unit"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Unit"})}),(0,s.jsx)(n.td,{children:"The newly created Unit model instance"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"$data"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"array"})}),(0,s.jsx)(n.td,{children:"The original data array used to create the unit"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"when-is-it-dispatched",children:"When Is It Dispatched?"}),"\n",(0,s.jsxs)(n.p,{children:["This event is dispatched by the ",(0,s.jsx)(n.code,{children:"UnitConverter::store()"})," method after:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Input data has been validated"}),"\n",(0,s.jsx)(n.li,{children:"The unit record has been created in the database"}),"\n",(0,s.jsx)(n.li,{children:"Translations have been stored"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n$response = UnitConverter::store([\n    'type' => 'weight',\n    'value' => 1000,\n    'status' => true,\n    'translation' => [\n        'en' => ['name' => 'Kilogram', 'code' => 'kg'],\n    ],\n]);\n\n// UnitStoreEvent is dispatched here with:\n// - $unit: The created Unit model\n// - $data: The input array above\n"})}),"\n",(0,s.jsx)(n.h2,{id:"accessing-event-data",children:"Accessing Event Data"}),"\n",(0,s.jsx)(n.p,{children:"In your listener, you can access the event properties:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\nclass HandleUnitCreation\n{\n    public function handle(UnitStoreEvent $event): void\n    {\n        // Access the created unit\n        $unit = $event->unit;\n        \n        echo $unit->id;        // e.g., 5\n        echo $unit->type;      // e.g., 'weight'\n        echo $unit->value;     // e.g., 1000\n        echo $unit->status;    // e.g., true\n        \n        // Access the original input data\n        $data = $event->data;\n        \n        $translations = $data['translation'];\n        // ['en' => ['name' => 'Kilogram', 'code' => 'kg']]\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"registering-listeners",children:"Registering Listeners"}),"\n",(0,s.jsx)(n.h3,{id:"using-eventserviceprovider",children:"Using EventServiceProvider"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// app/Providers/EventServiceProvider.php\n\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\nuse App\\Listeners\\LogUnitCreation;\nuse App\\Listeners\\NotifyAdminNewUnit;\nuse App\\Listeners\\SyncUnitToExternalService;\n\nprotected $listen = [\n    UnitStoreEvent::class => [\n        LogUnitCreation::class,\n        NotifyAdminNewUnit::class,\n        SyncUnitToExternalService::class,\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"using-closure",children:"Using Closure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'// app/Providers/AppServiceProvider.php\n\nuse Illuminate\\Support\\Facades\\Event;\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\npublic function boot(): void\n{\n    Event::listen(UnitStoreEvent::class, function (UnitStoreEvent $event) {\n        \\Log::info("New unit created: {$event->unit->id}");\n    });\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"using-attribute-laravel-11",children:"Using Attribute (Laravel 11+)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Events\\Attribute\\AsEventListener;\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\n#[AsEventListener]\nclass LogUnitCreation\n{\n    public function __invoke(UnitStoreEvent $event): void\n    {\n        \\Log::info(\"Unit created\", [\n            'id' => $event->unit->id,\n            'type' => $event->unit->type,\n        ]);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"example-listeners",children:"Example Listeners"}),"\n",(0,s.jsx)(n.h3,{id:"audit-logging",children:"Audit Logging"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse App\\Models\\AuditLog;\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\nclass LogUnitCreation\n{\n    public function handle(UnitStoreEvent $event): void\n    {\n        AuditLog::create([\n            'action' => 'unit.created',\n            'model_type' => 'Unit',\n            'model_id' => $event->unit->id,\n            'user_id' => auth()->id(),\n            'data' => [\n                'type' => $event->unit->type,\n                'value' => $event->unit->value,\n                'translations' => $event->data['translation'] ?? [],\n            ],\n            'ip_address' => request()->ip(),\n        ]);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cache-invalidation",children:"Cache Invalidation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse Illuminate\\Support\\Facades\\Cache;\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\nclass InvalidateUnitCache\n{\n    public function handle(UnitStoreEvent $event): void\n    {\n        // Clear type-specific cache\n        Cache::forget(\"units:type:{$event->unit->type}\");\n        \n        // Clear all units cache\n        Cache::forget('units:all');\n        \n        // Clear unit count cache\n        Cache::forget('units:count');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"external-api-sync",children:"External API Sync"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse App\\Jobs\\SyncUnitToExternalApi;\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\nclass SyncNewUnit\n{\n    public function handle(UnitStoreEvent $event): void\n    {\n        // Dispatch job to sync to external system\n        SyncUnitToExternalApi::dispatch($event->unit, 'create');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"admin-notification",children:"Admin Notification"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse App\\Models\\User;\nuse App\\Notifications\\NewUnitCreated;\nuse Illuminate\\Support\\Facades\\Notification;\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\nclass NotifyAdminNewUnit\n{\n    public function handle(UnitStoreEvent $event): void\n    {\n        $admins = User::role('admin')->get();\n        \n        Notification::send($admins, new NewUnitCreated($event->unit));\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"queued-listeners",children:"Queued Listeners"}),"\n",(0,s.jsx)(n.p,{children:"For time-consuming operations, use queued listeners:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse Illuminate\\Contracts\\Queue\\ShouldQueue;\nuse Illuminate\\Queue\\InteractsWithQueue;\nuse JobMetric\\UnitConverter\\Events\\UnitStoreEvent;\n\nclass ProcessNewUnit implements ShouldQueue\n{\n    use InteractsWithQueue;\n\n    public $queue = 'units';\n    \n    public $delay = 10; // Delay in seconds\n\n    public function handle(UnitStoreEvent $event): void\n    {\n        // Heavy processing that runs in background\n        $this->generateUnitReport($event->unit);\n        $this->syncToDataWarehouse($event->unit);\n    }\n    \n    public function failed(UnitStoreEvent $event, \\Throwable $exception): void\n    {\n        // Handle failure\n        \\Log::error(\"Failed to process unit: {$event->unit->id}\", [\n            'exception' => $exception->getMessage(),\n        ]);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"event-definition",children:"Event Definition"}),"\n",(0,s.jsxs)(n.p,{children:["The event implements ",(0,s.jsx)(n.code,{children:"DomainEvent"})," interface with metadata:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"public static function definition(): DomainEventDefinition\n{\n    return new DomainEventDefinition(\n        key: 'unit.stored',\n        entityName: 'unit-converter::base.entity_names.unit',\n        title: 'unit-converter::base.events.unit_stored.title',\n        description: 'unit-converter::base.events.unit_stored.description',\n        icon: 'fas fa-save',\n        tags: ['unit', 'storage', 'management']\n    );\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This metadata can be used for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Event discovery and documentation"}),"\n",(0,s.jsx)(n.li,{children:"Admin panel event listings"}),"\n",(0,s.jsx)(n.li,{children:"Filtering and categorizing events"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-events",children:"Related Events"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./unit-update-event",children:"UnitUpdateEvent"})," - Dispatched when a unit is updated"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./unit-delete-event",children:"UnitDeleteEvent"})," - Dispatched when a unit is deleted"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453(e,n,t){t.d(n,{R:()=>a,x:()=>l});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);