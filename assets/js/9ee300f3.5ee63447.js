"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[8228],{28453(e,n,i){i.d(n,{R:()=>o,x:()=>l});var t=i(96540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},39994(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"laravel-language/deep-diving/middleware/set-timezone-middleware","title":"SetTimezoneMiddleware","description":"The SetTimezoneMiddleware automatically sets the application timezone based on user preferences, request parameters, or language settings, enabling accurate date and time handling for global applications.","source":"@site/packages/laravel-language/deep-diving/middleware/set-timezone-middleware.md","sourceDirName":"laravel-language/deep-diving/middleware","slug":"/laravel-language/deep-diving/middleware/set-timezone-middleware","permalink":"/packages/laravel-language/deep-diving/middleware/set-timezone-middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-language/deep-diving/middleware/set-timezone-middleware.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"SetTimezoneMiddleware"},"sidebar":"packagesSidebar","previous":{"title":"SetLanguageMiddleware","permalink":"/packages/laravel-language/deep-diving/middleware/set-language-middleware"},"next":{"title":"StoreLanguageRequest","permalink":"/packages/laravel-language/deep-diving/requests/store-language-request"}}');var s=i(74848),r=i(28453),o=i(28774);const l={sidebar_position:2,sidebar_label:"SetTimezoneMiddleware"},a="SetTimezoneMiddleware",d={},c=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Why Use This Middleware?",id:"why-use-this-middleware",level:2},{value:"Problem Without Middleware",id:"problem-without-middleware",level:3},{value:"Solution With Middleware",id:"solution-with-middleware",level:3},{value:"Usage",id:"usage",level:2},{value:"Basic Registration",id:"basic-registration",level:3},{value:"API Routes",id:"api-routes",level:3},{value:"Specific Routes",id:"specific-routes",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Priority System",id:"priority-system",level:3},{value:"Timezone Resolution",id:"timezone-resolution",level:3},{value:"Real-World Use Cases",id:"real-world-use-cases",level:2},{value:"Use Case 1: Global Event Management System",id:"use-case-1-global-event-management-system",level:3},{value:"Use Case 2: E-Commerce Order Tracking",id:"use-case-2-e-commerce-order-tracking",level:3},{value:"Use Case 3: Appointment Booking System",id:"use-case-3-appointment-booking-system",level:3},{value:"Use Case 4: Social Media Platform",id:"use-case-4-social-media-platform",level:3},{value:"Use Case 5: Analytics Dashboard",id:"use-case-5-analytics-dashboard",level:3},{value:"Integration with Helper Functions",id:"integration-with-helper-functions",level:2},{value:"client_timezone()",id:"client_timezone",level:3},{value:"tz_format()",id:"tz_format",level:3},{value:"tz_carbon()",id:"tz_carbon",level:3},{value:"Complete Setup Example",id:"complete-setup-example",level:2},{value:"Step 1: Register Middleware",id:"step-1-register-middleware",level:3},{value:"Step 2: Send Timezone in Requests",id:"step-2-send-timezone-in-requests",level:3},{value:"Step 3: Use in Controllers",id:"step-3-use-in-controllers",level:3},{value:"Step 4: Custom Timezone Detection",id:"step-4-custom-timezone-detection",level:3},{value:"When to Use SetTimezoneMiddleware",id:"when-to-use-settimezonemiddleware",level:2},{value:"When NOT to Use",id:"when-not-to-use",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always Store Dates in UTC",id:"1-always-store-dates-in-utc",level:3},{value:"2. Use Helper Functions",id:"2-use-helper-functions",level:3},{value:"3. Set User Timezone on Registration",id:"3-set-user-timezone-on-registration",level:3},{value:"4. Allow Timezone Override",id:"4-allow-timezone-override",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"settimezonemiddleware",children:"SetTimezoneMiddleware"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"SetTimezoneMiddleware"})," automatically sets the application timezone based on user preferences, request parameters, or language settings, enabling accurate date and time handling for global applications."]}),"\n",(0,s.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"JobMetric\\Language\\Http\\Middleware\\SetTimezoneMiddleware\n"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["This middleware intelligently sets the application timezone, which is then used by helper functions like ",(0,s.jsx)(n.code,{children:"client_timezone()"}),", ",(0,s.jsx)(n.code,{children:"tz_format()"}),", and ",(0,s.jsx)(n.code,{children:"tz_carbon()"})," to ensure all dates and times are displayed in the user's local timezone."]}),"\n",(0,s.jsx)(n.p,{children:"The middleware determines timezone from:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Accept-Timezone"})," header (if present and valid)"]}),"\n",(0,s.jsxs)(n.li,{children:["Config fallback ",(0,s.jsx)(n.code,{children:"config('app.timezone')"})," (defaults to 'UTC' if invalid)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"why-use-this-middleware",children:"Why Use This Middleware?"}),"\n",(0,s.jsx)(n.h3,{id:"problem-without-middleware",children:"Problem Without Middleware"}),"\n",(0,s.jsx)(n.p,{children:"Without this middleware, you would face:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Incorrect Date Display"}),": All dates shown in server timezone, confusing users"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Manual Timezone Handling"}),": Need to convert timezones in every controller"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Inconsistent Experience"}),": Different parts of app might use different timezones"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Complex Calculations"}),": Manual timezone conversions everywhere"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User Confusion"}),": Users see times that don't match their local time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scheduling Issues"}),": Events and appointments shown in wrong timezone"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"solution-with-middleware",children:"Solution With Middleware"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"SetTimezoneMiddleware"})," solves all these problems:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automatic Detection"}),": Sets timezone automatically based on user context"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consistent Experience"}),": All dates/times use the same timezone throughout request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Helper Integration"}),": Works seamlessly with timezone helper functions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Language Integration"}),": Uses timezone from language settings when available"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Session Persistence"}),": Remembers user's timezone preference"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Zero Configuration"}),": Works out of the box with sensible defaults"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.h3,{id:"basic-registration",children:"Basic Registration"}),"\n",(0,s.jsxs)(n.p,{children:["Register in ",(0,s.jsx)(n.code,{children:"app/Http/Kernel.php"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"protected $middlewareGroups = [\n    'web' => [\n        // ... other middleware\n        \\JobMetric\\Language\\Http\\Middleware\\SetTimezoneMiddleware::class,\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-routes",children:"API Routes"}),"\n",(0,s.jsxs)(n.p,{children:["For API routes, register in the ",(0,s.jsx)(n.code,{children:"api"})," middleware group:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"protected $middlewareGroups = [\n    'api' => [\n        // ... other middleware\n        \\JobMetric\\Language\\Http\\Middleware\\SetTimezoneMiddleware::class,\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"specific-routes",children:"Specific Routes"}),"\n",(0,s.jsx)(n.p,{children:"Apply to specific routes only:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"Route::middleware([\n    \\JobMetric\\Language\\Http\\Middleware\\SetTimezoneMiddleware::class\n])->group(function () {\n    Route::get('/events', [EventController::class, 'index']);\n    Route::get('/appointments', [AppointmentController::class, 'index']);\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(n.h3,{id:"priority-system",children:"Priority System"}),"\n",(0,s.jsx)(n.p,{children:"The middleware follows this priority order:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Accept-Timezone Header"})," (Highest Priority)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Checks for ",(0,s.jsx)(n.code,{children:"Accept-Timezone"})," header in request"]}),"\n",(0,s.jsxs)(n.li,{children:["Example: ",(0,s.jsx)(n.code,{children:"Accept-Timezone: America/New_York"})]}),"\n",(0,s.jsx)(n.li,{children:"Validates timezone identifier (IANA format)"}),"\n",(0,s.jsx)(n.li,{children:"Useful for API clients and browser-based timezone detection"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Config Fallback"})," (Lowest Priority)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Uses ",(0,s.jsx)(n.code,{children:"config('app.timezone')"})," as fallback"]}),"\n",(0,s.jsx)(n.li,{children:"Defaults to 'UTC' if config value is invalid"}),"\n",(0,s.jsx)(n.li,{children:"Ensures a valid timezone is always set"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"timezone-resolution",children:"Timezone Resolution"}),"\n",(0,s.jsx)(n.p,{children:"The middleware resolves timezone using this logic:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Priority 1: Accept-Timezone header\n$timezone = $request->header('Accept-Timezone');\nif ($this->isValidTimezone($timezone)) {\n    // Use header value\n} else {\n    // Priority 2: Config fallback\n    $timezone = config('app.timezone', 'UTC');\n    if (!$this->isValidTimezone($timezone)) {\n        $timezone = 'UTC'; // Final fallback\n    }\n}\n\n// Store for request lifetime\nconfig(['app.client_timezone' => $timezone]);\n$request->headers->set('Accept-Timezone', $timezone);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important Notes"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The middleware does ",(0,s.jsx)(n.strong,{children:"NOT"})," change ",(0,s.jsx)(n.code,{children:"config('app.timezone')"})," or PHP's default timezone"]}),"\n",(0,s.jsxs)(n.li,{children:["It stores the client timezone in ",(0,s.jsx)(n.code,{children:"config('app.client_timezone')"})," for the current request only"]}),"\n",(0,s.jsxs)(n.li,{children:["Helper functions like ",(0,s.jsx)(n.code,{children:"client_timezone()"})," read from ",(0,s.jsx)(n.code,{children:"config('app.client_timezone')"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"real-world-use-cases",children:"Real-World Use Cases"}),"\n",(0,s.jsx)(n.h3,{id:"use-case-1-global-event-management-system",children:"Use Case 1: Global Event Management System"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scenario"}),": An event management platform needs to show event times in each user's local timezone."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem Without Middleware"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'// All events shown in server timezone (UTC)\n$event = Event::find(1);\necho $event->starts_at; // "2024-01-15 14:00:00" (UTC)\n// User in New York sees: 2:00 PM (but it\'s actually 9:00 AM their time!)\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution With Middleware"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Middleware automatically sets user's timezone\n// User in New York: timezone = 'America/New_York'\n\n// In controller\n$event = Event::find(1);\n\n// Helper functions use middleware-set timezone\necho tz_format($event->starts_at); // \"2024-01-15 09:00:00\" (New York time)\necho tz_carbon($event->starts_at)->format('g:i A'); // \"9:00 AM\"\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Users see event times in their local timezone"}),"\n",(0,s.jsx)(n.li,{children:"No confusion about when events occur"}),"\n",(0,s.jsx)(n.li,{children:"Better user experience and fewer missed events"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-case-2-e-commerce-order-tracking",children:"Use Case 2: E-Commerce Order Tracking"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scenario"}),": An e-commerce platform needs to show order timestamps in customer's timezone."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Middleware sets customer's timezone\n// Customer in Tokyo: timezone = 'Asia/Tokyo'\n\n// Order confirmation email\n$order = Order::find(123);\n\n// Dates automatically in customer's timezone\n$data = [\n    'order_date' => tz_format($order->created_at), // Tokyo time\n    'estimated_delivery' => tz_format($order->estimated_delivery), // Tokyo time\n    'current_time' => tz_carbon(now())->format('Y-m-d H:i:s'), // Tokyo time\n];\n\nMail::to($order->customer)->send(new OrderConfirmation($data));\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Customers see order times in their local timezone"}),"\n",(0,s.jsx)(n.li,{children:"Delivery estimates make sense to customers"}),"\n",(0,s.jsx)(n.li,{children:'Reduced support inquiries about "wrong" times'}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-case-3-appointment-booking-system",children:"Use Case 3: Appointment Booking System"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scenario"}),": A healthcare appointment system needs to show available slots in patient's timezone."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Patient in London: timezone = 'Europe/London'\n// Doctor in New York: timezone = 'America/New_York'\n\n// Show available slots in patient's timezone\n$slots = AppointmentSlot::where('doctor_id', $doctorId)\n    ->where('date', '>=', now())\n    ->get()\n    ->map(function ($slot) {\n        return [\n            'id' => $slot->id,\n            'date' => tz_format($slot->date), // Patient's timezone\n            'time' => tz_carbon($slot->date)->format('g:i A'), // Patient's timezone\n            'available' => $slot->isAvailable(),\n        ];\n    });\n\nreturn response()->json($slots);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Patients see appointment times in their timezone"}),"\n",(0,s.jsx)(n.li,{children:"No confusion about booking times"}),"\n",(0,s.jsx)(n.li,{children:"Better booking experience"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-case-4-social-media-platform",children:"Use Case 4: Social Media Platform"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scenario"}),": A social media platform needs to show post timestamps in user's timezone."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// User in Dubai: timezone = 'Asia/Dubai'\n\n// Timeline posts\n$posts = Post::latest()->paginate(20);\n\nreturn view('timeline', [\n    'posts' => $posts->map(function ($post) {\n        return [\n            'id' => $post->id,\n            'content' => $post->content,\n            'posted_at' => tz_carbon($post->created_at)->diffForHumans(), // \"2 hours ago\" (Dubai time)\n            'posted_time' => tz_format($post->created_at, 'g:i A'), // \"3:45 PM\" (Dubai time)\n        ];\n    }),\n]);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Users see "2 hours ago" relative to their timezone'}),"\n",(0,s.jsx)(n.li,{children:"Timestamps make sense to users"}),"\n",(0,s.jsx)(n.li,{children:"Better engagement and user experience"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-case-5-analytics-dashboard",children:"Use Case 5: Analytics Dashboard"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scenario"}),": An analytics dashboard needs to show metrics in user's timezone for accurate reporting."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Admin in Sydney: timezone = 'Australia/Sydney'\n\n// Daily analytics\n$startOfDay = tz_carbon(now())->startOfDay(); // Sydney midnight\n$endOfDay = tz_carbon(now())->endOfDay(); // Sydney 11:59 PM\n\n$metrics = [\n    'today_visits' => Visit::whereBetween('created_at', [$startOfDay, $endOfDay])->count(),\n    'today_orders' => Order::whereBetween('created_at', [$startOfDay, $endOfDay])->count(),\n    'today_revenue' => Order::whereBetween('created_at', [$startOfDay, $endOfDay])->sum('total'),\n];\n\n// All metrics are for \"today\" in admin's timezone\nreturn view('analytics.dashboard', compact('metrics'));\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Reports show data for "today" in admin\'s timezone'}),"\n",(0,s.jsx)(n.li,{children:"Accurate daily/weekly/monthly reports"}),"\n",(0,s.jsx)(n.li,{children:"No confusion about time ranges"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"integration-with-helper-functions",children:"Integration with Helper Functions"}),"\n",(0,s.jsx)(n.p,{children:"The middleware works seamlessly with timezone helper functions:"}),"\n",(0,s.jsx)(n.h3,{id:"client_timezone",children:"client_timezone()"}),"\n",(0,s.jsx)(n.p,{children:"Get the current client timezone:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Middleware sets timezone to 'America/New_York'\n$timezone = client_timezone(); // 'America/New_York'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"tz_format",children:"tz_format()"}),"\n",(0,s.jsx)(n.p,{children:"Format dates in client timezone:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$date = now(); // Server time: 2024-01-15 14:00:00 (UTC)\n\n// Middleware sets timezone to 'America/New_York'\n$formatted = tz_format($date); // \"2024-01-15 09:00:00\" (New York time)\n$formatted = tz_format($date, 'Y-m-d H:i:s'); // Custom format\n"})}),"\n",(0,s.jsx)(n.h3,{id:"tz_carbon",children:"tz_carbon()"}),"\n",(0,s.jsx)(n.p,{children:"Get Carbon instance in client timezone:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$date = now(); // Server time\n\n// Middleware sets timezone to 'Asia/Tokyo'\n$carbon = tz_carbon($date); // Carbon instance in Tokyo timezone\n\necho $carbon->format('Y-m-d H:i:s'); // Tokyo time\necho $carbon->diffForHumans(); // Relative time in Tokyo timezone\n"})}),"\n",(0,s.jsx)(n.h2,{id:"complete-setup-example",children:"Complete Setup Example"}),"\n",(0,s.jsx)(n.h3,{id:"step-1-register-middleware",children:"Step 1: Register Middleware"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// app/Http/Kernel.php\nprotected $middlewareGroups = [\n    'web' => [\n        \\Illuminate\\Cookie\\Middleware\\EncryptCookies::class,\n        \\Illuminate\\Session\\Middleware\\StartSession::class,\n        \\JobMetric\\Language\\Http\\Middleware\\SetLanguageMiddleware::class,\n        \\JobMetric\\Language\\Http\\Middleware\\SetTimezoneMiddleware::class,\n        // ... other middleware\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-send-timezone-in-requests",children:"Step 2: Send Timezone in Requests"}),"\n",(0,s.jsx)(n.p,{children:"For web applications, you can send timezone via JavaScript:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Detect user timezone\nconst timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n// Send with every request\nfetch('/api/events', {\n    headers: {\n        'Accept-Timezone': timezone\n    }\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or set it in your frontend framework:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Axios interceptor\naxios.interceptors.request.use(config => {\n    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n    config.headers['Accept-Timezone'] = timezone;\n    return config;\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"For API clients, include the header:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// API client example\n$response = Http::withHeaders([\n    'Accept-Timezone' => 'America/New_York'\n])->get('https://api.example.com/events');\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-3-use-in-controllers",children:"Step 3: Use in Controllers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// app/Http/Controllers/EventController.php\npublic function index()\n{\n    $events = Event::upcoming()\n        ->get()\n        ->map(function ($event) {\n            return [\n                'id' => $event->id,\n                'title' => $event->title,\n                'starts_at' => tz_format($event->starts_at),\n                'starts_at_formatted' => tz_carbon($event->starts_at)->format('l, F j, Y \\a\\t g:i A'),\n                'timezone' => client_timezone(),\n            ];\n        });\n    \n    return view('events.index', compact('events'));\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-4-custom-timezone-detection",children:"Step 4: Custom Timezone Detection"}),"\n",(0,s.jsxs)(n.p,{children:["You can extend the middleware behavior by creating a custom middleware that sets the ",(0,s.jsx)(n.code,{children:"Accept-Timezone"})," header:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// app/Http/Middleware/DetectUserTimezone.php\nclass DetectUserTimezone\n{\n    public function handle(Request $request, Closure $next)\n    {\n        // Check session first\n        if ($request->hasSession() && $request->session()->has('timezone')) {\n            $timezone = $request->session()->get('timezone');\n        }\n        // Check user profile\n        elseif (auth()->check() && auth()->user()->timezone) {\n            $timezone = auth()->user()->timezone;\n        }\n        // Check language timezone\n        elseif ($language = CurrentLanguage::resolve() && $language->timezone) {\n            $timezone = $language->timezone;\n        }\n        \n        // Set header for SetTimezoneMiddleware to use\n        if (isset($timezone)) {\n            $request->headers->set('Accept-Timezone', $timezone);\n        }\n        \n        return $next($request);\n    }\n}\n\n// Register before SetTimezoneMiddleware\nprotected $middlewareGroups = [\n    'web' => [\n        \\App\\Http\\Middleware\\DetectUserTimezone::class,\n        \\JobMetric\\Language\\Http\\Middleware\\SetTimezoneMiddleware::class,\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use-settimezonemiddleware",children:"When to Use SetTimezoneMiddleware"}),"\n",(0,s.jsx)(n.p,{children:"Use this middleware when you need to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automatic Timezone Detection"}),": Automatically detect and set timezone from user context"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User Timezone"}),": Support user-specific timezones for personalized experience"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Date Formatting"}),": Format dates in user's timezone throughout the application"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Global Applications"}),": Support users in different timezones seamlessly"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event Management"}),": Show event times in user's local timezone"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"E-Commerce"}),": Display order timestamps in customer's timezone"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Appointment Systems"}),": Show available slots in user's timezone"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Social Media"}),": Display post timestamps relative to user's timezone"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics"}),": Show reports in admin's timezone for accurate data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Notifications"}),": Send notifications with times in user's timezone"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"when-not-to-use",children:"When NOT to Use"}),"\n",(0,s.jsx)(n.p,{children:"You might not need this middleware if:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Your application only serves users in one timezone"}),"\n",(0,s.jsx)(n.li,{children:"You handle timezone conversion manually in controllers"}),"\n",(0,s.jsx)(n.li,{children:"You use a different timezone management strategy"}),"\n",(0,s.jsx)(n.li,{children:"All dates are stored and displayed in UTC only"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-always-store-dates-in-utc",children:"1. Always Store Dates in UTC"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Store in UTC\n$event->starts_at = Carbon::parse($request->input('starts_at'), $userTimezone)->utc();\n$event->save();\n\n// Display in user timezone\necho tz_format($event->starts_at); // Automatically converted\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-use-helper-functions",children:"2. Use Helper Functions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Good: Use helper functions\n$formatted = tz_format($date);\n$carbon = tz_carbon($date);\n\n// Bad: Manual timezone conversion\n$formatted = Carbon::parse($date)->setTimezone($timezone)->format('Y-m-d H:i:s');\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-set-user-timezone-on-registration",children:"3. Set User Timezone on Registration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// When user registers, detect and set timezone\npublic function register(Request $request)\n{\n    $user = User::create([...]);\n    \n    // Detect timezone from request or use default\n    $timezone = $request->input('timezone') ?? config('app.timezone');\n    session(['timezone' => $timezone]);\n    \n    $user->update(['timezone' => $timezone]);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-allow-timezone-override",children:"4. Allow Timezone Override"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Provide timezone selector in user settings\n<select name=\"timezone\">\n    @foreach(timezone_identifiers_list() as $tz)\n        <option value=\"{{ $tz }}\" {{ $tz === session('timezone') ? 'selected' : '' }}>\n            {{ $tz }}\n        </option>\n    @endforeach\n</select>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(o.A,{to:"/packages/laravel-language/deep-diving/middleware/set-language-middleware",children:"SetLanguageMiddleware"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(o.A,{to:"/packages/laravel-language/deep-diving/support/helpers",children:"Helper Functions"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(o.A,{to:"/packages/laravel-language/deep-diving/models/language",children:"Language Model"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(o.A,{to:"/packages/laravel-language/deep-diving/support/current-language",children:"CurrentLanguage"}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}}}]);