"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[6925],{8898(e,n,l){l.r(n),l.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"laravel-flow/deep-diving/services/flow","title":"Flow Service","description":"The Flow service provides comprehensive CRUD operations and workflow management functionality for Laravel Flow. You can use it directly via the service class or through the convenient Facade.","source":"@site/packages/laravel-flow/deep-diving/services/flow.md","sourceDirName":"laravel-flow/deep-diving/services","slug":"/laravel-flow/deep-diving/services/flow","permalink":"/packages/laravel-flow/deep-diving/services/flow","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/services/flow.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Flow"},"sidebar":"packagesSidebar","previous":{"title":"HasFlow","permalink":"/packages/laravel-flow/deep-diving/has-flow"},"next":{"title":"FlowState","permalink":"/packages/laravel-flow/deep-diving/services/flow-state"}}');var a=l(74848),t=l(28453);const i={sidebar_position:1,sidebar_label:"Flow"},o="Flow Service",r={},d=[{value:"Namespace",id:"namespace",level:2},{value:"Facade",id:"facade",level:2},{value:"Basic CRUD Operations",id:"basic-crud-operations",level:2},{value:"Store",id:"store",level:3},{value:"Show",id:"show",level:3},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3},{value:"Restore",id:"restore",level:3},{value:"Force Delete",id:"force-delete",level:3},{value:"Workflow Management",id:"workflow-management",level:2},{value:"Toggle Status",id:"toggle-status",level:3},{value:"Get Start State",id:"get-start-state",level:3},{value:"Get End States",id:"get-end-states",level:3},{value:"Set Default",id:"set-default",level:3},{value:"Set Active Window",id:"set-active-window",level:3},{value:"Set Rollout",id:"set-rollout",level:3},{value:"Reorder",id:"reorder",level:3},{value:"Duplicate",id:"duplicate",level:3},{value:"State Management",id:"state-management",level:2},{value:"Get States",id:"get-states",level:3},{value:"Get States by Status Map",id:"get-states-by-status-map",level:3},{value:"Validation",id:"validation",level:2},{value:"Validate Consistency",id:"validate-consistency",level:3},{value:"Flow Picking",id:"flow-picking",level:2},{value:"Preview Pick",id:"preview-pick",level:3},{value:"Import &amp; Export",id:"import--export",level:2},{value:"Export",id:"export",level:3},{value:"Import",id:"import",level:3},{value:"Response Format",id:"response-format",level:2},{value:"Direct Service Usage",id:"direct-service-usage",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"flow-service",children:"Flow Service"})}),"\n",(0,a.jsx)(n.p,{children:"The Flow service provides comprehensive CRUD operations and workflow management functionality for Laravel Flow. You can use it directly via the service class or through the convenient Facade."}),"\n",(0,a.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\Services\\Flow\n"})}),"\n",(0,a.jsx)(n.h2,{id:"facade",children:"Facade"}),"\n",(0,a.jsx)(n.p,{children:"For convenience, you can use the Flow Facade:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"basic-crud-operations",children:"Basic CRUD Operations"}),"\n",(0,a.jsx)(n.h3,{id:"store",children:"Store"}),"\n",(0,a.jsx)(n.p,{children:"Create a new workflow flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n\n$response = Flow::store([\n    'subject_type' => 'App\\Models\\Order',\n    'subject_scope' => null,\n    'subject_collection' => null,\n    'version' => 1,\n    'channel' => 'web',\n    'environment' => 'production',\n]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"show",children:"Show"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve a specific flow by ID."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::show($flowId);\n\n// With relations\n$response = Flow::show($flowId, ['states', 'transitions']);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,a.jsx)(n.p,{children:"Update an existing flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::update($flowId, [\n    'channel' => 'api',\n    'environment' => 'staging',\n]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"delete",children:"Delete"}),"\n",(0,a.jsx)(n.p,{children:"Soft delete a flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::delete($flowId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"restore",children:"Restore"}),"\n",(0,a.jsx)(n.p,{children:"Restore a soft-deleted flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::restore($flowId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"force-delete",children:"Force Delete"}),"\n",(0,a.jsx)(n.p,{children:"Permanently delete a flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::forceDelete($flowId);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"workflow-management",children:"Workflow Management"}),"\n",(0,a.jsx)(n.h3,{id:"toggle-status",children:"Toggle Status"}),"\n",(0,a.jsx)(n.p,{children:"Enable or disable a flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::toggleStatus($flowId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"get-start-state",children:"Get Start State"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve the START state of a flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$startState = Flow::getStartState($flowId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"get-end-states",children:"Get End States"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve all END states of a flow."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$endStates = Flow::getEndState($flowId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"set-default",children:"Set Default"}),"\n",(0,a.jsx)(n.p,{children:"Mark a flow as the default within its scope (subject_type + subject_scope + version). This will automatically unset other defaults in the same scope."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::setDefault($flowId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"set-active-window",children:"Set Active Window"}),"\n",(0,a.jsxs)(n.p,{children:["Define the active time window for a flow. Set dates to ",(0,a.jsx)(n.code,{children:"null"})," to clear the window."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Support\\Carbon;\n\n$response = Flow::setActiveWindow(\n    $flowId,\n    Carbon::parse('2024-01-01'),\n    Carbon::parse('2024-12-31')\n);\n\n// Clear active window\n$response = Flow::setActiveWindow($flowId, null, null);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"set-rollout",children:"Set Rollout"}),"\n",(0,a.jsxs)(n.p,{children:["Configure the rollout percentage for canary deployments (0-100). Set to ",(0,a.jsx)(n.code,{children:"null"})," to reset to 100% (no canary)."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Set 50% rollout\n$response = Flow::setRollout($flowId, 50);\n\n// Reset to 100%\n$response = Flow::setRollout($flowId, null);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"reorder",children:"Reorder"}),"\n",(0,a.jsx)(n.p,{children:"Reorder multiple flows by providing an array of flow IDs in the desired order."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::reorder([3, 1, 2, 5, 4]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"duplicate",children:"Duplicate"}),"\n",(0,a.jsx)(n.p,{children:"Create a copy of an existing flow, optionally including its states and transitions."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Duplicate with full graph\n$response = Flow::duplicate($flowId, [], true);\n\n// Duplicate without graph\n$response = Flow::duplicate($flowId, [], false);\n\n// Duplicate with overrides\n$response = Flow::duplicate($flowId, [\n    'channel' => 'mobile',\n    'version' => 2,\n], true);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"state-management",children:"State Management"}),"\n",(0,a.jsx)(n.h3,{id:"get-states",children:"Get States"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve all states for a flow, ordered by ID."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$states = Flow::getStates($flowId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"get-states-by-status-map",children:"Get States by Status Map"}),"\n",(0,a.jsx)(n.p,{children:"Get states keyed by their status value for quick lookup."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$statesMap = Flow::getStatesByStatusMap($flowId);\n// Returns: ['pending' => FlowState, 'processing' => FlowState, ...]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,a.jsx)(n.h3,{id:"validate-consistency",children:"Validate Consistency"}),"\n",(0,a.jsx)(n.p,{children:"Validate the structural consistency of a flow definition. This checks:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Exactly one START state exists"}),"\n",(0,a.jsx)(n.li,{children:"START state has no incoming transitions"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::validateConsistency($flowId);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"flow-picking",children:"Flow Picking"}),"\n",(0,a.jsx)(n.h3,{id:"preview-pick",children:"Preview Pick"}),"\n",(0,a.jsx)(n.p,{children:"Preview which flow would be selected for a given subject model."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use App\\Models\\Order;\n\n$order = Order::find(1);\n$flow = Flow::previewPick($order);\n\n// With custom tuner\n$flow = Flow::previewPick($order, function ($builder) {\n    $builder->onlyActive(false)\n            ->orderByDefault(false);\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"import--export",children:"Import & Export"}),"\n",(0,a.jsx)(n.h3,{id:"export",children:"Export"}),"\n",(0,a.jsx)(n.p,{children:"Export a flow to an array structure, optionally including the complete graph (states and transitions)."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Export with graph\n$data = Flow::export($flowId, true);\n\n// Export without graph\n$data = Flow::export($flowId, false);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"import",children:"Import"}),"\n",(0,a.jsx)(n.p,{children:"Import a flow from an exported payload."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$payload = [\n    'flow' => [\n        'subject_type' => 'App\\Models\\Order',\n        'version' => 1,\n        // ... other flow fields\n    ],\n    'states' => [\n        // ... state definitions\n    ],\n    'transitions' => [\n        // ... transition definitions\n    ],\n];\n\n$flow = Flow::import($payload);\n\n// With overrides\n$flow = Flow::import($payload, [\n    'channel' => 'api',\n    'environment' => 'production',\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"response-format",children:"Response Format"}),"\n",(0,a.jsxs)(n.p,{children:["All methods that return a ",(0,a.jsx)(n.code,{children:"Response"})," object follow this structure:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"Response::make(\n    bool $success,\n    string $message,\n    mixed $data = null\n)\n"})}),"\n",(0,a.jsx)(n.p,{children:"Example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$response = Flow::store([...]);\n\nif ($response->isSuccess()) {\n    $flow = $response->getData();\n    // Work with the flow resource\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"direct-service-usage",children:"Direct Service Usage"}),"\n",(0,a.jsx)(n.p,{children:"If you prefer dependency injection over the Facade:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Services\\Flow as FlowService;\n\nclass YourController\n{\n    public function __construct(\n        protected FlowService $flowService\n    ) {}\n\n    public function index()\n    {\n        $response = $this->flowService->store([...]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/store-flow-request",children:"StoreFlowRequest"})," - Validation for flow creation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/update-flow-request",children:"UpdateFlowRequest"})," - Validation for flow updates"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-resource",children:"FlowResource"})," - JSON resource for flows"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-state",children:"FlowState Service"})," - Managing workflow states"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-transition",children:"FlowTransition Service"})," - Managing transitions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-flow",children:"HasFlow"})," - Simple flow binding trait"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-workflow",children:"HasWorkflow"})," - Advanced workflow binding trait"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/support/flow-picker-builder",children:"FlowPickerBuilder"})," - Custom flow selection logic"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/events",children:"Events"})," - Flow lifecycle events"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453(e,n,l){l.d(n,{R:()=>i,x:()=>o});var s=l(96540);const a={},t=s.createContext(a);function i(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);