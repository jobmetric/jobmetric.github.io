"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[2288],{28453(e,n,t){t.d(n,{R:()=>o,x:()=>r});var i=t(96540);const a={},c=i.createContext(a);function o(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(c.Provider,{value:n},e.children)}},94490(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"laravel-reaction/deep-diving/events","title":"Events","description":"Laravel Reaction provides a comprehensive event system that fires domain events for all reaction operations. These events allow you to hook into the reaction lifecycle and perform additional actions when reactions are added or removed.","source":"@site/packages/laravel-reaction/deep-diving/events.md","sourceDirName":"laravel-reaction/deep-diving","slug":"/laravel-reaction/deep-diving/events","permalink":"/packages/laravel-reaction/deep-diving/events","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-reaction/deep-diving/events.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_label":"Events"},"sidebar":"packagesSidebar","previous":{"title":"Reaction","permalink":"/packages/laravel-reaction/deep-diving/models/reaction"},"next":{"title":"InvalidReactionSourceException","permalink":"/packages/laravel-reaction/deep-diving/exceptions/invalid-reaction-source-exception"}}');var a=t(74848),c=t(28453),o=t(28774);const r={sidebar_position:5,sidebar_label:"Events"},s="Events",d={},l=[{value:"Overview",id:"overview",level:2},{value:"Event Structure",id:"event-structure",level:2},{value:"Base Event Structure",id:"base-event-structure",level:3},{value:"Available Events",id:"available-events",level:2},{value:"Reaction Events",id:"reaction-events",level:3},{value:"Listening to Events",id:"listening-to-events",level:2},{value:"Method 1: Event Listeners in Service Provider",id:"method-1-event-listeners-in-service-provider",level:3},{value:"Method 2: Using Event Facade",id:"method-2-using-event-facade",level:3},{value:"Method 3: Using Event Subscribers",id:"method-3-using-event-subscribers",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Cache Invalidation on Reaction Changes",id:"example-1-cache-invalidation-on-reaction-changes",level:3},{value:"Example 2: Audit Logging",id:"example-2-audit-logging",level:3},{value:"Example 3: Notification System",id:"example-3-notification-system",level:3},{value:"Example 4: Analytics Tracking",id:"example-4-analytics-tracking",level:3},{value:"Example 5: Reaction Aggregation",id:"example-5-reaction-aggregation",level:3},{value:"Example 6: Real-time Updates",id:"example-6-real-time-updates",level:3},{value:"Example 7: Spam Detection",id:"example-7-spam-detection",level:3},{value:"Example 8: Complete Event Listener Setup",id:"example-8-complete-event-listener-setup",level:3},{value:"Event Timing",id:"event-timing",level:2},{value:"ReactionAddEvent",id:"reactionaddevent",level:3},{value:"ReactionRemovingEvent / ReactionRemovedEvent",id:"reactionremovingevent--reactionremovedevent",level:3},{value:"Queued Events",id:"queued-events",level:2},{value:"Event Payload Details",id:"event-payload-details",level:2},{value:"ReactionAddEvent",id:"reactionaddevent-1",level:3},{value:"ReactionRemovingEvent / ReactionRemovedEvent",id:"reactionremovingevent--reactionremovedevent-1",level:3},{value:"When to Use Events",id:"when-to-use-events",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function v(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"events",children:"Events"})}),"\n",(0,a.jsx)(n.p,{children:"Laravel Reaction provides a comprehensive event system that fires domain events for all reaction operations. These events allow you to hook into the reaction lifecycle and perform additional actions when reactions are added or removed."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"The event system in Laravel Reaction:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Fires automatically"})," during reaction operations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Provides Reaction model instances"})," in event payloads"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Uses DomainEvent interface"})," for consistency"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Supports event listeners"})," for custom logic"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enables event-driven architecture"})," for reaction management"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"event-structure",children:"Event Structure"}),"\n",(0,a.jsx)(n.p,{children:"All events in Laravel Reaction:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Implement ",(0,a.jsx)(n.code,{children:"JobMetric\\EventSystem\\Contracts\\DomainEvent"})]}),"\n",(0,a.jsxs)(n.li,{children:["Are ",(0,a.jsx)(n.code,{children:"readonly"})," classes for immutability"]}),"\n",(0,a.jsx)(n.li,{children:"Contain the affected Reaction model instance"}),"\n",(0,a.jsxs)(n.li,{children:["Provide a stable ",(0,a.jsx)(n.code,{children:"key()"})," method"]}),"\n",(0,a.jsxs)(n.li,{children:["Include metadata via ",(0,a.jsx)(n.code,{children:"definition()"})," method"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"base-event-structure",children:"Base Event Structure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"readonly class ReactionAddEvent implements DomainEvent\n{\n    public function __construct(\n        public Reaction $reaction\n    ) {}\n\n    public static function key(): string\n    {\n        return 'reaction.added';\n    }\n\n    public static function definition(): DomainEventDefinition\n    {\n        return new DomainEventDefinition(\n            self::key(),\n            'reaction::base.entity_names.reaction',\n            'reaction::base.events.reaction_added.title',\n            'reaction::base.events.reaction_added.description',\n            'fas fa-heart',\n            ['reaction', 'interaction', 'social']\n        );\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"available-events",children:"Available Events"}),"\n",(0,a.jsx)(n.h3,{id:"reaction-events",children:"Reaction Events"}),"\n",(0,a.jsx)(n.p,{children:"Events fired for Reaction operations."}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Event Class"}),(0,a.jsx)(n.th,{children:"Event Key"}),(0,a.jsx)(n.th,{children:"Description"}),(0,a.jsx)(n.th,{children:"Payload"}),(0,a.jsx)(n.th,{children:"Triggered When"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"ReactionAddEvent"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"reaction.added"})}),(0,a.jsx)(n.td,{children:"Fired when a new reaction is added"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"Reaction $reaction"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"HasReaction::addReaction()"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"ReactionRemovingEvent"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"reaction.removing"})}),(0,a.jsx)(n.td,{children:"Fired before a reaction is removed"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"Reaction $reaction"})}),(0,a.jsxs)(n.td,{children:["Before ",(0,a.jsx)(n.code,{children:"Reaction::delete()"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"ReactionRemovedEvent"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"reaction.removed"})}),(0,a.jsx)(n.td,{children:"Fired after a reaction is removed"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"Reaction $reaction"})}),(0,a.jsxs)(n.td,{children:["After ",(0,a.jsx)(n.code,{children:"Reaction::delete()"})]})]})]})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Namespace:"})," ",(0,a.jsx)(n.code,{children:"JobMetric\\Reaction\\Events\\*"})]}),"\n",(0,a.jsx)(n.h2,{id:"listening-to-events",children:"Listening to Events"}),"\n",(0,a.jsx)(n.h3,{id:"method-1-event-listeners-in-service-provider",children:"Method 1: Event Listeners in Service Provider"}),"\n",(0,a.jsx)(n.p,{children:"Register event listeners in a service provider:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Providers;\n\nuse Illuminate\\Foundation\\Support\\Providers\\EventServiceProvider as ServiceProvider;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\n\nclass EventServiceProvider extends ServiceProvider\n{\n    protected $listen = [\n        ReactionAddEvent::class => [\n            \\App\\Listeners\\Reaction\\LogReactionCreation::class,\n            \\App\\Listeners\\Reaction\\InvalidateReactionCache::class,\n            \\App\\Listeners\\Reaction\\NotifyReactionAdded::class,\n        ],\n        ReactionRemovedEvent::class => [\n            \\App\\Listeners\\Reaction\\LogReactionRemoval::class,\n            \\App\\Listeners\\Reaction\\InvalidateReactionCache::class,\n        ],\n    ];\n\n    public function boot(): void\n    {\n        parent::boot();\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"method-2-using-event-facade",children:"Method 2: Using Event Facade"}),"\n",(0,a.jsx)(n.p,{children:"Listen to events using the Event facade:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Illuminate\\Support\\Facades\\Event;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\n\nEvent::listen(ReactionAddEvent::class, function (ReactionAddEvent $event) {\n    $reaction = $event->reaction;\n    \n    // Perform actions\n    Log::info('Reaction added', [\n        'reaction_id' => $reaction->id,\n        'reaction_type' => $reaction->reaction,\n        'reactable_type' => $reaction->reactable_type,\n        'reactable_id' => $reaction->reactable_id,\n    ]);\n    \n    Cache::forget(\"reactions.{$reaction->reactable_type}.{$reaction->reactable_id}\");\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"method-3-using-event-subscribers",children:"Method 3: Using Event Subscribers"}),"\n",(0,a.jsx)(n.p,{children:"Create event subscribers for multiple events:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners;\n\nuse Illuminate\\Events\\Dispatcher;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\n\nclass ReactionEventSubscriber\n{\n    public function handleReactionAdded(ReactionAddEvent $event): void\n    {\n        $reaction = $event->reaction;\n        Log::info('Reaction added', [\n            'reaction_id' => $reaction->id,\n            'reaction_type' => $reaction->reaction,\n            'reactable' => \"{$reaction->reactable_type}:{$reaction->reactable_id}\",\n        ]);\n    }\n\n    public function handleReactionRemoved(ReactionRemovedEvent $event): void\n    {\n        $reaction = $event->reaction;\n        Log::warning('Reaction removed', [\n            'reaction_id' => $reaction->id,\n            'reaction_type' => $reaction->reaction,\n        ]);\n    }\n\n    public function subscribe(Dispatcher $events): void\n    {\n        $events->listen(\n            ReactionAddEvent::class,\n            [ReactionEventSubscriber::class, 'handleReactionAdded']\n        );\n\n        $events->listen(\n            ReactionRemovedEvent::class,\n            [ReactionEventSubscriber::class, 'handleReactionRemoved']\n        );\n    }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Register the subscriber:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Providers;\n\nuse App\\Listeners\\ReactionEventSubscriber;\nuse Illuminate\\Foundation\\Support\\Providers\\EventServiceProvider as ServiceProvider;\n\nclass EventServiceProvider extends ServiceProvider\n{\n    protected $subscribe = [\n        ReactionEventSubscriber::class,\n    ];\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,a.jsx)(n.h3,{id:"example-1-cache-invalidation-on-reaction-changes",children:"Example 1: Cache Invalidation on Reaction Changes"}),"\n",(0,a.jsx)(n.p,{children:"Invalidate cache when reactions are modified:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:'namespace App\\Listeners\\Reaction;\n\nuse Illuminate\\Support\\Facades\\Cache;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\n\nclass InvalidateReactionCache\n{\n    public function handle(ReactionAddEvent|ReactionRemovedEvent $event): void\n    {\n        $reaction = $event->reaction;\n\n        // Invalidate specific reactable cache\n        Cache::forget("reactions.{$reaction->reactable_type}.{$reaction->reactable_id}");\n        Cache::forget("reaction_summary.{$reaction->reactable_type}.{$reaction->reactable_id}");\n        Cache::forget("reaction_count.{$reaction->reactable_type}.{$reaction->reactable_id}");\n\n        // Invalidate by reaction type\n        Cache::forget("reactions.{$reaction->reactable_type}.{$reaction->reactable_id}.{$reaction->reaction}");\n\n        // Invalidate reactor cache if authenticated\n        if ($reaction->reactor) {\n            Cache::forget("user_reactions.{$reaction->reactor_id}");\n        }\n\n        // Clear all reaction caches for this reactable\n        Cache::tags(["reactable_{$reaction->reactable_type}_{$reaction->reactable_id}"])->flush();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-2-audit-logging",children:"Example 2: Audit Logging"}),"\n",(0,a.jsx)(n.p,{children:"Log all reaction operations for audit trail:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Reaction;\n\nuse App\\Models\\AuditLog;\nuse Illuminate\\Support\\Facades\\Auth;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\n\nclass AuditReactionOperations\n{\n    public function handleReactionAdded(ReactionAddEvent $event): void\n    {\n        $this->logAudit('added', $event->reaction);\n    }\n\n    public function handleReactionRemoved(ReactionRemovedEvent $event): void\n    {\n        $this->logAudit('removed', $event->reaction);\n    }\n\n    protected function logAudit(string $action, $reaction): void\n    {\n        AuditLog::create([\n            'user_id' => Auth::id(),\n            'action' => \"reaction.{$action}\",\n            'model_type' => get_class($reaction),\n            'model_id' => $reaction->id,\n            'reactable_type' => $reaction->reactable_type,\n            'reactable_id' => $reaction->reactable_id,\n            'reaction_type' => $reaction->reaction,\n            'reactor_type' => $reaction->reactor_type,\n            'reactor_id' => $reaction->reactor_id,\n            'device_id' => $reaction->device_id,\n            'ip_address' => request()->ip(),\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-3-notification-system",children:"Example 3: Notification System"}),"\n",(0,a.jsx)(n.p,{children:"Send notifications when reactions are added:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Reaction;\n\nuse App\\Notifications\\ReactionAdded;\nuse Illuminate\\Support\\Facades\\Notification;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\n\nclass NotifyReactionChanges\n{\n    public function handleReactionAdded(ReactionAddEvent $event): void\n    {\n        $reaction = $event->reaction;\n        $reactable = $reaction->reactable;\n\n        // Only notify for authenticated users\n        if (!$reaction->reactor) {\n            return;\n        }\n\n        // Get reactable owner\n        $owner = null;\n        if (method_exists($reactable, 'user')) {\n            $owner = $reactable->user;\n        } elseif (method_exists($reactable, 'author')) {\n            $owner = $reactable->author;\n        }\n\n        // Don't notify if user reacted to their own content\n        if ($owner && $owner->id !== $reaction->reactor->id) {\n            $owner->notify(new ReactionAdded($reaction));\n        }\n\n        // Notify administrators for popular content\n        if ($reactable->reactions()->count() >= 100) {\n            $admins = User::whereHas('roles', function ($query) {\n                $query->where('name', 'admin');\n            })->get();\n\n            Notification::send($admins, new ReactionAdded($reaction));\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-4-analytics-tracking",children:"Example 4: Analytics Tracking"}),"\n",(0,a.jsx)(n.p,{children:"Track reaction changes for analytics:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Reaction;\n\nuse App\\Services\\AnalyticsService;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\n\nclass TrackReactionAnalytics\n{\n    public function __construct(\n        protected AnalyticsService $analytics\n    ) {}\n\n    public function handleReactionAdded(ReactionAddEvent $event): void\n    {\n        $reaction = $event->reaction;\n        \n        $this->analytics->track('reaction.added', [\n            'reaction_id' => $reaction->id,\n            'reaction_type' => $reaction->reaction,\n            'reactable_type' => $reaction->reactable_type,\n            'reactable_id' => $reaction->reactable_id,\n            'reactor_type' => $reaction->reactor_type,\n            'reactor_id' => $reaction->reactor_id,\n            'device_id' => $reaction->device_id,\n            'source' => $reaction->source,\n            'ip_address' => $reaction->ip_address,\n            'is_anonymous' => !$reaction->reactor,\n        ]);\n    }\n\n    public function handleReactionRemoved(ReactionRemovedEvent $event): void\n    {\n        $reaction = $event->reaction;\n        \n        $this->analytics->track('reaction.removed', [\n            'reaction_id' => $reaction->id,\n            'reaction_type' => $reaction->reaction,\n            'reactable_type' => $reaction->reactable_type,\n            'reactable_id' => $reaction->reactable_id,\n            'removed_at' => now(),\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-5-reaction-aggregation",children:"Example 5: Reaction Aggregation"}),"\n",(0,a.jsx)(n.p,{children:"Update reaction aggregates when reactions change:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Reaction;\n\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\n\nclass UpdateReactionAggregates\n{\n    public function handleReactionAdded(ReactionAddEvent $event): void\n    {\n        $this->recalculateAggregates($event->reaction);\n    }\n\n    public function handleReactionRemoved(ReactionRemovedEvent $event): void\n    {\n        $this->recalculateAggregates($event->reaction);\n    }\n\n    protected function recalculateAggregates($reaction): void\n    {\n        $reactable = $reaction->reactable;\n        \n        // Recalculate reaction counts by type\n        $counts = $reactable->reactions()\n            ->selectRaw('reaction, COUNT(*) as count')\n            ->groupBy('reaction')\n            ->pluck('count', 'reaction')\n            ->toArray();\n        \n        $totalCount = $reactable->reactions()->count();\n        \n        // Update reactable model if it has reaction fields\n        if (method_exists($reactable, 'updateReactionCounts')) {\n            $reactable->updateReactionCounts($counts, $totalCount);\n        }\n        \n        // Or update directly if columns exist\n        if (Schema::hasColumn($reactable->getTable(), 'reaction_counts')) {\n            $reactable->update([\n                'reaction_counts' => $counts,\n                'reaction_total' => $totalCount,\n            ]);\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-6-real-time-updates",children:"Example 6: Real-time Updates"}),"\n",(0,a.jsx)(n.p,{children:"Send real-time updates via WebSockets or broadcasting:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Reaction;\n\nuse Illuminate\\Support\\Facades\\Broadcast;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\n\nclass BroadcastReactionChanges\n{\n    public function handleReactionAdded(ReactionAddEvent $event): void\n    {\n        $reaction = $event->reaction;\n        \n        Broadcast::channel(\"reactable.{$reaction->reactable_type}.{$reaction->reactable_id}\", function () {\n            return true;\n        })->toOthers();\n        \n        event(new ReactionChanged([\n            'type' => 'added',\n            'reaction' => $reaction,\n            'counts' => $reaction->reactable->reactions()\n                ->selectRaw('reaction, COUNT(*) as count')\n                ->groupBy('reaction')\n                ->pluck('count', 'reaction')\n                ->toArray(),\n            'total' => $reaction->reactable->reactions()->count(),\n        ]));\n    }\n\n    public function handleReactionRemoved(ReactionRemovedEvent $event): void\n    {\n        $reaction = $event->reaction;\n        \n        event(new ReactionChanged([\n            'type' => 'removed',\n            'reaction' => $reaction,\n            'counts' => $reaction->reactable->reactions()\n                ->selectRaw('reaction, COUNT(*) as count')\n                ->groupBy('reaction')\n                ->pluck('count', 'reaction')\n                ->toArray(),\n            'total' => $reaction->reactable->reactions()->count(),\n        ]));\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-7-spam-detection",children:"Example 7: Spam Detection"}),"\n",(0,a.jsx)(n.p,{children:"Detect and handle potential spam reactions:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Reaction;\n\nuse App\\Services\\SpamDetectionService;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovingEvent;\n\nclass DetectSpamReactions\n{\n    public function __construct(\n        protected SpamDetectionService $spamDetection\n    ) {}\n\n    public function handleReactionAdded(ReactionAddEvent $event): void\n    {\n        $reaction = $event->reaction;\n        \n        // Check for spam patterns\n        $isSpam = $this->spamDetection->check([\n            'ip_address' => $reaction->ip_address,\n            'device_id' => $reaction->device_id,\n            'reaction_type' => $reaction->reaction,\n            'reactable_id' => $reaction->reactable_id,\n            'reactor_id' => $reaction->reactor_id,\n        ]);\n        \n        if ($isSpam) {\n            // Mark as spam or delete\n            $reaction->update(['is_spam' => true]);\n            \n            // Log for review\n            Log::warning('Potential spam reaction detected', [\n                'reaction_id' => $reaction->id,\n                'ip_address' => $reaction->ip_address,\n                'device_id' => $reaction->device_id,\n            ]);\n        }\n    }\n\n    public function handleReactionRemoving(ReactionRemovingEvent $event): void\n    {\n        $reaction = $event->reaction;\n        \n        // Prevent rapid reaction changes (potential abuse)\n        $recentChanges = $reaction->reactable->reactions()\n            ->where(function ($query) use ($reaction) {\n                if ($reaction->reactor_id) {\n                    $query->where('reactor_id', $reaction->reactor_id);\n                } else {\n                    $query->where('device_id', $reaction->device_id);\n                }\n            })\n            ->where('updated_at', '>', now()->subMinutes(5))\n            ->count();\n        \n        if ($recentChanges > 10) {\n            Log::warning('Rapid reaction changes detected', [\n                'reaction_id' => $reaction->id,\n                'changes' => $recentChanges,\n            ]);\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-8-complete-event-listener-setup",children:"Example 8: Complete Event Listener Setup"}),"\n",(0,a.jsx)(n.p,{children:"Complete setup for all reaction events:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Providers;\n\nuse App\\Listeners\\Reaction\\AuditReactionOperations;\nuse App\\Listeners\\Reaction\\BroadcastReactionChanges;\nuse App\\Listeners\\Reaction\\DetectSpamReactions;\nuse App\\Listeners\\Reaction\\InvalidateReactionCache;\nuse App\\Listeners\\Reaction\\NotifyReactionChanges;\nuse App\\Listeners\\Reaction\\TrackReactionAnalytics;\nuse App\\Listeners\\Reaction\\UpdateReactionAggregates;\nuse Illuminate\\Foundation\\Support\\Providers\\EventServiceProvider as ServiceProvider;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovedEvent;\nuse JobMetric\\Reaction\\Events\\ReactionRemovingEvent;\n\nclass EventServiceProvider extends ServiceProvider\n{\n    protected $listen = [\n        // Reaction added\n        ReactionAddEvent::class => [\n            AuditReactionOperations::class,\n            InvalidateReactionCache::class,\n            NotifyReactionChanges::class,\n            TrackReactionAnalytics::class,\n            UpdateReactionAggregates::class,\n            BroadcastReactionChanges::class,\n            DetectSpamReactions::class,\n        ],\n\n        // Reaction removing (before deletion)\n        ReactionRemovingEvent::class => [\n            DetectSpamReactions::class,\n        ],\n\n        // Reaction removed (after deletion)\n        ReactionRemovedEvent::class => [\n            AuditReactionOperations::class,\n            InvalidateReactionCache::class,\n            TrackReactionAnalytics::class,\n            UpdateReactionAggregates::class,\n            BroadcastReactionChanges::class,\n        ],\n    ];\n\n    public function boot(): void\n    {\n        parent::boot();\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"event-timing",children:"Event Timing"}),"\n",(0,a.jsx)(n.h3,{id:"reactionaddevent",children:"ReactionAddEvent"}),"\n",(0,a.jsxs)(n.p,{children:["Fired ",(0,a.jsx)(n.strong,{children:"after"})," the reaction is saved to database:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Execution order:\n// 1. Validate input\n// 2. Create reaction record\n// 3. Save to database\n// 4. Fire ReactionAddEvent \u2190 Event fired here\n// 5. Return response\n"})}),"\n",(0,a.jsx)(n.h3,{id:"reactionremovingevent--reactionremovedevent",children:"ReactionRemovingEvent / ReactionRemovedEvent"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ReactionRemovingEvent"}),": Fired ",(0,a.jsx)(n.strong,{children:"before"})," the deletion operation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ReactionRemovedEvent"}),": Fired ",(0,a.jsx)(n.strong,{children:"after"})," the deletion operation completes"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Execution order:\n// 1. Fire ReactionRemovingEvent \u2190 Before deletion\n// 2. Soft delete reaction record\n// 3. Fire ReactionRemovedEvent \u2190 After deletion\n// 4. Return response\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Important Notes"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The model is ",(0,a.jsx)(n.strong,{children:"saved"})," to database before ",(0,a.jsx)(n.code,{children:"ReactionAddEvent"})," fires"]}),"\n",(0,a.jsxs)(n.li,{children:["You can access ",(0,a.jsx)(n.strong,{children:"fresh model data"})," in listeners"]}),"\n",(0,a.jsxs)(n.li,{children:["Database transaction is ",(0,a.jsx)(n.strong,{children:"committed"})," before events fire"]}),"\n",(0,a.jsxs)(n.li,{children:["Events are ",(0,a.jsx)(n.strong,{children:"synchronous"})," by default (can be queued)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ReactionRemovingEvent"})," allows you to ",(0,a.jsx)(n.strong,{children:"prevent"})," deletion if needed"]}),"\n",(0,a.jsxs)(n.li,{children:["Reactions are ",(0,a.jsx)(n.strong,{children:"soft-deleted"}),", so they still exist in database after removal"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"queued-events",children:"Queued Events"}),"\n",(0,a.jsx)(n.p,{children:"You can queue events for asynchronous processing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Listeners\\Reaction;\n\nuse Illuminate\\Contracts\\Queue\\ShouldQueue;\nuse JobMetric\\Reaction\\Events\\ReactionAddEvent;\n\nclass ProcessReactionAsync implements ShouldQueue\n{\n    public function handle(ReactionAddEvent $event): void\n    {\n        $reaction = $event->reaction;\n        \n        // Heavy processing that doesn't block the request\n        $this->updateSearchIndex($reaction);\n        $this->sendWelcomeNotifications($reaction);\n        $this->generateAnalyticsReport($reaction);\n    }\n\n    protected function updateSearchIndex($reaction): void\n    {\n        // Update search index with new reaction\n    }\n\n    protected function sendWelcomeNotifications($reaction): void\n    {\n        // Send notifications\n    }\n\n    protected function generateAnalyticsReport($reaction): void\n    {\n        // Generate analytics\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"event-payload-details",children:"Event Payload Details"}),"\n",(0,a.jsx)(n.h3,{id:"reactionaddevent-1",children:"ReactionAddEvent"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"readonly class ReactionAddEvent implements DomainEvent\n{\n    public function __construct(\n        public Reaction $reaction  // Complete Reaction model instance\n    ) {}\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:["Available Properties on ",(0,a.jsx)(n.code,{children:"$reaction"})]}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"id"}),": Reaction ID"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"reaction"}),": Reaction type (e.g., 'like', 'love', 'haha')"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"reactable_type"}),": Type of reacted model"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"reactable_id"}),": ID of reacted model"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"reactor_type"}),": Type of reacting entity (User, Device, etc.)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"reactor_id"}),": ID of reacting entity"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"device_id"}),": Device identifier (if anonymous)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ip_address"}),": IP address of reactor"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"source"}),": Source of reaction"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"created_at"}),": Creation timestamp"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"updated_at"}),": Update timestamp"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"deleted_at"}),": Deletion timestamp (null for active reactions)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"reactionremovingevent--reactionremovedevent-1",children:"ReactionRemovingEvent / ReactionRemovedEvent"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"readonly class ReactionRemovedEvent implements DomainEvent\n{\n    public function __construct(\n        public Reaction $reaction  // Reaction model instance (soft-deleted)\n    ) {}\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Available Properties"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$reaction"}),": Reaction model instance (still accessible, but soft-deleted)"]}),"\n",(0,a.jsxs)(n.li,{children:["All properties from ",(0,a.jsx)(n.code,{children:"ReactionAddEvent"})," are available"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"deleted_at"}),": Contains deletion timestamp"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"when-to-use-events",children:"When to Use Events"}),"\n",(0,a.jsx)(n.p,{children:"Use events when you need to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cache Management"}),": Invalidate or update cached reaction data"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Notifications"}),": Send notifications when reactions change"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Analytics"}),": Track reaction operations for analytics"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Audit Logging"}),": Log reaction changes for compliance"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Reaction Aggregation"}),": Update reaction counts and summaries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Real-time Updates"}),": Broadcast reaction changes to clients"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Spam Detection"}),": Detect and handle spam reactions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Integration"}),": Integrate with external services"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Side Effects"}),": Perform side effects without coupling"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(o.A,{to:"/packages/laravel-reaction/deep-diving/has-reaction",children:"HasReaction"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(o.A,{to:"/packages/laravel-reaction/deep-diving/can-react",children:"CanReact"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(o.A,{to:"/packages/laravel-reaction/deep-diving/models/reaction",children:"Reaction Model"}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(v,{...e})}):v(e)}}}]);