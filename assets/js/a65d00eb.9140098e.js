"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[6036],{28453(e,l,n){n.d(l,{R:()=>a,x:()=>i});var r=n(96540);const s={},t=r.createContext(s);function a(e){const l=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function i(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:l},e.children)}},85585(e,l,n){n.r(l),n.d(l,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"laravel-url/deep-diving/full-url-controller","title":"FullUrlController","description":"The FullUrlController is a fallback controller that resolves any unmatched request path against the versioned urls table. It provides smart URL resolution with automatic 301 redirects for legacy URLs.","source":"@site/packages/laravel-url/deep-diving/full-url-controller.md","sourceDirName":"laravel-url/deep-diving","slug":"/laravel-url/deep-diving/full-url-controller","permalink":"/packages/laravel-url/deep-diving/full-url-controller","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-url/deep-diving/full-url-controller.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"sidebar_label":"FullUrlController"},"sidebar":"packagesSidebar","previous":{"title":"UrlTypeObjectRequest","permalink":"/packages/laravel-url/deep-diving/url-type-object-request"},"next":{"title":"SlugResource","permalink":"/packages/laravel-url/deep-diving/resources/slug-resource"}}');var s=n(74848),t=n(28453),a=n(28774);const i={sidebar_position:7,sidebar_label:"FullUrlController"},c="FullUrlController",o={},d=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Configuration",id:"configuration",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Request Flow",id:"request-flow",level:3},{value:"Path Candidates",id:"path-candidates",level:3},{value:"Usage",id:"usage",level:2},{value:"Basic Setup",id:"basic-setup",level:3},{value:"Event Handling",id:"event-handling",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Product Page Handler",id:"example-1-product-page-handler",level:3},{value:"Example 2: Category Page Handler",id:"example-2-category-page-handler",level:3},{value:"Example 3: API Response",id:"example-3-api-response",level:3},{value:"Example 4: Multiple Model Types",id:"example-4-multiple-model-types",level:3},{value:"Automatic Redirects",id:"automatic-redirects",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function h(e){const l={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.header,{children:(0,s.jsx)(l.h1,{id:"fullurlcontroller",children:"FullUrlController"})}),"\n",(0,s.jsxs)(l.p,{children:["The ",(0,s.jsx)(l.code,{children:"FullUrlController"})," is a fallback controller that resolves any unmatched request path against the versioned ",(0,s.jsx)(l.code,{children:"urls"})," table. It provides smart URL resolution with automatic 301 redirects for legacy URLs."]}),"\n",(0,s.jsx)(l.h2,{id:"namespace",children:"Namespace"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"JobMetric\\Url\\Http\\Controllers\\FullUrlController\n"})}),"\n",(0,s.jsx)(l.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(l.p,{children:"The controller handles:"}),"\n",(0,s.jsxs)(l.ul,{children:["\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Active URL matching"}),": Finds active URLs and fires ",(0,s.jsx)(l.code,{children:"UrlMatched"})," event"]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Legacy redirects"}),": Automatically redirects (301) old URLs to canonical versions"]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"404 handling"}),": Returns translated 404 when no match is found"]}),"\n"]}),"\n",(0,s.jsx)(l.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(l.p,{children:["Enable/disable the fallback route in ",(0,s.jsx)(l.code,{children:"config/url.php"}),":"]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"return [\n    'register_fallback' => env('URL_REGISTER_FALLBACK', true),\n    'fallback_middleware' => ['web'],\n];\n"})}),"\n",(0,s.jsx)(l.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(l.h3,{id:"request-flow",children:"Request Flow"}),"\n",(0,s.jsxs)(l.ol,{children:["\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Normalize path"}),": Builds candidate paths from request"]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Check active URLs"}),": Looks for active URL match"]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Check legacy URLs"}),": If no active match, checks soft-deleted URLs"]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Redirect or 404"}),": Redirects legacy URLs or returns 404"]}),"\n"]}),"\n",(0,s.jsx)(l.h3,{id:"path-candidates",children:"Path Candidates"}),"\n",(0,s.jsxs)(l.p,{children:["For a request like ",(0,s.jsx)(l.code,{children:"GET /shop/laptops/mbp-14"}),", the controller checks:"]}),"\n",(0,s.jsxs)(l.ul,{children:["\n",(0,s.jsx)(l.li,{children:(0,s.jsx)(l.code,{children:"shop/laptops/mbp-14"})}),"\n",(0,s.jsx)(l.li,{children:(0,s.jsx)(l.code,{children:"shop/laptops/mbp-14/"})}),"\n",(0,s.jsx)(l.li,{children:(0,s.jsx)(l.code,{children:"/shop/laptops/mbp-14"})}),"\n",(0,s.jsx)(l.li,{children:(0,s.jsx)(l.code,{children:"/shop/laptops/mbp-14/"})}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.code,{children:"/"})," (for root paths)"]}),"\n"]}),"\n",(0,s.jsx)(l.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(l.h3,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,s.jsxs)(l.p,{children:["The controller is automatically registered when ",(0,s.jsx)(l.code,{children:"register_fallback"})," is ",(0,s.jsx)(l.code,{children:"true"}),":"]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"// In routes (automatically registered)\nRoute::fallback(FullUrlController::class)\n    ->name('JobMetric.url.fallback');\n"})}),"\n",(0,s.jsx)(l.h3,{id:"event-handling",children:"Event Handling"}),"\n",(0,s.jsxs)(l.p,{children:["Listen to ",(0,s.jsx)(l.code,{children:"UrlMatched"})," event to handle active URLs:"]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"use Illuminate\\Support\\Facades\\Event;\nuse JobMetric\\Url\\Events\\UrlMatched;\n\nEvent::listen(UrlMatched::class, function (UrlMatched $event) {\n    if ($event->urlable instanceof Product) {\n        $event->respond(view('products.show', ['product' => $event->urlable]));\n    }\n});\n"})}),"\n",(0,s.jsx)(l.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,s.jsx)(l.h3,{id:"example-1-product-page-handler",children:"Example 1: Product Page Handler"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"Event::listen(UrlMatched::class, function (UrlMatched $event) {\n    if ($event->urlable instanceof Product) {\n        $event->respond(view('products.show', ['product' => $event->urlable]));\n    }\n});\n"})}),"\n",(0,s.jsx)(l.h3,{id:"example-2-category-page-handler",children:"Example 2: Category Page Handler"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"Event::listen(UrlMatched::class, function (UrlMatched $event) {\n    if ($event->urlable instanceof Category) {\n        $page = (int) $event->request->query('page', 1);\n        $products = $event->urlable->products()->paginate(24, ['*'], 'page', $page);\n        $event->respond(view('categories.show', [\n            'category' => $event->urlable,\n            'products' => $products,\n        ]));\n    }\n});\n"})}),"\n",(0,s.jsx)(l.h3,{id:"example-3-api-response",children:"Example 3: API Response"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"Event::listen(UrlMatched::class, function (UrlMatched $event) {\n    if ($event->request->wantsJson()) {\n        $event->respond(response()->json([\n            'url' => $event->url->full_url,\n            'model' => $event->urlable->toArray(),\n        ]));\n    }\n});\n"})}),"\n",(0,s.jsx)(l.h3,{id:"example-4-multiple-model-types",children:"Example 4: Multiple Model Types"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-php",children:"Event::listen(UrlMatched::class, function (UrlMatched $event) {\n    $model = $event->urlable;\n\n    if ($model instanceof Product) {\n        $event->respond(view('products.show', ['product' => $model]));\n    } elseif ($model instanceof Category) {\n        $event->respond(view('categories.show', ['category' => $model]));\n    } elseif ($model instanceof Page) {\n        $event->respond(view('pages.show', ['page' => $model]));\n    }\n});\n"})}),"\n",(0,s.jsx)(l.h2,{id:"automatic-redirects",children:"Automatic Redirects"}),"\n",(0,s.jsx)(l.p,{children:"Legacy URLs automatically redirect (301) to their canonical versions:"}),"\n",(0,s.jsxs)(l.ul,{children:["\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Request"}),": ",(0,s.jsx)(l.code,{children:"/shop/old-path"})]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Redirect"}),": ",(0,s.jsx)(l.code,{children:"301 \u2192 /shop/new-path"})]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.strong,{children:"Query strings"}),": Preserved in redirect"]}),"\n"]}),"\n",(0,s.jsx)(l.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(l.ul,{children:["\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(a.A,{to:"/packages/laravel-url/deep-diving/events",children:"Events"})," - UrlMatched event documentation"]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(a.A,{to:"/packages/laravel-url/deep-diving/has-url",children:"HasUrl Trait"})," - Trait that manages URLs"]}),"\n"]})]})}function u(e={}){const{wrapper:l}={...(0,t.R)(),...e.components};return l?(0,s.jsx)(l,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);