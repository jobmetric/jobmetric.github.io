"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[3199],{28453(e,n,t){t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const l={},s=i.createContext(l);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},63969(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"laravel-unit-converter/deep-diving/exceptions/cannot-delete-default-value","title":"CannotDeleteDefaultValueException","description":"Thrown when attempting to delete the base unit while other units of the same type exist.","source":"@site/packages/laravel-unit-converter/deep-diving/exceptions/cannot-delete-default-value.md","sourceDirName":"laravel-unit-converter/deep-diving/exceptions","slug":"/laravel-unit-converter/deep-diving/exceptions/cannot-delete-default-value","permalink":"/packages/laravel-unit-converter/deep-diving/exceptions/cannot-delete-default-value","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-unit-converter/deep-diving/exceptions/cannot-delete-default-value.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"sidebar_label":"CannotDeleteDefaultValueException"},"sidebar":"packagesSidebar","previous":{"title":"UnitTypeCannotChangeDefaultValueException","permalink":"/packages/laravel-unit-converter/deep-diving/exceptions/unit-type-cannot-change-default-value"},"next":{"title":"UnitTypeUsedInException","permalink":"/packages/laravel-unit-converter/deep-diving/exceptions/unit-type-used-in"}}');var l=t(74848),s=t(28453);const r={sidebar_position:7,sidebar_label:"CannotDeleteDefaultValueException"},a="CannotDeleteDefaultValueException",o={},d=[{value:"Namespace",id:"namespace",level:2},{value:"HTTP Status Code",id:"http-status-code",level:2},{value:"Constructor",id:"constructor",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Understanding the Restriction",id:"understanding-the-restriction",level:2},{value:"Example Scenario",id:"example-scenario",level:3},{value:"When Is It Thrown?",id:"when-is-it-thrown",level:2},{value:"Example: Invalid Delete Attempt",id:"example-invalid-delete-attempt",level:3},{value:"When Delete IS Allowed",id:"when-delete-is-allowed",level:3},{value:"Handling the Exception",id:"handling-the-exception",level:2},{value:"In Controllers",id:"in-controllers",level:3},{value:"In Admin Panels",id:"in-admin-panels",level:3},{value:"Solutions",id:"solutions",level:2},{value:"Solution 1: Change the Base Unit First",id:"solution-1-change-the-base-unit-first",level:3},{value:"Solution 2: Delete All Other Units First",id:"solution-2-delete-all-other-units-first",level:3},{value:"Solution 3: Bulk Delete Entire Type",id:"solution-3-bulk-delete-entire-type",level:3},{value:"Prevention",id:"prevention",level:2},{value:"1. Disable Delete Button for Base Units",id:"1-disable-delete-button-for-base-units",level:3},{value:"2. Show Base Unit Badge",id:"2-show-base-unit-badge",level:3},{value:"3. Provide Change Base Option",id:"3-provide-change-base-option",level:3},{value:"Related Exceptions",id:"related-exceptions",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"cannotdeletedefaultvalueexception",children:"CannotDeleteDefaultValueException"})}),"\n",(0,l.jsx)(n.p,{children:"Thrown when attempting to delete the base unit while other units of the same type exist."}),"\n",(0,l.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"JobMetric\\UnitConverter\\Exceptions\\CannotDeleteDefaultValueException\n"})}),"\n",(0,l.jsx)(n.h2,{id:"http-status-code",children:"HTTP Status Code"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"400 Bad Request"})}),"\n",(0,l.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"public function __construct(\n    int $code = 400,\n    ?Throwable $previous = null\n)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Parameter"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$code"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"int"})}),(0,l.jsx)(n.td,{children:"HTTP status code (default: 400)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$previous"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"Throwable|null"})}),(0,l.jsx)(n.td,{children:"Previous exception for chaining"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"understanding-the-restriction",children:"Understanding the Restriction"}),"\n",(0,l.jsx)(n.p,{children:"The base unit cannot be deleted while other units exist because:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Other units' values are defined ",(0,l.jsx)(n.strong,{children:"relative to the base unit"})]}),"\n",(0,l.jsxs)(n.li,{children:["Deleting the base would leave other units ",(0,l.jsx)(n.strong,{children:"without a reference point"})]}),"\n",(0,l.jsxs)(n.li,{children:["All conversion calculations would become ",(0,l.jsx)(n.strong,{children:"invalid"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-scenario",children:"Example Scenario"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Weight Type:\n\u251c\u2500\u2500 Gram (value = 1) \u2190 BASE UNIT\n\u251c\u2500\u2500 Kilogram (value = 1000) \u2190 relative to gram\n\u251c\u2500\u2500 Milligram (value = 0.001) \u2190 relative to gram\n\u2514\u2500\u2500 Ton (value = 1000000) \u2190 relative to gram\n"})}),"\n",(0,l.jsx)(n.p,{children:"If gram is deleted:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["What does ",(0,l.jsx)(n.code,{children:"value = 1000"})," for kilogram mean?"]}),"\n",(0,l.jsx)(n.li,{children:"There's no reference point for conversions"}),"\n",(0,l.jsx)(n.li,{children:"The entire type becomes unusable"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"when-is-it-thrown",children:"When Is It Thrown?"}),"\n",(0,l.jsx)(n.p,{children:"This exception is thrown when:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["You try to delete a unit with ",(0,l.jsx)(n.code,{children:"value = 1"})," (base unit)"]}),"\n",(0,l.jsx)(n.li,{children:"AND other units of the same type still exist"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-invalid-delete-attempt",children:"Example: Invalid Delete Attempt"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n// Weight type has: gram (base), kilogram, ton\n\n$gram = UnitConverter::findUnitByCode('g');\n\n// Trying to delete the base unit - WRONG!\nUnitConverter::destroy($gram->id);\n// Throws: CannotDeleteDefaultValueException\n"})}),"\n",(0,l.jsx)(n.h3,{id:"when-delete-is-allowed",children:"When Delete IS Allowed"}),"\n",(0,l.jsxs)(n.p,{children:["You CAN delete the base unit if it's the ",(0,l.jsx)(n.strong,{children:"only"})," unit in that type:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n// Assume: Weight type has ONLY gram (no other units)\n\n$gram = UnitConverter::findUnitByCode('g');\nUnitConverter::destroy($gram->id);\n// Success! Type is now empty\n"})}),"\n",(0,l.jsx)(n.h2,{id:"handling-the-exception",children:"Handling the Exception"}),"\n",(0,l.jsx)(n.h3,{id:"in-controllers",children:"In Controllers"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Exceptions\\CannotDeleteDefaultValueException;\nuse JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\nclass UnitController extends Controller\n{\n    public function destroy(int $id)\n    {\n        try {\n            $response = UnitConverter::destroy($id);\n            return response()->json(['message' => 'Unit deleted']);\n        } catch (CannotDeleteDefaultValueException $e) {\n            return response()->json([\n                'error' => 'cannot_delete_base_unit',\n                'message' => $e->getMessage(),\n                'hint' => 'Delete all other units first, or use changeDefaultValue() to set a different base unit.',\n            ], 400);\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"in-admin-panels",children:"In Admin Panels"}),"\n",(0,l.jsx)(n.p,{children:"Show a clear warning when users try to delete the base unit:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Check if unit can be deleted\npublic function canDelete(Unit $unit): array\n{\n    // Base unit with other units in type\n    if ((float) $unit->value === 1.0) {\n        $otherUnitsExist = Unit::where('type', $unit->type)\n            ->where('id', '!=', $unit->id)\n            ->exists();\n        \n        if ($otherUnitsExist) {\n            return [\n                'can_delete' => false,\n                'reason' => 'This is the base unit. Delete other units first or change the base unit.',\n            ];\n        }\n    }\n    \n    // Check if unit is used in relations\n    if ($unit->unitRelations()->exists()) {\n        return [\n            'can_delete' => false,\n            'reason' => 'This unit is in use by other models.',\n        ];\n    }\n    \n    return ['can_delete' => true];\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"solutions",children:"Solutions"}),"\n",(0,l.jsx)(n.h3,{id:"solution-1-change-the-base-unit-first",children:"Solution 1: Change the Base Unit First"}),"\n",(0,l.jsx)(n.p,{children:"If you need to delete the current base unit, first designate another unit as the base:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\n\n// Current: Gram (base), Kilogram, Ton\n\n// Step 1: Make Kilogram the new base\n$kilogram = UnitConverter::findUnitByCode('kg');\nUnitConverter::changeDefaultValue($kilogram->id);\n\n// After: Gram (0.001), Kilogram (base), Ton (1000)\n\n// Step 2: Now you can delete Gram\n$gram = UnitConverter::findUnitByCode('g');\nUnitConverter::destroy($gram->id);\n// Success!\n"})}),"\n",(0,l.jsx)(n.h3,{id:"solution-2-delete-all-other-units-first",children:"Solution 2: Delete All Other Units First"}),"\n",(0,l.jsx)(n.p,{children:"If you want to completely remove a unit type:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Facades\\UnitConverter;\nuse JobMetric\\UnitConverter\\Models\\Unit;\n\n// Get all weight units\n$weightUnits = Unit::where('type', 'weight')\n    ->orderByDesc('value') // Delete non-base units first\n    ->get();\n\nforeach ($weightUnits as $unit) {\n    // Skip base unit for now\n    if ((float) $unit->value === 1.0) {\n        continue;\n    }\n    \n    UnitConverter::destroy($unit->id);\n}\n\n// Now delete the base unit (it's the only one left)\n$baseUnit = Unit::where('type', 'weight')->first();\nUnitConverter::destroy($baseUnit->id);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"solution-3-bulk-delete-entire-type",children:"Solution 3: Bulk Delete Entire Type"}),"\n",(0,l.jsx)(n.p,{children:"If you need to delete all units of a type at once:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use JobMetric\\UnitConverter\\Models\\Unit;\n\n// WARNING: This bypasses business logic checks\n// Use only when you're certain no relations exist\n\nUnit::where('type', 'weight')->delete();\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,l.jsx)(n.strong,{children:"Warning"}),": Direct deletion bypasses the exception and could leave orphaned ",(0,l.jsx)(n.code,{children:"unit_relations"})," records."]}),"\n",(0,l.jsx)(n.h2,{id:"prevention",children:"Prevention"}),"\n",(0,l.jsx)(n.h3,{id:"1-disable-delete-button-for-base-units",children:"1. Disable Delete Button for Base Units"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"// Frontend\nfunction canDeleteUnit(unit, allUnitsOfType) {\n    // Is base unit?\n    if (unit.value === 1) {\n        // Check if other units exist\n        const otherUnits = allUnitsOfType.filter(u => u.id !== unit.id);\n        if (otherUnits.length > 0) {\n            return false;\n        }\n    }\n    return true;\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-show-base-unit-badge",children:"2. Show Base Unit Badge"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-html",children:'\x3c!-- In unit list --\x3e\n<tr v-for="unit in units">\n    <td>{{ unit.name }}</td>\n    <td>\n        {{ unit.value }}\n        <span v-if="unit.value === 1" class="badge badge-primary">Base Unit</span>\n    </td>\n    <td>\n        <button \n            @click="deleteUnit(unit)"\n            :disabled="!canDeleteUnit(unit)"\n            :title="canDeleteUnit(unit) ? \'Delete\' : \'Cannot delete base unit\'"\n        >\n            Delete\n        </button>\n    </td>\n</tr>\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-provide-change-base-option",children:"3. Provide Change Base Option"}),"\n",(0,l.jsx)(n.p,{children:"Instead of delete, offer to change the base unit:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// In your controller\npublic function changeBase(Request $request, int $currentBaseId)\n{\n    $request->validate(['new_base_id' => 'required|exists:units,id']);\n    \n    $response = UnitConverter::changeDefaultValue($request->new_base_id);\n    \n    return response()->json([\n        'message' => 'Base unit changed successfully',\n        'new_base' => $response->data,\n    ]);\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"related-exceptions",children:"Related Exceptions"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./unit-type-default-value",children:"UnitTypeDefaultValueException"})," - When first unit doesn't have value = 1"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./unit-type-use-default-value",children:"UnitTypeUseDefaultValueException"})," - When creating duplicate base unit"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./unit-type-cannot-change-default-value",children:"UnitTypeCannotChangeDefaultValueException"})," - When trying to modify base unit's value"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./unit-type-used-in",children:"UnitTypeUsedInException"})," - When unit is used in relations"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);