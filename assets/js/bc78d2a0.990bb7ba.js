"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[8726],{8453(e,n,s){s.d(n,{R:()=>l,x:()=>c});var t=s(6540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}},9185(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"laravel-flow/deep-diving/resources/flow-instance-resource","title":"FlowInstanceResource","description":"JSON resource class for transforming FlowInstance models into structured API responses. This resource provides a consistent format for flow instance data with conditional relation loading.","source":"@site/packages/laravel-flow/deep-diving/resources/flow-instance-resource.md","sourceDirName":"laravel-flow/deep-diving/resources","slug":"/laravel-flow/deep-diving/resources/flow-instance-resource","permalink":"/packages/laravel-flow/deep-diving/resources/flow-instance-resource","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/resources/flow-instance-resource.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_label":"FlowInstanceResource"},"sidebar":"packagesSidebar","previous":{"title":"FlowTransitionResource","permalink":"/packages/laravel-flow/deep-diving/resources/flow-transition-resource"},"next":{"title":"FlowUseResource","permalink":"/packages/laravel-flow/deep-diving/resources/flow-use-resource"}}');var i=s(4848),r=s(8453);const l={sidebar_position:5,sidebar_label:"FlowInstanceResource"},c="FlowInstanceResource",d={},a=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Base Properties",id:"base-properties",level:2},{value:"Conditional Properties",id:"conditional-properties",level:2},{value:"Active Status Detection",id:"active-status-detection",level:2},{value:"Duration Calculation",id:"duration-calculation",level:2},{value:"Current State Detection",id:"current-state-detection",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"With Relations",id:"with-relations",level:3},{value:"In Collections",id:"in-collections",level:3},{value:"In API Responses",id:"in-api-responses",level:3},{value:"Response Examples",id:"response-examples",level:2},{value:"Basic Response",id:"basic-response",level:3},{value:"Completed Instance",id:"completed-instance",level:3},{value:"With Relations",id:"with-relations-1",level:3},{value:"Relation Loading",id:"relation-loading",level:2},{value:"Eager Loading Relations",id:"eager-loading-relations",level:3},{value:"Selective Loading",id:"selective-loading",level:3},{value:"Nested Relations",id:"nested-relations",level:3},{value:"Morph Relations",id:"morph-relations",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"flowinstanceresource",children:"FlowInstanceResource"})}),"\n",(0,i.jsx)(n.p,{children:"JSON resource class for transforming FlowInstance models into structured API responses. This resource provides a consistent format for flow instance data with conditional relation loading."}),"\n",(0,i.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"JobMetric\\Flow\\Http\\Resources\\FlowInstanceResource"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"FlowInstanceResource"})," transforms FlowInstance model instances into structured JSON responses. It includes:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Core instance properties"}),"\n",(0,i.jsx)(n.li,{children:"Instanceable and actor information"}),"\n",(0,i.jsx)(n.li,{children:"Transition and state information"}),"\n",(0,i.jsx)(n.li,{children:"Active status and duration"}),"\n",(0,i.jsx)(n.li,{children:"ISO 8601 formatted timestamps"}),"\n",(0,i.jsx)(n.li,{children:"Conditional relation loading"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"base-properties",children:"Base Properties"}),"\n",(0,i.jsx)(n.p,{children:"The resource always includes these properties:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:"Instance ID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"instanceable_type"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:"Model class name of the instanceable entity"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"instanceable_id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:"ID of the instanceable entity"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"flow_transition_id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:"Transition ID that created this instance"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actor_type"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string|null"})}),(0,i.jsx)(n.td,{children:"Model class name of the actor"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actor_id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int|null"})}),(0,i.jsx)(n.td,{children:"ID of the actor"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"started_at"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:"ISO 8601 formatted start date"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"completed_at"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string|null"})}),(0,i.jsx)(n.td,{children:"ISO 8601 formatted completion date"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"is_active"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:"Whether the instance is currently active"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"duration_seconds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int|null"})}),(0,i.jsx)(n.td,{children:"Duration in seconds (if completed)"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"conditional-properties",children:"Conditional Properties"}),"\n",(0,i.jsx)(n.p,{children:"These properties are only included when their relations are loaded:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Relation"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"flow"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transition.flow"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"object"})}),(0,i.jsx)(n.td,{children:"FlowResource (requires transition and flow loaded)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"current_state"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transition.toState|fromState"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"object|null"})}),(0,i.jsx)(n.td,{children:"FlowStateResource for current state"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"current_status"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transition.toState|fromState"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string|null"})}),(0,i.jsx)(n.td,{children:"Current status value"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"instanceable"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"instanceable"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mixed"})}),(0,i.jsx)(n.td,{children:"Instanceable entity resource or default context"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actor"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actor"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mixed"})}),(0,i.jsx)(n.td,{children:"Actor entity resource or default context"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transition"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transition"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"object"})}),(0,i.jsx)(n.td,{children:"FlowTransitionResource for the transition"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"active-status-detection",children:"Active Status Detection"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"is_active"})," property is determined by:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"'is_active' => (bool)(is_null($this->completed_at))\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"completed_at"})," is null, the instance is active."]}),"\n",(0,i.jsx)(n.h2,{id:"duration-calculation",children:"Duration Calculation"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"duration_seconds"})," property is calculated when the instance is completed:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"'duration_seconds' => $this->duration_seconds ?? null\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This is typically calculated as the difference between ",(0,i.jsx)(n.code,{children:"started_at"})," and ",(0,i.jsx)(n.code,{children:"completed_at"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"current-state-detection",children:"Current State Detection"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"current_state"})," and ",(0,i.jsx)(n.code,{children:"current_status"})," properties require:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"transition"})," relation loaded"]}),"\n",(0,i.jsxs)(n.li,{children:["Either ",(0,i.jsx)(n.code,{children:"transition.toState"})," or ",(0,i.jsx)(n.code,{children:"transition.fromState"})," loaded"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The resource uses ",(0,i.jsx)(n.code,{children:"toState"})," if available, otherwise falls back to ",(0,i.jsx)(n.code,{children:"fromState"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$currentState = $this->transition->toState ?? $this->transition->fromState;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Http\\Resources\\FlowInstanceResource;\nuse JobMetric\\Flow\\Models\\FlowInstance;\n\n$instance = FlowInstance::find(1);\n\nreturn FlowInstanceResource::make($instance);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"with-relations",children:"With Relations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$instance = FlowInstance::with([\n    'instanceable',\n    'actor',\n    'transition',\n    'transition.flow',\n    'transition.toState',\n    'transition.fromState',\n])->find(1);\n\nreturn FlowInstanceResource::make($instance);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"in-collections",children:"In Collections"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$instances = FlowInstance::with(['transition', 'instanceable'])->get();\n\nreturn FlowInstanceResource::collection($instances);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"in-api-responses",children:"In API Responses"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function show($id)\n{\n    $instance = FlowInstance::query()\n        ->with([\n            'instanceable',\n            'actor',\n            'transition.flow',\n            'transition.toState',\n        ])\n        ->findOrFail($id);\n\n    return new FlowInstanceResource($instance);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"response-examples",children:"Response Examples"}),"\n",(0,i.jsx)(n.h3,{id:"basic-response",children:"Basic Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "id": 1,\n    "instanceable_type": "App\\\\Models\\\\Order",\n    "instanceable_id": 123,\n    "flow_transition_id": 1,\n    "actor_type": "App\\\\Models\\\\User",\n    "actor_id": 5,\n    "started_at": "2024-01-01T00:00:00.000000Z",\n    "completed_at": null,\n    "is_active": true,\n    "duration_seconds": null\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"completed-instance",children:"Completed Instance"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "id": 1,\n    "instanceable_type": "App\\\\Models\\\\Order",\n    "instanceable_id": 123,\n    "flow_transition_id": 1,\n    "actor_type": "App\\\\Models\\\\User",\n    "actor_id": 5,\n    "started_at": "2024-01-01T00:00:00.000000Z",\n    "completed_at": "2024-01-01T01:30:00.000000Z",\n    "is_active": false,\n    "duration_seconds": 5400\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"with-relations-1",children:"With Relations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "id": 1,\n    "instanceable_type": "App\\\\Models\\\\Order",\n    "instanceable_id": 123,\n    "flow_transition_id": 1,\n    "actor_type": "App\\\\Models\\\\User",\n    "actor_id": 5,\n    "started_at": "2024-01-01T00:00:00.000000Z",\n    "completed_at": null,\n    "is_active": true,\n    "duration_seconds": null,\n    "flow": {\n        "id": 1,\n        "subject_type": "App\\\\Models\\\\Order",\n        // ... FlowResource fields\n    },\n    "current_state": {\n        "id": 2,\n        "flow_id": 1,\n        "type": "middle",\n        "status": "processing",\n        // ... FlowStateResource fields\n    },\n    "current_status": "processing",\n    "instanceable": {\n        "id": 123,\n        "order_number": "ORD-001",\n        // ... Order resource fields\n    },\n    "actor": {\n        "id": 5,\n        "name": "John Doe",\n        // ... User resource fields\n    },\n    "transition": {\n        "id": 1,\n        "flow_id": 1,\n        "from": 1,\n        "to": 2,\n        // ... FlowTransitionResource fields\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"relation-loading",children:"Relation Loading"}),"\n",(0,i.jsx)(n.h3,{id:"eager-loading-relations",children:"Eager Loading Relations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Load all relations\n$instance = FlowInstance::with([\n    'instanceable',\n    'actor',\n    'transition',\n    'transition.flow',\n    'transition.toState',\n    'transition.fromState',\n])->find(1);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"selective-loading",children:"Selective Loading"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Load only needed relations\n$instance = FlowInstance::with([\n    'transition',\n    'transition.toState',\n])->find(1);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"nested-relations",children:"Nested Relations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Load deeply nested relations\n$instance = FlowInstance::with([\n    'instanceable',\n    'actor',\n    'transition.flow.states',\n    'transition.toState',\n])->find(1);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"morph-relations",children:"Morph Relations"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"instanceable"})," and ",(0,i.jsx)(n.code,{children:"actor"})," properties use morph relations. The resource will:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"instanceable_resource"})," or ",(0,i.jsx)(n.code,{children:"actor_resource"})," if available"]}),"\n",(0,i.jsxs)(n.li,{children:["Otherwise, use ",(0,i.jsx)(n.code,{children:"resource_morph_default_context"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This allows custom resource transformation for different morph types."}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Load Relations Efficiently"}),": Only load relations you need"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// \u2705 Good\nFlowInstance::with(['transition', 'transition.toState'])->get();\n\n// \u274c Bad\nFlowInstance::with(['instanceable', 'actor', 'transition', 'transition.flow', 'transition.toState'])->get();\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Handle Active Status"}),": Check is_active for active instances"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"if ($instance->is_active) {\n    // Instance is still running\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Calculate Duration"}),": Use duration_seconds for completed instances"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"if ($instance->duration_seconds) {\n    $hours = $instance->duration_seconds / 3600;\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Load Current State"}),": Load toState or fromState for current state"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$instance = FlowInstance::with('transition.toState')->find(1);\n// current_state and current_status will be available\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-transition-resource",children:"FlowTransitionResource"})," - Transition resource"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-state-resource",children:"FlowStateResource"})," - State resource"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-resource",children:"FlowResource"})," - Flow resource"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);