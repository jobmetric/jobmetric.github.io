"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[1375],{7222(e,n,l){l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"laravel-flow/deep-diving/support/flow-picker-builder","title":"FlowPickerBuilder","description":"The FlowPickerBuilder defines the constraints and selection strategy used by the FlowPicker to choose a Flow. It centralizes all filters, ordering preferences, match strategy, fallback cascade steps, and performance hints.","source":"@site/packages/laravel-flow/deep-diving/support/flow-picker-builder.md","sourceDirName":"laravel-flow/deep-diving/support","slug":"/laravel-flow/deep-diving/support/flow-picker-builder","permalink":"/packages/laravel-flow/deep-diving/support/flow-picker-builder","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/support/flow-picker-builder.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"FlowPickerBuilder"},"sidebar":"packagesSidebar","previous":{"title":"FlowPicker","permalink":"/packages/laravel-flow/deep-diving/support/flow-picker"},"next":{"title":"FlowTaskContext","permalink":"/packages/laravel-flow/deep-diving/support/flow-task-context"}}');var i=l(4848),s=l(8453);const o={sidebar_position:3,sidebar_label:"FlowPickerBuilder"},t="FlowPickerBuilder",c={},d=[{value:"Namespace",id:"namespace",level:2},{value:"Where and When to Use FlowPickerBuilder",id:"where-and-when-to-use-flowpickerbuilder",level:2},{value:"Primary Use Cases",id:"primary-use-cases",level:3},{value:"Key Scenarios",id:"key-scenarios",level:3},{value:"Scenario 1: Multi-Tenant Applications",id:"scenario-1-multi-tenant-applications",level:4},{value:"Scenario 2: Environment-Specific Workflows",id:"scenario-2-environment-specific-workflows",level:4},{value:"Scenario 3: Channel-Based Workflows",id:"scenario-3-channel-based-workflows",level:4},{value:"Scenario 4: A/B Testing and Gradual Rollouts",id:"scenario-4-ab-testing-and-gradual-rollouts",level:4},{value:"Scenario 5: Collection-Based Workflows",id:"scenario-5-collection-based-workflows",level:4},{value:"Scenario 6: Scheduled Workflow Activation",id:"scenario-6-scheduled-workflow-activation",level:4},{value:"Scenario 7: Version Management",id:"scenario-7-version-management",level:4},{value:"Scenario 8: Fallback Strategies",id:"scenario-8-fallback-strategies",level:4},{value:"When NOT to Use FlowPickerBuilder",id:"when-not-to-use-flowpickerbuilder",level:3},{value:"Overview",id:"overview",level:2},{value:"Constants",id:"constants",level:2},{value:"Match Strategy",id:"match-strategy",level:3},{value:"Fallback Steps",id:"fallback-steps",level:3},{value:"Subject Configuration",id:"subject-configuration",level:2},{value:"subjectType()",id:"subjecttype",level:3},{value:"subjectScope()",id:"subjectscope",level:3},{value:"subjectCollection()",id:"subjectcollection",level:3},{value:"Environment and Channel",id:"environment-and-channel",level:2},{value:"environment()",id:"environment",level:3},{value:"channel()",id:"channel",level:3},{value:"preferEnvironments()",id:"preferenvironments",level:3},{value:"preferChannels()",id:"preferchannels",level:3},{value:"Active Constraints",id:"active-constraints",level:2},{value:"onlyActive()",id:"onlyactive",level:3},{value:"ignoreTimeWindow()",id:"ignoretimewindow",level:3},{value:"timeNow()",id:"timenow",level:3},{value:"Rollout Configuration",id:"rollout-configuration",level:2},{value:"evaluateRollout()",id:"evaluaterollout",level:3},{value:"rolloutNamespace()",id:"rolloutnamespace",level:3},{value:"rolloutSalt()",id:"rolloutsalt",level:3},{value:"rolloutKeyResolver()",id:"rolloutkeyresolver",level:3},{value:"Version Constraints",id:"version-constraints",level:2},{value:"versionEquals()",id:"versionequals",level:3},{value:"versionAtLeast()",id:"versionatleast",level:3},{value:"versionAtMost()",id:"versionatmost",level:3},{value:"versionMin() / versionMax()",id:"versionmin--versionmax",level:3},{value:"Include/Exclude/Prefer",id:"includeexcludeprefer",level:2},{value:"includeFlows()",id:"includeflows",level:3},{value:"excludeFlows()",id:"excludeflows",level:3},{value:"preferFlows()",id:"preferflows",level:3},{value:"Ordering",id:"ordering",level:2},{value:"orderByDefault()",id:"orderbydefault",level:3},{value:"orderBy()",id:"orderby",level:3},{value:"matchStrategy()",id:"matchstrategy",level:3},{value:"pickFirstMatch()",id:"pickfirstmatch",level:3},{value:"Custom Filters",id:"custom-filters",level:2},{value:"where()",id:"where",level:3},{value:"Fallback Cascade",id:"fallback-cascade",level:2},{value:"fallbackCascade()",id:"fallbackcascade",level:3},{value:"Force Flow ID",id:"force-flow-id",level:2},{value:"forceFlowIdResolver()",id:"forceflowidresolver",level:3},{value:"Default Requirement",id:"default-requirement",level:2},{value:"requireDefault()",id:"requiredefault",level:3},{value:"Candidates Configuration",id:"candidates-configuration",level:2},{value:"returnCandidates()",id:"returncandidates",level:3},{value:"candidatesLimit()",id:"candidateslimit",level:3},{value:"Performance",id:"performance",level:2},{value:"cacheInRequest()",id:"cacheinrequest",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Basic Configuration",id:"example-1-basic-configuration",level:3},{value:"Example 2: With Rollout",id:"example-2-with-rollout",level:3},{value:"Example 3: With Fallback",id:"example-3-with-fallback",level:3},{value:"Example 4: Version Constraints",id:"example-4-version-constraints",level:3},{value:"Example 5: Include/Exclude",id:"example-5-includeexclude",level:3},{value:"Example 6: Custom Ordering",id:"example-6-custom-ordering",level:3},{value:"Example 7: Custom Filters",id:"example-7-custom-filters",level:3},{value:"Example 8: Complex Configuration",id:"example-8-complex-configuration",level:3},{value:"Getter Methods",id:"getter-methods",level:2},{value:"Integration with HasWorkflow",id:"integration-with-hasworkflow",level:2},{value:"Real-World System Implementation Examples",id:"real-world-system-implementation-examples",level:2},{value:"Example 1: Complete E-Commerce Order Management System",id:"example-1-complete-e-commerce-order-management-system",level:3},{value:"Example 2: Multi-Tenant SaaS Document Management System",id:"example-2-multi-tenant-saas-document-management-system",level:3},{value:"Example 3: Content Management System with A/B Testing",id:"example-3-content-management-system-with-ab-testing",level:3},{value:"Example 4: Financial Transaction Processing System",id:"example-4-financial-transaction-processing-system",level:3},{value:"Example 5: Support Ticket System with Priority-Based Workflows",id:"example-5-support-ticket-system-with-priority-based-workflows",level:3},{value:"Example 6: Invoice Processing with Time-Based Activation",id:"example-6-invoice-processing-with-time-based-activation",level:3},{value:"Example 7: Complete Implementation with All Features",id:"example-7-complete-implementation-with-all-features",level:3},{value:"Example 8: Testing and Development Scenarios",id:"example-8-testing-and-development-scenarios",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"flowpickerbuilder",children:"FlowPickerBuilder"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"FlowPickerBuilder"})," defines the constraints and selection strategy used by the ",(0,i.jsx)(n.code,{children:"FlowPicker"})," to choose a Flow. It centralizes all filters, ordering preferences, match strategy, fallback cascade steps, and performance hints."]}),"\n",(0,i.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\Support\\FlowPickerBuilder\n"})}),"\n",(0,i.jsx)(n.h2,{id:"where-and-when-to-use-flowpickerbuilder",children:"Where and When to Use FlowPickerBuilder"}),"\n",(0,i.jsx)(n.h3,{id:"primary-use-cases",children:"Primary Use Cases"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"FlowPickerBuilder is used in the following scenarios:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"HasWorkflow Trait Integration"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When models use ",(0,i.jsx)(n.code,{children:"HasWorkflow"})," trait, they override ",(0,i.jsx)(n.code,{children:"buildFlowPicker()"})," method"]}),"\n",(0,i.jsxs)(n.li,{children:["This method receives a ",(0,i.jsx)(n.code,{children:"FlowPickerBuilder"})," instance to configure flow selection"]}),"\n",(0,i.jsx)(n.li,{children:"Used automatically during model creation to select the appropriate flow"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"HasFlow Trait Integration"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When models use ",(0,i.jsx)(n.code,{children:"HasFlow"})," trait, they also use ",(0,i.jsx)(n.code,{children:"buildFlowPicker()"})," internally"]}),"\n",(0,i.jsxs)(n.li,{children:["Uses ",(0,i.jsx)(n.code,{children:"forceFlowIdResolver"})," to bypass complex selection logic"]}),"\n",(0,i.jsx)(n.li,{children:"Directly binds flows by ID while still using the builder pattern"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flow Service Preview"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When using ",(0,i.jsx)(n.code,{children:"Flow::previewPick()"})," to preview which flow would be selected"]}),"\n",(0,i.jsx)(n.li,{children:"Allows testing flow selection logic without actually binding flows"}),"\n",(0,i.jsx)(n.li,{children:"Useful for debugging and validation"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Manual Flow Selection"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"When manually selecting flows outside of automatic binding"}),"\n",(0,i.jsx)(n.li,{children:"When building custom flow selection logic"}),"\n",(0,i.jsx)(n.li,{children:"When implementing advanced flow routing scenarios"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"key-scenarios",children:"Key Scenarios"}),"\n",(0,i.jsx)(n.h4,{id:"scenario-1-multi-tenant-applications",children:"Scenario 1: Multi-Tenant Applications"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Different tenants need different workflows for the same model type."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use ",(0,i.jsx)(n.code,{children:"subjectScope()"})," to partition flows by tenant:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->subjectScope((string)$this->tenant_id);\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"scenario-2-environment-specific-workflows",children:"Scenario 2: Environment-Specific Workflows"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Different workflows for production, staging, and development."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use ",(0,i.jsx)(n.code,{children:"environment()"})," filter:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->environment(config('app.env'));\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"scenario-3-channel-based-workflows",children:"Scenario 3: Channel-Based Workflows"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Different workflows for web, API, and mobile channels."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use ",(0,i.jsx)(n.code,{children:"channel()"})," filter:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->channel(request()->header('X-Channel', 'web'));\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"scenario-4-ab-testing-and-gradual-rollouts",children:"Scenario 4: A/B Testing and Gradual Rollouts"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Gradually rolling out new workflows to a percentage of users."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use rollout configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->evaluateRollout(true)\n        ->rolloutNamespace('order_v2')\n        ->rolloutKeyResolver(function ($model) {\n            return (string)$model->user_id;\n        });\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"scenario-5-collection-based-workflows",children:"Scenario 5: Collection-Based Workflows"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Different workflows based on model attributes (e.g., premium vs standard orders)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use ",(0,i.jsx)(n.code,{children:"subjectCollection()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->subjectCollection($this->order_type);\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"scenario-6-scheduled-workflow-activation",children:"Scenario 6: Scheduled Workflow Activation"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Workflows that activate/deactivate at specific times."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use active window constraints:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->onlyActive(true)\n        ->ignoreTimeWindow(false)\n        ->timeNow(Carbon::now('UTC'));\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"scenario-7-version-management",children:"Scenario 7: Version Management"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Managing multiple versions of workflows and migrating between them."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use version constraints:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->versionAtLeast(1)\n        ->versionAtMost(3);\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"scenario-8-fallback-strategies",children:"Scenario 8: Fallback Strategies"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When:"})," Need graceful degradation when exact flow match is not found."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How:"})," Use fallback cascade:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n    $builder->fallbackCascade([\n        FlowPickerBuilder::FB_DROP_CHANNEL,\n        FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n    ]);\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"when-not-to-use-flowpickerbuilder",children:"When NOT to Use FlowPickerBuilder"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"You typically don't need to use FlowPickerBuilder directly when:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Using ",(0,i.jsx)(n.code,{children:"HasFlow"})," trait with simple flow ID resolution (it's handled internally)"]}),"\n",(0,i.jsx)(n.li,{children:"Working with single, fixed flows per model type"}),"\n",(0,i.jsx)(n.li,{children:"Flow selection logic is straightforward and doesn't change"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["In these cases, use ",(0,i.jsx)(n.code,{children:"HasFlow"})," instead of ",(0,i.jsx)(n.code,{children:"HasWorkflow"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The builder provides a fluent interface to configure:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Subject filters"}),": Type, scope, collection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Environment/Channel filters"}),": Production, staging, web, API, etc."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Active constraints"}),": Status and time windows"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Rollout gating"}),": Gradual feature rollouts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Version constraints"}),": Exact version or version ranges"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Include/Exclude lists"}),": Whitelist and blacklist flows"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Preferential ordering"}),": Boost certain flows in ordering"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Match strategy"}),": BEST (default) or FIRST"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fallback cascade"}),": Progressive constraint relaxation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Request caching"}),": Performance optimization"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"constants",children:"Constants"}),"\n",(0,i.jsx)(n.h3,{id:"match-strategy",children:"Match Strategy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"FlowPickerBuilder::STRATEGY_BEST  // Best candidate based on ordering (default)\nFlowPickerBuilder::STRATEGY_FIRST // First matching record\n"})}),"\n",(0,i.jsx)(n.h3,{id:"fallback-steps",children:"Fallback Steps"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"FlowPickerBuilder::FB_DROP_CHANNEL         // Remove channel filter\nFlowPickerBuilder::FB_DROP_ENVIRONMENT     // Remove environment filter\nFlowPickerBuilder::FB_IGNORE_TIMEWINDOW    // Ignore active window\nFlowPickerBuilder::FB_DISABLE_ROLLOUT      // Disable rollout checks\nFlowPickerBuilder::FB_DROP_REQUIRE_DEFAULT // Don't require is_default\n"})}),"\n",(0,i.jsx)(n.h2,{id:"subject-configuration",children:"Subject Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"subjecttype",children:"subjectType()"}),"\n",(0,i.jsxs)(n.p,{children:["Set the model class that flows are being selected for. This is the primary filter and is ",(0,i.jsx)(n.strong,{children:"required"})," for flow selection."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"class-string<Model> $class"}),": Fully qualified model class name"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"subject_type"})," column matches the provided class"]}),"\n",(0,i.jsx)(n.li,{children:"Must be set before flow selection can work"}),"\n",(0,i.jsxs)(n.li,{children:["Used internally by ",(0,i.jsx)(n.code,{children:"HasWorkflow"})," and ",(0,i.jsx)(n.code,{children:"HasFlow"})," traits"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(\\App\\Models\\Order::class);\n// Matches flows with subject_type = 'App\\Models\\Order'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"subjectscope",children:"subjectScope()"}),"\n",(0,i.jsx)(n.p,{children:"Set optional subject scope to partition flows by domain (tenant, organization, etc.). This allows multiple flows for the same model type based on scope."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectScope((string)$order->tenant_id);\n$builder->subjectScope(null); // Clear scope filter\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"?string $scope"}),": Scope identifier (e.g., tenant ID, org ID) or null to clear"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"subject_scope"})," column matches the provided value"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"}),", no scope filtering is applied"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for multi-tenant applications"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Tenant-specific flows\n$builder->subjectScope((string)$order->tenant_id);\n// Matches flows with subject_scope = '123' (tenant ID)\n\n// Clear scope to match any scope\n$builder->subjectScope(null);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multi-tenant SaaS applications"}),"\n",(0,i.jsx)(n.li,{children:"Organization-based workflows"}),"\n",(0,i.jsx)(n.li,{children:"Department-specific processes"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"subjectcollection",children:"subjectCollection()"}),"\n",(0,i.jsx)(n.p,{children:"Set optional subject collection to further partition flows. Collections allow different workflows for the same model type based on attributes."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectCollection($order->collection);\n$builder->subjectCollection(null); // Clear collection filter\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"?string $collection"}),": Collection identifier (e.g., 'premium', 'standard', 'enterprise') or null to clear"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"subject_collection"})," column matches the provided value"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"}),", no collection filtering is applied"]}),"\n",(0,i.jsxs)(n.li,{children:["Can be combined with ",(0,i.jsx)(n.code,{children:"subjectScope()"})," for fine-grained control"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Premium order workflow\n$builder->subjectCollection('premium');\n// Matches flows with subject_collection = 'premium'\n\n// Standard order workflow\n$builder->subjectCollection('standard');\n// Matches flows with subject_collection = 'standard'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Different workflows for premium vs standard customers"}),"\n",(0,i.jsx)(n.li,{children:"Collection-based business rules"}),"\n",(0,i.jsx)(n.li,{children:"Attribute-driven workflow selection"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"environment-and-channel",children:"Environment and Channel"}),"\n",(0,i.jsx)(n.h3,{id:"environment",children:"environment()"}),"\n",(0,i.jsx)(n.p,{children:"Filter flows by environment. This restricts flows to a specific deployment environment."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->environment('production');\n$builder->environment(config('app.env'));\n$builder->environment(null); // Clear filter\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"?string $environment"}),": Environment name (e.g., 'production', 'staging', 'development') or null to clear"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"environment"})," column matches the provided value"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"}),", no environment filtering is applied"]}),"\n",(0,i.jsx)(n.li,{children:"Common values: 'production', 'staging', 'development', 'testing'"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Production-only flows\n$builder->environment('production');\n\n// Environment from config\n$builder->environment(config('app.env'));\n\n// Clear to match any environment\n$builder->environment(null);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Different workflows per deployment environment"}),"\n",(0,i.jsx)(n.li,{children:"Testing workflows in staging"}),"\n",(0,i.jsx)(n.li,{children:"Production-specific business rules"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"channel",children:"channel()"}),"\n",(0,i.jsx)(n.p,{children:"Filter flows by channel. This restricts flows based on the request channel (web, API, mobile, etc.)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->channel('web');\n$builder->channel(request()->header('X-Channel', 'web'));\n$builder->channel(null); // Clear filter\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"?string $channel"}),": Channel name (e.g., 'web', 'api', 'mobile', 'admin') or null to clear"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"channel"})," column matches the provided value"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"}),", no channel filtering is applied"]}),"\n",(0,i.jsx)(n.li,{children:"Can be determined from request headers, routes, or user context"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Web-only flows\n$builder->channel('web');\n\n// API-only flows\n$builder->channel('api');\n\n// From request header\n$builder->channel(request()->header('X-Channel', 'web'));\n\n// From route\n$builder->channel(request()->is('api/*') ? 'api' : 'web');\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Different workflows for web vs API requests"}),"\n",(0,i.jsx)(n.li,{children:"Mobile-specific workflows"}),"\n",(0,i.jsx)(n.li,{children:"Admin panel workflows"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"preferenvironments",children:"preferEnvironments()"}),"\n",(0,i.jsx)(n.p,{children:"Set preferred environments for ordering (not filtering). This boosts certain environments in the ordering without filtering them out."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->preferEnvironments(['production', 'staging', 'development']);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"array<int,string> $envs"}),": Array of preferred environment names"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Not a filter"})," - doesn't exclude other environments"]}),"\n",(0,i.jsx)(n.li,{children:"Earlier items in the array rank higher in ordering"}),"\n",(0,i.jsx)(n.li,{children:"Uses CASE-based SQL ordering to boost preferred values"}),"\n",(0,i.jsx)(n.li,{children:"Empty strings and null values are filtered out"}),"\n",(0,i.jsx)(n.li,{children:"Values are converted to strings"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Prefer production, then staging, then development\n$builder->preferEnvironments(['production', 'staging', 'development']);\n\n// If multiple flows match, production will be selected first\n// But development flows are still eligible if production doesn't match\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Prefer production flows but allow staging as fallback"}),"\n",(0,i.jsx)(n.li,{children:"Environment priority ordering"}),"\n",(0,i.jsx)(n.li,{children:"Graceful degradation"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"preferchannels",children:"preferChannels()"}),"\n",(0,i.jsx)(n.p,{children:"Set preferred channels for ordering (not filtering). This boosts certain channels in the ordering without filtering them out."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->preferChannels(['web', 'api', 'mobile']);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"array<int,string> $channels"}),": Array of preferred channel names"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Not a filter"})," - doesn't exclude other channels"]}),"\n",(0,i.jsx)(n.li,{children:"Earlier items in the array rank higher in ordering"}),"\n",(0,i.jsx)(n.li,{children:"Uses CASE-based SQL ordering to boost preferred values"}),"\n",(0,i.jsx)(n.li,{children:"Empty strings and null values are filtered out"}),"\n",(0,i.jsx)(n.li,{children:"Values are converted to strings"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Prefer web, then API, then mobile\n$builder->preferChannels(['web', 'api', 'mobile']);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Prefer web flows but allow API as fallback"}),"\n",(0,i.jsx)(n.li,{children:"Channel priority ordering"}),"\n",(0,i.jsx)(n.li,{children:"Multi-channel support with preferences"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"active-constraints",children:"Active Constraints"}),"\n",(0,i.jsx)(n.h3,{id:"onlyactive",children:"onlyActive()"}),"\n",(0,i.jsxs)(n.p,{children:["Require active flows. When enabled, only flows with ",(0,i.jsx)(n.code,{children:"status=true"})," are eligible, and optionally time window checks are applied."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->onlyActive(true);  // Enforce active constraints\n$builder->onlyActive(false); // Disable active checks\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bool $onlyActive"}),": Whether to enforce active constraints"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default:"})," ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"true"}),": Requires ",(0,i.jsx)(n.code,{children:"status = true"})," and optionally checks ",(0,i.jsx)(n.code,{children:"active_from"}),"/",(0,i.jsx)(n.code,{children:"active_to"})," time windows"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"false"}),": No active status or time window checks are applied"]}),"\n",(0,i.jsxs)(n.li,{children:["Time window checks can be disabled separately with ",(0,i.jsx)(n.code,{children:"ignoreTimeWindow(true)"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Only active flows\n$builder->onlyActive(true);\n\n// Include inactive flows (for testing or admin)\n$builder->onlyActive(false);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Production workflows (only active)"}),"\n",(0,i.jsx)(n.li,{children:"Testing scenarios (include inactive)"}),"\n",(0,i.jsx)(n.li,{children:"Admin interfaces (show all flows)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"ignoretimewindow",children:"ignoreTimeWindow()"}),"\n",(0,i.jsxs)(n.p,{children:["Ignore ",(0,i.jsx)(n.code,{children:"active_from"}),"/",(0,i.jsx)(n.code,{children:"active_to"})," time window checks while keeping ",(0,i.jsx)(n.code,{children:"status=true"})," requirement (if ",(0,i.jsx)(n.code,{children:"onlyActive"})," is true)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->ignoreTimeWindow(true);  // Ignore time window\n$builder->ignoreTimeWindow(false); // Enforce time window\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bool $ignore = true"}),": Whether to ignore time window checks"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default:"})," ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"true"}),": Only checks ",(0,i.jsx)(n.code,{children:"status = true"}),", ignores ",(0,i.jsx)(n.code,{children:"active_from"})," and ",(0,i.jsx)(n.code,{children:"active_to"})]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"false"}),": Checks both ",(0,i.jsx)(n.code,{children:"status = true"})," and time window constraints"]}),"\n",(0,i.jsxs)(n.li,{children:["Only has effect when ",(0,i.jsx)(n.code,{children:"onlyActive(true)"})," is set"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for testing or when time windows are not needed"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Check status only, ignore time windows\n$builder->onlyActive(true)\n    ->ignoreTimeWindow(true);\n\n// Check both status and time windows\n$builder->onlyActive(true)\n    ->ignoreTimeWindow(false);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Testing without time constraints"}),"\n",(0,i.jsx)(n.li,{children:"Workflows without scheduled activation"}),"\n",(0,i.jsx)(n.li,{children:"Simplified active checks"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"timenow",children:"timeNow()"}),"\n",(0,i.jsx)(n.p,{children:'Set the reference "now" time in UTC for deterministic time window evaluation. This allows testing with specific times and ensures consistent evaluation.'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->timeNow(Carbon::now('UTC'));\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DateTimeInterface $now"}),": UTC instant for time comparisons"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Sets the reference time used to evaluate ",(0,i.jsx)(n.code,{children:"active_from"})," and ",(0,i.jsx)(n.code,{children:"active_to"})," constraints"]}),"\n",(0,i.jsx)(n.li,{children:"Must be in UTC timezone"}),"\n",(0,i.jsxs)(n.li,{children:["When not set, ",(0,i.jsx)(n.code,{children:"Carbon::now('UTC')"})," is used by FlowPicker"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for testing and deterministic evaluation"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Use current time\n$builder->timeNow(Carbon::now('UTC'));\n\n// Use specific time for testing\n$builder->timeNow(Carbon::parse('2024-01-01 12:00:00', 'UTC'));\n\n// Use time from model\n$builder->timeNow($order->created_at->utc());\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Testing with specific times"}),"\n",(0,i.jsx)(n.li,{children:"Deterministic evaluation in tests"}),"\n",(0,i.jsx)(n.li,{children:"Time-based flow activation/deactivation"}),"\n",(0,i.jsx)(n.li,{children:"Scheduled workflow scenarios"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"rollout-configuration",children:"Rollout Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"evaluaterollout",children:"evaluateRollout()"}),"\n",(0,i.jsx)(n.p,{children:"Enable or disable rollout gating. Rollout allows gradual feature deployment by assigning flows to a percentage of users based on a stable key."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->evaluateRollout(true);  // Enable rollout\n$builder->evaluateRollout(false); // Disable rollout\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bool $enabled"}),": Whether rollout should be applied"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default:"})," ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"true"}),": Applies rollout percentage checks using stable bucket hashing"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"false"}),": Ignores ",(0,i.jsx)(n.code,{children:"rollout_pct"})," column, all flows are eligible"]}),"\n",(0,i.jsxs)(n.li,{children:["Requires ",(0,i.jsx)(n.code,{children:"rolloutKeyResolver"})," to be set for proper operation"]}),"\n",(0,i.jsxs)(n.li,{children:["If no rollout key is available, only flows with ",(0,i.jsx)(n.code,{children:"rollout_pct IS NULL"})," are eligible"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Enable gradual rollout\n$builder->evaluateRollout(true);\n\n// Disable for testing\n$builder->evaluateRollout(false);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A/B testing new workflows"}),"\n",(0,i.jsx)(n.li,{children:"Gradual feature rollouts"}),"\n",(0,i.jsx)(n.li,{children:"Canary deployments"}),"\n",(0,i.jsx)(n.li,{children:"Percentage-based user segmentation"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rolloutnamespace",children:"rolloutNamespace()"}),"\n",(0,i.jsx)(n.p,{children:"Set namespace to isolate rollout bucket spaces across different domains or features. This ensures that rollout percentages are independent for different features."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->rolloutNamespace('order_v2');\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"?string $ns"}),": Namespace string or null to clear"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Used in hash calculation to isolate buckets"}),"\n",(0,i.jsx)(n.li,{children:"Different namespaces create independent bucket spaces"}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"}),", no namespace is used in hashing"]}),"\n",(0,i.jsx)(n.li,{children:"Combined with salt and key to compute stable bucket"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Isolate order workflow rollout\n$builder->rolloutNamespace('order_v2');\n\n// Isolate payment workflow rollout (independent)\n$builder->rolloutNamespace('payment_v3');\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multiple feature rollouts running simultaneously"}),"\n",(0,i.jsx)(n.li,{children:"Independent A/B tests"}),"\n",(0,i.jsx)(n.li,{children:"Domain-specific rollouts"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rolloutsalt",children:"rolloutSalt()"}),"\n",(0,i.jsx)(n.p,{children:"Set salt to further stabilize or segregate rollout hashing. Salt allows version-specific or context-specific bucket assignment."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->rolloutSalt('2024-01');\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"?string $salt"}),": Salt string or null to clear"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Used in hash calculation for additional stability/segregation"}),"\n",(0,i.jsx)(n.li,{children:"Changing salt redistributes buckets (users get different flows)"}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"}),", no salt is used in hashing"]}),"\n",(0,i.jsx)(n.li,{children:"Combined with namespace and key to compute stable bucket"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Version-specific salt\n$builder->rolloutSalt('2024-01');\n\n// Date-based salt for monthly redistribution\n$builder->rolloutSalt(now()->format('Y-m'));\n\n// Clear salt\n$builder->rolloutSalt(null);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Version-specific rollouts"}),"\n",(0,i.jsx)(n.li,{children:"Time-based bucket redistribution"}),"\n",(0,i.jsx)(n.li,{children:"Further segregation of rollout spaces"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rolloutkeyresolver",children:"rolloutKeyResolver()"}),"\n",(0,i.jsx)(n.p,{children:"Set resolver callback that returns a stable rollout key per model instance. The same key will always fall into the same bucket, ensuring consistent assignment."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->rolloutKeyResolver(function (Model $model): ?string {\n    return (string)$model->user_id;\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"callable(Model):(?string) $resolver"}),": Callback that returns a stable key or null"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Called with the model instance to get a stable key"}),"\n",(0,i.jsx)(n.li,{children:"Key is used to compute bucket (0-99) via hash"}),"\n",(0,i.jsx)(n.li,{children:"Same key always produces same bucket (stable assignment)"}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"})," or empty string, only flows with ",(0,i.jsx)(n.code,{children:"rollout_pct IS NULL"})," are eligible"]}),"\n",(0,i.jsxs)(n.li,{children:["Common keys: ",(0,i.jsx)(n.code,{children:"user_id"}),", ",(0,i.jsx)(n.code,{children:"order_id"}),", ",(0,i.jsx)(n.code,{children:"customer_id"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Use user ID for consistent assignment\n$builder->rolloutKeyResolver(function ($model) {\n    return (string)$model->user_id;\n});\n\n// Use order ID\n$builder->rolloutKeyResolver(function ($model) {\n    return (string)$model->getKey();\n});\n\n// Use combination\n$builder->rolloutKeyResolver(function ($model) {\n    return $model->user_id . '_' . $model->tenant_id;\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Bucket Calculation:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"bucket = crc32(namespace + '|' + salt + '|' + key) % 100\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Consistent user assignment (same user always gets same flow)"}),"\n",(0,i.jsx)(n.li,{children:"Order-based assignment"}),"\n",(0,i.jsx)(n.li,{children:"Customer-based segmentation"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"version-constraints",children:"Version Constraints"}),"\n",(0,i.jsx)(n.h3,{id:"versionequals",children:"versionEquals()"}),"\n",(0,i.jsxs)(n.p,{children:["Pin selection to an exact version. When set, ",(0,i.jsx)(n.code,{children:"versionMin"})," and ",(0,i.jsx)(n.code,{children:"versionMax"})," are ignored."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->versionEquals(2); // Only version 2\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"int $version"}),": Exact version number"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"version"})," column equals the provided value"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Disables"})," ",(0,i.jsx)(n.code,{children:"versionMin"})," and ",(0,i.jsx)(n.code,{children:"versionMax"})," if they were set"]}),"\n",(0,i.jsx)(n.li,{children:"Most restrictive version constraint"}),"\n",(0,i.jsx)(n.li,{children:"Useful for testing specific versions or pinning to a known good version"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Only version 2 flows\n$builder->versionEquals(2);\n\n// This will ignore versionMin/versionMax\n$builder->versionEquals(2)\n    ->versionAtLeast(1)  // Ignored\n    ->versionAtMost(3);  // Ignored\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Testing specific workflow versions"}),"\n",(0,i.jsx)(n.li,{children:"Pinning to stable versions"}),"\n",(0,i.jsx)(n.li,{children:"Version-specific deployments"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"versionatleast",children:"versionAtLeast()"}),"\n",(0,i.jsxs)(n.p,{children:["Set minimum allowed version (inclusive). Ignored when ",(0,i.jsx)(n.code,{children:"versionEquals"})," is set."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->versionAtLeast(1); // Version >= 1\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"int $min"}),": Minimum version number (inclusive)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"version >= $min"})]}),"\n",(0,i.jsxs)(n.li,{children:["Ignored if ",(0,i.jsx)(n.code,{children:"versionEquals"})," is set"]}),"\n",(0,i.jsxs)(n.li,{children:["Can be combined with ",(0,i.jsx)(n.code,{children:"versionAtMost"})," for range"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for excluding older versions"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Versions 1 and above\n$builder->versionAtLeast(1);\n\n// Combined with maximum\n$builder->versionAtLeast(1)\n    ->versionAtMost(3); // Versions 1-3\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Excluding deprecated versions"}),"\n",(0,i.jsx)(n.li,{children:"Minimum version requirements"}),"\n",(0,i.jsx)(n.li,{children:"Version migration scenarios"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"versionatmost",children:"versionAtMost()"}),"\n",(0,i.jsxs)(n.p,{children:["Set maximum allowed version (inclusive). Ignored when ",(0,i.jsx)(n.code,{children:"versionEquals"})," is set."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->versionAtMost(3); // Version <= 3\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"int $max"}),": Maximum version number (inclusive)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"version <= $max"})]}),"\n",(0,i.jsxs)(n.li,{children:["Ignored if ",(0,i.jsx)(n.code,{children:"versionEquals"})," is set"]}),"\n",(0,i.jsxs)(n.li,{children:["Can be combined with ",(0,i.jsx)(n.code,{children:"versionAtLeast"})," for range"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for excluding newer versions"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Versions 3 and below\n$builder->versionAtMost(3);\n\n// Combined with minimum\n$builder->versionAtLeast(1)\n    ->versionAtMost(3); // Versions 1-3\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Excluding beta versions"}),"\n",(0,i.jsx)(n.li,{children:"Maximum version limits"}),"\n",(0,i.jsx)(n.li,{children:"Gradual version migration"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"versionmin--versionmax",children:"versionMin() / versionMax()"}),"\n",(0,i.jsxs)(n.p,{children:["Alternative method names for ",(0,i.jsx)(n.code,{children:"versionAtLeast()"})," and ",(0,i.jsx)(n.code,{children:"versionAtMost()"}),". Functionally identical."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->versionMin(1)->versionMax(3); // Versions 1-3\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"versionMin(int $min)"}),": Minimum version (same as ",(0,i.jsx)(n.code,{children:"versionAtLeast"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"versionMax(int $max)"}),": Maximum version (same as ",(0,i.jsx)(n.code,{children:"versionAtMost"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," These are aliases for ",(0,i.jsx)(n.code,{children:"versionAtLeast()"})," and ",(0,i.jsx)(n.code,{children:"versionAtMost()"}),". Use whichever naming you prefer."]}),"\n",(0,i.jsx)(n.h2,{id:"includeexcludeprefer",children:"Include/Exclude/Prefer"}),"\n",(0,i.jsx)(n.h3,{id:"includeflows",children:"includeFlows()"}),"\n",(0,i.jsx)(n.p,{children:"Restrict selection to only these flow IDs (whitelist). Only flows with IDs in this list are eligible."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->includeFlows([1, 2, 3]); // Only these flows\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"array<int,int> $ids"}),": Array of allowed flow IDs"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"id IN ($ids)"})]}),"\n",(0,i.jsx)(n.li,{children:"Empty array means no whitelist (all flows eligible)"}),"\n",(0,i.jsx)(n.li,{children:"Duplicate IDs are removed"}),"\n",(0,i.jsx)(n.li,{children:"Non-integer values are converted to integers"}),"\n",(0,i.jsx)(n.li,{children:"Array is re-indexed"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Only flows 1, 2, 3\n$builder->includeFlows([1, 2, 3]);\n\n// Single flow\n$builder->includeFlows([1]);\n\n// Clear whitelist\n$builder->includeFlows([]);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Testing specific flows"}),"\n",(0,i.jsx)(n.li,{children:"Limited flow selection"}),"\n",(0,i.jsx)(n.li,{children:"Flow subset scenarios"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"excludeflows",children:"excludeFlows()"}),"\n",(0,i.jsx)(n.p,{children:"Exclude these flow IDs from selection (blacklist). Flows with IDs in this list are not eligible."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->excludeFlows([4, 5]); // Exclude these flows\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"array<int,int> $ids"}),": Array of disallowed flow IDs"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Filters flows where ",(0,i.jsx)(n.code,{children:"id NOT IN ($ids)"})]}),"\n",(0,i.jsx)(n.li,{children:"Empty array means no blacklist"}),"\n",(0,i.jsx)(n.li,{children:"Duplicate IDs are removed"}),"\n",(0,i.jsx)(n.li,{children:"Non-integer values are converted to integers"}),"\n",(0,i.jsx)(n.li,{children:"Array is re-indexed"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Exclude flows 4, 5\n$builder->excludeFlows([4, 5]);\n\n// Exclude deprecated flows\n$builder->excludeFlows([10, 11, 12]);\n\n// Clear blacklist\n$builder->excludeFlows([]);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Excluding deprecated flows"}),"\n",(0,i.jsx)(n.li,{children:"Removing problematic flows"}),"\n",(0,i.jsx)(n.li,{children:"Testing without specific flows"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"preferflows",children:"preferFlows()"}),"\n",(0,i.jsx)(n.p,{children:"Prefer these flow IDs in ordering (not filtering). This boosts certain flows in the ordering without excluding others."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->preferFlows([1, 2]); // Boost these in ordering\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"array<int,int> $ids"}),": Array of preferred flow IDs"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Not a filter"})," - doesn't exclude other flows"]}),"\n",(0,i.jsx)(n.li,{children:"Earlier IDs in the array rank higher in ordering"}),"\n",(0,i.jsx)(n.li,{children:"Uses CASE-based SQL ordering to boost preferred IDs"}),"\n",(0,i.jsx)(n.li,{children:"Duplicate IDs are removed"}),"\n",(0,i.jsx)(n.li,{children:"Non-integer values are converted to integers"}),"\n",(0,i.jsx)(n.li,{children:"Array is re-indexed"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Prefer flows 1, 2, then 3\n$builder->preferFlows([1, 2, 3]);\n\n// If multiple flows match, flow 1 will be selected first\n// But other flows are still eligible if 1, 2, 3 don't match\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Preferring specific flows but allowing fallbacks"}),"\n",(0,i.jsx)(n.li,{children:"Priority-based flow selection"}),"\n",(0,i.jsx)(n.li,{children:"Testing flows with fallback options"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ordering",children:"Ordering"}),"\n",(0,i.jsx)(n.h3,{id:"orderbydefault",children:"orderByDefault()"}),"\n",(0,i.jsx)(n.p,{children:"Apply the default ordering strategy. This is the standard ordering used when no custom ordering is specified."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->orderByDefault();\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Default Ordering (applied in order):"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"version DESC"})," - Higher versions preferred"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"is_default DESC"})," - Default flows preferred"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ordering DESC"})," - Higher ordering value preferred"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"id DESC"})," - Higher ID as tiebreaker"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Sets the ",(0,i.jsx)(n.code,{children:"orderingCallback"})," to default implementation"]}),"\n",(0,i.jsxs)(n.li,{children:["Used automatically if no custom ",(0,i.jsx)(n.code,{children:"orderBy()"})," is set"]}),"\n",(0,i.jsxs)(n.li,{children:["Only applies when ",(0,i.jsx)(n.code,{children:"matchStrategy"})," is ",(0,i.jsx)(n.code,{children:"STRATEGY_BEST"})]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"STRATEGY_FIRST"}),", minimal ordering is used instead"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Use default ordering\n$builder->orderByDefault();\n\n// This is equivalent to:\n$builder->orderBy(function ($query) {\n    $query->orderByDesc('version')\n        ->orderByDesc('is_default')\n        ->orderByDesc('ordering')\n        ->orderByDesc('id');\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Standard flow selection"}),"\n",(0,i.jsx)(n.li,{children:"Most common use case"}),"\n",(0,i.jsx)(n.li,{children:"When no special ordering is needed"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"orderby",children:"orderBy()"}),"\n",(0,i.jsx)(n.p,{children:"Provide a custom ORDER BY callback to override default ordering. This allows complete control over how flows are sorted."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->orderBy(function (Builder $query): void {\n    $query->orderBy('priority', 'desc')\n          ->orderBy('created_at', 'asc');\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure(Builder):void $callback"}),": Ordering callback that receives the query builder"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Replaces default ordering with custom callback"}),"\n",(0,i.jsxs)(n.li,{children:["Callback receives ",(0,i.jsx)(n.code,{children:"Builder $query"})," parameter"]}),"\n",(0,i.jsx)(n.li,{children:"Can apply any ordering logic"}),"\n",(0,i.jsxs)(n.li,{children:["Only used when ",(0,i.jsx)(n.code,{children:"matchStrategy"})," is ",(0,i.jsx)(n.code,{children:"STRATEGY_BEST"})]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"STRATEGY_FIRST"}),", this is ignored"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Custom priority-based ordering\n$builder->orderBy(function ($query) {\n    $query->orderByDesc('priority')\n        ->orderByAsc('created_at');\n});\n\n// Complex ordering with conditions\n$builder->orderBy(function ($query) {\n    $query->orderByRaw('CASE WHEN is_default = 1 THEN 0 ELSE 1 END')\n        ->orderByDesc('version');\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Custom business logic ordering"}),"\n",(0,i.jsx)(n.li,{children:"Priority-based selection"}),"\n",(0,i.jsx)(n.li,{children:"Complex sorting requirements"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"matchstrategy",children:"matchStrategy()"}),"\n",(0,i.jsx)(n.p,{children:"Set the selection strategy for choosing flows when multiple candidates match."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->matchStrategy(FlowPickerBuilder::STRATEGY_BEST);  // Best candidate\n$builder->matchStrategy(FlowPickerBuilder::STRATEGY_FIRST); // First match\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"string $strategy"}),": Strategy constant (",(0,i.jsx)(n.code,{children:"STRATEGY_BEST"})," or ",(0,i.jsx)(n.code,{children:"STRATEGY_FIRST"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default:"})," ",(0,i.jsx)(n.code,{children:"STRATEGY_BEST"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"STRATEGY_BEST:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Returns the best candidate based on ordering rules"}),"\n",(0,i.jsx)(n.li,{children:"Applies full ordering (version, is_default, ordering, id)"}),"\n",(0,i.jsxs)(n.li,{children:["Uses custom ",(0,i.jsx)(n.code,{children:"orderBy()"})," if provided"]}),"\n",(0,i.jsx)(n.li,{children:"Most predictable and recommended"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"STRATEGY_FIRST:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Returns the very first matching record"}),"\n",(0,i.jsxs)(n.li,{children:["Minimal ordering (just ",(0,i.jsx)(n.code,{children:"id ASC"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Ignores custom ",(0,i.jsx)(n.code,{children:"orderBy()"})," callback"]}),"\n",(0,i.jsx)(n.li,{children:"Faster but less predictable"}),"\n",(0,i.jsx)(n.li,{children:"Useful for testing or when order doesn't matter"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Best candidate (default)\n$builder->matchStrategy(FlowPickerBuilder::STRATEGY_BEST);\n\n// First match (faster)\n$builder->matchStrategy(FlowPickerBuilder::STRATEGY_FIRST);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"STRATEGY_BEST"}),": Production use, predictable selection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"STRATEGY_FIRST"}),": Testing, performance-critical scenarios"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"pickfirstmatch",children:"pickFirstMatch()"}),"\n",(0,i.jsx)(n.p,{children:"Convenience method to switch between first match and best match strategies."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->pickFirstMatch(true);  // STRATEGY_FIRST\n$builder->pickFirstMatch(false); // STRATEGY_BEST\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bool $enabled = true"}),": Whether to pick first match"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"true"}),": Sets strategy to ",(0,i.jsx)(n.code,{children:"STRATEGY_FIRST"})]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"false"}),": Sets strategy to ",(0,i.jsx)(n.code,{children:"STRATEGY_BEST"})]}),"\n",(0,i.jsxs)(n.li,{children:["Convenience wrapper around ",(0,i.jsx)(n.code,{children:"matchStrategy()"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Use first match\n$builder->pickFirstMatch(true);\n\n// Use best match\n$builder->pickFirstMatch(false);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"custom-filters",children:"Custom Filters"}),"\n",(0,i.jsx)(n.h3,{id:"where",children:"where()"}),"\n",(0,i.jsx)(n.p,{children:"Attach a custom WHERE callback to extend query constraints. This allows adding any custom filtering logic beyond the standard filters."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->where(function (Builder $query, Model $model): void {\n    $query->where('custom_field', $model->some_attribute);\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Closure(Builder,Model):void $callback"}),": Callback receiving the query builder and model instance"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Callback is called after all standard filters are applied"}),"\n",(0,i.jsxs)(n.li,{children:["Receives both ",(0,i.jsx)(n.code,{children:"Builder $query"})," and ",(0,i.jsx)(n.code,{children:"Model $model"})," parameters"]}),"\n",(0,i.jsx)(n.li,{children:"Can add any WHERE conditions"}),"\n",(0,i.jsx)(n.li,{children:"Multiple callbacks can be chained"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Disables request caching"})," (dynamic callbacks prevent safe caching)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Single custom filter\n$builder->where(function ($query, $model) {\n    $query->where('custom_field', $model->some_attribute);\n});\n\n// Multiple filters\n$builder->where(function ($query, $model) {\n    $query->where('field1', $model->attr1);\n})\n->where(function ($query, $model) {\n    $query->where('field2', $model->attr2);\n});\n\n// Complex conditions\n$builder->where(function ($query, $model) {\n    if ($model->is_premium) {\n        $query->where('is_premium_flow', true);\n    } else {\n        $query->where('is_premium_flow', false);\n    }\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Custom business logic filtering"}),"\n",(0,i.jsx)(n.li,{children:"Complex conditional filters"}),"\n",(0,i.jsx)(n.li,{children:"Model-specific requirements"}),"\n",(0,i.jsx)(n.li,{children:"Dynamic filtering based on model state"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important:"})," Using ",(0,i.jsx)(n.code,{children:"where()"})," disables request caching because callbacks are dynamic and may depend on model state."]}),"\n",(0,i.jsx)(n.h2,{id:"fallback-cascade",children:"Fallback Cascade"}),"\n",(0,i.jsx)(n.h3,{id:"fallbackcascade",children:"fallbackCascade()"}),"\n",(0,i.jsx)(n.p,{children:"Define an ordered list of fallback steps to progressively relax constraints when no flow matches initially. Steps are tried in order until a match is found."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->fallbackCascade([\n    FlowPickerBuilder::FB_DROP_CHANNEL,\n    FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n    FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n]);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"array<int,string> $steps"}),": Ordered array of fallback step constants"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Steps are tried ",(0,i.jsx)(n.strong,{children:"in order"})," until a match is found"]}),"\n",(0,i.jsx)(n.li,{children:"First step that produces candidates wins (selection stops)"}),"\n",(0,i.jsx)(n.li,{children:"Invalid step constants are automatically filtered out"}),"\n",(0,i.jsxs)(n.li,{children:["Only recognized ",(0,i.jsx)(n.code,{children:"FB_*"})," constants are kept"]}),"\n",(0,i.jsx)(n.li,{children:"Empty array means no fallback (returns null if no match)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Available Fallback Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"FB_DROP_CHANNEL"})}),": Remove the channel filter"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Allows flows from any channel"}),"\n",(0,i.jsx)(n.li,{children:"Useful when channel-specific flows aren't available"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"FB_DROP_ENVIRONMENT"})}),": Remove the environment filter"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Allows flows from any environment"}),"\n",(0,i.jsx)(n.li,{children:"Useful when environment-specific flows aren't available"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"FB_IGNORE_TIMEWINDOW"})}),": Ignore ",(0,i.jsx)(n.code,{children:"active_from"}),"/",(0,i.jsx)(n.code,{children:"active_to"})," checks"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Keeps ",(0,i.jsx)(n.code,{children:"status=true"})," requirement"]}),"\n",(0,i.jsx)(n.li,{children:"Useful when flows are outside active window"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"FB_DISABLE_ROLLOUT"})}),": Disable rollout gating entirely"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Ignores ",(0,i.jsx)(n.code,{children:"rollout_pct"})," column"]}),"\n",(0,i.jsx)(n.li,{children:"Useful when rollout prevents matching"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"FB_DROP_REQUIRE_DEFAULT"})}),": Don't require ",(0,i.jsx)(n.code,{children:"is_default=true"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Allows non-default flows"}),"\n",(0,i.jsx)(n.li,{children:"Useful when only default flows are required initially"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Progressive fallback\n$builder->fallbackCascade([\n    FlowPickerBuilder::FB_DROP_CHANNEL,        // Try without channel\n    FlowPickerBuilder::FB_DROP_ENVIRONMENT,    // Try without environment\n    FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,   // Try ignoring time window\n]);\n\n// Invalid steps are ignored\n$builder->fallbackCascade([\n    'invalid_step',                              // Ignored\n    FlowPickerBuilder::FB_DROP_CHANNEL,         // Used\n]);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Graceful degradation when exact match not found"}),"\n",(0,i.jsx)(n.li,{children:"Flexible flow selection"}),"\n",(0,i.jsx)(n.li,{children:"Fallback to less specific flows"}),"\n",(0,i.jsx)(n.li,{children:"Ensuring a flow is always found when possible"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"force-flow-id",children:"Force Flow ID"}),"\n",(0,i.jsx)(n.h3,{id:"forceflowidresolver",children:"forceFlowIdResolver()"}),"\n",(0,i.jsx)(n.p,{children:"Provide a resolver that can force a specific Flow ID from the model. When set, this bypasses all complex selection logic and directly resolves the Flow by ID."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->forceFlowIdResolver(function (Model $model): ?int {\n    return $model->flowId(); // Direct Flow ID\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"callable(Model):(?int) $resolver"}),": Callback returning a Flow ID or null"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Bypasses all selection logic"})," (subject, environment, channel, rollout, etc.)"]}),"\n",(0,i.jsx)(n.li,{children:"Directly loads Flow by ID from database"}),"\n",(0,i.jsxs)(n.li,{children:["Still validates active constraints if ",(0,i.jsx)(n.code,{children:"onlyActive(true)"})," is set"]}),"\n",(0,i.jsxs)(n.li,{children:["When resolver returns ",(0,i.jsx)(n.code,{children:"null"}),", normal selection logic is used"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Disables request caching"})," (dynamic resolver prevents safe caching)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Used by:"})," ",(0,i.jsx)(n.code,{children:"HasFlow"})," trait for direct ID binding"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Direct Flow ID from model\n$builder->forceFlowIdResolver(function ($model) {\n    return $model->flow_id;\n});\n\n// From method\n$builder->forceFlowIdResolver(function ($model) {\n    return $model->resolveFlowId();\n});\n\n// From config\n$builder->forceFlowIdResolver(function ($model) {\n    return config('flows.order_flow_id');\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Direct Flow ID binding (HasFlow trait)"}),"\n",(0,i.jsx)(n.li,{children:"Simplified flow selection"}),"\n",(0,i.jsx)(n.li,{children:"Explicit flow assignment"}),"\n",(0,i.jsx)(n.li,{children:"Bypassing complex selection logic"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important:"})," When ",(0,i.jsx)(n.code,{children:"forceFlowIdResolver"})," is set, all other selection criteria are ignored. Only active constraints (if enabled) are still validated."]}),"\n",(0,i.jsx)(n.h2,{id:"default-requirement",children:"Default Requirement"}),"\n",(0,i.jsx)(n.h3,{id:"requiredefault",children:"requireDefault()"}),"\n",(0,i.jsxs)(n.p,{children:["Require flows with ",(0,i.jsx)(n.code,{children:"is_default=true"}),". When enabled, only flows marked as default are eligible for selection."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->requireDefault(true);  // Only default flows\n$builder->requireDefault(false); // Any flow\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bool $required = true"}),": Whether to require is_default=true"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default:"})," ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"true"}),": Filters flows where ",(0,i.jsx)(n.code,{children:"is_default = true"})]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"false"}),": No default requirement (any flow eligible)"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for enforcing a single default flow per scope"}),"\n",(0,i.jsxs)(n.li,{children:["Can be relaxed in fallback cascade with ",(0,i.jsx)(n.code,{children:"FB_DROP_REQUIRE_DEFAULT"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Only default flows\n$builder->requireDefault(true);\n\n// Any flow (default or not)\n$builder->requireDefault(false);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Enforcing single default flow"}),"\n",(0,i.jsx)(n.li,{children:"Default flow selection"}),"\n",(0,i.jsx)(n.li,{children:"Fallback to default when specific flows unavailable"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"candidates-configuration",children:"Candidates Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"returncandidates",children:"returnCandidates()"}),"\n",(0,i.jsxs)(n.p,{children:["Hint that the consumer intends to fetch candidates (for diagnostics or insight). This is a hint only; ",(0,i.jsx)(n.code,{children:"pick()"})," still returns a single Flow."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->returnCandidates(true);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bool $on = true"}),": Whether to enable the hint"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Hint only"})," - doesn't change ",(0,i.jsx)(n.code,{children:"pick()"})," behavior"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pick()"})," still returns single Flow (first match)"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"FlowPicker::candidates()"})," to get full list"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for debugging and diagnostics"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Hint for candidate fetching\n$builder->returnCandidates(true);\n\n// Get candidates\n$candidates = $picker->candidates($model, $builder);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Debugging flow selection"}),"\n",(0,i.jsx)(n.li,{children:"Displaying available flows"}),"\n",(0,i.jsx)(n.li,{children:"Diagnostics and insight"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"candidateslimit",children:"candidatesLimit()"}),"\n",(0,i.jsxs)(n.p,{children:["Limit the number of candidates returned by ",(0,i.jsx)(n.code,{children:"FlowPicker::candidates()"}),". This helps with performance when fetching candidate lists."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->candidatesLimit(10); // Max 10 candidates\n$builder->candidatesLimit(null); // No limit\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"?int $limit"}),": Positive integer for limit or null for no limit"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Applies ",(0,i.jsx)(n.code,{children:"LIMIT"})," clause to candidate query"]}),"\n",(0,i.jsxs)(n.li,{children:["Only affects ",(0,i.jsx)(n.code,{children:"FlowPicker::candidates()"}),", not ",(0,i.jsx)(n.code,{children:"pick()"})]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"null"}),", no limit is applied"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"0"})," or negative, limit is ignored"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Limit to 10 candidates\n$builder->candidatesLimit(10);\n\n// No limit\n$builder->candidatesLimit(null);\n\n// Get top 5 candidates\n$builder->candidatesLimit(5);\n$candidates = $picker->candidates($model, $builder);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Performance optimization"}),"\n",(0,i.jsx)(n.li,{children:"Limiting candidate lists"}),"\n",(0,i.jsx)(n.li,{children:"Top N flow selection"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,i.jsx)(n.h3,{id:"cacheinrequest",children:"cacheInRequest()"}),"\n",(0,i.jsx)(n.p,{children:"Enable simple per-request memoization when no dynamic callbacks are present. This caches flow selection results within a single request for better performance."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->cacheInRequest(true);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bool $on = true"}),": Whether to enable memoization"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"$this"})," (fluent interface)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default:"})," ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Caches flow selection results per request"}),"\n",(0,i.jsx)(n.li,{children:"Cache key is computed from builder configuration and model"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automatically disabled"})," if unsafe conditions detected:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Custom WHERE callbacks exist"}),"\n",(0,i.jsx)(n.li,{children:"Custom ordering callback exists"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"forceFlowIdResolver"})," is set"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Cache is cleared at end of request"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When Safe to Enable:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 No custom WHERE callbacks"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 No custom ordering callback"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 No forceFlowIdResolver"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Static configuration only"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When NOT Safe (automatically disabled):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u274c Custom WHERE callbacks (dynamic)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Custom ordering callback (dynamic)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c forceFlowIdResolver (dynamic)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Request-dependent logic"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Safe: Static configuration\n$builder->subjectType(Order::class)\n    ->environment('production')\n    ->cacheInRequest(true); // \u2705 Safe\n\n// Unsafe: Dynamic callback\n$builder->where(function ($query, $model) {\n    $query->where('field', $model->attr);\n})\n->cacheInRequest(true); // \u274c Automatically disabled\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Performance optimization"}),"\n",(0,i.jsx)(n.li,{children:"Repeated flow selection in same request"}),"\n",(0,i.jsx)(n.li,{children:"Reducing database queries"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-basic-configuration",children:"Example 1: Basic Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Support\\FlowPickerBuilder;\n\n$builder = new FlowPickerBuilder();\n$builder->subjectType(Order::class)\n    ->subjectScope((string)$order->tenant_id)\n    ->environment(config('app.env'))\n    ->channel('web')\n    ->onlyActive(true)\n    ->orderByDefault();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-2-with-rollout",children:"Example 2: With Rollout"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->environment('production')\n    ->evaluateRollout(true)\n    ->rolloutNamespace('order_v2')\n    ->rolloutSalt('2024')\n    ->rolloutKeyResolver(function ($model) {\n        return (string)$model->user_id;\n    });\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-3-with-fallback",children:"Example 3: With Fallback"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->environment('production')\n    ->channel('web')\n    ->fallbackCascade([\n        FlowPickerBuilder::FB_DROP_CHANNEL,\n        FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n    ]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-4-version-constraints",children:"Example 4: Version Constraints"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->versionAtLeast(1)\n    ->versionAtMost(3); // Versions 1-3\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-5-includeexclude",children:"Example 5: Include/Exclude"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->includeFlows([1, 2, 3])\n    ->excludeFlows([4, 5])\n    ->preferFlows([1, 2]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-6-custom-ordering",children:"Example 6: Custom Ordering"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->orderBy(function ($query) {\n        $query->orderBy('priority', 'desc')\n              ->orderBy('created_at', 'asc');\n    });\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-7-custom-filters",children:"Example 7: Custom Filters"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->where(function ($query, $model) {\n        if ($model->is_premium) {\n            $query->where('is_premium_flow', true);\n        }\n    });\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-8-complex-configuration",children:"Example 8: Complex Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->subjectScope((string)$order->tenant_id)\n    ->subjectCollection($order->collection)\n    ->environment(config('app.env'))\n    ->channel(request()->header('X-Channel', 'web'))\n    ->preferEnvironments(['production', 'staging'])\n    ->preferChannels(['web', 'api'])\n    ->onlyActive(true)\n    ->ignoreTimeWindow(false)\n    ->timeNow(Carbon::now('UTC'))\n    ->evaluateRollout(true)\n    ->rolloutNamespace('order')\n    ->rolloutKeyResolver(function ($model) {\n        return (string)$model->user_id;\n    })\n    ->versionAtLeast(1)\n    ->versionAtMost(3)\n    ->includeFlows([1, 2, 3])\n    ->excludeFlows([4, 5])\n    ->preferFlows([1, 2])\n    ->orderByDefault()\n    ->matchStrategy(FlowPickerBuilder::STRATEGY_BEST)\n    ->requireDefault(false)\n    ->fallbackCascade([\n        FlowPickerBuilder::FB_DROP_CHANNEL,\n        FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n        FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n    ])\n    ->cacheInRequest(true);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"getter-methods",children:"Getter Methods"}),"\n",(0,i.jsx)(n.p,{children:"All configuration values can be retrieved:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$builder->getSubjectType();\n$builder->getSubjectScope();\n$builder->getSubjectCollection();\n$builder->getEnvironment();\n$builder->getChannel();\n$builder->getPreferEnvironments();\n$builder->getPreferChannels();\n$builder->isOnlyActive();\n$builder->shouldIgnoreTimeWindow();\n$builder->getNowUtc();\n$builder->shouldEvaluateRollout();\n$builder->getRolloutNamespace();\n$builder->getRolloutSalt();\n$builder->getRolloutKeyResolver();\n$builder->getVersionEquals();\n$builder->getVersionMin();\n$builder->getVersionMax();\n$builder->getIncludeFlowIds();\n$builder->getExcludeFlowIds();\n$builder->getPreferFlowIds();\n$builder->getMatchStrategy();\n$builder->isRequireDefault();\n$builder->getFallbackCascade();\n$builder->getForceFlowIdResolver();\n$builder->shouldReturnCandidates();\n$builder->getCandidatesLimit();\n$builder->shouldCacheInRequest();\n$builder->getWhereCallbacks();\n$builder->getOrderingCallback();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"integration-with-hasworkflow",children:"Integration with HasWorkflow"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"HasWorkflow"})," trait uses ",(0,i.jsx)(n.code,{children:"FlowPickerBuilder"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    $builder->subjectType(static::class)\n        ->subjectCollection($this->flowSubjectCollection())\n        ->onlyActive(true)\n        ->timeNow(Carbon::now('UTC'))\n        ->orderByDefault()\n        ->evaluateRollout(true)\n        ->rolloutKeyResolver(function (Model $model): ?string {\n            return $model->getKey() ? (string)$model->getKey() : null;\n        });\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"real-world-system-implementation-examples",children:"Real-World System Implementation Examples"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-complete-e-commerce-order-management-system",children:"Example 1: Complete E-Commerce Order Management System"}),"\n",(0,i.jsx)(n.p,{children:"A comprehensive order management system with multiple workflows based on order type, customer tier, and environment."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Model:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasWorkflow;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\n\nclass Order extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = [\n        'user_id',\n        'tenant_id',\n        'order_type',      // 'premium', 'standard', 'express'\n        'customer_tier',   // 'vip', 'regular', 'new'\n        'total',\n        'status',\n    ];\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        parent::buildFlowPicker($builder);\n\n        // Multi-tenant support\n        $builder->subjectScope((string)$this->tenant_id);\n\n        // Collection-based workflows (order type)\n        $builder->subjectCollection($this->order_type);\n\n        // Environment-specific workflows\n        $builder->environment(config('app.env'));\n\n        // Channel-based workflows\n        $channel = request()->header('X-Channel', 'web');\n        $builder->channel($channel);\n\n        // Prefer production, then staging\n        $builder->preferEnvironments(['production', 'staging', 'development']);\n\n        // Prefer web, then API\n        $builder->preferChannels(['web', 'api', 'mobile']);\n\n        // Rollout for new workflow (A/B testing)\n        $builder->evaluateRollout(true)\n            ->rolloutNamespace('order_processing_v2')\n            ->rolloutSalt('2024-01')\n            ->rolloutKeyResolver(function ($model) {\n                return (string)$model->user_id;\n            });\n\n        // Version constraints (only versions 1-3)\n        $builder->versionAtLeast(1)\n            ->versionAtMost(3);\n\n        // Fallback cascade for graceful degradation\n        $builder->fallbackCascade([\n            FlowPickerBuilder::FB_DROP_CHANNEL,\n            FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n            FlowPickerBuilder::FB_DISABLE_ROLLOUT,\n        ]);\n\n        // Custom filter for customer tier\n        $builder->where(function ($query, $model) {\n            $customerTier = $model->customer_tier;\n            \n            if ($customerTier === 'vip') {\n                $query->where('is_vip_flow', true);\n            } elseif ($customerTier === 'new') {\n                $query->where('is_new_customer_flow', true);\n            }\n        });\n\n        // Request caching for performance\n        $builder->cacheInRequest(true);\n    }\n\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('order_type');\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flow Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n\n// Premium order flow - Production\nFlow::store([\n    'subject_type' => Order::class,\n    'subject_scope' => '1', // Tenant 1\n    'subject_collection' => 'premium',\n    'environment' => 'production',\n    'channel' => 'web',\n    'version' => 2,\n    'rollout_pct' => 50, // 50% rollout\n    'is_default' => true,\n    'status' => true,\n]);\n\n// Standard order flow - Production\nFlow::store([\n    'subject_type' => Order::class,\n    'subject_scope' => '1',\n    'subject_collection' => 'standard',\n    'environment' => 'production',\n    'channel' => 'web',\n    'version' => 2,\n    'is_default' => true,\n    'status' => true,\n]);\n\n// Express order flow - Production\nFlow::store([\n    'subject_type' => Order::class,\n    'subject_scope' => '1',\n    'subject_collection' => 'express',\n    'environment' => 'production',\n    'channel' => 'web',\n    'version' => 2,\n    'is_default' => true,\n    'status' => true,\n]);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Create order - flow automatically selected\n$order = Order::create([\n    'user_id' => 123,\n    'tenant_id' => 1,\n    'order_type' => 'premium',\n    'customer_tier' => 'vip',\n    'total' => 1000.00,\n]);\n\n// Flow is automatically bound based on:\n// - Tenant ID (subject_scope)\n// - Order type (subject_collection)\n// - Environment (production)\n// - Channel (web)\n// - Customer tier (custom filter)\n// - Rollout percentage (user_id bucket)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-2-multi-tenant-saas-document-management-system",children:"Example 2: Multi-Tenant SaaS Document Management System"}),"\n",(0,i.jsx)(n.p,{children:"A document management system where each tenant has different approval workflows, with environment-specific and time-based activation."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Model:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasWorkflow;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\nuse Illuminate\\Support\\Carbon;\n\nclass Document extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = [\n        'tenant_id',\n        'document_type',  // 'contract', 'invoice', 'report'\n        'department',     // 'legal', 'finance', 'hr'\n        'priority',        // 'high', 'normal', 'low'\n        'status',\n    ];\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        parent::buildFlowPicker($builder);\n\n        // Tenant isolation\n        $builder->subjectScope((string)$this->tenant_id);\n\n        // Document type as collection\n        $builder->subjectCollection($this->document_type);\n\n        // Environment-specific\n        $builder->environment(config('app.env'));\n\n        // Active window enforcement\n        $builder->onlyActive(true)\n            ->ignoreTimeWindow(false)\n            ->timeNow(Carbon::now('UTC'));\n\n        // Prefer production, allow staging fallback\n        $builder->preferEnvironments(['production', 'staging']);\n\n        // Version management (only current versions)\n        $builder->versionAtLeast(1);\n\n        // Exclude deprecated flows\n        $builder->excludeFlows([10, 11, 12]); // Old flow IDs\n\n        // Custom filter for department\n        $builder->where(function ($query, $model) {\n            $department = $model->department;\n            \n            // Department-specific flows\n            if ($department === 'legal') {\n                $query->where('is_legal_flow', true);\n            } elseif ($department === 'finance') {\n                $query->where('is_finance_flow', true);\n            }\n        });\n\n        // Fallback: drop environment, then ignore time window\n        $builder->fallbackCascade([\n            FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n        ]);\n    }\n\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('document_type');\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flow Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Contract approval flow - Tenant 1, Production, Active Jan 2024\nFlow::store([\n    'subject_type' => Document::class,\n    'subject_scope' => '1',\n    'subject_collection' => 'contract',\n    'environment' => 'production',\n    'version' => 1,\n    'status' => true,\n    'active_from' => '2024-01-01 00:00:00',\n    'active_to' => '2024-12-31 23:59:59',\n    'is_default' => true,\n]);\n\n// Invoice approval flow - Tenant 1, Production\nFlow::store([\n    'subject_type' => Document::class,\n    'subject_scope' => '1',\n    'subject_collection' => 'invoice',\n    'environment' => 'production',\n    'version' => 1,\n    'status' => true,\n    'is_default' => true,\n]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-3-content-management-system-with-ab-testing",children:"Example 3: Content Management System with A/B Testing"}),"\n",(0,i.jsx)(n.p,{children:"A CMS with gradual rollout of new content approval workflows, supporting multiple content types and channels."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Model:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasWorkflow;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\n\nclass Article extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = [\n        'author_id',\n        'content_type',  // 'news', 'blog', 'press-release'\n        'category',      // 'tech', 'business', 'lifestyle'\n        'status',\n    ];\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        parent::buildFlowPicker($builder);\n\n        // Content type as collection\n        $builder->subjectCollection($this->content_type);\n\n        // Environment\n        $builder->environment(config('app.env'));\n\n        // Channel (web vs admin)\n        $channel = request()->is('admin/*') ? 'admin' : 'web';\n        $builder->channel($channel);\n\n        // A/B Testing: Rollout new workflow to 30% of authors\n        $builder->evaluateRollout(true)\n            ->rolloutNamespace('content_approval_v2')\n            ->rolloutSalt('2024-Q1')\n            ->rolloutKeyResolver(function ($model) {\n                // Consistent assignment by author\n                return (string)$model->author_id;\n            });\n\n        // Prefer new version, but allow old version\n        $builder->preferFlows([5, 6]); // New flow IDs\n        $builder->versionAtLeast(1);\n\n        // Fallback: disable rollout if new workflow not available\n        $builder->fallbackCascade([\n            FlowPickerBuilder::FB_DISABLE_ROLLOUT,\n            FlowPickerBuilder::FB_DROP_CHANNEL,\n        ]);\n\n        // Custom filter for category\n        $builder->where(function ($query, $model) {\n            $category = $model->category;\n            \n            // Category-specific workflows\n            if (in_array($category, ['tech', 'business'])) {\n                $query->where('requires_technical_review', true);\n            }\n        });\n    }\n\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('content_type');\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flow Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// New approval workflow (30% rollout)\nFlow::store([\n    'subject_type' => Article::class,\n    'subject_collection' => 'news',\n    'environment' => 'production',\n    'channel' => 'web',\n    'version' => 2,\n    'rollout_pct' => 30, // 30% of authors\n    'status' => true,\n    'is_default' => false,\n]);\n\n// Old approval workflow (70% of authors, or 100% if rollout disabled)\nFlow::store([\n    'subject_type' => Article::class,\n    'subject_collection' => 'news',\n    'environment' => 'production',\n    'channel' => 'web',\n    'version' => 1,\n    'rollout_pct' => null, // No rollout gate\n    'status' => true,\n    'is_default' => true,\n]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-4-financial-transaction-processing-system",children:"Example 4: Financial Transaction Processing System"}),"\n",(0,i.jsx)(n.p,{children:"A financial system with strict version control, environment isolation, and scheduled workflow activation."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Model:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasWorkflow;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\nuse Illuminate\\Support\\Carbon;\n\nclass Transaction extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = [\n        'account_id',\n        'transaction_type', // 'payment', 'refund', 'transfer'\n        'amount',\n        'currency',\n        'status',\n    ];\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        parent::buildFlowPicker($builder);\n\n        // Transaction type as collection\n        $builder->subjectCollection($this->transaction_type);\n\n        // Strict environment isolation (no fallback)\n        $builder->environment(config('app.env'));\n\n        // Active window enforcement (scheduled workflows)\n        $builder->onlyActive(true)\n            ->ignoreTimeWindow(false)\n            ->timeNow(Carbon::now('UTC'));\n\n        // Version pinning (exact version required)\n        $currentVersion = config('flows.transaction_version', 2);\n        $builder->versionEquals($currentVersion);\n\n        // Require default flows only\n        $builder->requireDefault(true);\n\n        // No rollout (all transactions use same workflow)\n        $builder->evaluateRollout(false);\n\n        // Custom filter for currency\n        $builder->where(function ($query, $model) {\n            $currency = $model->currency;\n            \n            // Currency-specific workflows\n            if ($currency === 'USD') {\n                $query->where('supports_usd', true);\n            } elseif ($currency === 'EUR') {\n                $query->where('supports_eur', true);\n            }\n        });\n\n        // No fallback (strict matching required)\n        $builder->fallbackCascade([]);\n    }\n\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('transaction_type');\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flow Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Payment processing flow - Version 2, Production, Active Q1 2024\nFlow::store([\n    'subject_type' => Transaction::class,\n    'subject_collection' => 'payment',\n    'environment' => 'production',\n    'version' => 2,\n    'status' => true,\n    'active_from' => '2024-01-01 00:00:00',\n    'active_to' => '2024-03-31 23:59:59',\n    'is_default' => true,\n    'supports_usd' => true,\n    'supports_eur' => true,\n]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-5-support-ticket-system-with-priority-based-workflows",children:"Example 5: Support Ticket System with Priority-Based Workflows"}),"\n",(0,i.jsx)(n.p,{children:"A support ticket system with different workflows based on ticket priority, customer tier, and channel."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Model:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasWorkflow;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\n\nclass Ticket extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = [\n        'customer_id',\n        'priority',        // 'critical', 'high', 'normal', 'low'\n        'category',        // 'technical', 'billing', 'general'\n        'channel',         // 'email', 'chat', 'phone'\n        'customer_tier',   // 'enterprise', 'business', 'standard'\n        'status',\n    ];\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        parent::buildFlowPicker($builder);\n\n        // Priority as collection\n        $builder->subjectCollection($this->priority);\n\n        // Channel-based workflows\n        $builder->channel($this->channel);\n\n        // Environment\n        $builder->environment(config('app.env'));\n\n        // Prefer critical priority flows\n        $builder->preferFlows([1, 2, 3]); // Critical flow IDs\n\n        // Version constraints\n        $builder->versionAtLeast(1)\n            ->versionAtMost(2);\n\n        // Custom filters\n        $builder->where(function ($query, $model) {\n            // Category-specific\n            if ($model->category === 'technical') {\n                $query->where('requires_technical_team', true);\n            }\n\n            // Customer tier\n            if ($model->customer_tier === 'enterprise') {\n                $query->where('is_enterprise_flow', true);\n            }\n        });\n\n        // Fallback: drop channel, then environment\n        $builder->fallbackCascade([\n            FlowPickerBuilder::FB_DROP_CHANNEL,\n            FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n        ]);\n    }\n\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('priority');\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flow Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Critical priority - Email channel\nFlow::store([\n    'subject_type' => Ticket::class,\n    'subject_collection' => 'critical',\n    'channel' => 'email',\n    'environment' => 'production',\n    'version' => 1,\n    'requires_technical_team' => true,\n    'status' => true,\n    'is_default' => true,\n]);\n\n// High priority - Chat channel\nFlow::store([\n    'subject_type' => Ticket::class,\n    'subject_collection' => 'high',\n    'channel' => 'chat',\n    'environment' => 'production',\n    'version' => 1,\n    'status' => true,\n    'is_default' => true,\n]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-6-invoice-processing-with-time-based-activation",children:"Example 6: Invoice Processing with Time-Based Activation"}),"\n",(0,i.jsx)(n.p,{children:"An invoice processing system with workflows that activate/deactivate at specific times, supporting multiple currencies and regions."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Model:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasWorkflow;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\nuse Illuminate\\Support\\Carbon;\n\nclass Invoice extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = [\n        'tenant_id',\n        'region',          // 'us', 'eu', 'asia'\n        'currency',\n        'invoice_type',    // 'recurring', 'one-time'\n        'status',\n    ];\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        parent::buildFlowPicker($builder);\n\n        // Tenant isolation\n        $builder->subjectScope((string)$this->tenant_id);\n\n        // Invoice type as collection\n        $builder->subjectCollection($this->invoice_type);\n\n        // Environment\n        $builder->environment(config('app.env'));\n\n        // Strict time window enforcement\n        $builder->onlyActive(true)\n            ->ignoreTimeWindow(false)\n            ->timeNow(Carbon::now('UTC'));\n\n        // Prefer current region\n        $builder->preferEnvironments(['production', 'staging']);\n\n        // Version management\n        $builder->versionAtLeast(1);\n\n        // Custom filters\n        $builder->where(function ($query, $model) {\n            // Region-specific\n            $query->where('supported_regions', 'LIKE', \"%{$model->region}%\");\n\n            // Currency support\n            if ($model->currency === 'USD') {\n                $query->where('supports_usd', true);\n            }\n        });\n\n        // Fallback: ignore time window if outside active period\n        $builder->fallbackCascade([\n            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n            FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n        ]);\n    }\n\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('invoice_type');\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Flow Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Recurring invoice flow - Active during business quarter\nFlow::store([\n    'subject_type' => Invoice::class,\n    'subject_scope' => '1',\n    'subject_collection' => 'recurring',\n    'environment' => 'production',\n    'version' => 1,\n    'status' => true,\n    'active_from' => '2024-01-01 00:00:00',\n    'active_to' => '2024-03-31 23:59:59',\n    'supported_regions' => 'us,eu,asia',\n    'supports_usd' => true,\n    'is_default' => true,\n]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-7-complete-implementation-with-all-features",children:"Example 7: Complete Implementation with All Features"}),"\n",(0,i.jsx)(n.p,{children:"A comprehensive example using all FlowPickerBuilder features for a complex enterprise system."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Model:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Flow\\HasWorkflow;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\nuse Illuminate\\Support\\Carbon;\n\nclass EnterpriseOrder extends Model\n{\n    use HasWorkflow;\n\n    protected $fillable = [\n        'organization_id',\n        'department_id',\n        'order_category',   // 'procurement', 'it', 'hr'\n        'order_type',       // 'urgent', 'standard', 'planned'\n        'budget_tier',      // 'high', 'medium', 'low'\n        'region',\n        'status',\n    ];\n\n    protected function buildFlowPicker(FlowPickerBuilder $builder): void\n    {\n        parent::buildFlowPicker($builder);\n\n        // Organization scope (multi-tenant)\n        $builder->subjectScope((string)$this->organization_id);\n\n        // Order category as collection\n        $builder->subjectCollection($this->order_category);\n\n        // Environment with preference\n        $builder->environment(config('app.env'))\n            ->preferEnvironments(['production', 'staging', 'development']);\n\n        // Channel\n        $channel = $this->determineChannel();\n        $builder->channel($channel)\n            ->preferChannels(['web', 'api', 'mobile']);\n\n        // Active constraints with time window\n        $builder->onlyActive(true)\n            ->ignoreTimeWindow(false)\n            ->timeNow(Carbon::now('UTC'));\n\n        // Rollout for new workflow (25% of organizations)\n        $builder->evaluateRollout(true)\n            ->rolloutNamespace('enterprise_order_v3')\n            ->rolloutSalt('2024-Q2')\n            ->rolloutKeyResolver(function ($model) {\n                return (string)$model->organization_id;\n            });\n\n        // Version constraints\n        $builder->versionAtLeast(2)\n            ->versionAtMost(4);\n\n        // Include only approved flows\n        $builder->includeFlows([10, 11, 12, 13]);\n\n        // Exclude deprecated flows\n        $builder->excludeFlows([1, 2, 3]);\n\n        // Prefer newer flows\n        $builder->preferFlows([13, 12, 11, 10]);\n\n        // Require default flows\n        $builder->requireDefault(true);\n\n        // Custom ordering\n        $builder->orderBy(function ($query) {\n            $query->orderByDesc('priority')\n                ->orderByDesc('version')\n                ->orderByDesc('is_default');\n        });\n\n        // Match strategy\n        $builder->matchStrategy(FlowPickerBuilder::STRATEGY_BEST);\n\n        // Custom filters\n        $builder->where(function ($query, $model) {\n            // Department-specific\n            if ($model->department_id === 5) { // IT Department\n                $query->where('requires_it_approval', true);\n            }\n\n            // Budget tier\n            if ($model->budget_tier === 'high') {\n                $query->where('requires_executive_approval', true);\n            }\n\n            // Region\n            $query->where('supported_regions', 'LIKE', \"%{$model->region}%\");\n        });\n\n        // Comprehensive fallback cascade\n        $builder->fallbackCascade([\n            FlowPickerBuilder::FB_DROP_CHANNEL,\n            FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n            FlowPickerBuilder::FB_DISABLE_ROLLOUT,\n            FlowPickerBuilder::FB_DROP_REQUIRE_DEFAULT,\n        ]);\n\n        // Performance optimization\n        $builder->cacheInRequest(true);\n    }\n\n    protected function flowSubjectCollection(): ?string\n    {\n        return $this->getAttribute('order_category');\n    }\n\n    protected function determineChannel(): string\n    {\n        if (request()->is('api/*')) {\n            return 'api';\n        } elseif (request()->is('mobile/*')) {\n            return 'mobile';\n        }\n        return 'web';\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Complete Flow Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n\n// Procurement flow - Production, Version 3, 25% rollout\nFlow::store([\n    'subject_type' => EnterpriseOrder::class,\n    'subject_scope' => '100', // Organization 100\n    'subject_collection' => 'procurement',\n    'environment' => 'production',\n    'channel' => 'web',\n    'version' => 3,\n    'rollout_pct' => 25,\n    'status' => true,\n    'active_from' => '2024-04-01 00:00:00',\n    'active_to' => '2024-06-30 23:59:59',\n    'is_default' => true,\n    'priority' => 10,\n    'requires_it_approval' => false,\n    'requires_executive_approval' => true,\n    'supported_regions' => 'us,eu',\n]);\n\n// IT flow - Production, Version 3\nFlow::store([\n    'subject_type' => EnterpriseOrder::class,\n    'subject_scope' => '100',\n    'subject_collection' => 'it',\n    'environment' => 'production',\n    'channel' => 'web',\n    'version' => 3,\n    'rollout_pct' => 25,\n    'status' => true,\n    'active_from' => '2024-04-01 00:00:00',\n    'active_to' => '2024-06-30 23:59:59',\n    'is_default' => true,\n    'priority' => 10,\n    'requires_it_approval' => true,\n    'requires_executive_approval' => false,\n    'supported_regions' => 'us,eu,asia',\n]);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage in Controller:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Controllers;\n\nuse App\\Models\\EnterpriseOrder;\nuse Illuminate\\Http\\Request;\n\nclass OrderController extends Controller\n{\n    public function store(Request $request)\n    {\n        // Create order - flow automatically selected\n        $order = EnterpriseOrder::create([\n            'organization_id' => $request->organization_id,\n            'department_id' => $request->department_id,\n            'order_category' => $request->category,\n            'order_type' => $request->type,\n            'budget_tier' => $request->budget_tier,\n            'region' => $request->region,\n        ]);\n\n        // Flow is automatically bound with all criteria:\n        // - Organization scope\n        // - Order category\n        // - Environment\n        // - Channel\n        // - Active time window\n        // - Rollout percentage\n        // - Version constraints\n        // - Custom filters (department, budget, region)\n\n        return response()->json([\n            'order' => $order,\n            'flow' => $order->boundFlow(),\n        ]);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-8-testing-and-development-scenarios",children:"Example 8: Testing and Development Scenarios"}),"\n",(0,i.jsx)(n.p,{children:"Examples for testing and development environments."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Test Configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n\n    // Testing: Include specific test flows\n    if (app()->environment('testing')) {\n        $builder->includeFlows([999, 998, 997]) // Test flow IDs\n            ->evaluateRollout(false) // Disable rollout in tests\n            ->onlyActive(false) // Include inactive flows\n            ->ignoreTimeWindow(true); // Ignore time windows\n    } else {\n        // Production configuration\n        $builder->environment(config('app.env'))\n            ->onlyActive(true)\n            ->evaluateRollout(true);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Development Configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function buildFlowPicker(FlowPickerBuilder $builder): void\n{\n    parent::buildFlowPicker($builder);\n\n    // Development: Allow any environment, prefer development\n    $builder->environment(null) // No environment filter\n        ->preferEnvironments(['development', 'staging', 'production'])\n        ->onlyActive(false) // Include inactive for testing\n        ->fallbackCascade([\n            FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n        ]);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/support/flow-picker",children:"FlowPicker"})," - Flow selection mechanism"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-workflow",children:"HasWorkflow"})," - Workflow integration trait"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow",children:"Flow Service"})," - Flow management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-flow",children:"HasFlow"})," - Simple flow binding"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,l){l.d(n,{R:()=>o,x:()=>t});var r=l(6540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);