"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[3300],{28453(e,n,l){l.d(n,{R:()=>t,x:()=>c});var s=l(96540);const r={},i=s.createContext(r);function t(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(i.Provider,{value:n},e.children)}},88455(e,n,l){l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"laravel-url/deep-diving/has-url","title":"HasUrl Trait","description":"The HasUrl trait is the core foundation of Laravel URL package, providing powerful URL and slug management capabilities for your Eloquent models. It enables automatic URL versioning, intelligent conflict detection, cascading URL updates, and comprehensive slug management with collections.","source":"@site/packages/laravel-url/deep-diving/has-url.md","sourceDirName":"laravel-url/deep-diving","slug":"/laravel-url/deep-diving/has-url","permalink":"/packages/laravel-url/deep-diving/has-url","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-url/deep-diving/has-url.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"HasUrl"},"sidebar":"packagesSidebar","previous":{"title":"Showcase","permalink":"/packages/laravel-url/showcase"},"next":{"title":"UrlContract","permalink":"/packages/laravel-url/deep-diving/url-contract"}}');var r=l(74848),i=l(28453),t=l(28774);const c={sidebar_position:1,sidebar_label:"HasUrl"},d="HasUrl Trait",o={},a=[{value:"When to Use HasUrl",id:"when-to-use-hasurl",level:2},{value:"Overview",id:"overview",level:2},{value:"Namespace",id:"namespace",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Assigning Slugs",id:"assigning-slugs",level:2},{value:"Using <code>dispatchSlug()</code>",id:"using-dispatchslug",level:3},{value:"Using Virtual Attributes",id:"using-virtual-attributes",level:3},{value:"Reading Slugs",id:"reading-slugs",level:2},{value:"Accessors",id:"accessors",level:3},{value:"Methods",id:"methods",level:3},{value:"Finding Models by Slug",id:"finding-models-by-slug",level:3},{value:"Collections",id:"collections",level:2},{value:"Collection Resolution",id:"collection-resolution",level:3},{value:"Custom Default Collection",id:"custom-default-collection",level:3},{value:"URL Versioning",id:"url-versioning",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Reading URLs",id:"reading-urls",level:3},{value:"URL Resolution",id:"url-resolution",level:3},{value:"Cascading URL Updates",id:"cascading-url-updates",level:2},{value:"Implementing Cascading",id:"implementing-cascading",level:3},{value:"Disabling Cascade",id:"disabling-cascade",level:3},{value:"Soft Delete and Restore",id:"soft-delete-and-restore",level:2},{value:"Soft Delete",id:"soft-delete",level:3},{value:"Restore",id:"restore",level:3},{value:"Force Delete",id:"force-delete",level:3},{value:"Bulk Operations",id:"bulk-operations",level:2},{value:"Rebuilding URLs",id:"rebuilding-urls",level:3},{value:"Conflict Detection",id:"conflict-detection",level:2},{value:"Slug Conflicts",id:"slug-conflicts",level:3},{value:"URL Conflicts",id:"url-conflicts",level:3},{value:"Removing Slugs",id:"removing-slugs",level:2},{value:"Real-World Examples",id:"real-world-examples",level:2},{value:"Example 1: E-Commerce Product",id:"example-1-e-commerce-product",level:3},{value:"Example 2: Blog Post with Category",id:"example-2-blog-post-with-category",level:3},{value:"Example 3: Handling Conflicts",id:"example-3-handling-conflicts",level:3},{value:"Example 4: Using Collections",id:"example-4-using-collections",level:3},{value:"Example 5: URL History and Redirects",id:"example-5-url-history-and-redirects",level:3},{value:"Example 6: Rebuilding URLs",id:"example-6-rebuilding-urls",level:3},{value:"Method Reference",id:"method-reference",level:2},{value:"Slug Methods",id:"slug-methods",level:3},{value:"URL Methods",id:"url-methods",level:3},{value:"Static Methods",id:"static-methods",level:3},{value:"Cascade Control",id:"cascade-control",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always Implement UrlContract",id:"1-always-implement-urlcontract",level:3},{value:"2. Make getFullUrl() Deterministic",id:"2-make-getfullurl-deterministic",level:3},{value:"3. Handle Conflicts Gracefully",id:"3-handle-conflicts-gracefully",level:3},{value:"4. Use Collections for Organization",id:"4-use-collections-for-organization",level:3},{value:"5. Implement getUrlDescendants() for Hierarchies",id:"5-implement-geturldescendants-for-hierarchies",level:3},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Mistake 1: Not Implementing UrlContract",id:"mistake-1-not-implementing-urlcontract",level:3},{value:"Mistake 2: Non-Deterministic getFullUrl()",id:"mistake-2-non-deterministic-getfullurl",level:3},{value:"Mistake 3: Not Handling Conflicts",id:"mistake-3-not-handling-conflicts",level:3},{value:"Mistake 4: Forgetting Cascade",id:"mistake-4-forgetting-cascade",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"hasurl-trait",children:"HasUrl Trait"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"HasUrl"})," trait is the ",(0,r.jsx)(n.strong,{children:"core foundation"})," of Laravel URL package, providing powerful URL and slug management capabilities for your Eloquent models. It enables automatic URL versioning, intelligent conflict detection, cascading URL updates, and comprehensive slug management with collections."]}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use-hasurl",children:"When to Use HasUrl"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Use ",(0,r.jsx)(n.code,{children:"HasUrl"})," when you need:"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SEO-friendly URLs"}),": Create and manage clean, readable URLs for your models"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automatic URL versioning"}),": Track complete URL history for SEO redirects"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hierarchical URLs"}),": Build URLs that depend on parent models (e.g., category/product)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Conflict detection"}),": Ensure global uniqueness for active URLs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cascading updates"}),": Automatically update child URLs when parent slugs change"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Slug management"}),": Organize slugs with collections and handle soft deletes gracefully"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example scenarios:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["E-commerce products with category-based URLs (",(0,r.jsx)(n.code,{children:"/shop/category/product"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Blog posts with category and tag URLs (",(0,r.jsx)(n.code,{children:"/blog/category/post-slug"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["CMS pages with hierarchical structures (",(0,r.jsx)(n.code,{children:"/about/team/member"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["News articles with section-based URLs (",(0,r.jsx)(n.code,{children:"/news/politics/article"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Documentation pages with nested paths (",(0,r.jsx)(n.code,{children:"/docs/getting-started/installation"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Real estate listings with location-based URLs (",(0,r.jsx)(n.code,{children:"/properties/city/listing"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"HasUrl"})," transforms any Eloquent model into a URL-capable entity, allowing you to:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Manage slugs"})," - One slug per model with optional collection grouping"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Version URLs"})," - Automatic versioning tracks complete URL history"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Detect conflicts"})," - Global uniqueness enforcement for active URLs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cascade updates"})," - Automatically update child URLs when parents change"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Handle soft deletes"})," - Graceful conflict checking on restore"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rebuild URLs"})," - Bulk URL resynchronization for migrations"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"JobMetric\\Url\\HasUrl\n"})}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsxs)(n.p,{children:["Add the trait to your model and implement ",(0,r.jsx)(n.code,{children:"UrlContract"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse JobMetric\\Url\\Contracts\\UrlContract;\nuse JobMetric\\Url\\HasUrl;\n\nclass Product extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function category()\n    {\n        return $this->belongsTo(Category::class);\n    }\n\n    public function getFullUrl(): string\n    {\n        $categorySlug = optional($this->category)->slug ?? 'uncategorized';\n        $productSlug = $this->slug ?? 'product-' . $this->id;\n        return \"/shop/{$categorySlug}/{$productSlug}\";\n    }\n}\n\n// Create and assign slug\n$product = Product::create(['name' => 'MacBook Pro 14']);\n$product->dispatchSlug('macbook-pro-14', 'products');\n\n// Access slug and URL\n$product->slug;                    // \"macbook-pro-14\"\n$product->getActiveFullUrl();     // \"/shop/laptops/macbook-pro-14\"\n"})}),"\n",(0,r.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(n.p,{children:["Your model ",(0,r.jsx)(n.strong,{children:"must"})," implement the ",(0,r.jsx)(n.code,{children:"UrlContract"})," interface:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Url\\Contracts\\UrlContract;\n\nclass Product extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function getFullUrl(): string\n    {\n        return '/shop/' . ($this->slug ?? 'product-' . $this->id);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"assigning-slugs",children:"Assigning Slugs"}),"\n",(0,r.jsxs)(n.h3,{id:"using-dispatchslug",children:["Using ",(0,r.jsx)(n.code,{children:"dispatchSlug()"})]}),"\n",(0,r.jsx)(n.p,{children:"The primary method for assigning or updating slugs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Assign slug with collection\n$product->dispatchSlug('macbook-pro-14', 'products');\n\n// Assign slug without collection (uses default)\n$product->dispatchSlug('macbook-pro-14');\n\n// Update slug\n$product->dispatchSlug('mbp-14', 'products');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Slug is normalized (slugified, trimmed, limited to 100 chars)"}),"\n",(0,r.jsxs)(n.li,{children:["Collection is resolved (explicit \u2192 ",(0,r.jsx)(n.code,{children:"getSlugCollectionDefault()"})," \u2192 ",(0,r.jsx)(n.code,{children:"type"})," attribute \u2192 ",(0,r.jsx)(n.code,{children:"null"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Conflict check ensures no active slug conflict"}),"\n",(0,r.jsx)(n.li,{children:"Slug row is upserted (one slug per model)"}),"\n",(0,r.jsx)(n.li,{children:"Full URL is synchronized and versioned"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"using-virtual-attributes",children:"Using Virtual Attributes"}),"\n",(0,r.jsx)(n.p,{children:"You can also assign slugs via model attributes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$product = Product::create([\n    'name' => 'MacBook Pro 14',\n    'slug' => 'macbook-pro-14',\n    'slug_collection' => 'products',\n]);\n\n// Slug is automatically assigned during save\n"})}),"\n",(0,r.jsx)(n.h2,{id:"reading-slugs",children:"Reading Slugs"}),"\n",(0,r.jsx)(n.h3,{id:"accessors",children:"Accessors"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:'// Slug string (default collection)\n$product->slug;                 // "macbook-pro-14"\n\n// SlugResource (default collection)\n$product->slug_resource;        // SlugResource instance\n\n// Collection name\n$product->slug_collection;      // "products"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Get slug resource (default collection)\n$result = $product->slug();\n// Returns: ['ok' => true, 'data' => SlugResource]\n\n// Get slug by collection\n$result = $product->slugByCollection('products');\n// Returns: ['ok' => true, 'data' => SlugResource]\n\n// Get slug string by collection\n$slug = $product->slugByCollection('products', true);\n// Returns: \"macbook-pro-14\"\n"})}),"\n",(0,r.jsx)(n.h3,{id:"finding-models-by-slug",children:"Finding Models by Slug"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Find by slug (any collection)\n$product = Product::findBySlug('macbook-pro-14');\n\n// Find by slug (or throw)\n$product = Product::findBySlugOrFail('macbook-pro-14');\n\n// Find by slug and collection\n$product = Product::findBySlugAndCollection('macbook-pro-14', 'products');\n\n// Find by slug and collection (or throw)\n$product = Product::findBySlugAndCollectionOrFail('macbook-pro-14', 'products');\n"})}),"\n",(0,r.jsx)(n.h2,{id:"collections",children:"Collections"}),"\n",(0,r.jsx)(n.p,{children:"Collections allow you to organize slugs by context:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Assign to specific collection\n$product->dispatchSlug('mbp-14', 'products');\n\n// Assign to different collection\n$product->dispatchSlug('mbp-14', 'featured-products');\n"})}),"\n",(0,r.jsx)(n.h3,{id:"collection-resolution",children:"Collection Resolution"}),"\n",(0,r.jsx)(n.p,{children:"The collection is resolved in this order:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Explicit collection parameter"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"getSlugCollectionDefault()"})," method"]}),"\n",(0,r.jsxs)(n.li,{children:["Model's ",(0,r.jsx)(n.code,{children:"type"})," attribute"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"null"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"custom-default-collection",children:"Custom Default Collection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class Product extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function getSlugCollectionDefault(): ?string\n    {\n        return 'products';\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"url-versioning",children:"URL Versioning"}),"\n",(0,r.jsx)(n.p,{children:"The trait automatically manages versioned URLs:"}),"\n",(0,r.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"First URL"}),": Creates version ",(0,r.jsx)(n.code,{children:"1"})," when first assigned"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"URL Change"}),": Soft-deletes previous active URL, creates new version"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No Change"}),": Updates collection if changed, no new version"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Conflict Check"}),": Ensures global uniqueness for active URLs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Event Firing"}),": Dispatches ",(0,r.jsx)(n.code,{children:"UrlChanged"})," event on create/change"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"reading-urls",children:"Reading URLs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:'// Current active full URL\n$url = $product->getActiveFullUrl();  // "/shop/laptops/macbook-pro-14"\n\n// Full URL history (active + trashed)\n$history = $product->urlHistory();  // Collection of Url models\n\n// Only active URLs\n$active = $product->urlHistory(withTrashed: false);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"url-resolution",children:"URL Resolution"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Resolve active model by full URL (static)\n$model = Product::resolveActiveByFullUrl('/shop/laptops/macbook-pro-14');\n\n// Resolve redirect target for old URL\n$target = Product::resolveRedirectTarget('/shop/old-path');\n// Returns current active URL or null\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cascading-url-updates",children:"Cascading URL Updates"}),"\n",(0,r.jsx)(n.p,{children:"When a parent model's slug changes, child URLs can automatically update:"}),"\n",(0,r.jsx)(n.h3,{id:"implementing-cascading",children:"Implementing Cascading"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class Category extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function products()\n    {\n        return $this->hasMany(Product::class);\n    }\n\n    public function getFullUrl(): string\n    {\n        return '/shop/' . ($this->slug ?? 'uncategorized');\n    }\n\n    // Return children that need URL refresh\n    public function getUrlDescendants(): iterable\n    {\n        return $this->products;  // Must implement UrlContract\n    }\n}\n\nclass Product extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function category()\n    {\n        return $this->belongsTo(Category::class);\n    }\n\n    public function getFullUrl(): string\n    {\n        $categorySlug = $this->category->slug ?? 'uncategorized';\n        return \"/shop/{$categorySlug}/{$this->slug}\";\n    }\n}\n\n// Change category slug \u2192 all products get new URLs\n$category->dispatchSlug('computers');\n// Product URLs automatically update from /shop/laptops/... to /shop/computers/...\n"})}),"\n",(0,r.jsx)(n.h3,{id:"disabling-cascade",children:"Disabling Cascade"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$category->withoutUrlCascade(function () use ($category) {\n    // Slug change without touching descendants\n    $category->dispatchSlug('new-category-slug');\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"soft-delete-and-restore",children:"Soft Delete and Restore"}),"\n",(0,r.jsx)(n.h3,{id:"soft-delete",children:"Soft Delete"}),"\n",(0,r.jsx)(n.p,{children:"When a model is soft-deleted:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Slug row is soft-deleted"}),"\n",(0,r.jsx)(n.li,{children:"All active URL rows are soft-deleted"}),"\n",(0,r.jsx)(n.li,{children:"No model claims the path anymore"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$product->delete();  // Soft delete\n"})}),"\n",(0,r.jsx)(n.h3,{id:"restore",children:"Restore"}),"\n",(0,r.jsx)(n.p,{children:"When restoring:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Slug conflict is checked (same type & collection)"}),"\n",(0,r.jsx)(n.li,{children:"Slug row is restored"}),"\n",(0,r.jsx)(n.li,{children:"URL is resynced"}),"\n",(0,r.jsxs)(n.li,{children:["Full URL conflict is checked (throws ",(0,r.jsx)(n.code,{children:"UrlConflictException"})," if conflict)"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$product->restore();  // May throw SlugConflictException or UrlConflictException\n"})}),"\n",(0,r.jsx)(n.h3,{id:"force-delete",children:"Force Delete"}),"\n",(0,r.jsx)(n.p,{children:"Permanently removes slug and all URL history:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$product->forceDelete();\n"})}),"\n",(0,r.jsx)(n.h2,{id:"bulk-operations",children:"Bulk Operations"}),"\n",(0,r.jsx)(n.h3,{id:"rebuilding-urls",children:"Rebuilding URLs"}),"\n",(0,r.jsxs)(n.p,{children:["Rebuild URLs for all records (useful after changing ",(0,r.jsx)(n.code,{children:"getFullUrl()"})," logic):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Rebuild all products\nProduct::rebuildAllUrls();\n\n// Rebuild with query filter\nProduct::rebuildAllUrls(function ($query) {\n    $query->where('status', 'published');\n}, chunk: 1000);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," This does not trigger ",(0,r.jsx)(n.code,{children:"saved()"})," hooks or cascades\u2014it directly resyncs URLs."]}),"\n",(0,r.jsx)(n.h2,{id:"conflict-detection",children:"Conflict Detection"}),"\n",(0,r.jsx)(n.h3,{id:"slug-conflicts",children:"Slug Conflicts"}),"\n",(0,r.jsx)(n.p,{children:"The trait checks for slug conflicts before assigning:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Throws SlugConflictException if another Product uses same slug in same collection\n$product->dispatchSlug('existing-slug', 'products');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Conflict Rules:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Same model type"}),"\n",(0,r.jsx)(n.li,{children:"Same slug"}),"\n",(0,r.jsx)(n.li,{children:"Same collection (or both null)"}),"\n",(0,r.jsx)(n.li,{children:"Active (not soft-deleted)"}),"\n",(0,r.jsx)(n.li,{children:"Different model ID"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"url-conflicts",children:"URL Conflicts"}),"\n",(0,r.jsx)(n.p,{children:"The trait checks for full URL conflicts before creating:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Throws UrlConflictException if another active model uses same full URL\n$product->dispatchSlug('conflicting-slug');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Conflict Rules:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Same full URL"}),"\n",(0,r.jsx)(n.li,{children:"Active (not soft-deleted)"}),"\n",(0,r.jsx)(n.li,{children:"Different model (type or ID)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"removing-slugs",children:"Removing Slugs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Remove slug (any collection)\n$product->forgetSlug();\n\n// Remove slug (specific collection)\n$product->forgetSlug('products');\n"})}),"\n",(0,r.jsx)(n.h2,{id:"real-world-examples",children:"Real-World Examples"}),"\n",(0,r.jsx)(n.h3,{id:"example-1-e-commerce-product",children:"Example 1: E-Commerce Product"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class Category extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function products()\n    {\n        return $this->hasMany(Product::class);\n    }\n\n    public function getFullUrl(): string\n    {\n        return '/shop/' . ($this->slug ?? 'uncategorized');\n    }\n\n    public function getUrlDescendants(): iterable\n    {\n        return $this->products;\n    }\n}\n\nclass Product extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function category()\n    {\n        return $this->belongsTo(Category::class);\n    }\n\n    public function getFullUrl(): string\n    {\n        $categorySlug = $this->category->slug ?? 'uncategorized';\n        return \"/shop/{$categorySlug}/{$this->slug}\";\n    }\n}\n\n// Create category\n$category = Category::create(['name' => 'Laptops']);\n$category->dispatchSlug('laptops', 'categories');\n\n// Create product\n$product = Product::create(['name' => 'MacBook Pro 14']);\n$product->dispatchSlug('macbook-pro-14', 'products');\n\n// Product URL: /shop/laptops/macbook-pro-14\n\n// Change category slug\n$category->dispatchSlug('computers', 'categories');\n// Product URLs automatically update to: /shop/computers/macbook-pro-14\n// Old URL redirects with 301\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-2-blog-post-with-category",children:"Example 2: Blog Post with Category"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class Category extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function posts()\n    {\n        return $this->hasMany(Post::class);\n    }\n\n    public function getFullUrl(): string\n    {\n        return '/blog/' . ($this->slug ?? 'uncategorized');\n    }\n\n    public function getUrlDescendants(): iterable\n    {\n        return $this->posts;\n    }\n}\n\nclass Post extends Model implements UrlContract\n{\n    use HasUrl;\n\n    public function category()\n    {\n        return $this->belongsTo(Category::class);\n    }\n\n    public function getFullUrl(): string\n    {\n        $categorySlug = $this->category->slug ?? 'uncategorized';\n        $postSlug = $this->slug ?? 'post-' . $this->id;\n        return \"/blog/{$categorySlug}/{$postSlug}\";\n    }\n}\n\n// Create post\n$post = Post::create(['title' => 'Getting Started with Laravel']);\n$post->dispatchSlug('getting-started-with-laravel', 'posts');\n\n// URL: /blog/laravel/getting-started-with-laravel\n\n// Update slug\n$post->dispatchSlug('laravel-beginners-guide', 'posts');\n// New URL: /blog/laravel/laravel-beginners-guide\n// Old URL redirects with 301\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-3-handling-conflicts",children:"Example 3: Handling Conflicts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"try {\n    $product->dispatchSlug('existing-slug', 'products');\n} catch (\\JobMetric\\Url\\Exceptions\\SlugConflictException $e) {\n    return back()->withErrors(['slug' => 'This slug is already taken.']);\n}\n\ntry {\n    $product->dispatchSlug('conflicting-slug');\n} catch (\\JobMetric\\Url\\Exceptions\\UrlConflictException $e) {\n    return back()->withErrors(['slug' => 'This URL is already in use.']);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-4-using-collections",children:"Example 4: Using Collections"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Products in different collections\n$product->dispatchSlug('mbp-14', 'products');\n$product->dispatchSlug('mbp-14', 'featured-products');\n\n// Find by collection\n$product = Product::findBySlugAndCollection('mbp-14', 'products');\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-5-url-history-and-redirects",children:"Example 5: URL History and Redirects"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Get URL history\n$history = $product->urlHistory();\n\nforeach ($history as $url) {\n    echo $url->full_url . ' (version ' . $url->version . ')' . PHP_EOL;\n}\n\n// Resolve redirect target\n$target = Product::resolveRedirectTarget('/shop/old-path');\nif ($target) {\n    return redirect($target, 301);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-6-rebuilding-urls",children:"Example 6: Rebuilding URLs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// After changing getFullUrl() logic, rebuild all URLs\nProduct::rebuildAllUrls(function ($query) {\n    $query->where('status', 'published');\n}, chunk: 500);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"method-reference",children:"Method Reference"}),"\n",(0,r.jsx)(n.h3,{id:"slug-methods",children:"Slug Methods"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Returns"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"dispatchSlug(?string $slug, ?string $collection = null)"})}),(0,r.jsx)(n.td,{children:"Assign or update slug"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array{ok: bool, data?: SlugResource}"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"forgetSlug(?string $collection = null)"})}),(0,r.jsx)(n.td,{children:"Remove slug"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array{ok: bool}"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"slug()"})}),(0,r.jsx)(n.td,{children:"Get slug resource (default collection)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array{ok: bool, data?: SlugResource}"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"slugByCollection(?string $collection, bool $mode = false)"})}),(0,r.jsx)(n.td,{children:"Get slug by collection"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array|string|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getSlug()"})}),(0,r.jsx)(n.td,{children:"Get slug string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$model->slug"})}),(0,r.jsx)(n.td,{children:"Accessor for slug"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$model->slug_resource"})}),(0,r.jsx)(n.td,{children:"Accessor for SlugResource"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SlugResource|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$model->slug_collection"})}),(0,r.jsx)(n.td,{children:"Accessor for collection"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string|null"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"url-methods",children:"URL Methods"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Returns"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getActiveFullUrl()"})}),(0,r.jsx)(n.td,{children:"Get current active full URL"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"urlHistory(bool $withTrashed = true)"})}),(0,r.jsx)(n.td,{children:"Get URL history"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Collection<Url>"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"static-methods",children:"Static Methods"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Returns"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"findBySlug(string $slug)"})}),(0,r.jsx)(n.td,{children:"Find by slug (any collection)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Model|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"findBySlugOrFail(string $slug)"})}),(0,r.jsx)(n.td,{children:"Find by slug (or throw)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Model"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"findBySlugAndCollection(string $slug, ?string $collection)"})}),(0,r.jsx)(n.td,{children:"Find by slug and collection"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Model|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"findBySlugAndCollectionOrFail(string $slug, ?string $collection)"})}),(0,r.jsx)(n.td,{children:"Find by slug and collection (or throw)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Model"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"rebuildAllUrls(?callable $queryHook, int $chunk = 500)"})}),(0,r.jsx)(n.td,{children:"Rebuild URLs for all records"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"void"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"resolveActiveByFullUrl(string $fullUrl)"})}),(0,r.jsx)(n.td,{children:"Resolve model by full URL"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Model|null"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"resolveRedirectTarget(string $fullUrl)"})}),(0,r.jsx)(n.td,{children:"Resolve redirect target"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string|null"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"cascade-control",children:"Cascade Control"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Returns"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"withoutUrlCascade(callable $fn)"})}),(0,r.jsx)(n.td,{children:"Disable cascade in callback"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mixed"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getUrlDescendants(): iterable"})}),(0,r.jsx)(n.td,{children:"Return children for cascade"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"iterable<Model>"})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-always-implement-urlcontract",children:"1. Always Implement UrlContract"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Good: Implements UrlContract\nclass Product extends Model implements UrlContract\n{\n    use HasUrl;\n    // ...\n}\n\n// Bad: Missing UrlContract\nclass Product extends Model\n{\n    use HasUrl;  // Will throw ModelUrlContractNotFoundException\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-make-getfullurl-deterministic",children:"2. Make getFullUrl() Deterministic"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Good: Deterministic, no side effects\npublic function getFullUrl(): string\n{\n    return '/shop/' . ($this->category->slug ?? 'uncategorized') . '/' . ($this->slug ?? 'product-' . $this->id);\n}\n\n// Bad: Non-deterministic\npublic function getFullUrl(): string\n{\n    return '/shop/' . $this->category->slug . '/' . $this->slug . '?ref=' . time();  // Changes every call\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-handle-conflicts-gracefully",children:"3. Handle Conflicts Gracefully"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Good: Handle conflicts\ntry {\n    $product->dispatchSlug($slug, 'products');\n} catch (SlugConflictException $e) {\n    return back()->withErrors(['slug' => 'This slug is already taken.']);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-use-collections-for-organization",children:"4. Use Collections for Organization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Good: Use collections\n$product->dispatchSlug('mbp-14', 'products');\n$product->dispatchSlug('mbp-14', 'featured-products');\n\n// Bad: No organization\n$product->dispatchSlug('mbp-14');  // Harder to manage\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-implement-geturldescendants-for-hierarchies",children:"5. Implement getUrlDescendants() for Hierarchies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Good: Cascade support\npublic function getUrlDescendants(): iterable\n{\n    return $this->products;\n}\n\n// Bad: No cascade\n// Children URLs won't update when parent changes\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,r.jsx)(n.h3,{id:"mistake-1-not-implementing-urlcontract",children:"Mistake 1: Not Implementing UrlContract"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Bad: Missing interface\nclass Product extends Model\n{\n    use HasUrl;  // Throws exception\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mistake-2-non-deterministic-getfullurl",children:"Mistake 2: Non-Deterministic getFullUrl()"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Bad: Returns different values\npublic function getFullUrl(): string\n{\n    return '/shop/' . $this->slug . '?t=' . time();\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mistake-3-not-handling-conflicts",children:"Mistake 3: Not Handling Conflicts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Bad: No error handling\n$product->dispatchSlug('existing-slug');  // May throw exception\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mistake-4-forgetting-cascade",children:"Mistake 4: Forgetting Cascade"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Bad: Children URLs don't update\nclass Category extends Model implements UrlContract\n{\n    use HasUrl;\n    // Missing getUrlDescendants()\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(t.A,{to:"/packages/laravel-url/deep-diving/url-contract",children:"UrlContract"})," - Interface for URL-capable models"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(t.A,{to:"/packages/laravel-url/deep-diving/models/slug",children:"Slug Model"})," - Slug model reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(t.A,{to:"/packages/laravel-url/deep-diving/models/url",children:"Url Model"})," - URL model reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(t.A,{to:"/packages/laravel-url/deep-diving/events",children:"Events"})," - URL-related events"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(t.A,{to:"/packages/laravel-url/deep-diving/slug-exist-rule",children:"SlugExistRule"})," - Validation rule for slugs"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);