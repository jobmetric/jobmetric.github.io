"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[3830],{28453(e,n,a){a.d(n,{R:()=>t,x:()=>r});var s=a(96540);const l={},i=s.createContext(l);function t(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(i.Provider,{value:n},e.children)}},95051(e,n,a){a.r(n),a.d(n,{assets:()=>u,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"laravel-metadata/deep-diving/metadata-value-exist-rule","title":"MetadataValueExistRule","description":"The MetadataValueExistRule is a validation rule that checks if a metadata value already exists for a specific model class and metadata key combination. This rule ensures uniqueness of metadata values across models, making it ideal for validating unique slugs, codes, identifiers, and other metadata that must be unique.","source":"@site/packages/laravel-metadata/deep-diving/metadata-value-exist-rule.md","sourceDirName":"laravel-metadata/deep-diving","slug":"/laravel-metadata/deep-diving/metadata-value-exist-rule","permalink":"/packages/laravel-metadata/deep-diving/metadata-value-exist-rule","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-metadata/deep-diving/metadata-value-exist-rule.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"sidebar_label":"MetadataValueExistRule"},"sidebar":"packagesSidebar","previous":{"title":"ModelMetaableKeyNotAllowedFieldException","permalink":"/packages/laravel-metadata/deep-diving/exceptions/model-metaable-key-not-allowed-field-exception"},"next":{"title":"Laravel Custom Field","permalink":"/packages/laravel-custom-field/"}}');var l=a(74848),i=a(28453),t=a(28774);const r={sidebar_position:7,sidebar_label:"MetadataValueExistRule"},d="MetadataValueExistRule",u={},c=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"In Form Request",id:"in-form-request",level:3},{value:"In Controller",id:"in-controller",level:3},{value:"Direct Validation",id:"direct-validation",level:3},{value:"Constructor",id:"constructor",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Example",id:"example",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Internal Implementation",id:"internal-implementation",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Unique Product Slug",id:"example-1-unique-product-slug",level:3},{value:"Example 2: Unique User Employee Code",id:"example-2-unique-user-employee-code",level:3},{value:"Example 3: Unique Category Identifier",id:"example-3-unique-category-identifier",level:3},{value:"Example 4: Update with Exclusion",id:"example-4-update-with-exclusion",level:3},{value:"Example 5: Multiple Metadata Keys",id:"example-5-multiple-metadata-keys",level:3},{value:"Example 6: Conditional Validation",id:"example-6-conditional-validation",level:3},{value:"Example 7: Custom Error Messages",id:"example-7-custom-error-messages",level:3},{value:"Example 8: With Other Validation Rules",id:"example-8-with-other-validation-rules",level:3},{value:"Value Type Handling",id:"value-type-handling",level:2},{value:"String Values",id:"string-values",level:3},{value:"Numeric Values",id:"numeric-values",level:3},{value:"Boolean Values",id:"boolean-values",level:3},{value:"JSON Values",id:"json-values",level:3},{value:"Error Messages",id:"error-messages",level:2},{value:"Default Message",id:"default-message",level:3},{value:"Custom Messages",id:"custom-messages",level:3},{value:"When to Use",id:"when-to-use",level:2},{value:"When NOT to Use",id:"when-not-to-use",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Use Class Constants",id:"1-use-class-constants",level:3},{value:"2. Combine with Other Rules",id:"2-combine-with-other-rules",level:3},{value:"3. Provide Clear Error Messages",id:"3-provide-clear-error-messages",level:3},{value:"4. Consider Performance",id:"4-consider-performance",level:3},{value:"5. Handle Updates Properly",id:"5-handle-updates-properly",level:3},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Mistake 1: Not Combining with Type Validation",id:"mistake-1-not-combining-with-type-validation",level:3},{value:"Mistake 2: Using Wrong Model Class",id:"mistake-2-using-wrong-model-class",level:3},{value:"Mistake 3: Case Sensitivity Issues",id:"mistake-3-case-sensitivity-issues",level:3},{value:"Mistake 4: Not Handling JSON Values",id:"mistake-4-not-handling-json-values",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Database Queries",id:"database-queries",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"metadatavalueexistrule",children:"MetadataValueExistRule"})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"MetadataValueExistRule"})," is a validation rule that checks if a metadata value already exists for a specific model class and metadata key combination. This rule ensures uniqueness of metadata values across models, making it ideal for validating unique slugs, codes, identifiers, and other metadata that must be unique."]}),"\n",(0,l.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"JobMetric\\Metadata\\Rules\\MetadataValueExistRule\n"})}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"MetadataValueExistRule"})," validates that a given metadata value does ",(0,l.jsx)(n.strong,{children:"not"})," already exist for a specific model class and key combination. It's particularly useful for:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Unique Identifiers"}),": Ensuring unique slugs, codes, or identifiers stored as metadata"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Business Rules"}),": Enforcing business constraints on metadata values"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Data Integrity"}),": Preventing duplicate metadata values that could cause conflicts"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Form Validation"}),": Validating user input before storing metadata"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"The rule performs a database query to check if a metadata value already exists, filtering by:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Model class (metaable_type)"}),"\n",(0,l.jsx)(n.li,{children:"Metadata key"}),"\n",(0,l.jsx)(n.li,{children:"Metadata value"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,l.jsx)(n.h3,{id:"in-form-request",children:"In Form Request"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests;\n\nuse App\\Models\\Product;\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\nclass StoreProductRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        return [\n            'slug' => [\n                'required',\n                'string',\n                'max:255',\n                new MetadataValueExistRule(Product::class, 'slug'),\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"in-controller",children:"In Controller"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use App\\Models\\Product;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\npublic function store(Request $request)\n{\n    $validated = $request->validate([\n        'code' => [\n            'required',\n            'string',\n            new MetadataValueExistRule(Product::class, 'code'),\n        ],\n    ]);\n\n    // Store product with metadata\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"direct-validation",children:"Direct Validation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use App\\Models\\User;\nuse Illuminate\\Support\\Facades\\Validator;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\n$validator = Validator::make($data, [\n    'employee_id' => [\n        'required',\n        'string',\n        new MetadataValueExistRule(User::class, 'employee_id'),\n    ],\n]);\n\nif ($validator->fails()) {\n    // Handle validation errors\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"public function __construct(string $class_name, string $key)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"string $class_name"})}),": The fully-qualified model class name (e.g., ",(0,l.jsx)(n.code,{children:"Product::class"})," or ",(0,l.jsx)(n.code,{children:"'App\\Models\\Product'"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"string $key"})}),": The metadata key to check (e.g., ",(0,l.jsx)(n.code,{children:"'slug'"}),", ",(0,l.jsx)(n.code,{children:"'code'"}),", ",(0,l.jsx)(n.code,{children:"'identifier'"}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Using class constant\nnew MetadataValueExistRule(Product::class, 'slug')\n\n// Using string\nnew MetadataValueExistRule('App\\Models\\Product', 'slug')\n"})}),"\n",(0,l.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,l.jsx)(n.p,{children:"The rule performs the following steps:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Query Metadata Table"}),": Searches the ",(0,l.jsx)(n.code,{children:"meta"})," table for existing records"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Filter by Model Type"}),": Filters by ",(0,l.jsx)(n.code,{children:"metaable_type"})," matching the provided class name"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Filter by Key"}),": Filters by ",(0,l.jsx)(n.code,{children:"key"})," matching the provided metadata key"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Filter by Value"}),": Filters by ",(0,l.jsx)(n.code,{children:"value"})," matching the input value"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check Existence"}),": Returns ",(0,l.jsx)(n.code,{children:"true"})," if value does NOT exist (validation passes), ",(0,l.jsx)(n.code,{children:"false"})," if it exists (validation fails)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"internal-implementation",children:"Internal Implementation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"public function passes($attribute, $value): bool\n{\n    return !Meta::query()\n        ->whereHasMorph('metaable', $this->class_name, function (Builder $query) use ($value) {\n            $query->where([\n                'key' => $this->key,\n                'value' => $value\n            ]);\n        })\n        ->exists();\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Key Points"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Uses ",(0,l.jsx)(n.code,{children:"whereHasMorph"})," to filter by polymorphic relationship"]}),"\n",(0,l.jsx)(n.li,{children:"Checks for exact value match (case-sensitive for strings)"}),"\n",(0,l.jsxs)(n.li,{children:["Returns negation (",(0,l.jsx)(n.code,{children:"!exists()"}),") because rule passes when value does NOT exist"]}),"\n",(0,l.jsx)(n.li,{children:"Works with all value types (string, integer, boolean, JSON)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,l.jsx)(n.h3,{id:"example-1-unique-product-slug",children:"Example 1: Unique Product Slug"}),"\n",(0,l.jsx)(n.p,{children:"Ensure product slugs are unique across all products:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests;\n\nuse App\\Models\\Product;\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\nclass StoreProductRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        return [\n            'name' => ['required', 'string', 'max:255'],\n            'slug' => [\n                'required',\n                'string',\n                'max:255',\n                'regex:/^[a-z0-9]+(?:-[a-z0-9]+)*$/',\n                new MetadataValueExistRule(Product::class, 'slug'),\n            ],\n            'description' => ['nullable', 'string'],\n        ];\n    }\n\n    public function messages(): array\n    {\n        return [\n            'slug' => 'This slug is already in use. Please choose a different one.',\n        ];\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-2-unique-user-employee-code",children:"Example 2: Unique User Employee Code"}),"\n",(0,l.jsx)(n.p,{children:"Validate unique employee codes for users:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests;\n\nuse App\\Models\\User;\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\nclass StoreUserRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        return [\n            'name' => ['required', 'string', 'max:255'],\n            'email' => ['required', 'email', 'unique:users,email'],\n            'employee_code' => [\n                'required',\n                'string',\n                'size:6',\n                'regex:/^[A-Z0-9]{6}$/',\n                new MetadataValueExistRule(User::class, 'employee_code'),\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-3-unique-category-identifier",children:"Example 3: Unique Category Identifier"}),"\n",(0,l.jsx)(n.p,{children:"Ensure category identifiers are unique:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use App\\Models\\Category;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\n$request->validate([\n    'name' => ['required', 'string'],\n    'identifier' => [\n        'required',\n        'string',\n        'alpha_dash',\n        new MetadataValueExistRule(Category::class, 'identifier'),\n    ],\n]);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-4-update-with-exclusion",children:"Example 4: Update with Exclusion"}),"\n",(0,l.jsx)(n.p,{children:"When updating, exclude the current model from uniqueness check:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests;\n\nuse App\\Models\\Product;\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\nclass UpdateProductRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        $productId = $this->route('product')->id;\n\n        return [\n            'slug' => [\n                'required',\n                'string',\n                new MetadataValueExistRule(Product::class, 'slug'),\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Note"}),": The rule checks all products. To exclude the current product, you may need a custom rule or modify the validation logic."]}),"\n",(0,l.jsx)(n.h3,{id:"example-5-multiple-metadata-keys",children:"Example 5: Multiple Metadata Keys"}),"\n",(0,l.jsx)(n.p,{children:"Validate multiple unique metadata values:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests;\n\nuse App\\Models\\Product;\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\nclass StoreProductRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        return [\n            'slug' => [\n                'required',\n                'string',\n                new MetadataValueExistRule(Product::class, 'slug'),\n            ],\n            'sku' => [\n                'required',\n                'string',\n                new MetadataValueExistRule(Product::class, 'sku'),\n            ],\n            'barcode' => [\n                'nullable',\n                'string',\n                new MetadataValueExistRule(Product::class, 'barcode'),\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-6-conditional-validation",children:"Example 6: Conditional Validation"}),"\n",(0,l.jsx)(n.p,{children:"Apply rule conditionally based on other fields:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests;\n\nuse App\\Models\\Post;\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse Illuminate\\Validation\\Rule;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\nclass StorePostRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        return [\n            'type' => ['required', 'in:article,page'],\n            'slug' => [\n                'required',\n                'string',\n                Rule::when(\n                    $this->type === 'page',\n                    new MetadataValueExistRule(Post::class, 'slug')\n                ),\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-7-custom-error-messages",children:"Example 7: Custom Error Messages"}),"\n",(0,l.jsx)(n.p,{children:"Provide custom error messages:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use App\\Models\\Product;\nuse Illuminate\\Support\\Facades\\Validator;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\n$validator = Validator::make($data, [\n    'slug' => [\n        'required',\n        'string',\n        new MetadataValueExistRule(Product::class, 'slug'),\n    ],\n], [\n    'slug.required' => 'The slug field is required.',\n    'slug' => 'This slug is already taken. Please choose a different one.',\n]);\n\nif ($validator->fails()) {\n    return response()->json([\n        'errors' => $validator->errors(),\n    ], 422);\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-8-with-other-validation-rules",children:"Example 8: With Other Validation Rules"}),"\n",(0,l.jsx)(n.p,{children:"Combine with other Laravel validation rules:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Http\\Requests;\n\nuse App\\Models\\Product;\nuse Illuminate\\Foundation\\Http\\FormRequest;\nuse Illuminate\\Validation\\Rule;\nuse JobMetric\\Metadata\\Rules\\MetadataValueExistRule;\n\nclass StoreProductRequest extends FormRequest\n{\n    public function rules(): array\n    {\n        return [\n            'slug' => [\n                'required',\n                'string',\n                'min:3',\n                'max:255',\n                'regex:/^[a-z0-9]+(?:-[a-z0-9]+)*$/',\n                Rule::unique('products', 'slug')->ignore($this->product),\n                new MetadataValueExistRule(Product::class, 'slug'),\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"value-type-handling",children:"Value Type Handling"}),"\n",(0,l.jsx)(n.p,{children:"The rule handles different value types:"}),"\n",(0,l.jsx)(n.h3,{id:"string-values",children:"String Values"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Case-sensitive string comparison\nnew MetadataValueExistRule(Product::class, 'slug')\n// Checks: WHERE value = 'product-slug'\n"})}),"\n",(0,l.jsx)(n.h3,{id:"numeric-values",children:"Numeric Values"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Integer comparison\nnew MetadataValueExistRule(Product::class, 'code')\n// Checks: WHERE value = 12345\n"})}),"\n",(0,l.jsx)(n.h3,{id:"boolean-values",children:"Boolean Values"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Boolean comparison\nnew MetadataValueExistRule(Product::class, 'is_featured')\n// Checks: WHERE value = 1 or value = 0\n"})}),"\n",(0,l.jsx)(n.h3,{id:"json-values",children:"JSON Values"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// JSON-encoded array comparison\nnew MetadataValueExistRule(Product::class, 'tags')\n// Checks: WHERE value = '[\"tag1\",\"tag2\"]' (JSON-encoded)\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Important"}),": JSON values are compared as strings (after JSON encoding), so array order matters."]}),"\n",(0,l.jsx)(n.h2,{id:"error-messages",children:"Error Messages"}),"\n",(0,l.jsx)(n.h3,{id:"default-message",children:"Default Message"}),"\n",(0,l.jsx)(n.p,{children:"The rule uses a translation key for error messages:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"trans('metadata::base.rule.exist', ['field' => $this->key])\n"})}),"\n",(0,l.jsx)(n.h3,{id:"custom-messages",children:"Custom Messages"}),"\n",(0,l.jsx)(n.p,{children:"Override in validation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"$validator = Validator::make($data, [\n    'slug' => new MetadataValueExistRule(Product::class, 'slug'),\n], [\n    'slug' => 'This slug is already in use.',\n]);\n"})}),"\n",(0,l.jsx)(n.p,{children:"Or in FormRequest:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"public function messages(): array\n{\n    return [\n        'slug' => 'The slug :input is already taken. Please choose another.',\n    ];\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,l.jsxs)(n.p,{children:["Use ",(0,l.jsx)(n.code,{children:"MetadataValueExistRule"})," when you need to:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Unique Identifiers"}),": Validate unique slugs, codes, or identifiers stored as metadata"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Business Constraints"}),": Enforce business rules on metadata values"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Data Integrity"}),": Prevent duplicate metadata values"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Form Validation"}),": Validate user input before storing metadata"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"API Validation"}),": Ensure unique values in API endpoints"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"when-not-to-use",children:"When NOT to Use"}),"\n",(0,l.jsx)(n.p,{children:"Avoid using this rule when:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Database Columns"}),": If the value is stored in a regular database column, use ",(0,l.jsx)(n.code,{children:"unique"})," rule instead"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Case-Insensitive"}),": The rule is case-sensitive; use custom validation for case-insensitive checks"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Complex Queries"}),": For complex uniqueness checks involving multiple conditions, consider custom rules"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Performance Critical"}),": For high-traffic scenarios, consider caching or database indexes"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"1-use-class-constants",children:"1. Use Class Constants"}),"\n",(0,l.jsx)(n.p,{children:"Prefer class constants over strings:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Good\nnew MetadataValueExistRule(Product::class, 'slug')\n\n// Avoid\nnew MetadataValueExistRule('App\\Models\\Product', 'slug')\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-combine-with-other-rules",children:"2. Combine with Other Rules"}),"\n",(0,l.jsx)(n.p,{children:"Always combine with type and format validation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"'slug' => [\n    'required',\n    'string',\n    'max:255',\n    'regex:/^[a-z0-9-]+$/',\n    new MetadataValueExistRule(Product::class, 'slug'),\n],\n"})}),"\n",(0,l.jsx)(n.h3,{id:"3-provide-clear-error-messages",children:"3. Provide Clear Error Messages"}),"\n",(0,l.jsx)(n.p,{children:"Use custom messages for better UX:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"public function messages(): array\n{\n    return [\n        'slug' => 'This slug is already in use. Please choose a different one.',\n    ];\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"4-consider-performance",children:"4. Consider Performance"}),"\n",(0,l.jsx)(n.p,{children:"For high-traffic scenarios:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Add database indexes on ",(0,l.jsx)(n.code,{children:"metaable_type"}),", ",(0,l.jsx)(n.code,{children:"key"}),", and ",(0,l.jsx)(n.code,{children:"value"})]}),"\n",(0,l.jsx)(n.li,{children:"Consider caching frequently checked values"}),"\n",(0,l.jsx)(n.li,{children:"Use database-level unique constraints when possible"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"5-handle-updates-properly",children:"5. Handle Updates Properly"}),"\n",(0,l.jsx)(n.p,{children:"When updating, ensure you're not checking the current record:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// In update scenario, you may need custom logic\n// to exclude the current model from the check\n"})}),"\n",(0,l.jsx)(n.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,l.jsx)(n.h3,{id:"mistake-1-not-combining-with-type-validation",children:"Mistake 1: Not Combining with Type Validation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Bad: No type validation\n'slug' => new MetadataValueExistRule(Product::class, 'slug'),\n\n// Good: Combined with type validation\n'slug' => [\n    'required',\n    'string',\n    new MetadataValueExistRule(Product::class, 'slug'),\n],\n"})}),"\n",(0,l.jsx)(n.h3,{id:"mistake-2-using-wrong-model-class",children:"Mistake 2: Using Wrong Model Class"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Bad: Wrong model class\nnew MetadataValueExistRule(User::class, 'slug') // For products\n\n// Good: Correct model class\nnew MetadataValueExistRule(Product::class, 'slug')\n"})}),"\n",(0,l.jsx)(n.h3,{id:"mistake-3-case-sensitivity-issues",children:"Mistake 3: Case Sensitivity Issues"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Rule is case-sensitive\n// 'Product-Slug' and 'product-slug' are considered different\n// Normalize input before validation if needed\n"})}),"\n",(0,l.jsx)(n.h3,{id:"mistake-4-not-handling-json-values",children:"Mistake 4: Not Handling JSON Values"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// JSON values are compared as strings\n// Ensure consistent encoding/decoding\n"})}),"\n",(0,l.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,l.jsx)(n.h3,{id:"database-queries",children:"Database Queries"}),"\n",(0,l.jsx)(n.p,{children:"The rule performs a database query for each validation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Each rule instance = 1 database query\n$rules = [\n    'slug' => new MetadataValueExistRule(Product::class, 'slug'),\n    'code' => new MetadataValueExistRule(Product::class, 'code'),\n];\n// = 2 database queries\n"})}),"\n",(0,l.jsx)(n.h3,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Add Database Indexes"}),":"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Migration\nSchema::table('meta', function (Blueprint $table) {\n    $table->index(['metaable_type', 'key', 'value']);\n});\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache Frequently Checked Values"}),":"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Cache unique values to reduce database queries\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Batch Validation"}),":"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Validate multiple fields in single request\n// to reduce overall query count\n"})}),"\n",(0,l.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(t.A,{to:"/packages/laravel-metadata/deep-diving/has-meta",children:"HasMeta"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(t.A,{to:"/packages/laravel-metadata/deep-diving/models/meta",children:"Meta Model"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(t.A,{to:"/packages/laravel-metadata/deep-diving/resources/metadata-resource",children:"MetadataResource"}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}}}]);