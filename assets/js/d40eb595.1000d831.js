"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[4963],{3034(e,n,l){l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"laravel-flow/deep-diving/support/flow-picker","title":"FlowPicker","description":"The FlowPicker class executes the flow selection process using a configured FlowPickerBuilder. It handles filtering, active constraints, rollout gates, version constraints, and fallback cascades to select the most appropriate flow for a model instance.","source":"@site/packages/laravel-flow/deep-diving/support/flow-picker.md","sourceDirName":"laravel-flow/deep-diving/support","slug":"/laravel-flow/deep-diving/support/flow-picker","permalink":"/packages/laravel-flow/deep-diving/support/flow-picker","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/support/flow-picker.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"FlowPicker"},"sidebar":"packagesSidebar","previous":{"title":"FlowTaskRegistry","permalink":"/packages/laravel-flow/deep-diving/support/flow-task-registry"},"next":{"title":"FlowPickerBuilder","permalink":"/packages/laravel-flow/deep-diving/support/flow-picker-builder"}}');var r=l(4848),s=l(8453);const c={sidebar_position:2,sidebar_label:"FlowPicker"},d="FlowPicker",o={},a=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Pick a Flow",id:"pick-a-flow",level:3},{value:"Get Candidates",id:"get-candidates",level:3},{value:"Selection Process",id:"selection-process",level:2},{value:"Forced Flow Resolution",id:"forced-flow-resolution",level:2},{value:"Request Caching",id:"request-caching",level:2},{value:"Filtering",id:"filtering",level:2},{value:"Subject Filters",id:"subject-filters",level:3},{value:"Environment and Channel",id:"environment-and-channel",level:3},{value:"Active Constraints",id:"active-constraints",level:3},{value:"Version Constraints",id:"version-constraints",level:3},{value:"Include/Exclude Lists",id:"includeexclude-lists",level:3},{value:"Default Requirement",id:"default-requirement",level:3},{value:"Rollout Gating",id:"rollout-gating",level:2},{value:"Ordering",id:"ordering",level:2},{value:"Match Strategy",id:"match-strategy",level:3},{value:"Default Ordering",id:"default-ordering",level:3},{value:"Preferential Ordering",id:"preferential-ordering",level:3},{value:"Fallback Cascade",id:"fallback-cascade",level:2},{value:"Custom Filters",id:"custom-filters",level:2},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Basic Flow Selection",id:"example-1-basic-flow-selection",level:3},{value:"Example 2: With Rollout",id:"example-2-with-rollout",level:3},{value:"Example 3: With Fallback Cascade",id:"example-3-with-fallback-cascade",level:3},{value:"Example 4: Get All Candidates",id:"example-4-get-all-candidates",level:3},{value:"Example 5: With Version Constraints",id:"example-5-with-version-constraints",level:3},{value:"Example 6: With Include/Exclude",id:"example-6-with-includeexclude",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Request Caching",id:"request-caching-1",level:3},{value:"Query Optimization",id:"query-optimization",level:3},{value:"Integration with HasWorkflow",id:"integration-with-hasworkflow",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"flowpicker",children:"FlowPicker"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"FlowPicker"})," class executes the flow selection process using a configured ",(0,r.jsx)(n.code,{children:"FlowPickerBuilder"}),". It handles filtering, active constraints, rollout gates, version constraints, and fallback cascades to select the most appropriate flow for a model instance."]}),"\n",(0,r.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\Support\\FlowPicker\n"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"FlowPicker"})," is responsible for:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Filtering flows by subject type/scope/collection, environment, channel"}),"\n",(0,r.jsx)(n.li,{children:"Enforcing active/time-window constraints (configurable)"}),"\n",(0,r.jsx)(n.li,{children:"Applying rollout gates (configurable)"}),"\n",(0,r.jsx)(n.li,{children:"Supporting include/exclude/prefer lists and version constraints"}),"\n",(0,r.jsx)(n.li,{children:"Honoring match strategy (BEST/FIRST) and fallback cascade"}),"\n",(0,r.jsxs)(n.li,{children:["Providing a ",(0,r.jsx)(n.code,{children:"candidates()"})," helper for diagnostics/insight"]}),"\n",(0,r.jsx)(n.li,{children:"Per-request caching for performance"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(n.h3,{id:"pick-a-flow",children:"Pick a Flow"}),"\n",(0,r.jsx)(n.p,{children:"Select a single flow according to the builder's strategy:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Support\\FlowPicker;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\n\n$picker = new FlowPicker();\n$builder = new FlowPickerBuilder();\n\n// Configure builder\n$builder->subjectType(Order::class)\n    ->environment('production')\n    ->channel('web')\n    ->onlyActive(true);\n\n// Pick flow\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Returns:"})," ",(0,r.jsx)(n.code,{children:"Flow|null"})," - The selected flow or null if no match found"]}),"\n",(0,r.jsx)(n.h3,{id:"get-candidates",children:"Get Candidates"}),"\n",(0,r.jsx)(n.p,{children:"Get all matching flows without applying fallback cascade:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$picker = new FlowPicker();\n$candidates = $picker->candidates($order, $builder);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Returns:"})," ",(0,r.jsx)(n.code,{children:"Collection<int, Flow>"})," - Collection of matching flows"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Debugging flow selection"}),"\n",(0,r.jsx)(n.li,{children:"Displaying available flows"}),"\n",(0,r.jsx)(n.li,{children:"Diagnostics and insight"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"selection-process",children:"Selection Process"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"pick()"})," method follows this process:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check Forced Flow"}),": If ",(0,r.jsx)(n.code,{children:"forceFlowIdResolver"})," is set, resolve and validate it"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check Cache"}),": If request caching is enabled, return cached result"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Get Candidates"}),": Query flows matching builder criteria"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Apply Fallback"}),": If no candidates found, apply fallback cascade"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cache Result"}),": Store result in request cache if enabled"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Return Flow"}),": Return the first matching flow or null"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"forced-flow-resolution",children:"Forced Flow Resolution"}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"forceFlowIdResolver"})," is configured, the picker will:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Call the resolver to get Flow ID"}),"\n",(0,r.jsx)(n.li,{children:"Load the Flow from database"}),"\n",(0,r.jsx)(n.li,{children:"Validate active constraints (if enabled)"}),"\n",(0,r.jsx)(n.li,{children:"Return the Flow if valid, null otherwise"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This is used by ",(0,r.jsx)(n.code,{children:"HasFlow"})," trait for direct Flow ID binding."]}),"\n",(0,r.jsx)(n.h2,{id:"request-caching",children:"Request Caching"}),"\n",(0,r.jsx)(n.p,{children:"The picker supports per-request memoization for performance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->cacheInRequest(true);\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Cache Key Components:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Model class and ID"}),"\n",(0,r.jsx)(n.li,{children:"Subject type, scope, collection"}),"\n",(0,r.jsx)(n.li,{children:"Environment, channel"}),"\n",(0,r.jsx)(n.li,{children:"Active constraints"}),"\n",(0,r.jsx)(n.li,{children:"Rollout configuration"}),"\n",(0,r.jsx)(n.li,{children:"Version constraints"}),"\n",(0,r.jsx)(n.li,{children:"Include/exclude IDs"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Cache Safety:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Only enabled when builder has no dynamic callbacks"}),"\n",(0,r.jsx)(n.li,{children:"Automatically disabled if custom WHERE callbacks exist"}),"\n",(0,r.jsx)(n.li,{children:"Automatically disabled if custom ordering callback exists"}),"\n",(0,r.jsxs)(n.li,{children:["Automatically disabled if ",(0,r.jsx)(n.code,{children:"forceFlowIdResolver"})," is set"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"filtering",children:"Filtering"}),"\n",(0,r.jsx)(n.h3,{id:"subject-filters",children:"Subject Filters"}),"\n",(0,r.jsx)(n.p,{children:"Flows are filtered by:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subject Type"}),": Model class name (required)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subject Scope"}),": Optional tenant/org identifier"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subject Collection"}),": Optional collection identifier (e.g., 'premium', 'standard')"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"environment-and-channel",children:"Environment and Channel"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment"}),": Filter by environment (e.g., 'production', 'staging')"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Channel"}),": Filter by channel (e.g., 'web', 'api', 'mobile')"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"active-constraints",children:"Active Constraints"}),"\n",(0,r.jsxs)(n.p,{children:["When ",(0,r.jsx)(n.code,{children:"onlyActive(true)"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Requires ",(0,r.jsx)(n.code,{children:"status = true"})]}),"\n",(0,r.jsxs)(n.li,{children:["Optionally checks ",(0,r.jsx)(n.code,{children:"active_from"})," and ",(0,r.jsx)(n.code,{children:"active_to"})," time windows"]}),"\n",(0,r.jsxs)(n.li,{children:["Can ignore time window with ",(0,r.jsx)(n.code,{children:"ignoreTimeWindow(true)"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"version-constraints",children:"Version Constraints"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Exact Version"}),": ",(0,r.jsx)(n.code,{children:"versionEquals(2)"})," - Only version 2"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Version Range"}),": ",(0,r.jsx)(n.code,{children:"versionMin(1)->versionMax(3)"})," - Versions 1-3"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"includeexclude-lists",children:"Include/Exclude Lists"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Include IDs"}),": Only flows with these IDs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Exclude IDs"}),": Exclude flows with these IDs"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"default-requirement",children:"Default Requirement"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Require Default"}),": Only flows with ",(0,r.jsx)(n.code,{children:"is_default = true"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"rollout-gating",children:"Rollout Gating"}),"\n",(0,r.jsxs)(n.p,{children:["When ",(0,r.jsx)(n.code,{children:"evaluateRollout(true)"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Get rollout key from ",(0,r.jsx)(n.code,{children:"rolloutKeyResolver"})]}),"\n",(0,r.jsx)(n.li,{children:"Compute stable bucket (0-99) using namespace, salt, and key"}),"\n",(0,r.jsxs)(n.li,{children:["Filter flows where ",(0,r.jsx)(n.code,{children:"rollout_pct >= bucket"})," or ",(0,r.jsx)(n.code,{children:"rollout_pct IS NULL"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Stable Bucket Algorithm:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Combines namespace, salt, and key"}),"\n",(0,r.jsx)(n.li,{children:"Uses CRC32 hash"}),"\n",(0,r.jsx)(n.li,{children:"Returns bucket in range 0-99"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Flow with rollout_pct: 50\n// User with bucket: 30 \u2192 Matches (30 < 50)\n// User with bucket: 60 \u2192 Doesn't match (60 >= 50)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ordering",children:"Ordering"}),"\n",(0,r.jsx)(n.h3,{id:"match-strategy",children:"Match Strategy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"STRATEGY_BEST"}),": Returns best candidate based on ordering rules (default)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"STRATEGY_FIRST"}),": Returns first matching record (minimal ordering)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"default-ordering",children:"Default Ordering"}),"\n",(0,r.jsxs)(n.p,{children:["When using ",(0,r.jsx)(n.code,{children:"STRATEGY_BEST"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"version DESC"})," - Higher versions preferred"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"is_default DESC"})," - Default flows preferred"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ordering DESC"})," - Higher ordering preferred"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"id DESC"})," - Higher ID as tiebreaker"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"preferential-ordering",children:"Preferential Ordering"}),"\n",(0,r.jsx)(n.p,{children:"Boosts (not filters) for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Preferred Flow IDs"}),": Earlier IDs rank higher"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Preferred Environments"}),": Earlier environments rank higher"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Preferred Channels"}),": Earlier channels rank higher"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"fallback-cascade",children:"Fallback Cascade"}),"\n",(0,r.jsx)(n.p,{children:"If no flow matches initially, the picker applies fallback steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FB_DROP_CHANNEL"}),": Remove channel filter"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FB_DROP_ENVIRONMENT"}),": Remove environment filter"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FB_IGNORE_TIMEWINDOW"}),": Ignore active window checks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FB_DISABLE_ROLLOUT"}),": Disable rollout checks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FB_DROP_REQUIRE_DEFAULT"}),": Don't require is_default"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->fallbackCascade([\n    FlowPickerBuilder::FB_DROP_CHANNEL,\n    FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n]);\n"})}),"\n",(0,r.jsx)(n.p,{children:"The picker tries each step in order until a flow is found."}),"\n",(0,r.jsx)(n.h2,{id:"custom-filters",children:"Custom Filters"}),"\n",(0,r.jsx)(n.p,{children:"You can add custom WHERE callbacks:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->where(function ($query, $model) {\n    $query->where('custom_field', $model->some_attribute);\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"These are applied after all standard filters."}),"\n",(0,r.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,r.jsx)(n.h3,{id:"example-1-basic-flow-selection",children:"Example 1: Basic Flow Selection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Support\\FlowPicker;\nuse JobMetric\\Flow\\Support\\FlowPickerBuilder;\n\n$picker = new FlowPicker();\n$builder = new FlowPickerBuilder();\n\n$builder->subjectType(Order::class)\n    ->subjectScope((string)$order->tenant_id)\n    ->environment(config('app.env'))\n    ->channel('web')\n    ->onlyActive(true)\n    ->orderByDefault();\n\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-2-with-rollout",children:"Example 2: With Rollout"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->environment('production')\n    ->evaluateRollout(true)\n    ->rolloutNamespace('order_v2')\n    ->rolloutSalt('2024')\n    ->rolloutKeyResolver(function ($model) {\n        return (string)$model->user_id;\n    });\n\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-3-with-fallback-cascade",children:"Example 3: With Fallback Cascade"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->environment('production')\n    ->channel('web')\n    ->fallbackCascade([\n        FlowPickerBuilder::FB_DROP_CHANNEL,\n        FlowPickerBuilder::FB_DROP_ENVIRONMENT,\n        FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,\n    ]);\n\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-4-get-all-candidates",children:"Example 4: Get All Candidates"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->environment('production');\n\n$candidates = $picker->candidates($order, $builder);\n\n// Display all matching flows\nforeach ($candidates as $flow) {\n    echo \"Flow ID: {$flow->id}, Version: {$flow->version}\\n\";\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-5-with-version-constraints",children:"Example 5: With Version Constraints"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->versionMin(1)\n    ->versionMax(3); // Only versions 1-3\n\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-6-with-includeexclude",children:"Example 6: With Include/Exclude"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->subjectType(Order::class)\n    ->includeFlowIds([1, 2, 3])  // Only these flows\n    ->excludeFlowIds([4, 5])      // Exclude these\n    ->preferFlowIds([1, 2]);      // Prefer these\n\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"request-caching-1",children:"Request Caching"}),"\n",(0,r.jsx)(n.p,{children:"Enable caching for better performance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$builder->cacheInRequest(true);\n$flow = $picker->pick($order, $builder);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When Safe:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No custom WHERE callbacks"}),"\n",(0,r.jsx)(n.li,{children:"No custom ordering callback"}),"\n",(0,r.jsx)(n.li,{children:"No forceFlowIdResolver"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When Not Safe:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Dynamic callbacks that depend on request state"}),"\n",(0,r.jsxs)(n.li,{children:["Callbacks that access ",(0,r.jsx)(n.code,{children:"$request"}),", ",(0,r.jsx)(n.code,{children:"auth()"}),", etc."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"query-optimization",children:"Query Optimization"}),"\n",(0,r.jsx)(n.p,{children:"The picker automatically:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Uses indexed columns (subject_type, environment, channel)"}),"\n",(0,r.jsx)(n.li,{children:"Applies efficient WHERE clauses"}),"\n",(0,r.jsx)(n.li,{children:"Uses proper JOINs when needed"}),"\n",(0,r.jsxs)(n.li,{children:["Limits results when ",(0,r.jsx)(n.code,{children:"candidatesLimit"})," is set"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"integration-with-hasworkflow",children:"Integration with HasWorkflow"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"HasWorkflow"})," trait uses ",(0,r.jsx)(n.code,{children:"FlowPicker"})," internally:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Inside HasWorkflow::pickFlow()\n$builder = $this->makeFlowPicker();\n$flow = (new FlowPicker())->pick($this, $builder);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/support/flow-picker-builder",children:"FlowPickerBuilder"})," - Configuring flow selection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-workflow",children:"HasWorkflow"})," - Workflow integration trait"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow",children:"Flow Service"})," - Flow management"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-flow",children:"HasFlow"})," - Simple flow binding"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453(e,n,l){l.d(n,{R:()=>c,x:()=>d});var i=l(6540);const r={},s=i.createContext(r);function c(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);