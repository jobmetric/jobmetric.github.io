"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[1186],{5049(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"laravel-flow/deep-diving/make-task","title":"MakeTask Command","description":"The flow:make-task artisan command is a powerful tool for generating Flow Task classes. It automatically creates properly structured task classes for Action, Restriction, and Validation tasks, saving you time and ensuring consistency across your workflow implementations.","source":"@site/packages/laravel-flow/deep-diving/make-task.md","sourceDirName":"laravel-flow/deep-diving","slug":"/laravel-flow/deep-diving/make-task","permalink":"/packages/laravel-flow/deep-diving/make-task","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/make-task.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"sidebar_label":"MakeTask Command"},"sidebar":"packagesSidebar","previous":{"title":"FlowTransition","permalink":"/packages/laravel-flow/deep-diving/services/flow-transition"},"next":{"title":"TransitionResult DTO","permalink":"/packages/laravel-flow/deep-diving/transition-result"}}');var l=s(4848),a=s(8453);const t={sidebar_position:4,sidebar_label:"MakeTask Command"},r="MakeTask Command",o={},c=[{value:"Namespace",id:"namespace",level:2},{value:"Command Signature",id:"command-signature",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Interactive Mode",id:"interactive-mode",level:3},{value:"Non-Interactive Mode",id:"non-interactive-mode",level:3},{value:"Command Arguments",id:"command-arguments",level:2},{value:"Type",id:"type",level:3},{value:"Name",id:"name",level:3},{value:"Model",id:"model",level:3},{value:"Title",id:"title",level:3},{value:"Command Options",id:"command-options",level:2},{value:"Force (<code>--force</code> or <code>-f</code>)",id:"force---force-or--f",level:3},{value:"Generated File Structure",id:"generated-file-structure",level:2},{value:"Directory Structure",id:"directory-structure",level:3},{value:"Namespace",id:"namespace-1",level:3},{value:"Task Types",id:"task-types",level:2},{value:"Action Task",id:"action-task",level:3},{value:"Restriction Task",id:"restriction-task",level:3},{value:"Validation Task",id:"validation-task",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Creating an Action Task",id:"example-1-creating-an-action-task",level:3},{value:"Example 2: Creating a Restriction Task",id:"example-2-creating-a-restriction-task",level:3},{value:"Example 3: Creating a Validation Task",id:"example-3-creating-a-validation-task",level:3},{value:"Model Discovery",id:"model-discovery",level:2},{value:"Task Registration",id:"task-registration",level:2},{value:"Naming Conventions",id:"naming-conventions",level:2},{value:"Task Name Conversion",id:"task-name-conversion",level:3},{value:"Final Class Name",id:"final-class-name",level:3},{value:"File Naming",id:"file-naming",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Invalid Task Type",id:"invalid-task-type",level:3},{value:"Model Without HasWorkflow",id:"model-without-hasworkflow",level:3},{value:"File Already Exists",id:"file-already-exists",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Task Not Appearing in Model List",id:"task-not-appearing-in-model-list",level:3},{value:"Generated File Has Placeholders",id:"generated-file-has-placeholders",level:3},{value:"Class Not Found After Generation",id:"class-not-found-after-generation",level:3},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Custom Model Paths",id:"custom-model-paths",level:3},{value:"Batch Task Creation",id:"batch-task-creation",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"maketask-command",children:"MakeTask Command"})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"flow:make-task"})," artisan command is a powerful tool for generating Flow Task classes. It automatically creates properly structured task classes for Action, Restriction, and Validation tasks, saving you time and ensuring consistency across your workflow implementations."]}),"\n",(0,l.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\Commands\\MakeTask\n"})}),"\n",(0,l.jsx)(n.h2,{id:"command-signature",children:"Command Signature"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"php artisan flow:make-task\n    {type? : The type of the task (e.g. validation, restriction, action) default: action}\n    {name? : The name of the task (e.g. RestrictOrderCancellation)}\n    {model? : Driver name (e.g. Order)}\n    {title? : The title of the task (e.g. translation key flow::base.task.restrict_order_cancellation.title)}\n    {--f|force : Overwrite if file already exists}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,l.jsx)(n.h3,{id:"interactive-mode",children:"Interactive Mode"}),"\n",(0,l.jsx)(n.p,{children:"Run the command without arguments to enter interactive mode:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"php artisan flow:make-task\n"})}),"\n",(0,l.jsx)(n.p,{children:"The command will prompt you for:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Task Type"}),": Choose from Validation, Restriction, or Action (default: Action)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Task Name"}),": Enter a descriptive name (e.g., ",(0,l.jsx)(n.code,{children:"RestrictOrderCancellation"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Model"}),": Select from available models that use ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Title"}),": Enter a title or translation key for the task"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"non-interactive-mode",children:"Non-Interactive Mode"}),"\n",(0,l.jsx)(n.p,{children:"Provide all arguments directly:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Action SendEmailNotification Order "flow::base.task.send_email_notification.title"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"command-arguments",children:"Command Arguments"}),"\n",(0,l.jsx)(n.h3,{id:"type",children:"Type"}),"\n",(0,l.jsx)(n.p,{children:"The type of task to create. Must be one of:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Action"}),": Executes actions during transitions"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Restriction"}),": Checks if a transition is allowed"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Validation"}),": Validates data before transitions"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Default:"})," ",(0,l.jsx)(n.code,{children:"Action"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Action MyTask Order "My Task Title"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"name",children:"Name"}),"\n",(0,l.jsx)(n.p,{children:"The name of the task class. This will be converted to StudlyCase automatically."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"send-email"})," \u2192 ",(0,l.jsx)(n.code,{children:"SendEmail"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"restrict_order_cancellation"})," \u2192 ",(0,l.jsx)(n.code,{children:"RestrictOrderCancellation"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"validatePayment"})," \u2192 ",(0,l.jsx)(n.code,{children:"ValidatePayment"})]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Note:"})," The final class name will be ",(0,l.jsx)(n.code,{children:"{Name}{Type}Task"})," (e.g., ",(0,l.jsx)(n.code,{children:"SendEmailActionTask"}),")."]}),"\n",(0,l.jsx)(n.h3,{id:"model",children:"Model"}),"\n",(0,l.jsxs)(n.p,{children:["The fully qualified class name of the Eloquent model that uses the ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Important:"})," The model must:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Extend ",(0,l.jsx)(n.code,{children:"Illuminate\\Database\\Eloquent\\Model"})]}),"\n",(0,l.jsxs)(n.li,{children:["Use the ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,l.jsxs)(n.li,{children:["Be discoverable by ",(0,l.jsx)(n.code,{children:"FilesystemHasWorkflowInModelLocator"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Action SendEmail App\\Models\\Order "Send Email"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"title",children:"Title"}),"\n",(0,l.jsxs)(n.p,{children:["The title or translation key for the task. This is used in the ",(0,l.jsx)(n.code,{children:"FlowTaskDefinition"}),"."]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Simple string: ",(0,l.jsx)(n.code,{children:'"Send Email Notification"'})]}),"\n",(0,l.jsxs)(n.li,{children:["Translation key: ",(0,l.jsx)(n.code,{children:'"flow::base.task.send_email_notification.title"'})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"command-options",children:"Command Options"}),"\n",(0,l.jsxs)(n.h3,{id:"force---force-or--f",children:["Force (",(0,l.jsx)(n.code,{children:"--force"})," or ",(0,l.jsx)(n.code,{children:"-f"}),")"]}),"\n",(0,l.jsx)(n.p,{children:"Overwrite existing files without prompting."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Action MyTask Order "Title" --force\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Without force:"})," If the file exists, you'll be prompted to confirm overwrite."]}),"\n",(0,l.jsx)(n.h2,{id:"generated-file-structure",children:"Generated File Structure"}),"\n",(0,l.jsx)(n.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,l.jsx)(n.p,{children:"Tasks are generated in the following structure:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"app/\n\u2514\u2500\u2500 Flows/\n    \u2514\u2500\u2500 {ModelName}/\n        \u2514\u2500\u2500 {Name}{Type}Task.php\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"app/\n\u2514\u2500\u2500 Flows/\n    \u2514\u2500\u2500 Order/\n        \u251c\u2500\u2500 SendEmailActionTask.php\n        \u251c\u2500\u2500 RestrictCancellationRestrictionTask.php\n        \u2514\u2500\u2500 ValidatePaymentValidationTask.php\n"})}),"\n",(0,l.jsx)(n.h3,{id:"namespace-1",children:"Namespace"}),"\n",(0,l.jsx)(n.p,{children:"The generated class will use the namespace:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"App\\Flows\\{ModelName}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"namespace App\\Flows\\Order;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"task-types",children:"Task Types"}),"\n",(0,l.jsx)(n.h3,{id:"action-task",children:"Action Task"}),"\n",(0,l.jsx)(n.p,{children:"Action tasks execute operations during workflow transitions."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Generated Class:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Flows\\Order;\n\nuse JobMetric\\Flow\\Contracts\\AbstractActionTask;\nuse JobMetric\\Flow\\Support\\FlowTaskContext;\nuse JobMetric\\Flow\\Support\\FlowTaskDefinition;\nuse JobMetric\\Form\\FormBuilder;\n\nclass SendEmailActionTask extends AbstractActionTask\n{\n    // use \\JobMetric\\Flow\\Concerns\\RunInBackground;\n\n    public static function subject(): string\n    {\n        return \\App\\Models\\Order::class;\n    }\n\n    public static function definition(): FlowTaskDefinition\n    {\n        return new FlowTaskDefinition(\n            title: 'flow::base.task.send_email_notification.title',\n            description: null,\n            icon: null,\n            tags: null,\n        );\n    }\n\n    public function form(): FormBuilder\n    {\n        return (new FormBuilder)\n            // Define configuration fields for this task here\n            ;\n    }\n\n    protected function handle(FlowTaskContext $context): void\n    {\n        // Implement the task logic here using:\n        // $context->subject();   // The main model\n        // $context->user();      // The authenticated user\n        // $context->transition(); // The transition key\n        // $context->config();    // The stored configuration for this task\n    }\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"subject()"}),": Returns the model class this task operates on"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"definition()"}),": Returns metadata for the task"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"form()"}),": Returns form builder for task configuration"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"handle()"}),": Executes the main action logic"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Background Execution:"})}),"\n",(0,l.jsx)(n.p,{children:"To run the task in the background, uncomment the trait:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use \\JobMetric\\Flow\\Concerns\\RunInBackground;\n"})}),"\n",(0,l.jsx)(n.h3,{id:"restriction-task",children:"Restriction Task"}),"\n",(0,l.jsx)(n.p,{children:"Restriction tasks determine if a transition is allowed."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Generated Class:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Flows\\Order;\n\nuse JobMetric\\Flow\\Contracts\\AbstractRestrictionTask;\nuse JobMetric\\Flow\\Support\\FlowTaskContext;\nuse JobMetric\\Flow\\Support\\FlowTaskDefinition;\nuse JobMetric\\Flow\\Support\\RestrictionResult;\nuse JobMetric\\Form\\FormBuilder;\n\nclass RestrictCancellationRestrictionTask extends AbstractRestrictionTask\n{\n    public static function subject(): string\n    {\n        return \\App\\Models\\Order::class;\n    }\n\n    public static function definition(): FlowTaskDefinition\n    {\n        return new FlowTaskDefinition(\n            title: 'flow::base.task.restrict_cancellation.title',\n            description: null,\n            icon: null,\n            tags: null,\n        );\n    }\n\n    public function form(): FormBuilder\n    {\n        return (new FormBuilder)\n            // Define configuration fields for this restriction task here\n            ;\n    }\n\n    public function restriction(FlowTaskContext $context): RestrictionResult\n    {\n        // Use $context->subject(), $context->user(), $context->payload(), $context->config()\n        // to implement your restriction logic.\n\n        return RestrictionResult::allow();\n    }\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"restriction()"}),": Returns ",(0,l.jsx)(n.code,{children:"RestrictionResult"})," to allow or deny the transition"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"RestrictionResult Methods:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"RestrictionResult::allow()"}),": Allow the transition"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"RestrictionResult::deny(string $message)"}),": Deny with a message"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"validation-task",children:"Validation Task"}),"\n",(0,l.jsx)(n.p,{children:"Validation tasks validate data before transitions."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Generated Class:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Flows\\Order;\n\nuse JobMetric\\Flow\\Contracts\\AbstractValidationTask;\nuse JobMetric\\Flow\\Support\\FlowTaskContext;\nuse JobMetric\\Flow\\Support\\FlowTaskDefinition;\nuse JobMetric\\Form\\FormBuilder;\n\nclass ValidatePaymentValidationTask extends AbstractValidationTask\n{\n    public static function subject(): string\n    {\n        return \\App\\Models\\Order::class;\n    }\n\n    public static function definition(): FlowTaskDefinition\n    {\n        return new FlowTaskDefinition(\n            title: 'flow::base.task.validate_payment.title',\n            description: null,\n            icon: null,\n            tags: null,\n        );\n    }\n\n    public function form(): FormBuilder\n    {\n        return (new FormBuilder)\n            // Define configuration fields for this validation task here\n            ;\n    }\n\n    public function rules(FlowTaskContext $context): array\n    {\n        return [];\n    }\n\n    public function messages(FlowTaskContext $context): array\n    {\n        return [];\n    }\n\n    public function attributes(FlowTaskContext $context): array\n    {\n        return [];\n    }\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"rules()"}),": Returns Laravel validation rules"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"messages()"}),": Returns custom validation messages"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"attributes()"}),": Returns custom attribute names"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,l.jsx)(n.h3,{id:"example-1-creating-an-action-task",children:"Example 1: Creating an Action Task"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Action SendEmailNotification Order "flow::base.task.send_email.title"\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Generated File:"})," ",(0,l.jsx)(n.code,{children:"app/Flows/Order/SendEmailNotificationActionTask.php"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"protected function handle(FlowTaskContext $context): void\n{\n    $order = $context->subject();\n    $user = $context->user();\n    $config = $context->config();\n\n    // Send email notification\n    Mail::to($user->email)->send(new OrderStatusChanged($order));\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-2-creating-a-restriction-task",children:"Example 2: Creating a Restriction Task"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Restriction PreventCancellation Order "flow::base.task.prevent_cancellation.title"\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Generated File:"})," ",(0,l.jsx)(n.code,{children:"app/Flows/Order/PreventCancellationRestrictionTask.php"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"public function restriction(FlowTaskContext $context): RestrictionResult\n{\n    $order = $context->subject();\n\n    // Prevent cancellation if order is already shipped\n    if ($order->status === 'shipped') {\n        return RestrictionResult::deny('Cannot cancel shipped orders');\n    }\n\n    return RestrictionResult::allow();\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-3-creating-a-validation-task",children:"Example 3: Creating a Validation Task"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Validation ValidatePayment Order "flow::base.task.validate_payment.title"\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Generated File:"})," ",(0,l.jsx)(n.code,{children:"app/Flows/Order/ValidatePaymentValidationTask.php"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"public function rules(FlowTaskContext $context): array\n{\n    return [\n        'payment_method' => 'required|string|in:credit_card,paypal,bank_transfer',\n        'amount' => 'required|numeric|min:0',\n    ];\n}\n\npublic function messages(FlowTaskContext $context): array\n{\n    return [\n        'payment_method.required' => 'Payment method is required',\n        'amount.min' => 'Amount must be greater than zero',\n    ];\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"model-discovery",children:"Model Discovery"}),"\n",(0,l.jsxs)(n.p,{children:["The command uses ",(0,l.jsx)(n.code,{children:"FilesystemHasWorkflowInModelLocator"})," to discover models that use the ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait."]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Discovery Process:"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Scans the ",(0,l.jsx)(n.code,{children:"app/Models"})," directory (and other configured paths)"]}),"\n",(0,l.jsxs)(n.li,{children:["Looks for PHP files that contain ",(0,l.jsx)(n.code,{children:"HasWorkflow"})]}),"\n",(0,l.jsxs)(n.li,{children:["Verifies the class extends ",(0,l.jsx)(n.code,{children:"Model"})]}),"\n",(0,l.jsxs)(n.li,{children:["Checks if the class uses the ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,l.jsx)(n.li,{children:"Returns a list of available models"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Requirements for Model Discovery:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Model must be in a discoverable directory"}),"\n",(0,l.jsxs)(n.li,{children:["Model must use ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,l.jsxs)(n.li,{children:["Model must extend ",(0,l.jsx)(n.code,{children:"Illuminate\\Database\\Eloquent\\Model"})]}),"\n",(0,l.jsx)(n.li,{children:"Model must not be abstract"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"task-registration",children:"Task Registration"}),"\n",(0,l.jsx)(n.p,{children:"After creating a task, you must register it in a service provider:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use App\\Flows\\Order\\SendEmailNotificationActionTask;\nuse JobMetric\\Flow\\Facades\\FlowTask;\n\npublic function boot(): void\n{\n    FlowTask::register(new SendEmailNotificationActionTask);\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Or using the registry directly:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use App\\Flows\\Order\\SendEmailNotificationActionTask;\n\napp('FlowTaskRegistry')->register(new SendEmailNotificationActionTask);\n"})}),"\n",(0,l.jsx)(n.h2,{id:"naming-conventions",children:"Naming Conventions"}),"\n",(0,l.jsx)(n.h3,{id:"task-name-conversion",children:"Task Name Conversion"}),"\n",(0,l.jsx)(n.p,{children:"The command automatically converts task names to StudlyCase:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"send-email"})," \u2192 ",(0,l.jsx)(n.code,{children:"SendEmail"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"send_email"})," \u2192 ",(0,l.jsx)(n.code,{children:"SendEmail"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"sendEmail"})," \u2192 ",(0,l.jsx)(n.code,{children:"SendEmail"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SEND_EMAIL"})," \u2192 ",(0,l.jsx)(n.code,{children:"SendEmail"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"final-class-name",children:"Final Class Name"}),"\n",(0,l.jsx)(n.p,{children:"The final class name follows this pattern:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"{Name}{Type}Task\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Name: ",(0,l.jsx)(n.code,{children:"SendEmail"}),", Type: ",(0,l.jsx)(n.code,{children:"Action"})," \u2192 ",(0,l.jsx)(n.code,{children:"SendEmailActionTask"})]}),"\n",(0,l.jsxs)(n.li,{children:["Name: ",(0,l.jsx)(n.code,{children:"RestrictCancellation"}),", Type: ",(0,l.jsx)(n.code,{children:"Restriction"})," \u2192 ",(0,l.jsx)(n.code,{children:"RestrictCancellationRestrictionTask"})]}),"\n",(0,l.jsxs)(n.li,{children:["Name: ",(0,l.jsx)(n.code,{children:"ValidatePayment"}),", Type: ",(0,l.jsx)(n.code,{children:"Validation"})," \u2192 ",(0,l.jsx)(n.code,{children:"ValidatePaymentValidationTask"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"file-naming",children:"File Naming"}),"\n",(0,l.jsx)(n.p,{children:"Files are named exactly as the class name:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"{Name}{Type}Task.php\n"})}),"\n",(0,l.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,l.jsx)(n.h3,{id:"invalid-task-type",children:"Invalid Task Type"}),"\n",(0,l.jsx)(n.p,{children:"If an invalid task type is provided:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task InvalidType MyTask Order "Title"\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Error:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Invalid task type: [InvalidType]. Allowed types are: Validation, Restriction, Action.\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution:"})," Use one of the allowed types: ",(0,l.jsx)(n.code,{children:"Action"}),", ",(0,l.jsx)(n.code,{children:"Restriction"}),", or ",(0,l.jsx)(n.code,{children:"Validation"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"model-without-hasworkflow",children:"Model Without HasWorkflow"}),"\n",(0,l.jsxs)(n.p,{children:["If the model doesn't use ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'php artisan flow:make-task Action MyTask App\\Models\\User "Title"\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Error:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"The model [App\\Models\\User] does not use the HasWorkflow trait.\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution:"})," Ensure the model uses the ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait."]}),"\n",(0,l.jsx)(n.h3,{id:"file-already-exists",children:"File Already Exists"}),"\n",(0,l.jsxs)(n.p,{children:["If the file already exists and ",(0,l.jsx)(n.code,{children:"--force"})," is not used:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Flow Action Task class already exists: [App\\Flows\\Order\\MyTaskActionTask], Use --force to overwrite.\nDo you want to overwrite the existing file? (yes/no) [no]:\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution:"})," Use ",(0,l.jsx)(n.code,{children:"--force"})," flag or confirm overwrite when prompted."]}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Use Descriptive Names"}),": Choose clear, descriptive task names that indicate their purpose"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u2705 Good\nphp artisan flow:make-task Action SendEmailNotification Order "Send Email"\n\n# \u274c Bad\nphp artisan flow:make-task Action Task1 Order "Task"\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Use Translation Keys"}),": Use translation keys for titles instead of hardcoded strings"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u2705 Good\nphp artisan flow:make-task Action SendEmail Order "flow::base.task.send_email.title"\n\n# \u26a0\ufe0f Acceptable\nphp artisan flow:make-task Action SendEmail Order "Send Email"\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Organize by Model"}),": Tasks are automatically organized by model in the ",(0,l.jsx)(n.code,{children:"app/Flows/{ModelName}/"})," directory"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Register Tasks"}),": Always register tasks in a service provider after creation"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Use Type Hints"}),": The generated code uses proper type hints - maintain this in your implementations"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Document Custom Logic"}),": Add PHPDoc comments for complex task logic"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"task-not-appearing-in-model-list",children:"Task Not Appearing in Model List"}),"\n",(0,l.jsx)(n.p,{children:"If your model doesn't appear in the interactive model selection:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check Trait Usage"}),": Ensure the model uses ",(0,l.jsx)(n.code,{children:"HasWorkflow"})," trait"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check Directory"}),": Ensure the model is in a discoverable directory (default: ",(0,l.jsx)(n.code,{children:"app/Models"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check Class Definition"}),": Ensure the model extends ",(0,l.jsx)(n.code,{children:"Model"})," and is not abstract"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Clear Cache"}),": Run ",(0,l.jsx)(n.code,{children:"php artisan clear-compiled"})," and ",(0,l.jsx)(n.code,{children:"composer dump-autoload"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"generated-file-has-placeholders",children:"Generated File Has Placeholders"}),"\n",(0,l.jsxs)(n.p,{children:["If the generated file still contains placeholders like ",(0,l.jsx)(n.code,{children:"{{namespace}}"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check Stub Files"}),": Ensure stub files exist in ",(0,l.jsx)(n.code,{children:"packages/laravel-flow/src/Commands/stub/"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check Permissions"}),": Ensure the command has write permissions"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Re-run Command"}),": Try running the command again with ",(0,l.jsx)(n.code,{children:"--force"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"class-not-found-after-generation",children:"Class Not Found After Generation"}),"\n",(0,l.jsx)(n.p,{children:'If you get "Class not found" errors:'}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Run Composer Dump-Autoload"}),": ",(0,l.jsx)(n.code,{children:"composer dump-autoload"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check Namespace"}),": Ensure the namespace matches your app namespace"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Check File Location"}),": Ensure the file is in the correct directory"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,l.jsx)(n.h3,{id:"custom-model-paths",children:"Custom Model Paths"}),"\n",(0,l.jsxs)(n.p,{children:["The model locator scans default paths. To add custom paths, you can extend ",(0,l.jsx)(n.code,{children:"FilesystemHasWorkflowInModelLocator"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Support\\FilesystemHasWorkflowInModelLocator;\n\n$models = FilesystemHasWorkflowInModelLocator::all([\n    app_path('Models'),\n    app_path('Custom/Models'),\n]);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"batch-task-creation",children:"Batch Task Creation"}),"\n",(0,l.jsx)(n.p,{children:"Create multiple tasks using a script:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"$tasks = [\n    ['type' => 'Action', 'name' => 'SendEmail', 'model' => Order::class, 'title' => 'Send Email'],\n    ['type' => 'Restriction', 'name' => 'PreventCancellation', 'model' => Order::class, 'title' => 'Prevent Cancellation'],\n    ['type' => 'Validation', 'name' => 'ValidatePayment', 'model' => Order::class, 'title' => 'Validate Payment'],\n];\n\nforeach ($tasks as $task) {\n    Artisan::call('flow:make-task', [\n        'type' => $task['type'],\n        'name' => $task['name'],\n        'model' => $task['model'],\n        'title' => $task['title'],\n        '--force' => true,\n    ]);\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-task",children:"FlowTask Service"})," - Learn about managing tasks"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/has-workflow",children:"HasWorkflow Trait"})," - Learn about workflow integration"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-transition",children:"FlowTransition Service"})," - Learn about transitions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>r});var i=s(6540);const l={},a=i.createContext(l);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);