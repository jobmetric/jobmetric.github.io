"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[4343],{28453(e,a,t){t.d(a,{R:()=>r,x:()=>i});var n=t(96540);const s={},l=n.createContext(s);function r(e){const a=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(l.Provider,{value:a},e.children)}},67554(e,a,t){t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>i,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"laravel-metadata/deep-diving/has-meta","title":"HasMeta","description":"The HasMeta trait adds metadata functionality to any Eloquent model, allowing you to store, retrieve, query, and manage arbitrary key-value pairs through a polymorphic relationship.","source":"@site/packages/laravel-metadata/deep-diving/has-meta.md","sourceDirName":"laravel-metadata/deep-diving","slug":"/laravel-metadata/deep-diving/has-meta","permalink":"/packages/laravel-metadata/deep-diving/has-meta","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-metadata/deep-diving/has-meta.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"HasMeta"},"sidebar":"packagesSidebar","previous":{"title":"Showcase","permalink":"/packages/laravel-metadata/showcase"},"next":{"title":"HasFilterMeta","permalink":"/packages/laravel-metadata/deep-diving/has-filter-meta"}}');var s=t(74848),l=t(28453),r=t(28774);const i={sidebar_position:1,sidebar_label:"HasMeta"},d="HasMeta",c={},o=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Attach Trait to Model",id:"attach-trait-to-model",level:3},{value:"Optional: Limit Allowed Keys",id:"optional-limit-allowed-keys",level:3},{value:"Available Methods",id:"available-methods",level:2},{value:"Store Metadata",id:"store-metadata",level:3},{value:"Store Multiple Metadata",id:"store-multiple-metadata",level:3},{value:"Get Metadata",id:"get-metadata",level:3},{value:"Check Metadata Exists",id:"check-metadata-exists",level:3},{value:"Delete Metadata",id:"delete-metadata",level:3},{value:"Get Metadata Keys",id:"get-metadata-keys",level:3},{value:"Merge Metadata Keys",id:"merge-metadata-keys",level:3},{value:"Remove Metadata Key",id:"remove-metadata-key",level:3},{value:"Relationships",id:"relationships",level:2},{value:"Metas Relationship",id:"metas-relationship",level:3},{value:"Meta Key Relationship",id:"meta-key-relationship",level:3},{value:"Query Scopes",id:"query-scopes",level:2},{value:"Has Meta Key",id:"has-meta-key",level:3},{value:"Storing via Model Attributes",id:"storing-via-model-attributes",level:2},{value:"Events",id:"events",level:2},{value:"Complete Examples",id:"complete-examples",level:2},{value:"E-Commerce Product Attributes",id:"e-commerce-product-attributes",level:3},{value:"User Preferences",id:"user-preferences",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function h(e){const a={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"hasmeta",children:"HasMeta"})}),"\n",(0,s.jsxs)(a.p,{children:["The ",(0,s.jsx)(a.code,{children:"HasMeta"})," trait adds metadata functionality to any Eloquent model, allowing you to store, retrieve, query, and manage arbitrary key-value pairs through a polymorphic relationship."]}),"\n",(0,s.jsx)(a.h2,{id:"namespace",children:"Namespace"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"JobMetric\\Metadata\\HasMeta\n"})}),"\n",(0,s.jsx)(a.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(a.p,{children:["The ",(0,s.jsx)(a.code,{children:"HasMeta"})," trait provides:"]}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Metadata Storage"}),": Store key-value pairs for any model"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Key Whitelisting"}),": Control which keys are allowed"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Automatic JSON Handling"}),": Arrays are automatically JSON-encoded/decoded"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Query Scopes"}),": Filter models by metadata"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Batch Operations"}),": Store or delete multiple metadata entries"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Event Integration"}),": Fires events on metadata operations"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,s.jsx)(a.h3,{id:"attach-trait-to-model",children:"Attach Trait to Model"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"use JobMetric\\Metadata\\HasMeta;\n\nclass Product extends Model\n{\n    use HasMeta;\n}\n"})}),"\n",(0,s.jsx)(a.h3,{id:"optional-limit-allowed-keys",children:"Optional: Limit Allowed Keys"}),"\n",(0,s.jsx)(a.p,{children:"Define allowed metadata keys in your model:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"class Product extends Model\n{\n    use HasMeta;\n\n    protected array $metadata = [\n        'color',\n        'size',\n        'weight',\n        'dimensions',\n    ];\n}\n"})}),"\n",(0,s.jsxs)(a.p,{children:["If omitted or set to ",(0,s.jsx)(a.code,{children:"['*']"}),", all keys are allowed."]}),"\n",(0,s.jsx)(a.h2,{id:"available-methods",children:"Available Methods"}),"\n",(0,s.jsx)(a.h3,{id:"store-metadata",children:"Store Metadata"}),"\n",(0,s.jsx)(a.p,{children:"Store or update a single metadata value:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$product->storeMetadata('color', 'red');\n$product->storeMetadata('dimensions', ['width' => 10, 'height' => 20]);\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"string $key"})," - Metadata key"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"array|string|bool|null $value"})," - Metadata value"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"static"})," - Fluent interface"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Throws:"})," ",(0,s.jsx)(a.code,{children:"ModelMetaableKeyNotAllowedFieldException"})," if key is not allowed"]}),"\n",(0,s.jsx)(a.h3,{id:"store-multiple-metadata",children:"Store Multiple Metadata"}),"\n",(0,s.jsx)(a.p,{children:"Store multiple metadata entries in a batch:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$product->storeMetadataBatch([\n    'color' => 'red',\n    'size' => 'large',\n    'weight' => 500,\n    'dimensions' => ['width' => 10, 'height' => 20],\n]);\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"array $metas"})," - Associative array of key => value pairs"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"static"})," - Fluent interface"]}),"\n",(0,s.jsx)(a.h3,{id:"get-metadata",children:"Get Metadata"}),"\n",(0,s.jsx)(a.p,{children:"Retrieve metadata value(s):"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"// Get single value\n$color = $product->getMetadata('color');\n// => 'red'\n\n// Get single value with default\n$price = $product->getMetadata('price', 0);\n// => 0 (if 'price' doesn't exist)\n\n// Get all metadata\n$all = $product->getMetadata();\n// => Collection with all key-value pairs\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"string|null $key"})," - Metadata key (null for all)"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"array|string|bool|null $default"})," - Default value if key doesn't exist"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"mixed"})," - Single value or Collection"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Throws:"})," ",(0,s.jsx)(a.code,{children:"ModelMetaableKeyNotAllowedFieldException"})," if key is not allowed"]}),"\n",(0,s.jsx)(a.h3,{id:"check-metadata-exists",children:"Check Metadata Exists"}),"\n",(0,s.jsx)(a.p,{children:"Check if a metadata key exists:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"if ($product->hasMetadata('color')) {\n    // Metadata exists\n}\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"string $key"})," - Metadata key to check"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"bool"})," - ",(0,s.jsx)(a.code,{children:"true"})," if key exists, ",(0,s.jsx)(a.code,{children:"false"})," otherwise"]}),"\n",(0,s.jsx)(a.h3,{id:"delete-metadata",children:"Delete Metadata"}),"\n",(0,s.jsx)(a.p,{children:"Delete metadata by key or all metadata:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"// Delete specific key\n$product->forgetMetadata('color');\n\n// Delete all metadata\n$product->forgetMetadata();\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"string|null $key"})," - Metadata key to delete (null for all)"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"static"})," - Fluent interface"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Throws:"})," ",(0,s.jsx)(a.code,{children:"ModelMetaableKeyNotAllowedFieldException"})," if key is not allowed"]}),"\n",(0,s.jsx)(a.h3,{id:"get-metadata-keys",children:"Get Metadata Keys"}),"\n",(0,s.jsx)(a.p,{children:"Get the list of allowed metadata keys:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$keys = $product->getMetaKeys();\n// => ['color', 'size', 'weight', 'dimensions']\n// or ['*'] if all keys are allowed\n"})}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"array"})," - Array of allowed keys or ",(0,s.jsx)(a.code,{children:"['*']"})]}),"\n",(0,s.jsx)(a.h3,{id:"merge-metadata-keys",children:"Merge Metadata Keys"}),"\n",(0,s.jsx)(a.p,{children:"Add additional allowed keys at runtime:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$product->mergeMeta(['nickname', 'website']);\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"array $meta"})," - Array of keys to add"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"void"})]}),"\n",(0,s.jsx)(a.h3,{id:"remove-metadata-key",children:"Remove Metadata Key"}),"\n",(0,s.jsx)(a.p,{children:"Remove a key from the allowed list:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$product->removeMetaKey('bio');\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"string $key"})," - Key to remove"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"void"})]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Throws:"})," ",(0,s.jsx)(a.code,{children:"ModelMetaableKeyNotAllowedFieldException"})," if key is not in allowed list"]}),"\n",(0,s.jsx)(a.h2,{id:"relationships",children:"Relationships"}),"\n",(0,s.jsx)(a.h3,{id:"metas-relationship",children:"Metas Relationship"}),"\n",(0,s.jsx)(a.p,{children:"Access the polymorphic relationship directly:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$metas = $product->metas;\n// => Collection of Meta models\n\n// Query relationship\n$colorMeta = $product->metas()->where('key', 'color')->first();\n"})}),"\n",(0,s.jsx)(a.h3,{id:"meta-key-relationship",children:"Meta Key Relationship"}),"\n",(0,s.jsx)(a.p,{children:"Filter metadata by key:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$colorMeta = $product->metaKey('color')->first();\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"string $key"})," - Metadata key"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"MorphMany"})," - Query builder instance"]}),"\n",(0,s.jsx)(a.h2,{id:"query-scopes",children:"Query Scopes"}),"\n",(0,s.jsx)(a.h3,{id:"has-meta-key",children:"Has Meta Key"}),"\n",(0,s.jsx)(a.p,{children:"Filter models that have a specific metadata key:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$productsWithColor = Product::hasMetaKey('color')->get();\n"})}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"string $key"})," - Metadata key to filter by"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Returns:"})," ",(0,s.jsx)(a.code,{children:"Builder"})," - Query builder instance"]}),"\n",(0,s.jsx)(a.h2,{id:"storing-via-model-attributes",children:"Storing via Model Attributes"}),"\n",(0,s.jsx)(a.p,{children:"You can store metadata when creating or updating models:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"$product = Product::create([\n    'name' => 'Test Product',\n    'metadata' => [\n        'color' => 'red',\n        'size' => 'large',\n    ],\n]);\n"})}),"\n",(0,s.jsx)(a.p,{children:"The metadata will be validated against allowed keys and stored after the model is saved."}),"\n",(0,s.jsx)(a.h2,{id:"events",children:"Events"}),"\n",(0,s.jsx)(a.p,{children:"The trait fires the following events:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"MetadataStoringEvent"})," - Before metadata is stored"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"MetadataStoredEvent"})," - After metadata is stored"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"MetadataDeletingEvent"})," - Before metadata is deleted"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"MetadataDeletedEvent"})," - After metadata is deleted"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["Listen to these events in your ",(0,s.jsx)(a.code,{children:"EventServiceProvider"}),":"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"protected $listen = [\n    \\JobMetric\\Metadata\\Events\\MetadataStoredEvent::class => [\n        \\App\\Listeners\\LogMetadataStored::class,\n    ],\n];\n"})}),"\n",(0,s.jsx)(a.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,s.jsx)(a.h3,{id:"e-commerce-product-attributes",children:"E-Commerce Product Attributes"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"class Product extends Model\n{\n    use HasMeta;\n\n    protected array $metadata = [\n        'color',\n        'size',\n        'weight',\n        'dimensions',\n        'material',\n        'warranty_period',\n    ];\n}\n\n// Store product attributes\n$product = Product::find(1);\n$product->storeMetadataBatch([\n    'color' => 'blue',\n    'size' => 'large',\n    'weight' => 500,\n    'dimensions' => ['width' => 10, 'height' => 20, 'depth' => 5],\n    'material' => 'cotton',\n    'warranty_period' => '1 year',\n]);\n\n// Retrieve attributes\n$color = $product->getMetadata('color');\n$dimensions = $product->getMetadata('dimensions');\n"})}),"\n",(0,s.jsx)(a.h3,{id:"user-preferences",children:"User Preferences"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-php",children:"class User extends Model\n{\n    use HasMeta;\n    // No $metadata array = all keys allowed\n}\n\n// Store user preferences\n$user = User::find(1);\n$user->storeMetadata('theme', 'dark');\n$user->storeMetadata('notifications', [\n    'email' => true,\n    'sms' => false,\n    'push' => true,\n]);\n\n// Get preferences\n$theme = $user->getMetadata('theme', 'light');\n$notifications = $user->getMetadata('notifications', []);\n"})}),"\n",(0,s.jsx)(a.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(r.A,{to:"/packages/laravel-metadata/deep-diving/has-filter-meta",children:"HasFilterMeta"}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(r.A,{to:"/packages/laravel-metadata/deep-diving/has-dynamic-meta",children:"HasDynamicMeta"}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(r.A,{to:"/packages/laravel-metadata/deep-diving/models/meta",children:"Meta Model"}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(r.A,{to:"/packages/laravel-metadata/deep-diving/events",children:"Events"}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:a}={...(0,l.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);