"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[599],{5007(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"laravel-flow/deep-diving/requests/store-flow-request","title":"StoreFlowRequest","description":"Form request class for validating Flow creation data. This request handles validation for creating new workflow flows with multi-language support, date ranges, and cross-field validation.","source":"@site/packages/laravel-flow/deep-diving/requests/store-flow-request.md","sourceDirName":"laravel-flow/deep-diving/requests","slug":"/laravel-flow/deep-diving/requests/store-flow-request","permalink":"/packages/laravel-flow/deep-diving/requests/store-flow-request","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/requests/store-flow-request.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"StoreFlowRequest"},"sidebar":"packagesSidebar","previous":{"title":"Events","permalink":"/packages/laravel-flow/deep-diving/events"},"next":{"title":"UpdateFlowRequest","permalink":"/packages/laravel-flow/deep-diving/requests/update-flow-request"}}');var s=i(4848),r=i(8453);const t={sidebar_position:1,sidebar_label:"StoreFlowRequest"},a="StoreFlowRequest",d={},o=[{value:"Namespace",id:"namespace",level:2},{value:"Overview",id:"overview",level:2},{value:"Validation Rules",id:"validation-rules",level:2},{value:"Required Fields",id:"required-fields",level:3},{value:"Optional Fields",id:"optional-fields",level:3},{value:"Cross-Field Validation",id:"cross-field-validation",level:2},{value:"Active Window Validation",id:"active-window-validation",level:3},{value:"Translation Validation",id:"translation-validation",level:2},{value:"Name Uniqueness",id:"name-uniqueness",level:3},{value:"Required Locales",id:"required-locales",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic Flow Creation",id:"basic-flow-creation",level:3},{value:"Complete Request Data",id:"complete-request-data",level:3},{value:"Minimal Request Data",id:"minimal-request-data",level:3},{value:"With Active Window",id:"with-active-window",level:3},{value:"Custom Attributes",id:"custom-attributes",level:2},{value:"Authorization",id:"authorization",level:2},{value:"Integration with Flow Service",id:"integration-with-flow-service",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Validation Errors",id:"validation-errors",level:3},{value:"Handling in Controllers",id:"handling-in-controllers",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"storeflowrequest",children:"StoreFlowRequest"})}),"\n",(0,s.jsx)(n.p,{children:"Form request class for validating Flow creation data. This request handles validation for creating new workflow flows with multi-language support, date ranges, and cross-field validation."}),"\n",(0,s.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"JobMetric\\Flow\\Http\\Requests\\Flow\\StoreFlowRequest"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"StoreFlowRequest"})," validates incoming data when creating a new Flow entity. It ensures:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Required fields are present"}),"\n",(0,s.jsx)(n.li,{children:"Multi-language translations are valid"}),"\n",(0,s.jsx)(n.li,{children:"Date ranges are logical (active_from before or equal to active_to)"}),"\n",(0,s.jsx)(n.li,{children:"Field types and constraints are correct"}),"\n",(0,s.jsx)(n.li,{children:"Translation uniqueness across flows"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"validation-rules",children:"Validation Rules"}),"\n",(0,s.jsx)(n.h3,{id:"required-fields",children:"Required Fields"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Rule"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|array"})}),(0,s.jsx)(n.td,{children:"Multi-language translation data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation.{locale}"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|array"})}),(0,s.jsx)(n.td,{children:"Translation data for each active locale"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation.{locale}.name"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|string"})}),(0,s.jsx)(n.td,{children:"Flow name in each locale (must be unique)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"subject_type"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"required|string|max:255"})}),(0,s.jsx)(n.td,{children:"Model class name that uses this flow"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"optional-fields",children:"Optional Fields"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Rule"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"subject_scope"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|string|max:255"})}),(0,s.jsx)(n.td,{children:"Optional scope identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"subject_collection"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|string|max:255"})}),(0,s.jsx)(n.td,{children:"Optional collection identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"version"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|integer|min:1"})}),(0,s.jsx)(n.td,{children:"Flow version number (defaults to 1)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"is_default"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|boolean"})}),(0,s.jsx)(n.td,{children:"Whether this is the default flow"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"status"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|boolean"})}),(0,s.jsx)(n.td,{children:"Active/inactive status"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"active_from"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|date"})}),(0,s.jsx)(n.td,{children:"Start date for active window"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"active_to"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|date"})}),(0,s.jsx)(n.td,{children:"End date for active window"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"channel"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|string|max:64"})}),(0,s.jsx)(n.td,{children:"Channel identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ordering"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sometimes|integer|min:0"})}),(0,s.jsx)(n.td,{children:"Display order"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"rollout_pct"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|integer|between:0,100"})}),(0,s.jsx)(n.td,{children:"Rollout percentage (0-100)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"environment"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|string|max:64"})}),(0,s.jsx)(n.td,{children:"Environment identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"translation.{locale}.description"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nullable|string"})}),(0,s.jsx)(n.td,{children:"Optional description in each locale"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"cross-field-validation",children:"Cross-Field Validation"}),"\n",(0,s.jsxs)(n.p,{children:["The request includes custom validation in ",(0,s.jsx)(n.code,{children:"withValidator()"}),":"]}),"\n",(0,s.jsx)(n.h3,{id:"active-window-validation",children:"Active Window Validation"}),"\n",(0,s.jsxs)(n.p,{children:["If both ",(0,s.jsx)(n.code,{children:"active_from"})," and ",(0,s.jsx)(n.code,{children:"active_to"})," are provided, ",(0,s.jsx)(n.code,{children:"active_from"})," must be before or equal to ",(0,s.jsx)(n.code,{children:"active_to"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Valid\n'active_from' => '2024-01-01',\n'active_to' => '2024-12-31',\n\n// \u274c Invalid\n'active_from' => '2024-12-31',\n'active_to' => '2024-01-01',\n"})}),"\n",(0,s.jsx)(n.h2,{id:"translation-validation",children:"Translation Validation"}),"\n",(0,s.jsx)(n.h3,{id:"name-uniqueness",children:"Name Uniqueness"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"translation.{locale}.name"})," field is validated for uniqueness using ",(0,s.jsx)(n.code,{children:"TranslationFieldExistRule"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Checks if a flow with the same name already exists in the same locale"}),"\n",(0,s.jsx)(n.li,{children:"Prevents duplicate flow names within the same language"}),"\n",(0,s.jsx)(n.li,{children:"Trims whitespace before validation"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"required-locales",children:"Required Locales"}),"\n",(0,s.jsxs)(n.p,{children:["All active locales (from ",(0,s.jsx)(n.code,{children:"Language::getActiveLocales()"}),") must have translation data:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// If active locales are ['en', 'fa']\n// Both must be provided:\n'translation' => [\n    'en' => ['name' => 'Order Processing'],\n    'fa' => ['name' => '\u067e\u0631\u062f\u0627\u0632\u0634 \u0633\u0641\u0627\u0631\u0634'],\n]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,s.jsx)(n.h3,{id:"basic-flow-creation",children:"Basic Flow Creation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Http\\Requests\\Flow\\StoreFlowRequest;\nuse JobMetric\\Flow\\Facades\\Flow;\n\n// In controller\npublic function store(StoreFlowRequest $request)\n{\n    $validated = $request->validated();\n    \n    $flow = Flow::store($validated);\n    \n    return response()->json($flow);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"complete-request-data",children:"Complete Request Data"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$requestData = [\n    'translation' => [\n        'en' => [\n            'name' => 'Order Processing Workflow',\n            'description' => 'Handles order processing from creation to delivery',\n        ],\n        'fa' => [\n            'name' => '\u06af\u0631\u062f\u0634 \u06a9\u0627\u0631 \u067e\u0631\u062f\u0627\u0632\u0634 \u0633\u0641\u0627\u0631\u0634',\n            'description' => '\u067e\u0631\u062f\u0627\u0632\u0634 \u0633\u0641\u0627\u0631\u0634 \u0627\u0632 \u0627\u06cc\u062c\u0627\u062f \u062a\u0627 \u062a\u062d\u0648\u06cc\u0644',\n        ],\n    ],\n    'subject_type' => 'App\\Models\\Order',\n    'subject_scope' => 'ecommerce',\n    'version' => 1,\n    'is_default' => true,\n    'status' => true,\n    'active_from' => '2024-01-01',\n    'active_to' => '2024-12-31',\n    'channel' => 'web',\n    'ordering' => 0,\n    'rollout_pct' => 100,\n    'environment' => 'production',\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"minimal-request-data",children:"Minimal Request Data"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$requestData = [\n    'translation' => [\n        'en' => ['name' => 'Simple Workflow'],\n    ],\n    'subject_type' => 'App\\Models\\Document',\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"with-active-window",children:"With Active Window"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$requestData = [\n    'translation' => [\n        'en' => ['name' => 'Seasonal Workflow'],\n    ],\n    'subject_type' => 'App\\Models\\Product',\n    'active_from' => '2024-06-01',\n    'active_to' => '2024-08-31', // Summer season\n];\n"})}),"\n",(0,s.jsx)(n.h2,{id:"custom-attributes",children:"Custom Attributes"}),"\n",(0,s.jsx)(n.p,{children:"The request provides custom attribute names for validation error messages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Error messages will use these labels:\n'translation' => 'Translation'\n'translation.*.name' => 'Name'\n'subject_type' => 'Subject Type'\n'active_from' => 'Active From'\n// ... etc\n"})}),"\n",(0,s.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"authorize()"})," method returns ",(0,s.jsx)(n.code,{children:"true"})," by default. Override in your application if you need custom authorization logic:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// In your custom request class extending StoreFlowRequest\npublic function authorize(): bool\n{\n    return $this->user()->can('create', Flow::class);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"integration-with-flow-service",children:"Integration with Flow Service"}),"\n",(0,s.jsxs)(n.p,{children:["The request is automatically used by the ",(0,s.jsx)(n.code,{children:"Flow::store()"})," method:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\n\n// The service automatically validates using StoreFlowRequest\n$flow = Flow::store([\n    'translation' => [...],\n    'subject_type' => 'App\\Models\\Order',\n    // ... other fields\n]);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.h3,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,s.jsx)(n.p,{children:"When validation fails, Laravel returns a JSON response with error messages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "message": "The given data was invalid.",\n    "errors": {\n        "translation.en.name": [\n            "The translation.en.name field is required."\n        ],\n        "subject_type": [\n            "The subject type field is required."\n        ],\n        "active_from": [\n            "The active from must be before active to."\n        ]\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"handling-in-controllers",children:"Handling in Controllers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"public function store(StoreFlowRequest $request)\n{\n    try {\n        $flow = Flow::store($request->validated());\n        return response()->json($flow, 201);\n    } catch (\\Exception $e) {\n        return response()->json([\n            'message' => 'Failed to create flow',\n            'error' => $e->getMessage()\n        ], 500);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Always provide all active locales"}),": Ensure translation data exists for all active locales"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good\n$locales = Language::getActiveLocales();\nforeach ($locales as $locale) {\n    $data['translation'][$locale] = ['name' => '...'];\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Validate date ranges"}),": Always ensure ",(0,s.jsx)(n.code,{children:"active_from"})," is before or equal to ",(0,s.jsx)(n.code,{children:"active_to"})," when both are provided"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good\nif ($from && $to && strtotime($from) > strtotime($to)) {\n    // Handle error\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use meaningful names"}),": Flow names should be descriptive and unique"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// \u2705 Good\n'name' => 'Order Processing Workflow v2'\n\n// \u274c Bad\n'name' => 'Flow 1'\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Set appropriate defaults"}),": Use ",(0,s.jsx)(n.code,{children:"is_default"})," and ",(0,s.jsx)(n.code,{children:"status"})," appropriately"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Only one flow per subject_type should be default\n'is_default' => true, // Only for the primary flow\n'status' => true, // Active flows only\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow",children:"Flow Service"})," - Learn about flow management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/update-flow-request",children:"UpdateFlowRequest"})," - Flow update validation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/support/flow-picker-builder",children:"FlowPickerBuilder"})," - Flow selection logic"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,i){i.d(n,{R:()=>t,x:()=>a});var l=i(6540);const s={},r=l.createContext(s);function t(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);