"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[500],{28453(e,n,t){t.d(n,{R:()=>l,x:()=>r});var s=t(96540);const a={},i=s.createContext(a);function l(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(i.Provider,{value:n},e.children)}},65274(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"laravel-flow/deep-diving/services/flow-state","title":"FlowState Service","description":"The FlowState service provides CRUD operations for managing workflow states within a flow. States represent different stages in your workflow process.","source":"@site/packages/laravel-flow/deep-diving/services/flow-state.md","sourceDirName":"laravel-flow/deep-diving/services","slug":"/laravel-flow/deep-diving/services/flow-state","permalink":"/packages/laravel-flow/deep-diving/services/flow-state","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/services/flow-state.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"FlowState"},"sidebar":"packagesSidebar","previous":{"title":"Flow","permalink":"/packages/laravel-flow/deep-diving/services/flow"},"next":{"title":"FlowTask","permalink":"/packages/laravel-flow/deep-diving/services/flow-task"}}');var a=t(74848),i=t(28453);const l={sidebar_position:2,sidebar_label:"FlowState"},r="FlowState Service",o={},d=[{value:"Namespace",id:"namespace",level:2},{value:"Facade",id:"facade",level:2},{value:"Basic CRUD Operations",id:"basic-crud-operations",level:2},{value:"Store",id:"store",level:3},{value:"Show",id:"show",level:3},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3},{value:"State Types",id:"state-types",level:2},{value:"Translation Support",id:"translation-support",level:2},{value:"Status Field",id:"status-field",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Direct Service Usage",id:"direct-service-usage",level:2},{value:"Response Format",id:"response-format",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"flowstate-service",children:"FlowState Service"})}),"\n",(0,a.jsx)(n.p,{children:"The FlowState service provides CRUD operations for managing workflow states within a flow. States represent different stages in your workflow process."}),"\n",(0,a.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\Services\\FlowState\n"})}),"\n",(0,a.jsx)(n.h2,{id:"facade",children:"Facade"}),"\n",(0,a.jsx)(n.p,{children:"For convenience, you can use the FlowState Facade:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\FlowState;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"basic-crud-operations",children:"Basic CRUD Operations"}),"\n",(0,a.jsx)(n.h3,{id:"store",children:"Store"}),"\n",(0,a.jsxs)(n.p,{children:["Create a new state within a flow. The state type is automatically set to ",(0,a.jsx)(n.code,{children:"STATE"})," (middle state)."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\FlowState;\n\n$state = FlowState::store($flowId, [\n    'translation' => [\n        'en' => [\n            'name' => 'Processing',\n            'description' => 'Order is being processed',\n        ],\n        'fa' => [\n            'name' => '\u062f\u0631 \u062d\u0627\u0644 \u067e\u0631\u062f\u0627\u0632\u0634',\n            'description' => '\u0633\u0641\u0627\u0631\u0634 \u062f\u0631 \u062d\u0627\u0644 \u067e\u0631\u062f\u0627\u0632\u0634 \u0627\u0633\u062a',\n        ],\n    ],\n    'status' => 'processing',\n    'is_terminal' => false,\n    'color' => '#3b82f6',\n    'icon' => 'cog',\n    'position' => [\n        'x' => 100,\n        'y' => 200,\n    ],\n]);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Available Config Options:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"is_terminal"})," (boolean): Whether this state is a terminal/end state. Default: ",(0,a.jsx)(n.code,{children:"false"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"color"})," (string): Color code for the state (e.g., ",(0,a.jsx)(n.code,{children:"#3b82f6"}),"). Default: configured in ",(0,a.jsx)(n.code,{children:"workflow.state.middle.color"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"icon"})," (string): Icon identifier for the state. Default: configured in ",(0,a.jsx)(n.code,{children:"workflow.state.middle.icon"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"position"})," (array): X and Y coordinates for visual representation:","\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"'position' => [\n    'x' => 100,\n    'y' => 200,\n]\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Minimal Example:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::store($flowId, [\n    'translation' => [\n        'en' => ['name' => 'Pending', 'description' => 'Waiting for approval'],\n    ],\n    'status' => 'pending',\n]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"show",children:"Show"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve a specific state by ID."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::show($stateId);\n\n// With relations\n$state = FlowState::show($stateId, ['flow', 'transitions']);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,a.jsx)(n.p,{children:"Update an existing state."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::update($stateId, [\n    'translation' => [\n        'en' => [\n            'name' => 'In Progress',\n            'description' => 'Order is in progress',\n        ],\n    ],\n    'status' => 'in_progress',\n    'color' => '#10b981',\n]);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Updating Config:"})}),"\n",(0,a.jsx)(n.p,{children:"You can update the config separately:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::update($stateId, [\n    'config' => [\n        'is_terminal' => true,\n        'color' => '#ef4444',\n        'icon' => 'check-circle',\n        'position' => [\n            'x' => 300,\n            'y' => 400,\n        ],\n    ],\n]);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Mark as Terminal:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::update($stateId, [\n    'is_terminal' => true,\n]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"delete",children:"Delete"}),"\n",(0,a.jsxs)(n.p,{children:["Delete a state. ",(0,a.jsx)(n.strong,{children:"Note:"})," START states cannot be deleted and will throw a validation exception."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::delete($stateId);\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Important:"})," Attempting to delete a START state will result in a validation error:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"try {\n    FlowState::delete($startStateId);\n} catch (\\Illuminate\\Validation\\ValidationException $e) {\n    // Cannot delete START state\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"state-types",children:"State Types"}),"\n",(0,a.jsx)(n.p,{children:"FlowState automatically handles different state types:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"START"}),": Entry point of the workflow (created automatically when creating a flow)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"STATE"}),": Middle/intermediate states (default type for manually created states)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"END"}),": Terminal states (marked with ",(0,a.jsx)(n.code,{children:"is_terminal: true"}),")"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"translation-support",children:"Translation Support"}),"\n",(0,a.jsx)(n.p,{children:"States support multi-language translations:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::store($flowId, [\n    'translation' => [\n        'en' => [\n            'name' => 'Approved',\n            'description' => 'Request has been approved',\n        ],\n        'fa' => [\n            'name' => '\u062a\u0627\u06cc\u06cc\u062f \u0634\u062f\u0647',\n            'description' => '\u062f\u0631\u062e\u0648\u0627\u0633\u062a \u062a\u0627\u06cc\u06cc\u062f \u0634\u062f\u0647 \u0627\u0633\u062a',\n        ],\n        'ar' => [\n            'name' => '\u0645\u0648\u0627\u0641\u0642 \u0639\u0644\u064a\u0647',\n            'description' => '\u062a\u0645 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 \u0627\u0644\u0637\u0644\u0628',\n        ],\n    ],\n    'status' => 'approved',\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"status-field",children:"Status Field"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"status"})," field is a unique identifier for the state within the flow. It's used to reference states in transitions and workflow logic."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::store($flowId, [\n    'translation' => [\n        'en' => ['name' => 'Pending Review', 'description' => ''],\n    ],\n    'status' => 'pending_review', // Unique identifier\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,a.jsx)(n.p,{children:"Here's a complete example of creating a workflow with multiple states:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\Flow;\nuse JobMetric\\Flow\\Facades\\FlowState;\n\n// Create the flow\n$flow = Flow::store([\n    'subject_type' => 'App\\Models\\Order',\n    'version' => 1,\n])->getData();\n\n$flowId = $flow->id;\n\n// Get the automatically created START state\n$startState = Flow::getStartState($flowId);\n\n// Create middle states\n$processingState = FlowState::store($flowId, [\n    'translation' => [\n        'en' => ['name' => 'Processing', 'description' => 'Order is being processed'],\n    ],\n    'status' => 'processing',\n    'color' => '#3b82f6',\n    'icon' => 'cog',\n]);\n\n$shippedState = FlowState::store($flowId, [\n    'translation' => [\n        'en' => ['name' => 'Shipped', 'description' => 'Order has been shipped'],\n    ],\n    'status' => 'shipped',\n    'color' => '#8b5cf6',\n    'icon' => 'truck',\n]);\n\n// Create an END state\n$deliveredState = FlowState::store($flowId, [\n    'translation' => [\n        'en' => ['name' => 'Delivered', 'description' => 'Order has been delivered'],\n    ],\n    'status' => 'delivered',\n    'is_terminal' => true, // Mark as terminal/end state\n    'color' => '#10b981',\n    'icon' => 'check-circle',\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"direct-service-usage",children:"Direct Service Usage"}),"\n",(0,a.jsx)(n.p,{children:"If you prefer dependency injection over the Facade:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Services\\FlowState as FlowStateService;\n\nclass YourController\n{\n    public function __construct(\n        protected FlowStateService $flowStateService\n    ) {}\n\n    public function store($flowId)\n    {\n        $state = $this->flowStateService->store($flowId, [\n            'translation' => [...],\n            'status' => 'pending',\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"response-format",children:"Response Format"}),"\n",(0,a.jsx)(n.p,{children:"The service methods return the FlowState model directly (not wrapped in Response like Flow service):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$state = FlowState::store($flowId, [...]);\n\n// Access state properties\n$stateId = $state->id;\n$status = $state->status;\n$config = $state->config;\n$translations = $state->getTranslations();\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/store-flow-state-request",children:"StoreFlowStateRequest"})," - Validation for state creation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/update-flow-state-request",children:"UpdateFlowStateRequest"})," - Validation for state updates"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-state-resource",children:"FlowStateResource"})," - JSON resource for states"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow",children:"Flow Service"})," - Managing workflows"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-transition",children:"FlowTransition Service"})," - Managing transitions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule",children:"CheckStatusInDriverRule"})," - Status validation rule"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/events",children:"Events"})," - State lifecycle events"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);