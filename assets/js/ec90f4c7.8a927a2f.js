"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[5140],{28453(e,n,s){s.d(n,{R:()=>a,x:()=>l});var t=s(96540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},64286(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"laravel-event-system/deep-diving/support/event-bus","title":"EventBus","description":"The EventBus is a central event dispatcher responsible for dispatching domain events either by class instance or by a stable registry key. It decouples callers from concrete event classes, enabling you to dispatch events using stable keys instead of hard-coding class names.","source":"@site/packages/laravel-event-system/deep-diving/support/event-bus.md","sourceDirName":"laravel-event-system/deep-diving/support","slug":"/laravel-event-system/deep-diving/support/event-bus","permalink":"/packages/laravel-event-system/deep-diving/support/event-bus","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-event-system/deep-diving/support/event-bus.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"sidebar_label":"EventBus"},"sidebar":"packagesSidebar","previous":{"title":"EventSystem","permalink":"/packages/laravel-event-system/deep-diving/event-system"},"next":{"title":"EventRegistry","permalink":"/packages/laravel-event-system/deep-diving/support/event-registry"}}');var i=s(74848),r=s(28453);const a={sidebar_position:6,sidebar_label:"EventBus"},l="EventBus",d={},c=[{value:"When to Use EventBus",id:"when-to-use-eventbus",level:2},{value:"Overview",id:"overview",level:2},{value:"Namespace",id:"namespace",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Available Methods",id:"available-methods",level:2},{value:"<code>dispatchByKey(string $key, mixed ...$payload): void</code>",id:"dispatchbykeystring-key-mixed-payload-void",level:3},{value:"<code>dispatch(object $event): void</code>",id:"dispatchobject-event-void",level:3},{value:"Helper Function",id:"helper-function",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration-Based Event Dispatching",id:"configuration-based-event-dispatching",level:3},{value:"Plugin System",id:"plugin-system",level:3},{value:"API Endpoint",id:"api-endpoint",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"eventbus",children:"EventBus"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"EventBus"})," is a central event dispatcher responsible for dispatching domain events either by class instance or by a stable registry key. It decouples callers from concrete event classes, enabling you to dispatch events using stable keys instead of hard-coding class names."]}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-eventbus",children:"When to Use EventBus"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Use ",(0,i.jsx)(n.code,{children:"EventBus"})," when you need:"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Key-based dispatching"}),": Dispatch events using stable keys instead of class names"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Decoupled architecture"}),": Avoid hard-coding event class names in your code"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dynamic event handling"}),": Dispatch events whose classes may not be known at compile time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Event registry integration"}),": Leverage the event registry for key-to-class resolution"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistent event dispatching"}),": Use a single interface for all event dispatching"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example scenarios:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Dispatching events from configuration files"}),"\n",(0,i.jsx)(n.li,{children:"Plugin systems that dispatch events by key"}),"\n",(0,i.jsx)(n.li,{children:"Workflow engines that trigger events dynamically"}),"\n",(0,i.jsx)(n.li,{children:"Rule engines that fire events based on conditions"}),"\n",(0,i.jsx)(n.li,{children:"API endpoints that dispatch events based on request data"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"EventBus"})," provides two methods for dispatching events:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"By Key"}),": Dispatch events using stable keys (resolved via ",(0,i.jsx)(n.code,{children:"EventRegistry"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"By Instance"}),": Dispatch concrete event instances directly"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"JobMetric\\EventSystem\\Support\\EventBus\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(n.p,{children:"Use the facade or inject the service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\EventSystem\\Facades\\EventBus;\n\n// Dispatch by stable key\nEventBus::dispatchByKey('user.registered', $userId, $email, $name);\n\n// Dispatch concrete event instance\n$event = new UserRegistered($userId, $email, $name);\nEventBus::dispatch($event);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"available-methods",children:"Available Methods"}),"\n",(0,i.jsx)(n.h3,{id:"dispatchbykeystring-key-mixed-payload-void",children:(0,i.jsx)(n.code,{children:"dispatchByKey(string $key, mixed ...$payload): void"})}),"\n",(0,i.jsx)(n.p,{children:"Dispatches a domain event by its stable key using the registry to resolve the event class, constructing a new event instance from the provided payload."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$key"})," (string): The stable event key used to look up the event class in the registry"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"...$payload"})," (mixed): The payload passed as constructor arguments to the event class"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"void"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If the key is not registered in the registry, the call is silently ignored"}),"\n",(0,i.jsx)(n.li,{children:"The event class is resolved from the registry"}),"\n",(0,i.jsx)(n.li,{children:"A new event instance is created with the provided payload"}),"\n",(0,i.jsx)(n.li,{children:"The event is dispatched using Laravel's event dispatcher"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\EventSystem\\Facades\\EventBus;\n\n// Register the event first\n$registry = app(\\JobMetric\\EventSystem\\Support\\EventRegistry::class);\n$registry->register(UserRegistered::class);\n\n// Dispatch by key\nEventBus::dispatchByKey('user.registered', 123, 'user@example.com', 'John Doe');\n\n// With multiple payload arguments\nEventBus::dispatchByKey('product.created', $productId, $name, $price, $categoryId);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"dispatchobject-event-void",children:(0,i.jsx)(n.code,{children:"dispatch(object $event): void"})}),"\n",(0,i.jsx)(n.p,{children:"Dispatches a concrete domain event instance using the underlying Laravel dispatcher, allowing callers to work directly with event objects when the class is known."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$event"})," (object): The event instance to be dispatched"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"void"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use JobMetric\\EventSystem\\Facades\\EventBus;\nuse App\\Events\\UserRegistered;\n\n// Create and dispatch event instance\n$event = new UserRegistered(123, 'user@example.com', 'John Doe');\nEventBus::dispatch($event);\n\n// Or use Laravel's event helper\nevent($event);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"helper-function",children:"Helper Function"}),"\n",(0,i.jsx)(n.p,{children:"The package provides a helper function for key-based dispatching:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"eventKey(string $key, mixed ...$payload): void\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Instead of\nEventBus::dispatchByKey('user.registered', $userId, $email, $name);\n\n// You can use\neventKey('user.registered', $userId, $email, $name);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace App\\Services;\n\nuse JobMetric\\EventSystem\\Facades\\EventBus;\nuse JobMetric\\EventSystem\\Support\\EventRegistry;\nuse App\\Events\\UserRegistered;\nuse App\\Events\\OrderCompleted;\n\nclass UserService\n{\n    public function __construct(\n        private EventRegistry $registry\n    ) {}\n\n    public function registerUser(array $data): User\n    {\n        $user = User::create($data);\n\n        // Register event if not already registered\n        if (!$this->registry->has('user.registered')) {\n            $this->registry->register(UserRegistered::class);\n        }\n\n        // Dispatch by key\n        EventBus::dispatchByKey('user.registered', $user->id, $user->email, $user->name);\n\n        return $user;\n    }\n\n    public function completeOrder(Order $order): void\n    {\n        $order->update(['status' => 'completed']);\n\n        // Dispatch by instance\n        $event = new OrderCompleted($order->id, $order->total, $order->user_id);\n        EventBus::dispatch($event);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(n.h3,{id:"configuration-based-event-dispatching",children:"Configuration-Based Event Dispatching"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"class WorkflowEngine\n{\n    public function triggerEvent(string $eventKey, array $data): void\n    {\n        // Dispatch event based on configuration\n        EventBus::dispatchByKey($eventKey, ...$data);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"plugin-system",children:"Plugin System"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'class PluginManager\n{\n    public function firePluginEvent(string $pluginName, string $eventKey, ...$payload): void\n    {\n        $fullKey = "plugin.{$pluginName}.{$eventKey}";\n        \n        // Dispatch if registered\n        if (app(EventRegistry::class)->has($fullKey)) {\n            EventBus::dispatchByKey($fullKey, ...$payload);\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"api-endpoint",children:"API Endpoint"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"class EventController extends Controller\n{\n    public function dispatch(Request $request)\n    {\n        $key = $request->input('event_key');\n        $payload = $request->input('payload', []);\n\n        // Validate event exists\n        $registry = app(EventRegistry::class);\n        if (!$registry->has($key)) {\n            return response()->json(['error' => 'Event not found'], 404);\n        }\n\n        // Dispatch event\n        EventBus::dispatchByKey($key, ...$payload);\n\n        return response()->json(['success' => true]);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Register Events First"}),": Always register events in the registry before dispatching by key"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Keys for Dynamic Events"}),": Use key-based dispatching when event classes are determined at runtime"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Instances for Known Events"}),": Use instance-based dispatching when you know the event class"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Error Handling"}),": Check if event exists before dispatching by key"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Payload Structure"}),": Ensure payload matches event constructor parameters"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-event-system/deep-diving/support/event-registry",children:"EventRegistry"})," - Registry for managing domain events"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-event-system/deep-diving/domain-event",children:"DomainEvent"})," - Domain event contract"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/packages/laravel-event-system/deep-diving/event-system",children:"EventSystem"})," - Service for managing event-listener bindings"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);