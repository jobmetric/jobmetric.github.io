"use strict";(globalThis.webpackChunkjobmetric_document=globalThis.webpackChunkjobmetric_document||[]).push([[9151],{28453(e,n,s){s.d(n,{R:()=>t,x:()=>o});var i=s(96540);const a={},r=i.createContext(a);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(r.Provider,{value:n},e.children)}},30306(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"laravel-flow/deep-diving/services/flow-task","title":"FlowTask Service","description":"The FlowTask service provides CRUD operations for managing tasks within workflow transitions. Tasks are executed when a transition occurs and can be of three types: Restriction, Validation, or Action.","source":"@site/packages/laravel-flow/deep-diving/services/flow-task.md","sourceDirName":"laravel-flow/deep-diving/services","slug":"/laravel-flow/deep-diving/services/flow-task","permalink":"/packages/laravel-flow/deep-diving/services/flow-task","draft":false,"unlisted":false,"editUrl":"https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/services/flow-task.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"FlowTask"},"sidebar":"packagesSidebar","previous":{"title":"FlowState","permalink":"/packages/laravel-flow/deep-diving/services/flow-state"},"next":{"title":"FlowTransition","permalink":"/packages/laravel-flow/deep-diving/services/flow-transition"}}');var a=s(74848),r=s(28453);const t={sidebar_position:3,sidebar_label:"FlowTask"},o="FlowTask Service",l={},d=[{value:"Namespace",id:"namespace",level:2},{value:"Facade",id:"facade",level:2},{value:"Task Types",id:"task-types",level:2},{value:"Basic CRUD Operations",id:"basic-crud-operations",level:2},{value:"Store",id:"store",level:3},{value:"Show",id:"show",level:3},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3},{value:"Task Drivers",id:"task-drivers",level:2},{value:"Get Available Drivers",id:"get-available-drivers",level:3},{value:"Get Driver Details",id:"get-driver-details",level:3},{value:"Resolve Driver",id:"resolve-driver",level:3},{value:"Task Execution Order",id:"task-execution-order",level:2},{value:"Task Status",id:"task-status",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Creating Custom Task Drivers",id:"creating-custom-task-drivers",level:2},{value:"Direct Service Usage",id:"direct-service-usage",level:2},{value:"Response Format",id:"response-format",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"flowtask-service",children:"FlowTask Service"})}),"\n",(0,a.jsxs)(n.p,{children:["The FlowTask service provides CRUD operations for managing tasks within workflow transitions. Tasks are executed when a transition occurs and can be of three types: ",(0,a.jsx)(n.strong,{children:"Restriction"}),", ",(0,a.jsx)(n.strong,{children:"Validation"}),", or ",(0,a.jsx)(n.strong,{children:"Action"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"namespace",children:"Namespace"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"JobMetric\\Flow\\Services\\FlowTask\n"})}),"\n",(0,a.jsx)(n.h2,{id:"facade",children:"Facade"}),"\n",(0,a.jsx)(n.p,{children:"For convenience, you can use the FlowTask Facade:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\FlowTask;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"task-types",children:"Task Types"}),"\n",(0,a.jsx)(n.p,{children:"Tasks are categorized into three types based on when they execute:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Restriction"}),": Check if the transition is allowed (permissions, conditions)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Validation"}),": Validate data before transitioning"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Action"}),": Execute actions when transitioning (notifications, updates, etc.)"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"basic-crud-operations",children:"Basic CRUD Operations"}),"\n",(0,a.jsx)(n.h3,{id:"store",children:"Store"}),"\n",(0,a.jsx)(n.p,{children:"Create a new task for a transition. The task driver class determines the task type automatically."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\FlowTask;\n\n$task = FlowTask::store($flowId, $transitionId, [\n    'driver' => 'App\\Flows\\Tasks\\SendEmailNotification',\n    'config' => [\n        'to' => 'user@example.com',\n        'subject' => 'Order Status Updated',\n        'template' => 'order-status',\n    ],\n    'ordering' => 1,\n    'status' => true,\n]);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$flowId"})," (int): The ID of the flow"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$transitionId"})," (int): The ID of the transition this task belongs to"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"$data"})," (array): Task configuration"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Task Configuration:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"driver"})," (string): The fully qualified class name of the task driver"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"config"})," (array): Configuration specific to the task driver (validated via IOForm)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ordering"})," (int): Execution order within the transition (lower numbers execute first)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"status"})," (bool): Whether the task is enabled (",(0,a.jsx)(n.code,{children:"true"}),") or disabled (",(0,a.jsx)(n.code,{children:"false"}),")"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example with Different Task Types:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Restriction Task - Check user permission\n$restrictionTask = FlowTask::store($flowId, $transitionId, [\n    'driver' => 'App\\Flows\\Tasks\\CheckUserPermission',\n    'config' => [\n        'permission' => 'approve-orders',\n        'role' => 'manager',\n    ],\n    'ordering' => 1,\n    'status' => true,\n]);\n\n// Validation Task - Validate order amount\n$validationTask = FlowTask::store($flowId, $transitionId, [\n    'driver' => 'App\\Flows\\Tasks\\ValidateOrderAmount',\n    'config' => [\n        'min_amount' => 100,\n        'max_amount' => 10000,\n    ],\n    'ordering' => 2,\n    'status' => true,\n]);\n\n// Action Task - Send notification\n$actionTask = FlowTask::store($flowId, $transitionId, [\n    'driver' => 'App\\Flows\\Tasks\\SendEmailNotification',\n    'config' => [\n        'to' => 'customer@example.com',\n        'subject' => 'Your order has been processed',\n    ],\n    'ordering' => 3,\n    'status' => true,\n]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"show",children:"Show"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve a specific task by ID."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$task = FlowTask::show($taskId);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,a.jsx)(n.p,{children:"Update an existing task."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$task = FlowTask::update($taskId, [\n    'config' => [\n        'to' => 'newemail@example.com',\n        'subject' => 'Updated Subject',\n    ],\n    'ordering' => 2,\n    'status' => false, // Disable the task\n]);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Updating Driver:"})}),"\n",(0,a.jsx)(n.p,{children:"You can change the task driver, but the config will be re-validated:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$task = FlowTask::update($taskId, [\n    'driver' => 'App\\Flows\\Tasks\\SendSMSNotification',\n    'config' => [\n        'phone' => '+1234567890',\n        'message' => 'Your order status has changed',\n    ],\n]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"delete",children:"Delete"}),"\n",(0,a.jsx)(n.p,{children:"Delete a task."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$task = FlowTask::delete($taskId);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"task-drivers",children:"Task Drivers"}),"\n",(0,a.jsx)(n.h3,{id:"get-available-drivers",children:"Get Available Drivers"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve all registered task drivers, optionally filtered by subject model and task type."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Get all drivers\n$drivers = FlowTask::drivers();\n\n// Get drivers for a specific subject model\n$drivers = FlowTask::drivers('App\\Models\\Order');\n\n// Get only action tasks\n$actionTasks = FlowTask::drivers('', 'action');\n\n// Get validation and restriction tasks for Order model\n$tasks = FlowTask::drivers('App\\Models\\Order', ['validation', 'restriction']);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Response Format:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"[\n    [\n        'subject' => 'App\\Models\\Order',\n        'title' => 'Order',\n        'tasks' => [\n            [\n                'key' => 'SendEmailNotification',\n                'title' => 'Send Email Notification',\n                'type' => 'action',\n                'class' => 'App\\Flows\\Tasks\\SendEmailNotification',\n                'description' => 'Sends an email notification to the user',\n            ],\n            // ... more tasks\n        ],\n    ],\n    // ... more subjects\n]\n"})}),"\n",(0,a.jsx)(n.h3,{id:"get-driver-details",children:"Get Driver Details"}),"\n",(0,a.jsx)(n.p,{children:"Get detailed information about a specific task driver."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$details = FlowTask::details('App\\Models\\Order', 'SendEmailNotification');\n\n// Returns:\n// [\n//     'key' => 'SendEmailNotification',\n//     'title' => 'Send Email Notification',\n//     'type' => 'action',\n//     'class' => 'App\\Flows\\Tasks\\SendEmailNotification',\n//     'description' => 'Sends an email notification...',\n// ]\n"})}),"\n",(0,a.jsx)(n.h3,{id:"resolve-driver",children:"Resolve Driver"}),"\n",(0,a.jsx)(n.p,{children:"Resolve a task driver instance from the registry by class name."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$driver = FlowTask::resolveDriver('App\\Flows\\Tasks\\SendEmailNotification');\n\nif ($driver) {\n    // Use the driver instance\n    $form = $driver->form();\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"task-execution-order",children:"Task Execution Order"}),"\n",(0,a.jsxs)(n.p,{children:["Tasks are executed in the order specified by the ",(0,a.jsx)(n.code,{children:"ordering"})," field. Lower numbers execute first."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Task 1: Check permission (runs first)\n$task1 = FlowTask::store($flowId, $transitionId, [\n    'driver' => 'App\\Flows\\Tasks\\CheckPermission',\n    'ordering' => 1,\n    'status' => true,\n]);\n\n// Task 2: Validate data (runs second)\n$task2 = FlowTask::store($flowId, $transitionId, [\n    'driver' => 'App\\Flows\\Tasks\\ValidateData',\n    'ordering' => 2,\n    'status' => true,\n]);\n\n// Task 3: Send notification (runs third)\n$task3 = FlowTask::store($flowId, $transitionId, [\n    'driver' => 'App\\Flows\\Tasks\\SendNotification',\n    'ordering' => 3,\n    'status' => true,\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"task-status",children:"Task Status"}),"\n",(0,a.jsxs)(n.p,{children:["Tasks can be enabled or disabled using the ",(0,a.jsx)(n.code,{children:"status"})," field:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Enable a task\n$task = FlowTask::update($taskId, [\n    'status' => true,\n]);\n\n// Disable a task (it won't execute but remains in the database)\n$task = FlowTask::update($taskId, [\n    'status' => false,\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,a.jsx)(n.p,{children:"Here's a complete example of creating a transition with multiple tasks:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Facades\\FlowTransition;\nuse JobMetric\\Flow\\Facades\\FlowTask;\n\n// Create a transition\n$transition = FlowTransition::store($flowId, [\n    'from' => $pendingStateId,\n    'to' => $processingStateId,\n    'slug' => 'start_processing',\n]);\n\n// Add restriction task - check if user can process orders\n$restrictionTask = FlowTask::store($flowId, $transition->id, [\n    'driver' => 'App\\Flows\\Tasks\\CheckCanProcessOrder',\n    'config' => [\n        'required_role' => 'processor',\n    ],\n    'ordering' => 1,\n    'status' => true,\n]);\n\n// Add validation task - validate order data\n$validationTask = FlowTask::store($flowId, $transition->id, [\n    'driver' => 'App\\Flows\\Tasks\\ValidateOrderData',\n    'config' => [\n        'check_inventory' => true,\n        'check_payment' => true,\n    ],\n    'ordering' => 2,\n    'status' => true,\n]);\n\n// Add action task - send email notification\n$actionTask = FlowTask::store($flowId, $transition->id, [\n    'driver' => 'App\\Flows\\Tasks\\SendEmailNotification',\n    'config' => [\n        'to' => 'customer@example.com',\n        'subject' => 'Your order is being processed',\n        'template' => 'order-processing',\n    ],\n    'ordering' => 3,\n    'status' => true,\n]);\n\n// Add another action task - update inventory\n$inventoryTask = FlowTask::store($flowId, $transition->id, [\n    'driver' => 'App\\Flows\\Tasks\\UpdateInventory',\n    'config' => [\n        'decrease_stock' => true,\n    ],\n    'ordering' => 4,\n    'status' => true,\n]);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"creating-custom-task-drivers",children:"Creating Custom Task Drivers"}),"\n",(0,a.jsx)(n.p,{children:"To create a custom task driver, extend one of the abstract task classes:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"namespace App\\Flows\\Tasks;\n\nuse JobMetric\\Flow\\Contracts\\AbstractActionTask;\nuse JobMetric\\Flow\\Support\\FlowTaskContext;\nuse JobMetric\\Flow\\Support\\FlowTaskDefinition;\n\nclass SendEmailNotification extends AbstractActionTask\n{\n    public static function definition(): FlowTaskDefinition\n    {\n        return FlowTaskDefinition::make()\n            ->title('workflow::tasks.send_email.title')\n            ->description('workflow::tasks.send_email.description')\n            ->form(function ($form) {\n                $form->string('to')->required();\n                $form->string('subject')->required();\n                $form->string('template')->default('default');\n            });\n    }\n\n    public function handle(FlowTaskContext $context): void\n    {\n        $config = $this->getConfig();\n        \n        // Send email logic here\n        Mail::to($config['to'])\n            ->send(new OrderStatusMail($config['subject'], $config['template']));\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"direct-service-usage",children:"Direct Service Usage"}),"\n",(0,a.jsx)(n.p,{children:"If you prefer dependency injection over the Facade:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use JobMetric\\Flow\\Services\\FlowTask as FlowTaskService;\n\nclass YourController\n{\n    public function __construct(\n        protected FlowTaskService $flowTaskService\n    ) {}\n\n    public function store($flowId, $transitionId)\n    {\n        $task = $this->flowTaskService->store($flowId, $transitionId, [\n            'driver' => 'App\\Flows\\Tasks\\SendEmailNotification',\n            'config' => [...],\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"response-format",children:"Response Format"}),"\n",(0,a.jsx)(n.p,{children:"The service methods return the FlowTask model directly:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$task = FlowTask::store($flowId, $transitionId, [...]);\n\n// Access task properties\n$taskId = $task->id;\n$driver = $task->driver;\n$config = $task->config;\n$ordering = $task->ordering;\n$status = $task->status;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/store-flow-task-request",children:"StoreFlowTaskRequest"})," - Validation for task creation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/requests/update-flow-task-request",children:"UpdateFlowTaskRequest"})," - Validation for task updates"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/resources/flow-task-resource",children:"FlowTaskResource"})," - JSON resource for tasks"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-task",children:"FlowTask Service"})," - Managing tasks"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/services/flow-transition",children:"FlowTransition Service"})," - Managing transitions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/make-task",children:"MakeTask Command"})," - Creating task drivers"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/support/flow-task-registry",children:"FlowTaskRegistry"})," - Task driver registry"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/support/flow-task-context",children:"FlowTaskContext"})," - Task execution context"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/packages/laravel-flow/deep-diving/events",children:"Events"})," - Task lifecycle events"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);