<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-packages docs-version-current docs-doc-page docs-doc-id-laravel-flow/deep-diving/events" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Events | JobMetric</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jobmetric.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jobmetric.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jobmetric.github.io/packages/laravel-flow/deep-diving/events"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-packages-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-packages-current"><meta data-rh="true" property="og:title" content="Events | JobMetric"><meta data-rh="true" name="description" content="Laravel Flow provides a comprehensive event system that fires domain events for all CRUD operations on Flow entities. These events allow you to hook into the workflow lifecycle and perform additional actions when flows, states, tasks, or transitions are created, updated, or deleted."><meta data-rh="true" property="og:description" content="Laravel Flow provides a comprehensive event system that fires domain events for all CRUD operations on Flow entities. These events allow you to hook into the workflow lifecycle and perform additional actions when flows, states, tasks, or transitions are created, updated, or deleted."><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/events"><link data-rh="true" rel="alternate" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/events" hreflang="en"><link data-rh="true" rel="alternate" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/events" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Laravel Flow","item":"https://jobmetric.github.io/packages/laravel-flow/"},{"@type":"ListItem","position":2,"name":"Events","item":"https://jobmetric.github.io/packages/laravel-flow/deep-diving/events"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="JobMetric RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="JobMetric Atom Feed"><link rel="stylesheet" href="/assets/css/styles.aeeec671.css">
<script src="/assets/js/runtime~main.a8bd2a9e.js" defer="defer"></script>
<script src="/assets/js/main.3c5fb27f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="JobMetric Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="JobMetric Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JobMetric</b></a><div class="navbar__item"><div id="projects-dropdown-container"></div></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/packages/intro">Packages</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/team">Team</a><a href="https://github.com/jobmetric" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/intro"><span title="Packages" class="linkLabel_WmDU">Packages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/contributing"><span title="Contributing" class="linkLabel_WmDU">Contributing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/licence"><span title="License" class="linkLabel_WmDU">License</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/packages/laravel-flow/"><span title="Laravel Flow" class="categoryLinkLabel_W154">Laravel Flow</span></a><button aria-label="Collapse sidebar category &#x27;Laravel Flow&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/intro"><span title="Getting Started" class="linkLabel_WmDU">Getting Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/installation"><span title="Installation" class="linkLabel_WmDU">Installation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/showcase"><span title="Showcase" class="linkLabel_WmDU">Showcase</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/packages/laravel-flow/deep-diving/has-flow"><span title="Deep Diving in Document" class="categoryLinkLabel_W154">Deep Diving in Document</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/has-flow"><span title="HasFlow" class="linkLabel_WmDU">HasFlow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/has-workflow"><span title="HasWorkflow" class="linkLabel_WmDU">HasWorkflow</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/packages/laravel-flow/deep-diving/services/flow"><span title="Services" class="categoryLinkLabel_W154">Services</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/services/flow"><span title="Flow" class="linkLabel_WmDU">Flow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/services/flow-state"><span title="FlowState" class="linkLabel_WmDU">FlowState</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/services/flow-task"><span title="FlowTask" class="linkLabel_WmDU">FlowTask</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/services/flow-transition"><span title="FlowTransition" class="linkLabel_WmDU">FlowTransition</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/make-task"><span title="MakeTask Command" class="linkLabel_WmDU">MakeTask Command</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/transition-result"><span title="TransitionResult DTO" class="linkLabel_WmDU">TransitionResult DTO</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-task-registry"><span title="Support" class="categoryLinkLabel_W154">Support</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-task-registry"><span title="FlowTaskRegistry" class="linkLabel_WmDU">FlowTaskRegistry</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-picker"><span title="FlowPicker" class="linkLabel_WmDU">FlowPicker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-picker-builder"><span title="FlowPickerBuilder" class="linkLabel_WmDU">FlowPickerBuilder</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-task-context"><span title="FlowTaskContext" class="linkLabel_WmDU">FlowTaskContext</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/restriction-result"><span title="RestrictionResult" class="linkLabel_WmDU">RestrictionResult</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule"><span title="Rules" class="categoryLinkLabel_W154">Rules</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule"><span title="CheckStatusInDriverRule" class="linkLabel_WmDU">CheckStatusInDriverRule</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/packages/laravel-flow/deep-diving/events"><span title="Events" class="linkLabel_WmDU">Events</span></a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/packages/laravel-flow/"><span>Laravel Flow</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deep Diving in Document</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Events</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Events</h1></header>
<p>Laravel Flow provides a comprehensive event system that fires domain events for all CRUD operations on Flow entities. These events allow you to hook into the workflow lifecycle and perform additional actions when flows, states, tasks, or transitions are created, updated, or deleted.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>The event system in Laravel Flow:</p>
<ul>
<li class=""><strong>Fires automatically</strong> during CRUD operations</li>
<li class=""><strong>Provides model instances</strong> in event payloads</li>
<li class=""><strong>Uses DomainEvent interface</strong> for consistency</li>
<li class=""><strong>Supports event listeners</strong> for custom logic</li>
<li class=""><strong>Enables event-driven architecture</strong> for workflow management</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-structure">Event Structure<a href="#event-structure" class="hash-link" aria-label="Direct link to Event Structure" title="Direct link to Event Structure" translate="no">​</a></h2>
<p>All events in Laravel Flow:</p>
<ul>
<li class="">Implement <code>JobMetric\EventSystem\Contracts\DomainEvent</code></li>
<li class="">Are <code>readonly</code> classes for immutability</li>
<li class="">Contain the affected model instance</li>
<li class="">Provide a stable <code>key()</code> method</li>
<li class="">Include metadata via <code>definition()</code> method</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="base-event-structure">Base Event Structure<a href="#base-event-structure" class="hash-link" aria-label="Direct link to Base Event Structure" title="Direct link to Base Event Structure" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">readonly class FlowStoreEvent implements DomainEvent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function __construct(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public Flow $flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function key(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &#x27;flow.stored&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function definition(): DomainEventDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new DomainEventDefinition(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self::key(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow::base.events.flow_stored.group&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow::base.events.flow_stored.title&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow::base.events.flow_stored.description&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;fas fa-save&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [&#x27;flow&#x27;, &#x27;storage&#x27;, &#x27;management&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="available-events">Available Events<a href="#available-events" class="hash-link" aria-label="Direct link to Available Events" title="Direct link to Available Events" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-events">Flow Events<a href="#flow-events" class="hash-link" aria-label="Direct link to Flow Events" title="Direct link to Flow Events" translate="no">​</a></h3>
<p>Events fired for Flow entity CRUD operations.</p>
<table><thead><tr><th>Event Class</th><th>Event Key</th><th>Description</th><th>Payload</th><th>Triggered When</th></tr></thead><tbody><tr><td><code>FlowStoreEvent</code></td><td><code>flow.stored</code></td><td>Fired when a new Flow is created</td><td><code>Flow $flow</code></td><td><code>Flow::store()</code></td></tr><tr><td><code>FlowUpdateEvent</code></td><td><code>flow.updated</code></td><td>Fired when an existing Flow is updated</td><td><code>Flow $flow</code></td><td><code>Flow::update()</code></td></tr><tr><td><code>FlowDeleteEvent</code></td><td><code>flow.deleted</code></td><td>Fired when a Flow is soft-deleted</td><td><code>Flow $flow</code></td><td><code>Flow::destroy()</code></td></tr><tr><td><code>FlowRestoreEvent</code></td><td><code>flow.restored</code></td><td>Fired when a soft-deleted Flow is restored</td><td><code>Flow $flow</code></td><td><code>Flow::restore()</code></td></tr><tr><td><code>FlowForceDeleteEvent</code></td><td><code>flow.force_deleted</code></td><td>Fired when a Flow is permanently deleted</td><td><code>Flow $flow</code></td><td><code>Flow::forceDelete()</code></td></tr></tbody></table>
<p><strong>Namespace:</strong> <code>JobMetric\Flow\Events\Flow\*</code></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flowstate-events">FlowState Events<a href="#flowstate-events" class="hash-link" aria-label="Direct link to FlowState Events" title="Direct link to FlowState Events" translate="no">​</a></h3>
<p>Events fired for FlowState entity CRUD operations.</p>
<table><thead><tr><th>Event Class</th><th>Event Key</th><th>Description</th><th>Payload</th><th>Triggered When</th></tr></thead><tbody><tr><td><code>FlowStateStoreEvent</code></td><td><code>flow_state.stored</code></td><td>Fired when a new FlowState is created</td><td><code>FlowState $flowState</code></td><td><code>FlowState::store()</code></td></tr><tr><td><code>FlowStateUpdateEvent</code></td><td><code>flow_state.updated</code></td><td>Fired when an existing FlowState is updated</td><td><code>FlowState $flowState</code></td><td><code>FlowState::update()</code></td></tr><tr><td><code>FlowStateDeleteEvent</code></td><td><code>flow_state.deleted</code></td><td>Fired when a FlowState is deleted</td><td><code>FlowState $flowState</code></td><td><code>FlowState::destroy()</code></td></tr></tbody></table>
<p><strong>Namespace:</strong> <code>JobMetric\Flow\Events\FlowState\*</code></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flowtask-events">FlowTask Events<a href="#flowtask-events" class="hash-link" aria-label="Direct link to FlowTask Events" title="Direct link to FlowTask Events" translate="no">​</a></h3>
<p>Events fired for FlowTask entity CRUD operations.</p>
<table><thead><tr><th>Event Class</th><th>Event Key</th><th>Description</th><th>Payload</th><th>Triggered When</th></tr></thead><tbody><tr><td><code>FlowTaskStoreEvent</code></td><td><code>flow_task.stored</code></td><td>Fired when a new FlowTask is created</td><td><code>FlowTask $flowTask</code></td><td><code>FlowTask::store()</code></td></tr><tr><td><code>FlowTaskUpdateEvent</code></td><td><code>flow_task.updated</code></td><td>Fired when an existing FlowTask is updated</td><td><code>FlowTask $flowTask</code></td><td><code>FlowTask::update()</code></td></tr><tr><td><code>FlowTaskDeleteEvent</code></td><td><code>flow_task.deleted</code></td><td>Fired when a FlowTask is deleted</td><td><code>FlowTask $flowTask</code></td><td><code>FlowTask::destroy()</code></td></tr></tbody></table>
<p><strong>Namespace:</strong> <code>JobMetric\Flow\Events\FlowTask\*</code></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flowtransition-events">FlowTransition Events<a href="#flowtransition-events" class="hash-link" aria-label="Direct link to FlowTransition Events" title="Direct link to FlowTransition Events" translate="no">​</a></h3>
<p>Events fired for FlowTransition entity CRUD operations.</p>
<table><thead><tr><th>Event Class</th><th>Event Key</th><th>Description</th><th>Payload</th><th>Triggered When</th></tr></thead><tbody><tr><td><code>FlowTransitionStoreEvent</code></td><td><code>flow_transition.stored</code></td><td>Fired when a new FlowTransition is created</td><td><code>FlowTransition $flowTransition</code></td><td><code>FlowTransition::store()</code></td></tr><tr><td><code>FlowTransitionUpdateEvent</code></td><td><code>flow_transition.updated</code></td><td>Fired when an existing FlowTransition is updated</td><td><code>FlowTransition $flowTransition</code></td><td><code>FlowTransition::update()</code></td></tr><tr><td><code>FlowTransitionDeleteEvent</code></td><td><code>flow_transition.deleted</code></td><td>Fired when a FlowTransition is deleted</td><td><code>FlowTransition $flowTransition</code></td><td><code>FlowTransition::destroy()</code></td></tr></tbody></table>
<p><strong>Namespace:</strong> <code>JobMetric\Flow\Events\FlowTransition\*</code></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="listening-to-events">Listening to Events<a href="#listening-to-events" class="hash-link" aria-label="Direct link to Listening to Events" title="Direct link to Listening to Events" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="method-1-event-listeners-in-service-provider">Method 1: Event Listeners in Service Provider<a href="#method-1-event-listeners-in-service-provider" class="hash-link" aria-label="Direct link to Method 1: Event Listeners in Service Provider" title="Direct link to Method 1: Event Listeners in Service Provider" translate="no">​</a></h3>
<p>Register event listeners in a service provider:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Providers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowState\FlowStateStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class EventServiceProvider extends ServiceProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $listen = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowStoreEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            \App\Listeners\Flow\LogFlowCreation::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            \App\Listeners\Flow\InvalidateFlowCache::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowUpdateEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            \App\Listeners\Flow\LogFlowUpdate::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            \App\Listeners\Flow\InvalidateFlowCache::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowStateStoreEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            \App\Listeners\FlowState\UpdateFlowVisualization::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function boot(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::boot();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="method-2-using-event-facade">Method 2: Using Event Facade<a href="#method-2-using-event-facade" class="hash-link" aria-label="Direct link to Method 2: Using Event Facade" title="Direct link to Method 2: Using Event Facade" translate="no">​</a></h3>
<p>Listen to events using the Event facade:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Event;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Event::listen(FlowStoreEvent::class, function (FlowStoreEvent $event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Perform actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Log::info(&#x27;Flow created&#x27;, [&#x27;flow_id&#x27; =&gt; $flow-&gt;id]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Cache::forget(&quot;flow_{$flow-&gt;id}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="method-3-using-event-subscribers">Method 3: Using Event Subscribers<a href="#method-3-using-event-subscribers" class="hash-link" aria-label="Direct link to Method 3: Using Event Subscribers" title="Direct link to Method 3: Using Event Subscribers" translate="no">​</a></h3>
<p>Create event subscribers for multiple events:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Events\Dispatcher;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class FlowEventSubscriber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowStored(FlowStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Log::info(&#x27;Flow stored&#x27;, [&#x27;flow_id&#x27; =&gt; $flow-&gt;id]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowUpdated(FlowUpdateEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Log::info(&#x27;Flow updated&#x27;, [&#x27;flow_id&#x27; =&gt; $flow-&gt;id]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowDeleted(FlowDeleteEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Log::info(&#x27;Flow deleted&#x27;, [&#x27;flow_id&#x27; =&gt; $flow-&gt;id]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function subscribe(Dispatcher $events): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $events-&gt;listen(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowStoreEvent::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [FlowEventSubscriber::class, &#x27;handleFlowStored&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $events-&gt;listen(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowUpdateEvent::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [FlowEventSubscriber::class, &#x27;handleFlowUpdated&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $events-&gt;listen(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowDeleteEvent::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [FlowEventSubscriber::class, &#x27;handleFlowDeleted&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Register the subscriber:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Providers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Listeners\FlowEventSubscriber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class EventServiceProvider extends ServiceProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $subscribe = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowEventSubscriber::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-examples">Complete Examples<a href="#complete-examples" class="hash-link" aria-label="Direct link to Complete Examples" title="Direct link to Complete Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-1-cache-invalidation-on-flow-changes">Example 1: Cache Invalidation on Flow Changes<a href="#example-1-cache-invalidation-on-flow-changes" class="hash-link" aria-label="Direct link to Example 1: Cache Invalidation on Flow Changes" title="Direct link to Example 1: Cache Invalidation on Flow Changes" translate="no">​</a></h3>
<p>Invalidate cache when flows are modified:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Cache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class InvalidateFlowCache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handle(FlowStoreEvent|FlowUpdateEvent|FlowDeleteEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Invalidate specific flow cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Cache::forget(&quot;flow_{$flow-&gt;id}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Cache::forget(&quot;flow_{$flow-&gt;id}_states&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Cache::forget(&quot;flow_{$flow-&gt;id}_transitions&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Invalidate flow list cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Cache::forget(&quot;flows_{$flow-&gt;subject_type}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Clear all flow caches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        forgetFlowCache();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-2-audit-logging">Example 2: Audit Logging<a href="#example-2-audit-logging" class="hash-link" aria-label="Direct link to Example 2: Audit Logging" title="Direct link to Example 2: Audit Logging" translate="no">​</a></h3>
<p>Log all flow operations for audit trail:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Models\AuditLog;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Auth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class AuditFlowOperations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowStored(FlowStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;logAudit(&#x27;created&#x27;, $event-&gt;flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowUpdated(FlowUpdateEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;logAudit(&#x27;updated&#x27;, $event-&gt;flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowDeleted(FlowDeleteEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;logAudit(&#x27;deleted&#x27;, $event-&gt;flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function logAudit(string $action, $flow): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AuditLog::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;user_id&#x27; =&gt; Auth::id(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;action&#x27; =&gt; &quot;flow.{$action}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;model_type&#x27; =&gt; get_class($flow),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;model_id&#x27; =&gt; $flow-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;changes&#x27; =&gt; $flow-&gt;getChanges(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;ip_address&#x27; =&gt; request()-&gt;ip(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-3-notification-system">Example 3: Notification System<a href="#example-3-notification-system" class="hash-link" aria-label="Direct link to Example 3: Notification System" title="Direct link to Example 3: Notification System" translate="no">​</a></h3>
<p>Send notifications when flows are created or updated:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Notifications\FlowCreated;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Notifications\FlowUpdated;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Notification;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class NotifyFlowChanges</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowStored(FlowStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Notify administrators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $admins = User::whereHas(&#x27;roles&#x27;, function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $query-&gt;where(&#x27;name&#x27;, &#x27;admin&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })-&gt;get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Notification::send($admins, new FlowCreated($flow));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowUpdated(FlowUpdateEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Notify flow owners</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($flow-&gt;created_by) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $owner = User::find($flow-&gt;created_by);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($owner) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $owner-&gt;notify(new FlowUpdated($flow));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-4-search-index-update">Example 4: Search Index Update<a href="#example-4-search-index-update" class="hash-link" aria-label="Direct link to Example 4: Search Index Update" title="Direct link to Example 4: Search Index Update" translate="no">​</a></h3>
<p>Update search index when flows change:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Services\SearchService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class UpdateSearchIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function __construct(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protected SearchService $searchService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowStored(FlowStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;searchService-&gt;indexFlow($event-&gt;flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowUpdated(FlowUpdateEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;searchService-&gt;updateFlow($event-&gt;flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleFlowDeleted(FlowDeleteEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;searchService-&gt;removeFlow($event-&gt;flow-&gt;id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-5-state-change-tracking">Example 5: State Change Tracking<a href="#example-5-state-change-tracking" class="hash-link" aria-label="Direct link to Example 5: State Change Tracking" title="Direct link to Example 5: State Change Tracking" translate="no">​</a></h3>
<p>Track state changes when FlowStates are modified:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\FlowState;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Models\StateChangeHistory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowState\FlowStateStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowState\FlowStateUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowState\FlowStateDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class TrackStateChanges</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleStateStored(FlowStateStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;recordChange(&#x27;created&#x27;, $event-&gt;flowState);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleStateUpdated(FlowStateUpdateEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;recordChange(&#x27;updated&#x27;, $event-&gt;flowState);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleStateDeleted(FlowStateDeleteEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;recordChange(&#x27;deleted&#x27;, $event-&gt;flowState);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function recordChange(string $action, $state): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StateChangeHistory::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow_id&#x27; =&gt; $state-&gt;flow_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;state_id&#x27; =&gt; $state-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;action&#x27; =&gt; $action,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;changes&#x27; =&gt; $state-&gt;getChanges(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;performed_by&#x27; =&gt; auth()-&gt;id(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;performed_at&#x27; =&gt; now(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-6-task-execution-monitoring">Example 6: Task Execution Monitoring<a href="#example-6-task-execution-monitoring" class="hash-link" aria-label="Direct link to Example 6: Task Execution Monitoring" title="Direct link to Example 6: Task Execution Monitoring" translate="no">​</a></h3>
<p>Monitor task changes for analytics:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\FlowTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Services\AnalyticsService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTask\FlowTaskStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTask\FlowTaskUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTask\FlowTaskDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MonitorTaskChanges</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function __construct(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protected AnalyticsService $analytics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleTaskStored(FlowTaskStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $task = $event-&gt;flowTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;analytics-&gt;track(&#x27;flow_task.created&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;task_id&#x27; =&gt; $task-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow_id&#x27; =&gt; $task-&gt;flow_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;transition_id&#x27; =&gt; $task-&gt;flow_transition_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;driver&#x27; =&gt; $task-&gt;driver,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;type&#x27; =&gt; $task-&gt;type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleTaskUpdated(FlowTaskUpdateEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $task = $event-&gt;flowTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;analytics-&gt;track(&#x27;flow_task.updated&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;task_id&#x27; =&gt; $task-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;changes&#x27; =&gt; $task-&gt;getChanges(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleTaskDeleted(FlowTaskDeleteEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $task = $event-&gt;flowTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;analytics-&gt;track(&#x27;flow_task.deleted&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;task_id&#x27; =&gt; $task-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-7-transition-validation-logging">Example 7: Transition Validation Logging<a href="#example-7-transition-validation-logging" class="hash-link" aria-label="Direct link to Example 7: Transition Validation Logging" title="Direct link to Example 7: Transition Validation Logging" translate="no">​</a></h3>
<p>Log transition changes for debugging:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\FlowTransition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Log;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTransition\FlowTransitionStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTransition\FlowTransitionUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTransition\FlowTransitionDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class LogTransitionChanges</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleTransitionStored(FlowTransitionStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $transition = $event-&gt;flowTransition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Log::info(&#x27;Flow transition created&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;transition_id&#x27; =&gt; $transition-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow_id&#x27; =&gt; $transition-&gt;flow_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;from_state&#x27; =&gt; $transition-&gt;from,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;to_state&#x27; =&gt; $transition-&gt;to,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;slug&#x27; =&gt; $transition-&gt;slug,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleTransitionUpdated(FlowTransitionUpdateEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $transition = $event-&gt;flowTransition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Log::info(&#x27;Flow transition updated&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;transition_id&#x27; =&gt; $transition-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;changes&#x27; =&gt; $transition-&gt;getChanges(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handleTransitionDeleted(FlowTransitionDeleteEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $transition = $event-&gt;flowTransition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Log::warning(&#x27;Flow transition deleted&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;transition_id&#x27; =&gt; $transition-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow_id&#x27; =&gt; $transition-&gt;flow_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-8-complete-event-listener-setup">Example 8: Complete Event Listener Setup<a href="#example-8-complete-event-listener-setup" class="hash-link" aria-label="Direct link to Example 8: Complete Event Listener Setup" title="Direct link to Example 8: Complete Event Listener Setup" translate="no">​</a></h3>
<p>Complete setup for all flow events:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Providers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Listeners\Flow\AuditFlowOperations;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Listeners\Flow\InvalidateFlowCache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Listeners\Flow\NotifyFlowChanges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Listeners\FlowState\TrackStateChanges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Listeners\FlowTask\MonitorTaskChanges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Listeners\FlowTransition\LogTransitionChanges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowState\FlowStateDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowState\FlowStateStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowState\FlowStateUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTask\FlowTaskDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTask\FlowTaskStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTask\FlowTaskUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTransition\FlowTransitionDeleteEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTransition\FlowTransitionStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\FlowTransition\FlowTransitionUpdateEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class EventServiceProvider extends ServiceProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $listen = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Flow events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowStoreEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AuditFlowOperations::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            InvalidateFlowCache::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            NotifyFlowChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowUpdateEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AuditFlowOperations::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            InvalidateFlowCache::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            NotifyFlowChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowDeleteEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AuditFlowOperations::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            InvalidateFlowCache::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // FlowState events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowStateStoreEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TrackStateChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowStateUpdateEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TrackStateChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowStateDeleteEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TrackStateChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // FlowTask events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowTaskStoreEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MonitorTaskChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowTaskUpdateEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MonitorTaskChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowTaskDeleteEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MonitorTaskChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // FlowTransition events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowTransitionStoreEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LogTransitionChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowTransitionUpdateEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LogTransitionChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowTransitionDeleteEvent::class =&gt; [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LogTransitionChanges::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function boot(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::boot();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-timing">Event Timing<a href="#event-timing" class="hash-link" aria-label="Direct link to Event Timing" title="Direct link to Event Timing" translate="no">​</a></h2>
<p>Events are fired <strong>after</strong> the database operation completes:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Execution order:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 1. Validate input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. Perform database operation (create/update/delete)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 3. Fire event ← Event fired here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 4. Return response</span><br></span></code></pre></div></div>
<p>This means:</p>
<ul>
<li class="">The model is <strong>saved</strong> to database before event fires</li>
<li class="">You can access <strong>fresh model data</strong> in listeners</li>
<li class="">Database transaction is <strong>committed</strong> before event fires</li>
<li class="">Events are <strong>synchronous</strong> by default (can be queued)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="queued-events">Queued Events<a href="#queued-events" class="hash-link" aria-label="Direct link to Queued Events" title="Direct link to Queued Events" translate="no">​</a></h2>
<p>You can queue events for asynchronous processing:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Listeners\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Contracts\Queue\ShouldQueue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ProcessFlowAsync implements ShouldQueue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handle(FlowStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $flow = $event-&gt;flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Heavy processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;generateFlowDocumentation($flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;updateSearchIndex($flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;sendNotifications($flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h2>
<ol>
<li class="">
<p><strong>Keep Listeners Lightweight</strong>: Perform heavy operations asynchronously</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Good: Queue heavy operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class HeavyOperationListener implements ShouldQueue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handle($event) { /* ... */ }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ Bad: Blocking operations in listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class HeavyOperationListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function handle($event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sleep(10); // Blocks execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Handle Failures Gracefully</strong>: Use try-catch in listeners</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function handle(FlowStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Operation that might fail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;externalService-&gt;sync($event-&gt;flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (\Exception $e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Log::error(&#x27;Failed to sync flow&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow_id&#x27; =&gt; $event-&gt;flow-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;error&#x27; =&gt; $e-&gt;getMessage(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Avoid Circular Events</strong>: Don&#x27;t trigger events that cause the same event</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ Bad: Circular event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function handle(FlowStoreEvent $event): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // This will fire FlowStoreEvent again!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Flow::store([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Use Event Keys for Filtering</strong>: Filter events by key if needed</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Event::listen(function ($event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (method_exists($event, &#x27;key&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $key = $event::key();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (str_starts_with($key, &#x27;flow.&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Handle flow events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Test Event Listeners</strong>: Write tests for your listeners</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function test_flow_store_event_triggers_cache_invalidation(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Event::fake();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Flow::store([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Event::assertDispatched(FlowStoreEvent::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-events">Testing Events<a href="#testing-events" class="hash-link" aria-label="Direct link to Testing Events" title="Direct link to Testing Events" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fake-events-in-tests">Fake Events in Tests<a href="#fake-events-in-tests" class="hash-link" aria-label="Direct link to Fake Events in Tests" title="Direct link to Fake Events in Tests" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Event;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Events\Flow\FlowStoreEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function test_flow_creation_fires_event(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Event::fake();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $flow = Flow::store([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Event::assertDispatched(FlowStoreEvent::class, function ($event) use ($flow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $event-&gt;flow-&gt;id === $flow-&gt;id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="assert-event-not-dispatched">Assert Event Not Dispatched<a href="#assert-event-not-dispatched" class="hash-link" aria-label="Direct link to Assert Event Not Dispatched" title="Direct link to Assert Event Not Dispatched" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Event::fake();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Perform operation that shouldn&#x27;t fire event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::query()-&gt;where(&#x27;id&#x27;, 999)-&gt;delete();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Event::assertNotDispatched(FlowDeleteEvent::class);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="assert-multiple-events">Assert Multiple Events<a href="#assert-multiple-events" class="hash-link" aria-label="Direct link to Assert Multiple Events" title="Direct link to Assert Multiple Events" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Event::fake();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::update($id, [...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Event::assertDispatched(FlowStoreEvent::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Event::assertDispatched(FlowUpdateEvent::class);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related-documentation">Related Documentation<a href="#related-documentation" class="hash-link" aria-label="Direct link to Related Documentation" title="Direct link to Related Documentation" translate="no">​</a></h2>
<ul>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow">Flow Service</a> - Learn about flow management</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow-state">FlowState Service</a> - Learn about state management</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow-task">FlowTask Service</a> - Learn about task management</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow-transition">FlowTransition Service</a> - Learn about transition management</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/events.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CheckStatusInDriverRule</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#event-structure" class="table-of-contents__link toc-highlight">Event Structure</a><ul><li><a href="#base-event-structure" class="table-of-contents__link toc-highlight">Base Event Structure</a></li></ul></li><li><a href="#available-events" class="table-of-contents__link toc-highlight">Available Events</a><ul><li><a href="#flow-events" class="table-of-contents__link toc-highlight">Flow Events</a></li><li><a href="#flowstate-events" class="table-of-contents__link toc-highlight">FlowState Events</a></li><li><a href="#flowtask-events" class="table-of-contents__link toc-highlight">FlowTask Events</a></li><li><a href="#flowtransition-events" class="table-of-contents__link toc-highlight">FlowTransition Events</a></li></ul></li><li><a href="#listening-to-events" class="table-of-contents__link toc-highlight">Listening to Events</a><ul><li><a href="#method-1-event-listeners-in-service-provider" class="table-of-contents__link toc-highlight">Method 1: Event Listeners in Service Provider</a></li><li><a href="#method-2-using-event-facade" class="table-of-contents__link toc-highlight">Method 2: Using Event Facade</a></li><li><a href="#method-3-using-event-subscribers" class="table-of-contents__link toc-highlight">Method 3: Using Event Subscribers</a></li></ul></li><li><a href="#complete-examples" class="table-of-contents__link toc-highlight">Complete Examples</a><ul><li><a href="#example-1-cache-invalidation-on-flow-changes" class="table-of-contents__link toc-highlight">Example 1: Cache Invalidation on Flow Changes</a></li><li><a href="#example-2-audit-logging" class="table-of-contents__link toc-highlight">Example 2: Audit Logging</a></li><li><a href="#example-3-notification-system" class="table-of-contents__link toc-highlight">Example 3: Notification System</a></li><li><a href="#example-4-search-index-update" class="table-of-contents__link toc-highlight">Example 4: Search Index Update</a></li><li><a href="#example-5-state-change-tracking" class="table-of-contents__link toc-highlight">Example 5: State Change Tracking</a></li><li><a href="#example-6-task-execution-monitoring" class="table-of-contents__link toc-highlight">Example 6: Task Execution Monitoring</a></li><li><a href="#example-7-transition-validation-logging" class="table-of-contents__link toc-highlight">Example 7: Transition Validation Logging</a></li><li><a href="#example-8-complete-event-listener-setup" class="table-of-contents__link toc-highlight">Example 8: Complete Event Listener Setup</a></li></ul></li><li><a href="#event-timing" class="table-of-contents__link toc-highlight">Event Timing</a></li><li><a href="#queued-events" class="table-of-contents__link toc-highlight">Queued Events</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#testing-events" class="table-of-contents__link toc-highlight">Testing Events</a><ul><li><a href="#fake-events-in-tests" class="table-of-contents__link toc-highlight">Fake Events in Tests</a></li><li><a href="#assert-event-not-dispatched" class="table-of-contents__link toc-highlight">Assert Event Not Dispatched</a></li><li><a href="#assert-multiple-events" class="table-of-contents__link toc-highlight">Assert Multiple Events</a></li></ul></li><li><a href="#related-documentation" class="table-of-contents__link toc-highlight">Related Documentation</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 JobMetric.</div></div></div></footer></div>
</body>
</html>