<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-packages docs-version-current docs-doc-page docs-doc-id-laravel-flow/deep-diving/has-workflow" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">HasWorkflow Trait | JobMetric</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jobmetric.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jobmetric.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jobmetric.github.io/packages/laravel-flow/deep-diving/has-workflow"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-packages-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-packages-current"><meta data-rh="true" property="og:title" content="HasWorkflow Trait | JobMetric"><meta data-rh="true" name="description" content="The HasWorkflow trait binds an Eloquent model to a workflow flow, automatically selecting and binding the appropriate flow when a model is created. This trait provides a seamless way to integrate workflow management into your models."><meta data-rh="true" property="og:description" content="The HasWorkflow trait binds an Eloquent model to a workflow flow, automatically selecting and binding the appropriate flow when a model is created. This trait provides a seamless way to integrate workflow management into your models."><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/has-workflow"><link data-rh="true" rel="alternate" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/has-workflow" hreflang="en"><link data-rh="true" rel="alternate" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/has-workflow" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Laravel Flow","item":"https://jobmetric.github.io/packages/laravel-flow/"},{"@type":"ListItem","position":2,"name":"HasWorkflow","item":"https://jobmetric.github.io/packages/laravel-flow/deep-diving/has-workflow"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="JobMetric RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="JobMetric Atom Feed"><link rel="stylesheet" href="/assets/css/styles.51ee72d6.css">
<script src="/assets/js/runtime~main.ba8ff767.js" defer="defer"></script>
<script src="/assets/js/main.4cda453d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="JobMetric Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="JobMetric Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JobMetric</b></a><div class="navbar__item"><div id="projects-dropdown-container"></div></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/packages/intro">Packages</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/team">Team</a><a href="https://github.com/jobmetric" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/intro"><span title="Packages" class="linkLabel_WmDU">Packages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/contributing"><span title="Contributing" class="linkLabel_WmDU">Contributing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/licence"><span title="License" class="linkLabel_WmDU">License</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/packages/laravel-flow/"><span title="Laravel Flow" class="categoryLinkLabel_W154">Laravel Flow</span></a><button aria-label="Collapse sidebar category &#x27;Laravel Flow&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/intro"><span title="Getting Started" class="linkLabel_WmDU">Getting Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/installation"><span title="Installation" class="linkLabel_WmDU">Installation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/showcase"><span title="Showcase" class="linkLabel_WmDU">Showcase</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/packages/laravel-flow/deep-diving/has-workflow"><span title="Deep Diving in Document" class="categoryLinkLabel_W154">Deep Diving in Document</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/packages/laravel-flow/deep-diving/has-workflow"><span title="HasWorkflow" class="linkLabel_WmDU">HasWorkflow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/has-flow"><span title="HasFlow" class="linkLabel_WmDU">HasFlow</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/services/flow"><span title="Services" class="categoryLinkLabel_W154">Services</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/make-task"><span title="MakeTask Command" class="linkLabel_WmDU">MakeTask Command</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-task-registry"><span title="Support" class="categoryLinkLabel_W154">Support</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/requests/store-flow-request"><span title="Requests" class="categoryLinkLabel_W154">Requests</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/resources/flow-resource"><span title="Resources" class="categoryLinkLabel_W154">Resources</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/events"><span title="Events" class="linkLabel_WmDU">Events</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/transition-result"><span title="TransitionResult DTO" class="linkLabel_WmDU">TransitionResult DTO</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule"><span title="Rules" class="categoryLinkLabel_W154">Rules</span></a></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-translation/"><span title="Laravel Translation" class="categoryLinkLabel_W154">Laravel Translation</span></a><button aria-label="Expand sidebar category &#x27;Laravel Translation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-event-system/"><span title="Laravel Event System" class="categoryLinkLabel_W154">Laravel Event System</span></a><button aria-label="Expand sidebar category &#x27;Laravel Event System&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-env-modifier/"><span title="Laravel Env Modifier" class="categoryLinkLabel_W154">Laravel Env Modifier</span></a><button aria-label="Expand sidebar category &#x27;Laravel Env Modifier&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-metadata/"><span title="Laravel Metadata" class="categoryLinkLabel_W154">Laravel Metadata</span></a><button aria-label="Expand sidebar category &#x27;Laravel Metadata&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-custom-field/"><span title="Laravel Custom Field" class="categoryLinkLabel_W154">Laravel Custom Field</span></a><button aria-label="Expand sidebar category &#x27;Laravel Custom Field&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-form/"><span title="Laravel Form" class="categoryLinkLabel_W154">Laravel Form</span></a><button aria-label="Expand sidebar category &#x27;Laravel Form&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-reaction/"><span title="Laravel Reaction" class="categoryLinkLabel_W154">Laravel Reaction</span></a><button aria-label="Expand sidebar category &#x27;Laravel Reaction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-star/"><span title="Laravel Star" class="categoryLinkLabel_W154">Laravel Star</span></a><button aria-label="Expand sidebar category &#x27;Laravel Star&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-language/"><span title="Laravel Language" class="categoryLinkLabel_W154">Laravel Language</span></a><button aria-label="Expand sidebar category &#x27;Laravel Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-url/"><span title="Laravel URL" class="categoryLinkLabel_W154">Laravel URL</span></a><button aria-label="Expand sidebar category &#x27;Laravel URL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/packages/laravel-flow/"><span>Laravel Flow</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deep Diving in Document</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">HasWorkflow</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>HasWorkflow Trait</h1></header>
<p>The <code>HasWorkflow</code> trait binds an Eloquent model to a workflow flow, automatically selecting and binding the appropriate flow when a model is created. This trait provides a seamless way to integrate workflow management into your models.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-use-hasworkflow">When to Use HasWorkflow<a href="#when-to-use-hasworkflow" class="hash-link" aria-label="Direct link to When to Use HasWorkflow" title="Direct link to When to Use HasWorkflow" translate="no">​</a></h2>
<p><strong>Use <code>HasWorkflow</code> when you need:</strong></p>
<ul>
<li class=""><strong>Complex flow selection logic</strong>: Multiple flows for the same model type based on different criteria</li>
<li class=""><strong>Dynamic flow selection</strong>: Flows selected based on subject scope, collection, environment, channel, or rollout percentage</li>
<li class=""><strong>Multiple workflow variants</strong>: Different workflows for the same model based on business rules</li>
<li class=""><strong>Advanced features</strong>: Active time windows, canary deployments, environment-specific flows</li>
<li class=""><strong>Flexible configuration</strong>: Need to customize flow picking based on runtime conditions</li>
</ul>
<p><strong>Example scenarios:</strong></p>
<ul>
<li class="">E-commerce orders with different workflows for premium vs standard customers</li>
<li class="">Content approval workflows that vary by department or region</li>
<li class="">Multi-tenant applications where each tenant has different workflows</li>
<li class="">A/B testing workflows with rollout percentages</li>
<li class="">Environment-specific workflows (development, staging, production)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="hasworkflow-vs-hasflow">HasWorkflow vs HasFlow<a href="#hasworkflow-vs-hasflow" class="hash-link" aria-label="Direct link to HasWorkflow vs HasFlow" title="Direct link to HasWorkflow vs HasFlow" translate="no">​</a></h2>
<p><strong>Choose <code>HasWorkflow</code> if:</strong></p>
<ul>
<li class="">You have multiple flows for the same model type</li>
<li class="">Flow selection depends on dynamic criteria (user, collection, environment, etc.)</li>
<li class="">You need advanced features like rollout percentages or active windows</li>
<li class="">Your workflow requirements are complex and may change over time</li>
</ul>
<p><strong>Choose <code>HasFlow</code> if:</strong></p>
<ul>
<li class="">You have a single, fixed flow per model type</li>
<li class="">Flow selection is simple and doesn&#x27;t change</li>
<li class="">You prefer explicit flow ID assignment</li>
<li class="">Your project is straightforward with minimal workflow complexity</li>
</ul>
<p>For most simple projects (90% of use cases), <code>HasFlow</code> is recommended. For complex scenarios with multiple flows and dynamic selection, use <code>HasWorkflow</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="namespace">Namespace<a href="#namespace" class="hash-link" aria-label="Direct link to Namespace" title="Direct link to Namespace" translate="no">​</a></h2>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">JobMetric\Flow\HasWorkflow</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-usage">Basic Usage<a href="#basic-usage" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage" translate="no">​</a></h2>
<p>To use the HasWorkflow trait, simply add it to your model:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;user_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="status-column">Status Column<a href="#status-column" class="hash-link" aria-label="Direct link to Status Column" title="Direct link to Status Column" translate="no">​</a></h3>
<p>Your model <strong>must</strong> have a <code>status</code> column in the database table. The trait will automatically check for this column when the model is created.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Migration example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Schema::create(&#x27;orders&#x27;, function (Blueprint $table) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;id();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;string(&#x27;status&#x27;)-&gt;nullable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... other columns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p>If you need to use a different column name, override the <code>flowStatusColumn()</code> method:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowStatusColumn(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &#x27;order_status&#x27;; // Custom column name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-configuration">Flow Configuration<a href="#flow-configuration" class="hash-link" aria-label="Direct link to Flow Configuration" title="Direct link to Flow Configuration" translate="no">​</a></h3>
<p>Make sure you have created flows with the correct <code>subject_type</code> matching your model class. You can create multiple flows for different scenarios:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Facades\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Production flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$prodFlow = Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Staging flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$stagingFlow = Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;staging&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Premium collection flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$premiumFlow = Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;premium&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="database-migration-example">Database Migration Example<a href="#database-migration-example" class="hash-link" aria-label="Direct link to Database Migration Example" title="Direct link to Database Migration Example" translate="no">​</a></h3>
<p>Here&#x27;s a complete migration example for a model using <code>HasWorkflow</code>:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Migrations\Migration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Schema\Blueprint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Facades\Schema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return new class extends Migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function up(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Schema::create(&#x27;orders&#x27;, function (Blueprint $table) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $table-&gt;id();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $table-&gt;foreignId(&#x27;user_id&#x27;)-&gt;constrained();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $table-&gt;string(&#x27;collection&#x27;)-&gt;nullable(); // For subject_collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $table-&gt;string(&#x27;status&#x27;)-&gt;nullable(); // Required for HasWorkflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $table-&gt;decimal(&#x27;total&#x27;, 10, 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $table-&gt;timestamps();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function down(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Schema::dropIfExists(&#x27;orders&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p><strong>Required columns:</strong></p>
<ul>
<li class=""><code>status</code>: Required for workflow state management</li>
</ul>
<p><strong>Optional columns:</strong></p>
<ul>
<li class=""><code>collection</code>: If you use <code>flowSubjectCollection()</code></li>
<li class="">Any other columns your model needs</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="automatic-flow-binding">Automatic Flow Binding<a href="#automatic-flow-binding" class="hash-link" aria-label="Direct link to Automatic Flow Binding" title="Direct link to Automatic Flow Binding" translate="no">​</a></h2>
<p>When a model using <code>HasWorkflow</code> is created, the trait automatically:</p>
<ol>
<li class="">Picks the appropriate flow based on the model&#x27;s configuration</li>
<li class="">Binds the flow to the model via the <code>flow_uses</code> table</li>
<li class="">Sets the initial status if the flow has a START state</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; null, // Will be set automatically if flow has START state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Flow is automatically bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$boundFlow = $order-&gt;boundFlow();</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="customizing-flow-selection">Customizing Flow Selection<a href="#customizing-flow-selection" class="hash-link" aria-label="Direct link to Customizing Flow Selection" title="Direct link to Customizing Flow Selection" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="override-buildflowpicker">Override buildFlowPicker<a href="#override-buildflowpicker" class="hash-link" aria-label="Direct link to Override buildFlowPicker" title="Direct link to Override buildFlowPicker" translate="no">​</a></h3>
<p>You can customize how flows are selected by overriding the <code>buildFlowPicker()</code> method. This method receives a <code>FlowPickerBuilder</code> instance that you can configure with various options:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Call parent to set defaults</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Customize the builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectScope($this-&gt;user_id ? (string)$this-&gt;user_id : null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(&#x27;production&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(&#x27;web&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;order&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flowpickerbuilder-options">FlowPickerBuilder Options<a href="#flowpickerbuilder-options" class="hash-link" aria-label="Direct link to FlowPickerBuilder Options" title="Direct link to FlowPickerBuilder Options" translate="no">​</a></h3>
<p>The <code>FlowPickerBuilder</code> provides extensive configuration options for flow selection:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="subject-scope">Subject Scope<a href="#subject-scope" class="hash-link" aria-label="Direct link to Subject Scope" title="Direct link to Subject Scope" translate="no">​</a></h4>
<p>Use <code>subjectScope()</code> to partition flows by tenant, organization, or any logical grouping:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Partition flows by user/tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;subjectScope($this-&gt;user_id ? (string)$this-&gt;user_id : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Or by organization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;subjectScope($this-&gt;organization_id ? (string)$this-&gt;organization_id : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Use case:</strong> Multi-tenant applications where each tenant has different workflows.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="environment">Environment<a href="#environment" class="hash-link" aria-label="Direct link to Environment" title="Direct link to Environment" translate="no">​</a></h4>
<p>Filter flows by environment (production, staging, development):</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Or based on request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(request()-&gt;header(&#x27;X-Environment&#x27;, &#x27;production&#x27;));</span><br></span></code></pre></div></div>
<p><strong>Use case:</strong> Different workflows for different deployment environments.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="channel">Channel<a href="#channel" class="hash-link" aria-label="Direct link to Channel" title="Direct link to Channel" translate="no">​</a></h4>
<p>Filter flows by channel (web, api, mobile, etc.):</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Or based on route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(request()-&gt;is(&#x27;api/*&#x27;) ? &#x27;api&#x27; : &#x27;web&#x27;);</span><br></span></code></pre></div></div>
<p><strong>Use case:</strong> Different workflows for web vs API requests.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="preferred-environments-and-channels">Preferred Environments and Channels<a href="#preferred-environments-and-channels" class="hash-link" aria-label="Direct link to Preferred Environments and Channels" title="Direct link to Preferred Environments and Channels" translate="no">​</a></h4>
<p>Use <code>preferEnvironments()</code> and <code>preferChannels()</code> for ordering (not filtering). Earlier items rank higher:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;, &#x27;mobile&#x27;]);</span><br></span></code></pre></div></div>
<p>This means if multiple flows match, the one with the preferred environment/channel will be selected first.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="rollout-configuration">Rollout Configuration<a href="#rollout-configuration" class="hash-link" aria-label="Direct link to Rollout Configuration" title="Direct link to Rollout Configuration" translate="no">​</a></h4>
<p>Configure rollout (canary deployment) for gradual feature rollouts:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutNamespace(&#x27;order&#x27;) // Isolate rollout buckets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutSalt(&#x27;v2&#x27;) // Additional salt for stability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Return a stable key (e.g., user_id, order_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (string)$model-&gt;getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre></div></div>
<p><strong>Rollout Namespace:</strong> Isolates rollout buckets across different features/domains. This ensures that rollout percentages are independent for different features.</p>
<p><strong>Rollout Salt:</strong> Additional salt for hashing to further stabilize or segregate rollout buckets.</p>
<p><strong>Rollout Key Resolver:</strong> Returns a stable key (like user_id or order_id) that determines which bucket the model falls into. The same key will always fall into the same bucket.</p>
<p><strong>Example:</strong> If a flow has <code>rollout_pct: 50</code>, only 50% of models (based on the rollout key) will be assigned to this flow.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="fallback-cascade">Fallback Cascade<a href="#fallback-cascade" class="hash-link" aria-label="Direct link to Fallback Cascade" title="Direct link to Fallback Cascade" translate="no">​</a></h4>
<p>Define fallback steps to progressively relax constraints if no flow matches:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_CHANNEL,        // Remove channel filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_ENVIRONMENT,    // Remove environment filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,   // Ignore active window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DISABLE_ROLLOUT,      // Disable rollout checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_REQUIRE_DEFAULT, // Don&#x27;t require is_default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<p>The system will try each step in order until a flow is found.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="active-window">Active Window<a href="#active-window" class="hash-link" aria-label="Direct link to Active Window" title="Direct link to Active Window" translate="no">​</a></h4>
<p>Control time-based flow activation:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;onlyActive(true)           // Require status=true and active window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;ignoreTimeWindow(false)    // Enforce active_from/active_to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;)); // Reference time for evaluation</span><br></span></code></pre></div></div>
<p><strong>Use case:</strong> Schedule workflows to activate/deactivate at specific times.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-where-clauses">Custom Where Clauses<a href="#custom-where-clauses" class="hash-link" aria-label="Direct link to Custom Where Clauses" title="Direct link to Custom Where Clauses" translate="no">​</a></h4>
<p>Add custom query constraints to filter flows:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Filter flows based on model attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $query-&gt;where(&#x27;custom_field&#x27;, $model-&gt;some_attribute);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Or complex conditions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($model-&gt;is_premium) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $query-&gt;where(&#x27;is_premium_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Use case:</strong> Custom business logic that doesn&#x27;t fit standard criteria.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="version-constraints">Version Constraints<a href="#version-constraints" class="hash-link" aria-label="Direct link to Version Constraints" title="Direct link to Version Constraints" translate="no">​</a></h4>
<p>Control which flow versions are eligible:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionEquals(2)        // Exact version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // OR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionMin(1)           // Minimum version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionMax(3);          // Maximum version</span><br></span></code></pre></div></div>
<p><strong>Use case:</strong> Gradual migration between flow versions.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-id-whitelistblacklist">Flow ID Whitelist/Blacklist<a href="#flow-id-whitelistblacklist" class="hash-link" aria-label="Direct link to Flow ID Whitelist/Blacklist" title="Direct link to Flow ID Whitelist/Blacklist" translate="no">​</a></h4>
<p>Include or exclude specific flows:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;includeFlowIds([1, 2, 3])  // Only these flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;excludeFlowIds([4, 5])     // Exclude these flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;preferFlowIds([1, 2]);     // Prefer these (for ordering)</span><br></span></code></pre></div></div>
<p><strong>Use case:</strong> Testing specific flows or excluding deprecated flows.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-ordering">Custom Ordering<a href="#custom-ordering" class="hash-link" aria-label="Direct link to Custom Ordering" title="Direct link to Custom Ordering" translate="no">​</a></h4>
<p>Override default ordering:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;orderBy(function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;orderBy(&#x27;priority&#x27;, &#x27;desc&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          -&gt;orderBy(&#x27;created_at&#x27;, &#x27;asc&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p>Default ordering is: <code>version DESC, is_default DESC, ordering DESC, id DESC</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="match-strategy">Match Strategy<a href="#match-strategy" class="hash-link" aria-label="Direct link to Match Strategy" title="Direct link to Match Strategy" translate="no">​</a></h4>
<p>Control how flows are selected when multiple matches exist:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// STRATEGY_BEST: Returns the best candidate based on ordering rules (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;matchStrategy(FlowPickerBuilder::STRATEGY_BEST);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// STRATEGY_FIRST: Returns the first matching record (minimal ordering)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;matchStrategy(FlowPickerBuilder::STRATEGY_FIRST);</span><br></span></code></pre></div></div>
<p><strong>STRATEGY_BEST</strong> (default):</p>
<ul>
<li class="">Applies full ordering (version, is_default, ordering, id)</li>
<li class="">Returns the highest-ranked flow</li>
<li class="">Best for production use</li>
</ul>
<p><strong>STRATEGY_FIRST</strong>:</p>
<ul>
<li class="">Minimal ordering (just enough to get first match)</li>
<li class="">Faster but less predictable</li>
<li class="">Useful for testing or when order doesn&#x27;t matter</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="require-default">Require Default<a href="#require-default" class="hash-link" aria-label="Direct link to Require Default" title="Direct link to Require Default" translate="no">​</a></h4>
<p>Only select flows marked as default:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;requireDefault(true);</span><br></span></code></pre></div></div>
<p>This ensures only flows with <code>is_default = true</code> are selected. Useful when you want to enforce a single default flow per scope.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="request-caching">Request Caching<a href="#request-caching" class="hash-link" aria-label="Direct link to Request Caching" title="Direct link to Request Caching" translate="no">​</a></h4>
<p>Enable per-request caching for better performance:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;cacheInRequest(true);</span><br></span></code></pre></div></div>
<p><strong>Warning:</strong> Only enable if your builder doesn&#x27;t use dynamic callbacks that depend on request state. If callbacks access <code>$request</code>, <code>auth()</code>, or other request-specific data, caching may return incorrect results.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="subject-collection">Subject Collection<a href="#subject-collection" class="hash-link" aria-label="Direct link to Subject Collection" title="Direct link to Subject Collection" translate="no">​</a></h3>
<p>If your model has a collection field, you can use it for flow selection. Collections allow you to have different workflows for the same model type:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;collection&#x27;, // e.g., &#x27;premium&#x27;, &#x27;standard&#x27;, &#x27;enterprise&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;collection&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>How it works:</strong></p>
<p>When you create flows, set the <code>subject_collection</code> field:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Premium order flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$premiumFlow = Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;premium&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Standard order flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$standardFlow = Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;standard&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<p>When creating orders:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Premium order - gets premium flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$premiumOrder = Order::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;collection&#x27; =&gt; &#x27;premium&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Standard order - gets standard flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$standardOrder = Order::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;collection&#x27; =&gt; &#x27;standard&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<p><strong>Advanced Collection Scenarios:</strong></p>
<p>You can combine collections with other criteria:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;subjectCollection($this-&gt;collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;subjectScope((string)$this-&gt;tenant_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This allows you to have:</p>
<ul>
<li class="">Different flows per collection (premium vs standard)</li>
<li class="">Different flows per tenant</li>
<li class="">Different flows per environment</li>
</ul>
<p>All combined for maximum flexibility.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="working-with-bound-flows">Working with Bound Flows<a href="#working-with-bound-flows" class="hash-link" aria-label="Direct link to Working with Bound Flows" title="Direct link to Working with Bound Flows" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="get-bound-flow">Get Bound Flow<a href="#get-bound-flow" class="hash-link" aria-label="Direct link to Get Bound Flow" title="Direct link to Get Bound Flow" translate="no">​</a></h3>
<p>Retrieve the currently bound flow for a model:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get bound flow (lazy loading)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = $order-&gt;boundFlow();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Eager load for better performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::withFlow()-&gt;find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = $order-&gt;boundFlow();</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-use-relation">Flow Use Relation<a href="#flow-use-relation" class="hash-link" aria-label="Direct link to Flow Use Relation" title="Direct link to Flow Use Relation" translate="no">​</a></h3>
<p>Access the <code>FlowUse</code> relationship directly:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get the FlowUse record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flowUse = $order-&gt;flowUse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Access the flow through the relation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = $order-&gt;flowUse-&gt;flow;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="eager-loading">Eager Loading<a href="#eager-loading" class="hash-link" aria-label="Direct link to Eager Loading" title="Direct link to Eager Loading" translate="no">​</a></h3>
<p>Use the <code>withFlow()</code> scope to efficiently load flows. This prevents N+1 query problems:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Single model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::withFlow()-&gt;find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Multiple models (prevents N+1 queries)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$orders = Order::withFlow()-&gt;get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// In queries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$orders = Order::withFlow()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;where(&#x27;status&#x27;, &#x27;pending&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Combined with other relations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$orders = Order::withFlow()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;with(&#x27;user&#x27;, &#x27;items&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;get();</span><br></span></code></pre></div></div>
<p><strong>What <code>withFlow()</code> does:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Internally, it does:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$query-&gt;with([&#x27;flowUse.flow&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This eager loads:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 1. FlowUse records (polymorphic relation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. Flow models (through FlowUse)</span><br></span></code></pre></div></div>
<p><strong>Performance Tip:</strong></p>
<p>Always use <code>withFlow()</code> when loading multiple models:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ Bad: N+1 queries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$orders = Order::all();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($orders as $order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $flow = $order-&gt;boundFlow(); // Query for each order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Good: Single query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$orders = Order::withFlow()-&gt;get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($orders as $order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $flow = $order-&gt;boundFlow(); // Already loaded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="manual-flow-binding">Manual Flow Binding<a href="#manual-flow-binding" class="hash-link" aria-label="Direct link to Manual Flow Binding" title="Direct link to Manual Flow Binding" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="bind-flow">Bind Flow<a href="#bind-flow" class="hash-link" aria-label="Direct link to Bind Flow" title="Direct link to Bind Flow" translate="no">​</a></h3>
<p>Manually bind a specific flow to a model:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Facades\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::show($flowId)-&gt;getData();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;bindFlow($flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// With custom timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;bindFlow($flow, Carbon::now()-&gt;subDays(1));</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="rebind-flow">Rebind Flow<a href="#rebind-flow" class="hash-link" aria-label="Direct link to Rebind Flow" title="Direct link to Rebind Flow" translate="no">​</a></h3>
<p>Re-pick and rebind a flow (useful when flow configuration changes):</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Rebind with default picker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = $order-&gt;rebindFlow();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Rebind with custom tuner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = $order-&gt;rebindFlow(function ($builder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;environment(&#x27;staging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="unbind-flow">Unbind Flow<a href="#unbind-flow" class="hash-link" aria-label="Direct link to Unbind Flow" title="Direct link to Unbind Flow" translate="no">​</a></h3>
<p>Remove the flow binding:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;unbindFlow();</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-picking">Flow Picking<a href="#flow-picking" class="hash-link" aria-label="Direct link to Flow Picking" title="Direct link to Flow Picking" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pick-flow">Pick Flow<a href="#pick-flow" class="hash-link" aria-label="Direct link to Pick Flow" title="Direct link to Pick Flow" translate="no">​</a></h3>
<p>Manually pick a flow without binding it. This uses the configured <code>buildFlowPicker()</code> logic:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Pick with default configuration (uses buildFlowPicker())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = $order-&gt;pickFlow();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The flow is not automatically bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// You can manually bind it if needed:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($flow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $order-&gt;bindFlow($flow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>How it works:</strong></p>
<ol>
<li class="">Creates a new <code>FlowPickerBuilder</code> instance</li>
<li class="">Calls <code>buildFlowPicker()</code> to configure it</li>
<li class="">Uses <code>FlowPicker</code> to select the best matching flow</li>
<li class="">Returns the selected Flow or <code>null</code></li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-makeflowpicker">Understanding makeFlowPicker()<a href="#understanding-makeflowpicker" class="hash-link" aria-label="Direct link to Understanding makeFlowPicker()" title="Direct link to Understanding makeFlowPicker()" translate="no">​</a></h3>
<p>The <code>makeFlowPicker()</code> method creates and configures a <code>FlowPickerBuilder</code>:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Internal implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected function makeFlowPicker(): FlowPickerBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder = new FlowPickerBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;buildFlowPicker($builder); // Your custom configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $builder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>You can use this in custom scenarios:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get the configured builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder = $order-&gt;makeFlowPicker();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Modify it further</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(&#x27;staging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use it with FlowPicker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = (new FlowPicker())-&gt;pick($order, $builder);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="preview-flow-selection">Preview Flow Selection<a href="#preview-flow-selection" class="hash-link" aria-label="Direct link to Preview Flow Selection" title="Direct link to Preview Flow Selection" translate="no">​</a></h3>
<p>Use the Flow service to preview which flow would be selected:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Facades\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Preview without binding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::previewPick($order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Preview with custom tuner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::previewPick($order, function ($builder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;environment(&#x27;staging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="status-management">Status Management<a href="#status-management" class="hash-link" aria-label="Direct link to Status Management" title="Direct link to Status Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="current-status-value">Current Status Value<a href="#current-status-value" class="hash-link" aria-label="Direct link to Current Status Value" title="Direct link to Current Status Value" translate="no">​</a></h3>
<p>Get the current status as a scalar value (handles enum casting):</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns the status value (works with enums too)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$status = $order-&gt;flowCurrentStatusValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: &#x27;pending&#x27;, &#x27;processing&#x27;, etc.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="status-enum-support">Status Enum Support<a href="#status-enum-support" class="hash-link" aria-label="Direct link to Status Enum Support" title="Direct link to Status Enum Support" translate="no">​</a></h3>
<p>The trait automatically detects if your status column uses an enum:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use App\Enums\OrderStatus;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $casts = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27; =&gt; OrderStatus::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get enum class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$enumClass = $order-&gt;flowStatusEnumClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: OrderStatus::class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get enum values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$values = $order-&gt;flowStatusEnumValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: [&#x27;pending&#x27;, &#x27;processing&#x27;, &#x27;shipped&#x27;, &#x27;delivered&#x27;]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-status-enum">Custom Status Enum<a href="#custom-status-enum" class="hash-link" aria-label="Direct link to Custom Status Enum" title="Direct link to Custom Status Enum" translate="no">​</a></h3>
<p>If you&#x27;re using a custom enum with a <code>values()</code> method:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum OrderStatus: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PENDING = &#x27;pending&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PROCESSING = &#x27;processing&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case SHIPPED = &#x27;shipped&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case DELIVERED = &#x27;delivered&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function values(): array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return array_column(self::cases(), &#x27;value&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The trait will automatically use this method to get enum values.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enum-detection-priority">Enum Detection Priority<a href="#enum-detection-priority" class="hash-link" aria-label="Direct link to Enum Detection Priority" title="Direct link to Enum Detection Priority" translate="no">​</a></h3>
<p>The <code>flowStatusEnumValues()</code> method uses this priority:</p>
<ol>
<li class=""><strong>Custom <code>values()</code> method</strong>: If your enum defines <code>static values()</code>, it&#x27;s used first</li>
<li class=""><strong>Backed Enum values</strong>: If it&#x27;s a <code>BackedEnum</code>, returns scalar values from cases</li>
<li class=""><strong>Pure Enum names</strong>: Otherwise, returns case names</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Backed Enum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum OrderStatus: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PENDING = &#x27;pending&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PROCESSING = &#x27;processing&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$values = $order-&gt;flowStatusEnumValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: [&#x27;pending&#x27;, &#x27;processing&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Pure Enum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum OrderStatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PENDING;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PROCESSING;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$values = $order-&gt;flowStatusEnumValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: [&#x27;PENDING&#x27;, &#x27;PROCESSING&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Custom values() method (highest priority)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum OrderStatus: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PENDING = &#x27;pending&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case PROCESSING = &#x27;processing&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function values(): array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [&#x27;custom&#x27;, &#x27;values&#x27;]; // This will be used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-current-status">Getting Current Status<a href="#getting-current-status" class="hash-link" aria-label="Direct link to Getting Current Status" title="Direct link to Getting Current Status" translate="no">​</a></h3>
<p>The <code>flowCurrentStatusValue()</code> method handles enum conversion:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If status is a Backed Enum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;status = OrderStatus::PENDING; // OrderStatus enum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$value = $order-&gt;flowCurrentStatusValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: &#x27;pending&#x27; (scalar value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If status is a Pure Enum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;status = OrderStatus::PENDING; // OrderStatus enum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$value = $order-&gt;flowCurrentStatusValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: &#x27;PENDING&#x27; (case name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If status is a string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;status = &#x27;pending&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$value = $order-&gt;flowCurrentStatusValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: &#x27;pending&#x27; (raw value)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-flowpickerbuilder-examples">Advanced FlowPickerBuilder Examples<a href="#advanced-flowpickerbuilder-examples" class="hash-link" aria-label="Direct link to Advanced FlowPickerBuilder Examples" title="Direct link to Advanced FlowPickerBuilder Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multi-tenant-application">Multi-Tenant Application<a href="#multi-tenant-application" class="hash-link" aria-label="Direct link to Multi-Tenant Application" title="Direct link to Multi-Tenant Application" translate="no">​</a></h3>
<p>For a multi-tenant application where each tenant has different workflows:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectScope((string)$this-&gt;tenant_id) // Partition by tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(&#x27;web&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ab-testing-with-rollout">A/B Testing with Rollout<a href="#ab-testing-with-rollout" class="hash-link" aria-label="Direct link to A/B Testing with Rollout" title="Direct link to A/B Testing with Rollout" translate="no">​</a></h3>
<p>For gradual rollout of new workflows:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(&#x27;production&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(&#x27;web&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;order_v2&#x27;) // Isolate from other features</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutSalt(&#x27;2024&#x27;) // Version salt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Use user_id for consistent bucket assignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DISABLE_ROLLOUT, // Fallback to 100% if needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>How Rollout Works:</strong></p>
<p>If you have two flows:</p>
<ul>
<li class="">Flow A: <code>rollout_pct: 50</code> (old workflow)</li>
<li class="">Flow B: <code>rollout_pct: 50</code> (new workflow)</li>
</ul>
<p>The system will:</p>
<ol>
<li class="">Hash the rollout key (user_id) with namespace and salt</li>
<li class="">Determine which bucket (0-100) the user falls into</li>
<li class="">Assign Flow A to users in bucket 0-50</li>
<li class="">Assign Flow B to users in bucket 51-100</li>
</ol>
<p>The same user will always get the same flow (consistent bucket assignment).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="environment-specific-workflows">Environment-Specific Workflows<a href="#environment-specific-workflows" class="hash-link" aria-label="Direct link to Environment-Specific Workflows" title="Direct link to Environment-Specific Workflows" translate="no">​</a></h3>
<p>For different workflows per environment:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $env = config(&#x27;app.env&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment($env)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_ENVIRONMENT, // Fallback to any environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="channel-based-workflows">Channel-Based Workflows<a href="#channel-based-workflows" class="hash-link" aria-label="Direct link to Channel-Based Workflows" title="Direct link to Channel-Based Workflows" translate="no">​</a></h3>
<p>For different workflows based on request channel:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $channel = request()-&gt;is(&#x27;api/*&#x27;) ? &#x27;api&#x27; : &#x27;web&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel($channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;, &#x27;mobile&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_CHANNEL, // Fallback to any channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="collection-based-workflows">Collection-Based Workflows<a href="#collection-based-workflows" class="hash-link" aria-label="Direct link to Collection-Based Workflows" title="Direct link to Collection-Based Workflows" translate="no">​</a></h3>
<p>For different workflows based on model collection:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;collection&#x27;, // &#x27;premium&#x27;, &#x27;standard&#x27;, &#x27;enterprise&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectCollection($this-&gt;collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;collection&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scheduled-workflows">Scheduled Workflows<a href="#scheduled-workflows" class="hash-link" aria-label="Direct link to Scheduled Workflows" title="Direct link to Scheduled Workflows" translate="no">​</a></h3>
<p>For workflows that activate/deactivate at specific times:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(false) // Enforce active_from/active_to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_IGNORE_TIMEWINDOW, // Fallback: ignore time window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="complex-multi-criteria-selection">Complex Multi-Criteria Selection<a href="#complex-multi-criteria-selection" class="hash-link" aria-label="Direct link to Complex Multi-Criteria Selection" title="Direct link to Complex Multi-Criteria Selection" translate="no">​</a></h3>
<p>Combining multiple criteria:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectScope((string)$this-&gt;tenant_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectCollection($this-&gt;order_type) // &#x27;premium&#x27;, &#x27;standard&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;order&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DISABLE_ROLLOUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-example">Complete Example<a href="#complete-example" class="hash-link" aria-label="Direct link to Complete Example" title="Direct link to Complete Example" translate="no">​</a></h2>
<p>Here&#x27;s a complete example of using HasWorkflow in a real-world scenario:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Enums\OrderStatus;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;user_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;collection&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;total&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $casts = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27; =&gt; OrderStatus::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;total&#x27; =&gt; &#x27;decimal:2&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectScope($this-&gt;user_id ? (string)$this-&gt;user_id : null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectCollection($this-&gt;collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;order&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;collection&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;collection&#x27; =&gt; &#x27;premium&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;total&#x27; =&gt; 100.00,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Flow is automatically bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = $order-&gt;boundFlow();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get current status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$status = $order-&gt;flowCurrentStatusValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Execute a transition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Facades\FlowTransition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FlowTransition::runner(&#x27;start_processing&#x27;, $order);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-world-scenarios">Real-World Scenarios<a href="#real-world-scenarios" class="hash-link" aria-label="Direct link to Real-World Scenarios" title="Direct link to Real-World Scenarios" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-1-multi-tenant-saas-application">Scenario 1: Multi-Tenant SaaS Application<a href="#scenario-1-multi-tenant-saas-application" class="hash-link" aria-label="Direct link to Scenario 1: Multi-Tenant SaaS Application" title="Direct link to Scenario 1: Multi-Tenant SaaS Application" translate="no">​</a></h3>
<p>Different workflows per tenant with environment-specific variants:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Document extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectScope((string)$this-&gt;tenant_id) // Partition by tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow setup:</strong></p>
<ul>
<li class="">Tenant 1, Production: Flow ID 1</li>
<li class="">Tenant 1, Staging: Flow ID 2</li>
<li class="">Tenant 2, Production: Flow ID 3</li>
<li class="">etc.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-2-e-commerce-with-ab-testing">Scenario 2: E-Commerce with A/B Testing<a href="#scenario-2-e-commerce-with-ab-testing" class="hash-link" aria-label="Direct link to Scenario 2: E-Commerce with A/B Testing" title="Direct link to Scenario 2: E-Commerce with A/B Testing" translate="no">​</a></h3>
<p>Gradual rollout of new checkout workflow:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Checkout extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(&#x27;production&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(&#x27;web&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;checkout_v2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutSalt(&#x27;2024-01&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Use customer ID for consistent assignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;customer_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DISABLE_ROLLOUT, // Fallback to 100%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow setup:</strong></p>
<ul>
<li class="">Old checkout: <code>rollout_pct: 50</code></li>
<li class="">New checkout: <code>rollout_pct: 50</code></li>
</ul>
<p>50% of customers get old workflow, 50% get new workflow, consistently assigned by customer ID.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-3-content-management-with-collections">Scenario 3: Content Management with Collections<a href="#scenario-3-content-management-with-collections" class="hash-link" aria-label="Direct link to Scenario 3: Content Management with Collections" title="Direct link to Scenario 3: Content Management with Collections" translate="no">​</a></h3>
<p>Different approval workflows for different content types:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Article extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;collection&#x27;, // &#x27;news&#x27;, &#x27;blog&#x27;, &#x27;press-release&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectCollection($this-&gt;collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(&#x27;web&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;collection&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow setup:</strong></p>
<ul>
<li class="">News articles: <code>subject_collection: &#x27;news&#x27;</code></li>
<li class="">Blog posts: <code>subject_collection: &#x27;blog&#x27;</code></li>
<li class="">Press releases: <code>subject_collection: &#x27;press-release&#x27;</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-4-scheduled-workflow-activation">Scenario 4: Scheduled Workflow Activation<a href="#scenario-4-scheduled-workflow-activation" class="hash-link" aria-label="Direct link to Scenario 4: Scheduled Workflow Activation" title="Direct link to Scenario 4: Scheduled Workflow Activation" translate="no">​</a></h3>
<p>Workflows that activate at specific times:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Campaign extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(false) // Enforce active_from/active_to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_IGNORE_TIMEWINDOW, // Fallback if outside window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow setup:</strong></p>
<ul>
<li class="">Summer campaign: <code>active_from: &#x27;2024-06-01&#x27;</code>, <code>active_to: &#x27;2024-08-31&#x27;</code></li>
<li class="">Winter campaign: <code>active_from: &#x27;2024-12-01&#x27;</code>, <code>active_to: &#x27;2024-02-28&#x27;</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-5-complex-multi-criteria-selection">Scenario 5: Complex Multi-Criteria Selection<a href="#scenario-5-complex-multi-criteria-selection" class="hash-link" aria-label="Direct link to Scenario 5: Complex Multi-Criteria Selection" title="Direct link to Scenario 5: Complex Multi-Criteria Selection" translate="no">​</a></h3>
<p>Combining all features for maximum flexibility:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Invoice extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;tenant_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;invoice_type&#x27;, // &#x27;recurring&#x27;, &#x27;one-time&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectScope((string)$this-&gt;tenant_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;subjectCollection($this-&gt;invoice_type)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;invoice&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;customer_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlowPickerBuilder::FB_DISABLE_ROLLOUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;invoice_type&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This configuration allows for:</p>
<ul>
<li class="">Different workflows per tenant</li>
<li class="">Different workflows per invoice type</li>
<li class="">Environment-specific workflows</li>
<li class="">Channel-specific workflows</li>
<li class="">Gradual rollout of new workflows</li>
<li class="">Time-based activation</li>
<li class="">Graceful fallbacks if no exact match</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="lifecycle-events">Lifecycle Events<a href="#lifecycle-events" class="hash-link" aria-label="Direct link to Lifecycle Events" title="Direct link to Lifecycle Events" translate="no">​</a></h2>
<p>The trait hooks into Eloquent&#x27;s <code>creating</code> and <code>created</code> events to automatically bind flows:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="creating-event">Creating Event<a href="#creating-event" class="hash-link" aria-label="Direct link to Creating Event" title="Direct link to Creating Event" translate="no">​</a></h3>
<p>During the <code>creating</code> event:</p>
<ol>
<li class="">Checks if the model has a status column (throws exception if missing)</li>
<li class="">Checks if a flow binding already exists (skips if it does)</li>
<li class="">Calls <code>pickFlow()</code> to select the appropriate flow</li>
<li class="">Stores the selected flow ID in <code>selectedFlowIdForBinding</code> property</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// This happens automatically when you create a model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::create([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Flow is picked and stored temporarily during &#x27;creating&#x27; event</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="created-event">Created Event<a href="#created-event" class="hash-link" aria-label="Direct link to Created Event" title="Direct link to Created Event" translate="no">​</a></h3>
<p>During the <code>created</code> event:</p>
<ol>
<li class="">Checks if the model has a status column</li>
<li class="">Checks if a flow binding already exists (skips if it does)</li>
<li class="">Uses the stored <code>selectedFlowIdForBinding</code> or calls <code>pickFlow()</code> again</li>
<li class="">Creates a <code>FlowUse</code> record to bind the flow to the model</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Flow binding is persisted to database during &#x27;created&#x27; event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FlowUse record is created in flow_uses table</span><br></span></code></pre></div></div>
<p><strong>Important Notes:</strong></p>
<ul>
<li class="">If a <code>FlowUse</code> record already exists, the trait skips automatic binding</li>
<li class="">If <code>pickFlow()</code> returns <code>null</code>, no binding is created (no error thrown)</li>
<li class="">The <code>selectedFlowIdForBinding</code> property is used to avoid picking the flow twice</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-selectedflowidforbinding">Understanding selectedFlowIdForBinding<a href="#understanding-selectedflowidforbinding" class="hash-link" aria-label="Direct link to Understanding selectedFlowIdForBinding" title="Direct link to Understanding selectedFlowIdForBinding" translate="no">​</a></h3>
<p>The <code>selectedFlowIdForBinding</code> property is a temporary storage mechanism:</p>
<ol>
<li class=""><strong>During <code>creating</code> event</strong>: Flow is picked and ID is stored in this property</li>
<li class=""><strong>During <code>created</code> event</strong>: The stored ID is used instead of picking again</li>
<li class=""><strong>Purpose</strong>: Avoids picking the flow twice (once in creating, once in created)</li>
</ol>
<p>This is important because:</p>
<ul>
<li class="">Flow picking can be expensive (database queries, complex logic)</li>
<li class="">Model attributes might change between <code>creating</code> and <code>created</code> events</li>
<li class="">Storing the ID ensures consistency</li>
</ul>
<p><strong>Manual Access:</strong></p>
<p>You generally don&#x27;t need to access this property directly, but if you do:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// This is set automatically during creating event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;selectedFlowIdForBinding; // int|null</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="skipping-automatic-binding">Skipping Automatic Binding<a href="#skipping-automatic-binding" class="hash-link" aria-label="Direct link to Skipping Automatic Binding" title="Direct link to Skipping Automatic Binding" translate="no">​</a></h3>
<p>If you want to skip automatic binding and handle it manually:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create FlowUse record before creating the model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = new Order([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;flowUse()-&gt;create([&#x27;flow_id&#x27; =&gt; $flowId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order-&gt;save();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The trait will detect existing FlowUse and skip automatic binding</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-optimization">Performance Optimization<a href="#performance-optimization" class="hash-link" aria-label="Direct link to Performance Optimization" title="Direct link to Performance Optimization" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="caching-flow-picker-results">Caching Flow Picker Results<a href="#caching-flow-picker-results" class="hash-link" aria-label="Direct link to Caching Flow Picker Results" title="Direct link to Caching Flow Picker Results" translate="no">​</a></h3>
<p>For models with complex flow selection logic, you can enable request-level caching:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Enable caching if builder doesn&#x27;t use dynamic callbacks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;cacheInRequest(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Warning:</strong> Only enable if your callbacks don&#x27;t depend on request state. If callbacks access <code>$request</code>, <code>auth()</code>, or other request-specific data, caching may return incorrect results.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="optimizing-flow-queries">Optimizing Flow Queries<a href="#optimizing-flow-queries" class="hash-link" aria-label="Direct link to Optimizing Flow Queries" title="Direct link to Optimizing Flow Queries" translate="no">​</a></h3>
<p>The FlowPicker automatically optimizes queries, but you can help by:</p>
<ol>
<li class="">
<p><strong>Indexing database columns</strong> used in flow selection:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Schema::table(&#x27;flows&#x27;, function (Blueprint $table) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;index([&#x27;subject_type&#x27;, &#x27;subject_scope&#x27;, &#x27;subject_collection&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;index([&#x27;environment&#x27;, &#x27;channel&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;index([&#x27;status&#x27;, &#x27;active_from&#x27;, &#x27;active_to&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Using specific criteria</strong> instead of broad filters:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Good: Specific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(&#x27;production&#x27;)-&gt;channel(&#x27;web&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ⚠️ Less optimal: Broad</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(null)-&gt;channel(null);</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Limiting fallback cascade</strong> to necessary steps:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Good: Only necessary fallbacks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;fallbackCascade([FlowPickerBuilder::FB_DROP_CHANNEL]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ⚠️ Less optimal: Too many fallbacks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DISABLE_ROLLOUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_REQUIRE_DEFAULT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h2>
<ol>
<li class="">
<p><strong>Always use eager loading</strong> when working with multiple models:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$orders = Order::withFlow()-&gt;get();</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Override <code>buildFlowPicker()</code></strong> to customize flow selection based on your business logic</p>
</li>
<li class="">
<p><strong>Use <code>flowSubjectCollection()</code></strong> if you have different workflow variants for the same model type</p>
</li>
<li class="">
<p><strong>Ensure status column exists</strong> before using the trait to avoid runtime errors</p>
</li>
<li class="">
<p><strong>Use enums for status</strong> to get better type safety and automatic value detection</p>
</li>
<li class="">
<p><strong>Index database columns</strong> used in flow selection for better performance</p>
</li>
<li class="">
<p><strong>Keep <code>buildFlowPicker()</code> efficient</strong> - avoid heavy computations in callbacks</p>
</li>
<li class="">
<p><strong>Use specific criteria</strong> instead of broad filters when possible</p>
</li>
<li class="">
<p><strong>Limit fallback cascade</strong> to necessary steps only</p>
</li>
<li class="">
<p><strong>Enable request caching</strong> only if callbacks don&#x27;t depend on request state</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-and-debugging">Testing and Debugging<a href="#testing-and-debugging" class="hash-link" aria-label="Direct link to Testing and Debugging" title="Direct link to Testing and Debugging" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-flow-selection">Testing Flow Selection<a href="#testing-flow-selection" class="hash-link" aria-label="Direct link to Testing Flow Selection" title="Direct link to Testing Flow Selection" translate="no">​</a></h3>
<p>Use <code>Flow::previewPick()</code> to test which flow would be selected:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::make([&#x27;user_id&#x27; =&gt; 1, &#x27;collection&#x27; =&gt; &#x27;premium&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Preview without creating the model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::previewPick($order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Test with different configurations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::previewPick($order, function ($builder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;environment(&#x27;staging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="debugging-flow-picker-configuration">Debugging Flow Picker Configuration<a href="#debugging-flow-picker-configuration" class="hash-link" aria-label="Direct link to Debugging Flow Picker Configuration" title="Direct link to Debugging Flow Picker Configuration" translate="no">​</a></h3>
<p>Log the builder configuration to see what&#x27;s being used:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Your configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;subjectScope((string)$this-&gt;user_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Debug: Log configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (config(&#x27;app.debug&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger()-&gt;debug(&#x27;FlowPicker configuration&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;subject_type&#x27; =&gt; static::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;subject_scope&#x27; =&gt; $this-&gt;user_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;environment&#x27; =&gt; config(&#x27;app.env&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-rollout">Testing Rollout<a href="#testing-rollout" class="hash-link" aria-label="Direct link to Testing Rollout" title="Direct link to Testing Rollout" translate="no">​</a></h3>
<p>To test rollout behavior, you can temporarily override the rollout key:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::make([&#x27;user_id&#x27; =&gt; 1]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Test with specific rollout key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::previewPick($order, function ($builder) use ($order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;rolloutKeyResolver(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &#x27;test-key-123&#x27;; // Fixed key for testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verifying-flow-binding">Verifying Flow Binding<a href="#verifying-flow-binding" class="hash-link" aria-label="Direct link to Verifying Flow Binding" title="Direct link to Verifying Flow Binding" translate="no">​</a></h3>
<p>After creating a model, verify the flow was bound:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::create([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check if flow was bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($order-&gt;boundFlow()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger()-&gt;info(&#x27;Flow bound successfully&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;flow_id&#x27; =&gt; $order-&gt;boundFlow()-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger()-&gt;warning(&#x27;No flow bound to order&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;order_id&#x27; =&gt; $order-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues-and-solutions">Common Issues and Solutions<a href="#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions" translate="no">​</a></h3>
<p><strong>Issue: Flow not binding automatically</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Check if flow exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flows = Flow::query()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;where(&#x27;subject_type&#x27;, Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;where(&#x27;status&#x27;, true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check if flow matches criteria</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::previewPick($order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!$flow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // No flow matches - check your buildFlowPicker() configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Issue: Wrong flow being selected</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Check all matching flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder = $order-&gt;makeFlowPicker();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$candidates = (new FlowPicker())-&gt;pick($order, $builder-&gt;returnCandidates(true));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// See which flows match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($candidates as $candidate) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger()-&gt;info(&#x27;Matching flow&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;flow_id&#x27; =&gt; $candidate-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;version&#x27; =&gt; $candidate-&gt;version,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;is_default&#x27; =&gt; $candidate-&gt;is_default,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-not-binding">Flow Not Binding<a href="#flow-not-binding" class="hash-link" aria-label="Direct link to Flow Not Binding" title="Direct link to Flow Not Binding" translate="no">​</a></h3>
<p>If a flow is not being bound automatically:</p>
<ol>
<li class="">Check that a flow exists with the correct <code>subject_type</code></li>
<li class="">Verify the flow is active and matches your selection criteria</li>
<li class="">Check the <code>buildFlowPicker()</code> configuration</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="status-column-missing">Status Column Missing<a href="#status-column-missing" class="hash-link" aria-label="Direct link to Status Column Missing" title="Direct link to Status Column Missing" translate="no">​</a></h3>
<p>If you get an error about missing status column:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Error: Model Order must have a &quot;status&quot; column in table &quot;orders&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Solution: Add the column in a migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Schema::table(&#x27;orders&#x27;, function (Blueprint $table) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;string(&#x27;status&#x27;)-&gt;nullable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enum-not-detected">Enum Not Detected<a href="#enum-not-detected" class="hash-link" aria-label="Direct link to Enum Not Detected" title="Direct link to Enum Not Detected" translate="no">​</a></h3>
<p>If enum values are not being detected:</p>
<ol>
<li class="">Ensure the enum class exists and is properly imported</li>
<li class="">Check that the <code>$casts</code> array includes the status column</li>
<li class="">For custom enums, implement a <code>values()</code> static method</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-picking-returns-null">Flow Picking Returns Null<a href="#flow-picking-returns-null" class="hash-link" aria-label="Direct link to Flow Picking Returns Null" title="Direct link to Flow Picking Returns Null" translate="no">​</a></h3>
<p>If <code>pickFlow()</code> returns <code>null</code>, no binding is created (no error thrown):</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::create([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If pickFlow() returns null, no FlowUse record is created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This is intentional - not all models need workflows</span><br></span></code></pre></div></div>
<p><strong>Common reasons for null:</strong></p>
<ol>
<li class="">No flows match the selection criteria</li>
<li class="">All matching flows are inactive</li>
<li class="">Rollout percentage excludes this model</li>
<li class="">Active window doesn&#x27;t include current time</li>
<li class="">Fallback cascade exhausted all options</li>
</ol>
<p><strong>Debugging:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Preview which flow would be selected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$flow = Flow::previewPick($order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!$flow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // No flow matches - check your buildFlowPicker() configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Or check if flows exist with matching criteria</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multiple-flows-match">Multiple Flows Match<a href="#multiple-flows-match" class="hash-link" aria-label="Direct link to Multiple Flows Match" title="Direct link to Multiple Flows Match" translate="no">​</a></h3>
<p>When multiple flows match the criteria, the system uses ordering to select the best one:</p>
<ol>
<li class=""><strong>Version</strong> (DESC): Higher versions preferred</li>
<li class=""><strong>is_default</strong> (DESC): Default flows preferred</li>
<li class=""><strong>ordering</strong> (DESC): Higher ordering preferred</li>
<li class=""><strong>id</strong> (DESC): Higher ID as tiebreaker</li>
</ol>
<p>You can customize this with <code>orderBy()</code>:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;orderBy(function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $query-&gt;orderBy(&#x27;priority&#x27;, &#x27;desc&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              -&gt;orderBy(&#x27;created_at&#x27;, &#x27;asc&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fallback-cascade-exhausted">Fallback Cascade Exhausted<a href="#fallback-cascade-exhausted" class="hash-link" aria-label="Direct link to Fallback Cascade Exhausted" title="Direct link to Fallback Cascade Exhausted" translate="no">​</a></h3>
<p>If all fallback steps are exhausted and no flow is found:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// No flow will be bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// No error is thrown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Model is created successfully without workflow</span><br></span></code></pre></div></div>
<p>This is intentional - workflows are optional. If you need to enforce workflow binding, check after creation:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::create([...]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!$order-&gt;boundFlow()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new \Exception(&#x27;Order must have a workflow&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related-documentation">Related Documentation<a href="#related-documentation" class="hash-link" aria-label="Direct link to Related Documentation" title="Direct link to Related Documentation" translate="no">​</a></h2>
<ul>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/has-flow">HasFlow</a> - Simple flow binding for single-flow scenarios</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/support/flow-picker-builder">FlowPickerBuilder</a> - Customizing flow selection logic</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/support/flow-picker">FlowPicker</a> - Understanding flow picking mechanism</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow">Flow Service</a> - Managing workflows</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow-state">FlowState Service</a> - Managing states</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow-transition">FlowTransition Service</a> - Executing transitions</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/transition-result">TransitionResult</a> - Understanding transition results</li>
<li class=""><a class="" href="/packages/laravel-flow/installation">Installation</a> - Package installation guide</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/has-workflow.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/packages/laravel-flow/showcase"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Showcase</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/packages/laravel-flow/deep-diving/has-flow"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">HasFlow</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#when-to-use-hasworkflow" class="table-of-contents__link toc-highlight">When to Use HasWorkflow</a></li><li><a href="#hasworkflow-vs-hasflow" class="table-of-contents__link toc-highlight">HasWorkflow vs HasFlow</a></li><li><a href="#namespace" class="table-of-contents__link toc-highlight">Namespace</a></li><li><a href="#basic-usage" class="table-of-contents__link toc-highlight">Basic Usage</a></li><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href="#status-column" class="table-of-contents__link toc-highlight">Status Column</a></li><li><a href="#flow-configuration" class="table-of-contents__link toc-highlight">Flow Configuration</a></li><li><a href="#database-migration-example" class="table-of-contents__link toc-highlight">Database Migration Example</a></li></ul></li><li><a href="#automatic-flow-binding" class="table-of-contents__link toc-highlight">Automatic Flow Binding</a></li><li><a href="#customizing-flow-selection" class="table-of-contents__link toc-highlight">Customizing Flow Selection</a><ul><li><a href="#override-buildflowpicker" class="table-of-contents__link toc-highlight">Override buildFlowPicker</a></li><li><a href="#flowpickerbuilder-options" class="table-of-contents__link toc-highlight">FlowPickerBuilder Options</a></li><li><a href="#subject-collection" class="table-of-contents__link toc-highlight">Subject Collection</a></li></ul></li><li><a href="#working-with-bound-flows" class="table-of-contents__link toc-highlight">Working with Bound Flows</a><ul><li><a href="#get-bound-flow" class="table-of-contents__link toc-highlight">Get Bound Flow</a></li><li><a href="#flow-use-relation" class="table-of-contents__link toc-highlight">Flow Use Relation</a></li><li><a href="#eager-loading" class="table-of-contents__link toc-highlight">Eager Loading</a></li></ul></li><li><a href="#manual-flow-binding" class="table-of-contents__link toc-highlight">Manual Flow Binding</a><ul><li><a href="#bind-flow" class="table-of-contents__link toc-highlight">Bind Flow</a></li><li><a href="#rebind-flow" class="table-of-contents__link toc-highlight">Rebind Flow</a></li><li><a href="#unbind-flow" class="table-of-contents__link toc-highlight">Unbind Flow</a></li></ul></li><li><a href="#flow-picking" class="table-of-contents__link toc-highlight">Flow Picking</a><ul><li><a href="#pick-flow" class="table-of-contents__link toc-highlight">Pick Flow</a></li><li><a href="#understanding-makeflowpicker" class="table-of-contents__link toc-highlight">Understanding makeFlowPicker()</a></li><li><a href="#preview-flow-selection" class="table-of-contents__link toc-highlight">Preview Flow Selection</a></li></ul></li><li><a href="#status-management" class="table-of-contents__link toc-highlight">Status Management</a><ul><li><a href="#current-status-value" class="table-of-contents__link toc-highlight">Current Status Value</a></li><li><a href="#status-enum-support" class="table-of-contents__link toc-highlight">Status Enum Support</a></li><li><a href="#custom-status-enum" class="table-of-contents__link toc-highlight">Custom Status Enum</a></li><li><a href="#enum-detection-priority" class="table-of-contents__link toc-highlight">Enum Detection Priority</a></li><li><a href="#getting-current-status" class="table-of-contents__link toc-highlight">Getting Current Status</a></li></ul></li><li><a href="#advanced-flowpickerbuilder-examples" class="table-of-contents__link toc-highlight">Advanced FlowPickerBuilder Examples</a><ul><li><a href="#multi-tenant-application" class="table-of-contents__link toc-highlight">Multi-Tenant Application</a></li><li><a href="#ab-testing-with-rollout" class="table-of-contents__link toc-highlight">A/B Testing with Rollout</a></li><li><a href="#environment-specific-workflows" class="table-of-contents__link toc-highlight">Environment-Specific Workflows</a></li><li><a href="#channel-based-workflows" class="table-of-contents__link toc-highlight">Channel-Based Workflows</a></li><li><a href="#collection-based-workflows" class="table-of-contents__link toc-highlight">Collection-Based Workflows</a></li><li><a href="#scheduled-workflows" class="table-of-contents__link toc-highlight">Scheduled Workflows</a></li><li><a href="#complex-multi-criteria-selection" class="table-of-contents__link toc-highlight">Complex Multi-Criteria Selection</a></li></ul></li><li><a href="#complete-example" class="table-of-contents__link toc-highlight">Complete Example</a></li><li><a href="#real-world-scenarios" class="table-of-contents__link toc-highlight">Real-World Scenarios</a><ul><li><a href="#scenario-1-multi-tenant-saas-application" class="table-of-contents__link toc-highlight">Scenario 1: Multi-Tenant SaaS Application</a></li><li><a href="#scenario-2-e-commerce-with-ab-testing" class="table-of-contents__link toc-highlight">Scenario 2: E-Commerce with A/B Testing</a></li><li><a href="#scenario-3-content-management-with-collections" class="table-of-contents__link toc-highlight">Scenario 3: Content Management with Collections</a></li><li><a href="#scenario-4-scheduled-workflow-activation" class="table-of-contents__link toc-highlight">Scenario 4: Scheduled Workflow Activation</a></li><li><a href="#scenario-5-complex-multi-criteria-selection" class="table-of-contents__link toc-highlight">Scenario 5: Complex Multi-Criteria Selection</a></li></ul></li><li><a href="#lifecycle-events" class="table-of-contents__link toc-highlight">Lifecycle Events</a><ul><li><a href="#creating-event" class="table-of-contents__link toc-highlight">Creating Event</a></li><li><a href="#created-event" class="table-of-contents__link toc-highlight">Created Event</a></li><li><a href="#understanding-selectedflowidforbinding" class="table-of-contents__link toc-highlight">Understanding selectedFlowIdForBinding</a></li><li><a href="#skipping-automatic-binding" class="table-of-contents__link toc-highlight">Skipping Automatic Binding</a></li></ul></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance Optimization</a><ul><li><a href="#caching-flow-picker-results" class="table-of-contents__link toc-highlight">Caching Flow Picker Results</a></li><li><a href="#optimizing-flow-queries" class="table-of-contents__link toc-highlight">Optimizing Flow Queries</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#testing-and-debugging" class="table-of-contents__link toc-highlight">Testing and Debugging</a><ul><li><a href="#testing-flow-selection" class="table-of-contents__link toc-highlight">Testing Flow Selection</a></li><li><a href="#debugging-flow-picker-configuration" class="table-of-contents__link toc-highlight">Debugging Flow Picker Configuration</a></li><li><a href="#testing-rollout" class="table-of-contents__link toc-highlight">Testing Rollout</a></li><li><a href="#verifying-flow-binding" class="table-of-contents__link toc-highlight">Verifying Flow Binding</a></li><li><a href="#common-issues-and-solutions" class="table-of-contents__link toc-highlight">Common Issues and Solutions</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#flow-not-binding" class="table-of-contents__link toc-highlight">Flow Not Binding</a></li><li><a href="#status-column-missing" class="table-of-contents__link toc-highlight">Status Column Missing</a></li><li><a href="#enum-not-detected" class="table-of-contents__link toc-highlight">Enum Not Detected</a></li><li><a href="#flow-picking-returns-null" class="table-of-contents__link toc-highlight">Flow Picking Returns Null</a></li><li><a href="#multiple-flows-match" class="table-of-contents__link toc-highlight">Multiple Flows Match</a></li><li><a href="#fallback-cascade-exhausted" class="table-of-contents__link toc-highlight">Fallback Cascade Exhausted</a></li></ul></li><li><a href="#related-documentation" class="table-of-contents__link toc-highlight">Related Documentation</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2026 JobMetric.</div></div></div></footer></div>
</body>
</html>