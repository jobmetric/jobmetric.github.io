<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-packages docs-version-current docs-doc-page docs-doc-id-laravel-flow/deep-diving/support/flow-picker-builder" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">FlowPickerBuilder | JobMetric</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jobmetric.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jobmetric.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jobmetric.github.io/packages/laravel-flow/deep-diving/support/flow-picker-builder"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-packages-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-packages-current"><meta data-rh="true" property="og:title" content="FlowPickerBuilder | JobMetric"><meta data-rh="true" name="description" content="The FlowPickerBuilder defines the constraints and selection strategy used by the FlowPicker to choose a Flow. It centralizes all filters, ordering preferences, match strategy, fallback cascade steps, and performance hints."><meta data-rh="true" property="og:description" content="The FlowPickerBuilder defines the constraints and selection strategy used by the FlowPicker to choose a Flow. It centralizes all filters, ordering preferences, match strategy, fallback cascade steps, and performance hints."><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/support/flow-picker-builder"><link data-rh="true" rel="alternate" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/support/flow-picker-builder" hreflang="en"><link data-rh="true" rel="alternate" href="https://jobmetric.github.io/packages/laravel-flow/deep-diving/support/flow-picker-builder" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Laravel Flow","item":"https://jobmetric.github.io/packages/laravel-flow/"},{"@type":"ListItem","position":2,"name":"FlowPickerBuilder","item":"https://jobmetric.github.io/packages/laravel-flow/deep-diving/support/flow-picker-builder"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="JobMetric RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="JobMetric Atom Feed"><link rel="stylesheet" href="/assets/css/styles.aeeec671.css">
<script src="/assets/js/runtime~main.c43db54c.js" defer="defer"></script>
<script src="/assets/js/main.f7555845.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="JobMetric Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="JobMetric Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JobMetric</b></a><div class="navbar__item"><div id="projects-dropdown-container"></div></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/packages/intro">Packages</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/team">Team</a><a href="https://github.com/jobmetric" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/intro"><span title="Packages" class="linkLabel_WmDU">Packages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/contributing"><span title="Contributing" class="linkLabel_WmDU">Contributing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/packages/licence"><span title="License" class="linkLabel_WmDU">License</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/packages/laravel-flow/"><span title="Laravel Flow" class="categoryLinkLabel_W154">Laravel Flow</span></a><button aria-label="Collapse sidebar category &#x27;Laravel Flow&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/intro"><span title="Getting Started" class="linkLabel_WmDU">Getting Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/installation"><span title="Installation" class="linkLabel_WmDU">Installation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/showcase"><span title="Showcase" class="linkLabel_WmDU">Showcase</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/packages/laravel-flow/deep-diving/has-workflow"><span title="Deep Diving in Document" class="categoryLinkLabel_W154">Deep Diving in Document</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/has-workflow"><span title="HasWorkflow" class="linkLabel_WmDU">HasWorkflow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/has-flow"><span title="HasFlow" class="linkLabel_WmDU">HasFlow</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/services/flow"><span title="Services" class="categoryLinkLabel_W154">Services</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/make-task"><span title="MakeTask Command" class="linkLabel_WmDU">MakeTask Command</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-task-registry"><span title="Support" class="categoryLinkLabel_W154">Support</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-task-registry"><span title="FlowTaskRegistry" class="linkLabel_WmDU">FlowTaskRegistry</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-picker"><span title="FlowPicker" class="linkLabel_WmDU">FlowPicker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-picker-builder"><span title="FlowPickerBuilder" class="linkLabel_WmDU">FlowPickerBuilder</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/flow-task-context"><span title="FlowTaskContext" class="linkLabel_WmDU">FlowTaskContext</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/support/restriction-result"><span title="RestrictionResult" class="linkLabel_WmDU">RestrictionResult</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/requests/store-flow-request"><span title="Requests" class="categoryLinkLabel_W154">Requests</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/resources/flow-resource"><span title="Resources" class="categoryLinkLabel_W154">Resources</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/events"><span title="Events" class="linkLabel_WmDU">Events</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/packages/laravel-flow/deep-diving/transition-result"><span title="TransitionResult DTO" class="linkLabel_WmDU">TransitionResult DTO</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/packages/laravel-flow/deep-diving/rules/check-status-in-driver-rule"><span title="Rules" class="categoryLinkLabel_W154">Rules</span></a></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-translation/"><span title="Laravel Translation" class="categoryLinkLabel_W154">Laravel Translation</span></a><button aria-label="Expand sidebar category &#x27;Laravel Translation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-event-system/"><span title="Laravel Event System" class="categoryLinkLabel_W154">Laravel Event System</span></a><button aria-label="Expand sidebar category &#x27;Laravel Event System&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-env-modifier/"><span title="Laravel Env Modifier" class="categoryLinkLabel_W154">Laravel Env Modifier</span></a><button aria-label="Expand sidebar category &#x27;Laravel Env Modifier&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-metadata/"><span title="Laravel Metadata" class="categoryLinkLabel_W154">Laravel Metadata</span></a><button aria-label="Expand sidebar category &#x27;Laravel Metadata&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-custom-field/"><span title="Laravel Custom Field" class="categoryLinkLabel_W154">Laravel Custom Field</span></a><button aria-label="Expand sidebar category &#x27;Laravel Custom Field&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-form/"><span title="Laravel Form" class="categoryLinkLabel_W154">Laravel Form</span></a><button aria-label="Expand sidebar category &#x27;Laravel Form&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-reaction/"><span title="Laravel Reaction" class="categoryLinkLabel_W154">Laravel Reaction</span></a><button aria-label="Expand sidebar category &#x27;Laravel Reaction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-star/"><span title="Laravel Star" class="categoryLinkLabel_W154">Laravel Star</span></a><button aria-label="Expand sidebar category &#x27;Laravel Star&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-language/"><span title="Laravel Language" class="categoryLinkLabel_W154">Laravel Language</span></a><button aria-label="Expand sidebar category &#x27;Laravel Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/packages/laravel-url/"><span title="Laravel URL" class="categoryLinkLabel_W154">Laravel URL</span></a><button aria-label="Expand sidebar category &#x27;Laravel URL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/packages/laravel-flow/"><span>Laravel Flow</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deep Diving in Document</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Support</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">FlowPickerBuilder</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FlowPickerBuilder</h1></header>
<p>The <code>FlowPickerBuilder</code> defines the constraints and selection strategy used by the <code>FlowPicker</code> to choose a Flow. It centralizes all filters, ordering preferences, match strategy, fallback cascade steps, and performance hints.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="namespace">Namespace<a href="#namespace" class="hash-link" aria-label="Direct link to Namespace" title="Direct link to Namespace" translate="no">​</a></h2>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">JobMetric\Flow\Support\FlowPickerBuilder</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="where-and-when-to-use-flowpickerbuilder">Where and When to Use FlowPickerBuilder<a href="#where-and-when-to-use-flowpickerbuilder" class="hash-link" aria-label="Direct link to Where and When to Use FlowPickerBuilder" title="Direct link to Where and When to Use FlowPickerBuilder" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="primary-use-cases">Primary Use Cases<a href="#primary-use-cases" class="hash-link" aria-label="Direct link to Primary Use Cases" title="Direct link to Primary Use Cases" translate="no">​</a></h3>
<p><strong>FlowPickerBuilder is used in the following scenarios:</strong></p>
<ol>
<li class="">
<p><strong>HasWorkflow Trait Integration</strong></p>
<ul>
<li class="">When models use <code>HasWorkflow</code> trait, they override <code>buildFlowPicker()</code> method</li>
<li class="">This method receives a <code>FlowPickerBuilder</code> instance to configure flow selection</li>
<li class="">Used automatically during model creation to select the appropriate flow</li>
</ul>
</li>
<li class="">
<p><strong>HasFlow Trait Integration</strong></p>
<ul>
<li class="">When models use <code>HasFlow</code> trait, they also use <code>buildFlowPicker()</code> internally</li>
<li class="">Uses <code>forceFlowIdResolver</code> to bypass complex selection logic</li>
<li class="">Directly binds flows by ID while still using the builder pattern</li>
</ul>
</li>
<li class="">
<p><strong>Flow Service Preview</strong></p>
<ul>
<li class="">When using <code>Flow::previewPick()</code> to preview which flow would be selected</li>
<li class="">Allows testing flow selection logic without actually binding flows</li>
<li class="">Useful for debugging and validation</li>
</ul>
</li>
<li class="">
<p><strong>Manual Flow Selection</strong></p>
<ul>
<li class="">When manually selecting flows outside of automatic binding</li>
<li class="">When building custom flow selection logic</li>
<li class="">When implementing advanced flow routing scenarios</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-scenarios">Key Scenarios<a href="#key-scenarios" class="hash-link" aria-label="Direct link to Key Scenarios" title="Direct link to Key Scenarios" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-1-multi-tenant-applications">Scenario 1: Multi-Tenant Applications<a href="#scenario-1-multi-tenant-applications" class="hash-link" aria-label="Direct link to Scenario 1: Multi-Tenant Applications" title="Direct link to Scenario 1: Multi-Tenant Applications" translate="no">​</a></h4>
<p><strong>When:</strong> Different tenants need different workflows for the same model type.</p>
<p><strong>How:</strong> Use <code>subjectScope()</code> to partition flows by tenant:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;subjectScope((string)$this-&gt;tenant_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-2-environment-specific-workflows">Scenario 2: Environment-Specific Workflows<a href="#scenario-2-environment-specific-workflows" class="hash-link" aria-label="Direct link to Scenario 2: Environment-Specific Workflows" title="Direct link to Scenario 2: Environment-Specific Workflows" translate="no">​</a></h4>
<p><strong>When:</strong> Different workflows for production, staging, and development.</p>
<p><strong>How:</strong> Use <code>environment()</code> filter:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-3-channel-based-workflows">Scenario 3: Channel-Based Workflows<a href="#scenario-3-channel-based-workflows" class="hash-link" aria-label="Direct link to Scenario 3: Channel-Based Workflows" title="Direct link to Scenario 3: Channel-Based Workflows" translate="no">​</a></h4>
<p><strong>When:</strong> Different workflows for web, API, and mobile channels.</p>
<p><strong>How:</strong> Use <code>channel()</code> filter:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-4-ab-testing-and-gradual-rollouts">Scenario 4: A/B Testing and Gradual Rollouts<a href="#scenario-4-ab-testing-and-gradual-rollouts" class="hash-link" aria-label="Direct link to Scenario 4: A/B Testing and Gradual Rollouts" title="Direct link to Scenario 4: A/B Testing and Gradual Rollouts" translate="no">​</a></h4>
<p><strong>When:</strong> Gradually rolling out new workflows to a percentage of users.</p>
<p><strong>How:</strong> Use rollout configuration:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;rolloutNamespace(&#x27;order_v2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-5-collection-based-workflows">Scenario 5: Collection-Based Workflows<a href="#scenario-5-collection-based-workflows" class="hash-link" aria-label="Direct link to Scenario 5: Collection-Based Workflows" title="Direct link to Scenario 5: Collection-Based Workflows" translate="no">​</a></h4>
<p><strong>When:</strong> Different workflows based on model attributes (e.g., premium vs standard orders).</p>
<p><strong>How:</strong> Use <code>subjectCollection()</code>:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;subjectCollection($this-&gt;order_type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-6-scheduled-workflow-activation">Scenario 6: Scheduled Workflow Activation<a href="#scenario-6-scheduled-workflow-activation" class="hash-link" aria-label="Direct link to Scenario 6: Scheduled Workflow Activation" title="Direct link to Scenario 6: Scheduled Workflow Activation" translate="no">​</a></h4>
<p><strong>When:</strong> Workflows that activate/deactivate at specific times.</p>
<p><strong>How:</strong> Use active window constraints:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;ignoreTimeWindow(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-7-version-management">Scenario 7: Version Management<a href="#scenario-7-version-management" class="hash-link" aria-label="Direct link to Scenario 7: Version Management" title="Direct link to Scenario 7: Version Management" translate="no">​</a></h4>
<p><strong>When:</strong> Managing multiple versions of workflows and migrating between them.</p>
<p><strong>How:</strong> Use version constraints:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;versionAtLeast(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;versionAtMost(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-8-fallback-strategies">Scenario 8: Fallback Strategies<a href="#scenario-8-fallback-strategies" class="hash-link" aria-label="Direct link to Scenario 8: Fallback Strategies" title="Direct link to Scenario 8: Fallback Strategies" translate="no">​</a></h4>
<p><strong>When:</strong> Need graceful degradation when exact flow match is not found.</p>
<p><strong>How:</strong> Use fallback cascade:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-not-to-use-flowpickerbuilder">When NOT to Use FlowPickerBuilder<a href="#when-not-to-use-flowpickerbuilder" class="hash-link" aria-label="Direct link to When NOT to Use FlowPickerBuilder" title="Direct link to When NOT to Use FlowPickerBuilder" translate="no">​</a></h3>
<p><strong>You typically don&#x27;t need to use FlowPickerBuilder directly when:</strong></p>
<ul>
<li class="">Using <code>HasFlow</code> trait with simple flow ID resolution (it&#x27;s handled internally)</li>
<li class="">Working with single, fixed flows per model type</li>
<li class="">Flow selection logic is straightforward and doesn&#x27;t change</li>
</ul>
<p><strong>In these cases, use <code>HasFlow</code> instead of <code>HasWorkflow</code>.</strong></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>The builder provides a fluent interface to configure:</p>
<ul>
<li class=""><strong>Subject filters</strong>: Type, scope, collection</li>
<li class=""><strong>Environment/Channel filters</strong>: Production, staging, web, API, etc.</li>
<li class=""><strong>Active constraints</strong>: Status and time windows</li>
<li class=""><strong>Rollout gating</strong>: Gradual feature rollouts</li>
<li class=""><strong>Version constraints</strong>: Exact version or version ranges</li>
<li class=""><strong>Include/Exclude lists</strong>: Whitelist and blacklist flows</li>
<li class=""><strong>Preferential ordering</strong>: Boost certain flows in ordering</li>
<li class=""><strong>Match strategy</strong>: BEST (default) or FIRST</li>
<li class=""><strong>Fallback cascade</strong>: Progressive constraint relaxation</li>
<li class=""><strong>Request caching</strong>: Performance optimization</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="constants">Constants<a href="#constants" class="hash-link" aria-label="Direct link to Constants" title="Direct link to Constants" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="match-strategy">Match Strategy<a href="#match-strategy" class="hash-link" aria-label="Direct link to Match Strategy" title="Direct link to Match Strategy" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FlowPickerBuilder::STRATEGY_BEST  // Best candidate based on ordering (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FlowPickerBuilder::STRATEGY_FIRST // First matching record</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fallback-steps">Fallback Steps<a href="#fallback-steps" class="hash-link" aria-label="Direct link to Fallback Steps" title="Direct link to Fallback Steps" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FlowPickerBuilder::FB_DROP_CHANNEL         // Remove channel filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FlowPickerBuilder::FB_DROP_ENVIRONMENT     // Remove environment filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FlowPickerBuilder::FB_IGNORE_TIMEWINDOW    // Ignore active window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FlowPickerBuilder::FB_DISABLE_ROLLOUT      // Disable rollout checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FlowPickerBuilder::FB_DROP_REQUIRE_DEFAULT // Don&#x27;t require is_default</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="subject-configuration">Subject Configuration<a href="#subject-configuration" class="hash-link" aria-label="Direct link to Subject Configuration" title="Direct link to Subject Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="subjecttype">subjectType()<a href="#subjecttype" class="hash-link" aria-label="Direct link to subjectType()" title="Direct link to subjectType()" translate="no">​</a></h3>
<p>Set the model class that flows are being selected for. This is the primary filter and is <strong>required</strong> for flow selection.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>class-string&lt;Model&gt; $class</code>: Fully qualified model class name</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>subject_type</code> column matches the provided class</li>
<li class="">Must be set before flow selection can work</li>
<li class="">Used internally by <code>HasWorkflow</code> and <code>HasFlow</code> traits</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(\App\Models\Order::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Matches flows with subject_type = &#x27;App\Models\Order&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="subjectscope">subjectScope()<a href="#subjectscope" class="hash-link" aria-label="Direct link to subjectScope()" title="Direct link to subjectScope()" translate="no">​</a></h3>
<p>Set optional subject scope to partition flows by domain (tenant, organization, etc.). This allows multiple flows for the same model type based on scope.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectScope((string)$order-&gt;tenant_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectScope(null); // Clear scope filter</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>?string $scope</code>: Scope identifier (e.g., tenant ID, org ID) or null to clear</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>subject_scope</code> column matches the provided value</li>
<li class="">When <code>null</code>, no scope filtering is applied</li>
<li class="">Useful for multi-tenant applications</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Tenant-specific flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectScope((string)$order-&gt;tenant_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Matches flows with subject_scope = &#x27;123&#x27; (tenant ID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Clear scope to match any scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectScope(null);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Multi-tenant SaaS applications</li>
<li class="">Organization-based workflows</li>
<li class="">Department-specific processes</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="subjectcollection">subjectCollection()<a href="#subjectcollection" class="hash-link" aria-label="Direct link to subjectCollection()" title="Direct link to subjectCollection()" translate="no">​</a></h3>
<p>Set optional subject collection to further partition flows. Collections allow different workflows for the same model type based on attributes.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectCollection($order-&gt;collection);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectCollection(null); // Clear collection filter</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>?string $collection</code>: Collection identifier (e.g., &#x27;premium&#x27;, &#x27;standard&#x27;, &#x27;enterprise&#x27;) or null to clear</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>subject_collection</code> column matches the provided value</li>
<li class="">When <code>null</code>, no collection filtering is applied</li>
<li class="">Can be combined with <code>subjectScope()</code> for fine-grained control</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Premium order workflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectCollection(&#x27;premium&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Matches flows with subject_collection = &#x27;premium&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Standard order workflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectCollection(&#x27;standard&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Matches flows with subject_collection = &#x27;standard&#x27;</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Different workflows for premium vs standard customers</li>
<li class="">Collection-based business rules</li>
<li class="">Attribute-driven workflow selection</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="environment-and-channel">Environment and Channel<a href="#environment-and-channel" class="hash-link" aria-label="Direct link to Environment and Channel" title="Direct link to Environment and Channel" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="environment">environment()<a href="#environment" class="hash-link" aria-label="Direct link to environment()" title="Direct link to environment()" translate="no">​</a></h3>
<p>Filter flows by environment. This restricts flows to a specific deployment environment.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(&#x27;production&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(null); // Clear filter</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>?string $environment</code>: Environment name (e.g., &#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;) or null to clear</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>environment</code> column matches the provided value</li>
<li class="">When <code>null</code>, no environment filtering is applied</li>
<li class="">Common values: &#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;, &#x27;testing&#x27;</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Production-only flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(&#x27;production&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Environment from config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Clear to match any environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;environment(null);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Different workflows per deployment environment</li>
<li class="">Testing workflows in staging</li>
<li class="">Production-specific business rules</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="channel">channel()<a href="#channel" class="hash-link" aria-label="Direct link to channel()" title="Direct link to channel()" translate="no">​</a></h3>
<p>Filter flows by channel. This restricts flows based on the request channel (web, API, mobile, etc.).</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(&#x27;web&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(null); // Clear filter</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>?string $channel</code>: Channel name (e.g., &#x27;web&#x27;, &#x27;api&#x27;, &#x27;mobile&#x27;, &#x27;admin&#x27;) or null to clear</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>channel</code> column matches the provided value</li>
<li class="">When <code>null</code>, no channel filtering is applied</li>
<li class="">Can be determined from request headers, routes, or user context</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Web-only flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(&#x27;web&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// API-only flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(&#x27;api&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// From request header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// From route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;channel(request()-&gt;is(&#x27;api/*&#x27;) ? &#x27;api&#x27; : &#x27;web&#x27;);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Different workflows for web vs API requests</li>
<li class="">Mobile-specific workflows</li>
<li class="">Admin panel workflows</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="preferenvironments">preferEnvironments()<a href="#preferenvironments" class="hash-link" aria-label="Direct link to preferEnvironments()" title="Direct link to preferEnvironments()" translate="no">​</a></h3>
<p>Set preferred environments for ordering (not filtering). This boosts certain environments in the ordering without filtering them out.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;]);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>array&lt;int,string&gt; $envs</code>: Array of preferred environment names</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class=""><strong>Not a filter</strong> - doesn&#x27;t exclude other environments</li>
<li class="">Earlier items in the array rank higher in ordering</li>
<li class="">Uses CASE-based SQL ordering to boost preferred values</li>
<li class="">Empty strings and null values are filtered out</li>
<li class="">Values are converted to strings</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Prefer production, then staging, then development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If multiple flows match, production will be selected first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// But development flows are still eligible if production doesn&#x27;t match</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Prefer production flows but allow staging as fallback</li>
<li class="">Environment priority ordering</li>
<li class="">Graceful degradation</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="preferchannels">preferChannels()<a href="#preferchannels" class="hash-link" aria-label="Direct link to preferChannels()" title="Direct link to preferChannels()" translate="no">​</a></h3>
<p>Set preferred channels for ordering (not filtering). This boosts certain channels in the ordering without filtering them out.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;, &#x27;mobile&#x27;]);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>array&lt;int,string&gt; $channels</code>: Array of preferred channel names</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class=""><strong>Not a filter</strong> - doesn&#x27;t exclude other channels</li>
<li class="">Earlier items in the array rank higher in ordering</li>
<li class="">Uses CASE-based SQL ordering to boost preferred values</li>
<li class="">Empty strings and null values are filtered out</li>
<li class="">Values are converted to strings</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Prefer web, then API, then mobile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;, &#x27;mobile&#x27;]);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Prefer web flows but allow API as fallback</li>
<li class="">Channel priority ordering</li>
<li class="">Multi-channel support with preferences</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="active-constraints">Active Constraints<a href="#active-constraints" class="hash-link" aria-label="Direct link to Active Constraints" title="Direct link to Active Constraints" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="onlyactive">onlyActive()<a href="#onlyactive" class="hash-link" aria-label="Direct link to onlyActive()" title="Direct link to onlyActive()" translate="no">​</a></h3>
<p>Require active flows. When enabled, only flows with <code>status=true</code> are eligible, and optionally time window checks are applied.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;onlyActive(true);  // Enforce active constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;onlyActive(false); // Disable active checks</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>bool $onlyActive</code>: Whether to enforce active constraints</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">When <code>true</code>: Requires <code>status = true</code> and optionally checks <code>active_from</code>/<code>active_to</code> time windows</li>
<li class="">When <code>false</code>: No active status or time window checks are applied</li>
<li class="">Time window checks can be disabled separately with <code>ignoreTimeWindow(true)</code></li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Only active flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;onlyActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Include inactive flows (for testing or admin)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;onlyActive(false);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Production workflows (only active)</li>
<li class="">Testing scenarios (include inactive)</li>
<li class="">Admin interfaces (show all flows)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ignoretimewindow">ignoreTimeWindow()<a href="#ignoretimewindow" class="hash-link" aria-label="Direct link to ignoreTimeWindow()" title="Direct link to ignoreTimeWindow()" translate="no">​</a></h3>
<p>Ignore <code>active_from</code>/<code>active_to</code> time window checks while keeping <code>status=true</code> requirement (if <code>onlyActive</code> is true).</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;ignoreTimeWindow(true);  // Ignore time window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;ignoreTimeWindow(false); // Enforce time window</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>bool $ignore = true</code>: Whether to ignore time window checks</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">When <code>true</code>: Only checks <code>status = true</code>, ignores <code>active_from</code> and <code>active_to</code></li>
<li class="">When <code>false</code>: Checks both <code>status = true</code> and time window constraints</li>
<li class="">Only has effect when <code>onlyActive(true)</code> is set</li>
<li class="">Useful for testing or when time windows are not needed</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Check status only, ignore time windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;ignoreTimeWindow(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check both status and time windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;ignoreTimeWindow(false);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Testing without time constraints</li>
<li class="">Workflows without scheduled activation</li>
<li class="">Simplified active checks</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="timenow">timeNow()<a href="#timenow" class="hash-link" aria-label="Direct link to timeNow()" title="Direct link to timeNow()" translate="no">​</a></h3>
<p>Set the reference &quot;now&quot; time in UTC for deterministic time window evaluation. This allows testing with specific times and ensures consistent evaluation.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;timeNow(Carbon::now(&#x27;UTC&#x27;));</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>DateTimeInterface $now</code>: UTC instant for time comparisons</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Sets the reference time used to evaluate <code>active_from</code> and <code>active_to</code> constraints</li>
<li class="">Must be in UTC timezone</li>
<li class="">When not set, <code>Carbon::now(&#x27;UTC&#x27;)</code> is used by FlowPicker</li>
<li class="">Useful for testing and deterministic evaluation</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Use current time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;timeNow(Carbon::now(&#x27;UTC&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use specific time for testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;timeNow(Carbon::parse(&#x27;2024-01-01 12:00:00&#x27;, &#x27;UTC&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use time from model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;timeNow($order-&gt;created_at-&gt;utc());</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Testing with specific times</li>
<li class="">Deterministic evaluation in tests</li>
<li class="">Time-based flow activation/deactivation</li>
<li class="">Scheduled workflow scenarios</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rollout-configuration">Rollout Configuration<a href="#rollout-configuration" class="hash-link" aria-label="Direct link to Rollout Configuration" title="Direct link to Rollout Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="evaluaterollout">evaluateRollout()<a href="#evaluaterollout" class="hash-link" aria-label="Direct link to evaluateRollout()" title="Direct link to evaluateRollout()" translate="no">​</a></h3>
<p>Enable or disable rollout gating. Rollout allows gradual feature deployment by assigning flows to a percentage of users based on a stable key.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;evaluateRollout(true);  // Enable rollout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;evaluateRollout(false); // Disable rollout</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>bool $enabled</code>: Whether rollout should be applied</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">When <code>true</code>: Applies rollout percentage checks using stable bucket hashing</li>
<li class="">When <code>false</code>: Ignores <code>rollout_pct</code> column, all flows are eligible</li>
<li class="">Requires <code>rolloutKeyResolver</code> to be set for proper operation</li>
<li class="">If no rollout key is available, only flows with <code>rollout_pct IS NULL</code> are eligible</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Enable gradual rollout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;evaluateRollout(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Disable for testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;evaluateRollout(false);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">A/B testing new workflows</li>
<li class="">Gradual feature rollouts</li>
<li class="">Canary deployments</li>
<li class="">Percentage-based user segmentation</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="rolloutnamespace">rolloutNamespace()<a href="#rolloutnamespace" class="hash-link" aria-label="Direct link to rolloutNamespace()" title="Direct link to rolloutNamespace()" translate="no">​</a></h3>
<p>Set namespace to isolate rollout bucket spaces across different domains or features. This ensures that rollout percentages are independent for different features.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutNamespace(&#x27;order_v2&#x27;);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>?string $ns</code>: Namespace string or null to clear</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Used in hash calculation to isolate buckets</li>
<li class="">Different namespaces create independent bucket spaces</li>
<li class="">When <code>null</code>, no namespace is used in hashing</li>
<li class="">Combined with salt and key to compute stable bucket</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Isolate order workflow rollout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutNamespace(&#x27;order_v2&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Isolate payment workflow rollout (independent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutNamespace(&#x27;payment_v3&#x27;);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Multiple feature rollouts running simultaneously</li>
<li class="">Independent A/B tests</li>
<li class="">Domain-specific rollouts</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="rolloutsalt">rolloutSalt()<a href="#rolloutsalt" class="hash-link" aria-label="Direct link to rolloutSalt()" title="Direct link to rolloutSalt()" translate="no">​</a></h3>
<p>Set salt to further stabilize or segregate rollout hashing. Salt allows version-specific or context-specific bucket assignment.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutSalt(&#x27;2024-01&#x27;);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>?string $salt</code>: Salt string or null to clear</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Used in hash calculation for additional stability/segregation</li>
<li class="">Changing salt redistributes buckets (users get different flows)</li>
<li class="">When <code>null</code>, no salt is used in hashing</li>
<li class="">Combined with namespace and key to compute stable bucket</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Version-specific salt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutSalt(&#x27;2024-01&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Date-based salt for monthly redistribution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutSalt(now()-&gt;format(&#x27;Y-m&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Clear salt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutSalt(null);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Version-specific rollouts</li>
<li class="">Time-based bucket redistribution</li>
<li class="">Further segregation of rollout spaces</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="rolloutkeyresolver">rolloutKeyResolver()<a href="#rolloutkeyresolver" class="hash-link" aria-label="Direct link to rolloutKeyResolver()" title="Direct link to rolloutKeyResolver()" translate="no">​</a></h3>
<p>Set resolver callback that returns a stable rollout key per model instance. The same key will always fall into the same bucket, ensuring consistent assignment.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutKeyResolver(function (Model $model): ?string {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>callable(Model):(?string) $resolver</code>: Callback that returns a stable key or null</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Called with the model instance to get a stable key</li>
<li class="">Key is used to compute bucket (0-99) via hash</li>
<li class="">Same key always produces same bucket (stable assignment)</li>
<li class="">When <code>null</code> or empty string, only flows with <code>rollout_pct IS NULL</code> are eligible</li>
<li class="">Common keys: <code>user_id</code>, <code>order_id</code>, <code>customer_id</code></li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Use user ID for consistent assignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use order ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (string)$model-&gt;getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use combination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $model-&gt;user_id . &#x27;_&#x27; . $model-&gt;tenant_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Bucket Calculation:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bucket = crc32(namespace + &#x27;|&#x27; + salt + &#x27;|&#x27; + key) % 100</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Consistent user assignment (same user always gets same flow)</li>
<li class="">Order-based assignment</li>
<li class="">Customer-based segmentation</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="version-constraints">Version Constraints<a href="#version-constraints" class="hash-link" aria-label="Direct link to Version Constraints" title="Direct link to Version Constraints" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="versionequals">versionEquals()<a href="#versionequals" class="hash-link" aria-label="Direct link to versionEquals()" title="Direct link to versionEquals()" translate="no">​</a></h3>
<p>Pin selection to an exact version. When set, <code>versionMin</code> and <code>versionMax</code> are ignored.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionEquals(2); // Only version 2</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>int $version</code>: Exact version number</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>version</code> column equals the provided value</li>
<li class=""><strong>Disables</strong> <code>versionMin</code> and <code>versionMax</code> if they were set</li>
<li class="">Most restrictive version constraint</li>
<li class="">Useful for testing specific versions or pinning to a known good version</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Only version 2 flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionEquals(2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This will ignore versionMin/versionMax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionEquals(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtLeast(1)  // Ignored</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtMost(3);  // Ignored</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Testing specific workflow versions</li>
<li class="">Pinning to stable versions</li>
<li class="">Version-specific deployments</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="versionatleast">versionAtLeast()<a href="#versionatleast" class="hash-link" aria-label="Direct link to versionAtLeast()" title="Direct link to versionAtLeast()" translate="no">​</a></h3>
<p>Set minimum allowed version (inclusive). Ignored when <code>versionEquals</code> is set.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionAtLeast(1); // Version &gt;= 1</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>int $min</code>: Minimum version number (inclusive)</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>version &gt;= $min</code></li>
<li class="">Ignored if <code>versionEquals</code> is set</li>
<li class="">Can be combined with <code>versionAtMost</code> for range</li>
<li class="">Useful for excluding older versions</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Versions 1 and above</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionAtLeast(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Combined with maximum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionAtLeast(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtMost(3); // Versions 1-3</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Excluding deprecated versions</li>
<li class="">Minimum version requirements</li>
<li class="">Version migration scenarios</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="versionatmost">versionAtMost()<a href="#versionatmost" class="hash-link" aria-label="Direct link to versionAtMost()" title="Direct link to versionAtMost()" translate="no">​</a></h3>
<p>Set maximum allowed version (inclusive). Ignored when <code>versionEquals</code> is set.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionAtMost(3); // Version &lt;= 3</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>int $max</code>: Maximum version number (inclusive)</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>version &lt;= $max</code></li>
<li class="">Ignored if <code>versionEquals</code> is set</li>
<li class="">Can be combined with <code>versionAtLeast</code> for range</li>
<li class="">Useful for excluding newer versions</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Versions 3 and below</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionAtMost(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Combined with minimum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionAtLeast(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtMost(3); // Versions 1-3</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Excluding beta versions</li>
<li class="">Maximum version limits</li>
<li class="">Gradual version migration</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="versionmin--versionmax">versionMin() / versionMax()<a href="#versionmin--versionmax" class="hash-link" aria-label="Direct link to versionMin() / versionMax()" title="Direct link to versionMin() / versionMax()" translate="no">​</a></h3>
<p>Alternative method names for <code>versionAtLeast()</code> and <code>versionAtMost()</code>. Functionally identical.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;versionMin(1)-&gt;versionMax(3); // Versions 1-3</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>versionMin(int $min)</code>: Minimum version (same as <code>versionAtLeast</code>)</li>
<li class=""><code>versionMax(int $max)</code>: Maximum version (same as <code>versionAtMost</code>)</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Note:</strong> These are aliases for <code>versionAtLeast()</code> and <code>versionAtMost()</code>. Use whichever naming you prefer.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="includeexcludeprefer">Include/Exclude/Prefer<a href="#includeexcludeprefer" class="hash-link" aria-label="Direct link to Include/Exclude/Prefer" title="Direct link to Include/Exclude/Prefer" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="includeflows">includeFlows()<a href="#includeflows" class="hash-link" aria-label="Direct link to includeFlows()" title="Direct link to includeFlows()" translate="no">​</a></h3>
<p>Restrict selection to only these flow IDs (whitelist). Only flows with IDs in this list are eligible.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;includeFlows([1, 2, 3]); // Only these flows</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>array&lt;int,int&gt; $ids</code>: Array of allowed flow IDs</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>id IN ($ids)</code></li>
<li class="">Empty array means no whitelist (all flows eligible)</li>
<li class="">Duplicate IDs are removed</li>
<li class="">Non-integer values are converted to integers</li>
<li class="">Array is re-indexed</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Only flows 1, 2, 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;includeFlows([1, 2, 3]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Single flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;includeFlows([1]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Clear whitelist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;includeFlows([]);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Testing specific flows</li>
<li class="">Limited flow selection</li>
<li class="">Flow subset scenarios</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="excludeflows">excludeFlows()<a href="#excludeflows" class="hash-link" aria-label="Direct link to excludeFlows()" title="Direct link to excludeFlows()" translate="no">​</a></h3>
<p>Exclude these flow IDs from selection (blacklist). Flows with IDs in this list are not eligible.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;excludeFlows([4, 5]); // Exclude these flows</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>array&lt;int,int&gt; $ids</code>: Array of disallowed flow IDs</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Filters flows where <code>id NOT IN ($ids)</code></li>
<li class="">Empty array means no blacklist</li>
<li class="">Duplicate IDs are removed</li>
<li class="">Non-integer values are converted to integers</li>
<li class="">Array is re-indexed</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Exclude flows 4, 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;excludeFlows([4, 5]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Exclude deprecated flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;excludeFlows([10, 11, 12]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Clear blacklist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;excludeFlows([]);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Excluding deprecated flows</li>
<li class="">Removing problematic flows</li>
<li class="">Testing without specific flows</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="preferflows">preferFlows()<a href="#preferflows" class="hash-link" aria-label="Direct link to preferFlows()" title="Direct link to preferFlows()" translate="no">​</a></h3>
<p>Prefer these flow IDs in ordering (not filtering). This boosts certain flows in the ordering without excluding others.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;preferFlows([1, 2]); // Boost these in ordering</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>array&lt;int,int&gt; $ids</code>: Array of preferred flow IDs</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class=""><strong>Not a filter</strong> - doesn&#x27;t exclude other flows</li>
<li class="">Earlier IDs in the array rank higher in ordering</li>
<li class="">Uses CASE-based SQL ordering to boost preferred IDs</li>
<li class="">Duplicate IDs are removed</li>
<li class="">Non-integer values are converted to integers</li>
<li class="">Array is re-indexed</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Prefer flows 1, 2, then 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;preferFlows([1, 2, 3]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If multiple flows match, flow 1 will be selected first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// But other flows are still eligible if 1, 2, 3 don&#x27;t match</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Preferring specific flows but allowing fallbacks</li>
<li class="">Priority-based flow selection</li>
<li class="">Testing flows with fallback options</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ordering">Ordering<a href="#ordering" class="hash-link" aria-label="Direct link to Ordering" title="Direct link to Ordering" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="orderbydefault">orderByDefault()<a href="#orderbydefault" class="hash-link" aria-label="Direct link to orderByDefault()" title="Direct link to orderByDefault()" translate="no">​</a></h3>
<p>Apply the default ordering strategy. This is the standard ordering used when no custom ordering is specified.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;orderByDefault();</span><br></span></code></pre></div></div>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Default Ordering (applied in order):</strong></p>
<ol>
<li class=""><code>version DESC</code> - Higher versions preferred</li>
<li class=""><code>is_default DESC</code> - Default flows preferred</li>
<li class=""><code>ordering DESC</code> - Higher ordering value preferred</li>
<li class=""><code>id DESC</code> - Higher ID as tiebreaker</li>
</ol>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Sets the <code>orderingCallback</code> to default implementation</li>
<li class="">Used automatically if no custom <code>orderBy()</code> is set</li>
<li class="">Only applies when <code>matchStrategy</code> is <code>STRATEGY_BEST</code></li>
<li class="">When <code>STRATEGY_FIRST</code>, minimal ordering is used instead</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Use default ordering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;orderByDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This is equivalent to:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;orderBy(function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;orderByDesc(&#x27;version&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;orderByDesc(&#x27;is_default&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;orderByDesc(&#x27;ordering&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;orderByDesc(&#x27;id&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Standard flow selection</li>
<li class="">Most common use case</li>
<li class="">When no special ordering is needed</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="orderby">orderBy()<a href="#orderby" class="hash-link" aria-label="Direct link to orderBy()" title="Direct link to orderBy()" translate="no">​</a></h3>
<p>Provide a custom ORDER BY callback to override default ordering. This allows complete control over how flows are sorted.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;orderBy(function (Builder $query): void {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;orderBy(&#x27;priority&#x27;, &#x27;desc&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          -&gt;orderBy(&#x27;created_at&#x27;, &#x27;asc&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>Closure(Builder):void $callback</code>: Ordering callback that receives the query builder</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Replaces default ordering with custom callback</li>
<li class="">Callback receives <code>Builder $query</code> parameter</li>
<li class="">Can apply any ordering logic</li>
<li class="">Only used when <code>matchStrategy</code> is <code>STRATEGY_BEST</code></li>
<li class="">When <code>STRATEGY_FIRST</code>, this is ignored</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Custom priority-based ordering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;orderBy(function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;orderByDesc(&#x27;priority&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;orderByAsc(&#x27;created_at&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Complex ordering with conditions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;orderBy(function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;orderByRaw(&#x27;CASE WHEN is_default = 1 THEN 0 ELSE 1 END&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;orderByDesc(&#x27;version&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Custom business logic ordering</li>
<li class="">Priority-based selection</li>
<li class="">Complex sorting requirements</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="matchstrategy">matchStrategy()<a href="#matchstrategy" class="hash-link" aria-label="Direct link to matchStrategy()" title="Direct link to matchStrategy()" translate="no">​</a></h3>
<p>Set the selection strategy for choosing flows when multiple candidates match.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;matchStrategy(FlowPickerBuilder::STRATEGY_BEST);  // Best candidate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;matchStrategy(FlowPickerBuilder::STRATEGY_FIRST); // First match</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>string $strategy</code>: Strategy constant (<code>STRATEGY_BEST</code> or <code>STRATEGY_FIRST</code>)</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Default:</strong> <code>STRATEGY_BEST</code></p>
<p><strong>STRATEGY_BEST:</strong></p>
<ul>
<li class="">Returns the best candidate based on ordering rules</li>
<li class="">Applies full ordering (version, is_default, ordering, id)</li>
<li class="">Uses custom <code>orderBy()</code> if provided</li>
<li class="">Most predictable and recommended</li>
</ul>
<p><strong>STRATEGY_FIRST:</strong></p>
<ul>
<li class="">Returns the very first matching record</li>
<li class="">Minimal ordering (just <code>id ASC</code>)</li>
<li class="">Ignores custom <code>orderBy()</code> callback</li>
<li class="">Faster but less predictable</li>
<li class="">Useful for testing or when order doesn&#x27;t matter</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Best candidate (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;matchStrategy(FlowPickerBuilder::STRATEGY_BEST);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// First match (faster)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;matchStrategy(FlowPickerBuilder::STRATEGY_FIRST);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class=""><strong>STRATEGY_BEST</strong>: Production use, predictable selection</li>
<li class=""><strong>STRATEGY_FIRST</strong>: Testing, performance-critical scenarios</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pickfirstmatch">pickFirstMatch()<a href="#pickfirstmatch" class="hash-link" aria-label="Direct link to pickFirstMatch()" title="Direct link to pickFirstMatch()" translate="no">​</a></h3>
<p>Convenience method to switch between first match and best match strategies.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;pickFirstMatch(true);  // STRATEGY_FIRST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;pickFirstMatch(false); // STRATEGY_BEST</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>bool $enabled = true</code>: Whether to pick first match</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">When <code>true</code>: Sets strategy to <code>STRATEGY_FIRST</code></li>
<li class="">When <code>false</code>: Sets strategy to <code>STRATEGY_BEST</code></li>
<li class="">Convenience wrapper around <code>matchStrategy()</code></li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Use first match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;pickFirstMatch(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use best match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;pickFirstMatch(false);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-filters">Custom Filters<a href="#custom-filters" class="hash-link" aria-label="Direct link to Custom Filters" title="Direct link to Custom Filters" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="where">where()<a href="#where" class="hash-link" aria-label="Direct link to where()" title="Direct link to where()" translate="no">​</a></h3>
<p>Attach a custom WHERE callback to extend query constraints. This allows adding any custom filtering logic beyond the standard filters.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;where(function (Builder $query, Model $model): void {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;where(&#x27;custom_field&#x27;, $model-&gt;some_attribute);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>Closure(Builder,Model):void $callback</code>: Callback receiving the query builder and model instance</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Callback is called after all standard filters are applied</li>
<li class="">Receives both <code>Builder $query</code> and <code>Model $model</code> parameters</li>
<li class="">Can add any WHERE conditions</li>
<li class="">Multiple callbacks can be chained</li>
<li class=""><strong>Disables request caching</strong> (dynamic callbacks prevent safe caching)</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Single custom filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;where(&#x27;custom_field&#x27;, $model-&gt;some_attribute);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Multiple filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;where(&#x27;field1&#x27;, $model-&gt;attr1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;where(&#x27;field2&#x27;, $model-&gt;attr2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Complex conditions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($model-&gt;is_premium) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $query-&gt;where(&#x27;is_premium_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $query-&gt;where(&#x27;is_premium_flow&#x27;, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Custom business logic filtering</li>
<li class="">Complex conditional filters</li>
<li class="">Model-specific requirements</li>
<li class="">Dynamic filtering based on model state</li>
</ul>
<p><strong>Important:</strong> Using <code>where()</code> disables request caching because callbacks are dynamic and may depend on model state.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="fallback-cascade">Fallback Cascade<a href="#fallback-cascade" class="hash-link" aria-label="Direct link to Fallback Cascade" title="Direct link to Fallback Cascade" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fallbackcascade">fallbackCascade()<a href="#fallbackcascade" class="hash-link" aria-label="Direct link to fallbackCascade()" title="Direct link to fallbackCascade()" translate="no">​</a></h3>
<p>Define an ordered list of fallback steps to progressively relax constraints when no flow matches initially. Steps are tried in order until a match is found.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>array&lt;int,string&gt; $steps</code>: Ordered array of fallback step constants</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Steps are tried <strong>in order</strong> until a match is found</li>
<li class="">First step that produces candidates wins (selection stops)</li>
<li class="">Invalid step constants are automatically filtered out</li>
<li class="">Only recognized <code>FB_*</code> constants are kept</li>
<li class="">Empty array means no fallback (returns null if no match)</li>
</ul>
<p><strong>Available Fallback Steps:</strong></p>
<ol>
<li class="">
<p><strong><code>FB_DROP_CHANNEL</code></strong>: Remove the channel filter</p>
<ul>
<li class="">Allows flows from any channel</li>
<li class="">Useful when channel-specific flows aren&#x27;t available</li>
</ul>
</li>
<li class="">
<p><strong><code>FB_DROP_ENVIRONMENT</code></strong>: Remove the environment filter</p>
<ul>
<li class="">Allows flows from any environment</li>
<li class="">Useful when environment-specific flows aren&#x27;t available</li>
</ul>
</li>
<li class="">
<p><strong><code>FB_IGNORE_TIMEWINDOW</code></strong>: Ignore <code>active_from</code>/<code>active_to</code> checks</p>
<ul>
<li class="">Keeps <code>status=true</code> requirement</li>
<li class="">Useful when flows are outside active window</li>
</ul>
</li>
<li class="">
<p><strong><code>FB_DISABLE_ROLLOUT</code></strong>: Disable rollout gating entirely</p>
<ul>
<li class="">Ignores <code>rollout_pct</code> column</li>
<li class="">Useful when rollout prevents matching</li>
</ul>
</li>
<li class="">
<p><strong><code>FB_DROP_REQUIRE_DEFAULT</code></strong>: Don&#x27;t require <code>is_default=true</code></p>
<ul>
<li class="">Allows non-default flows</li>
<li class="">Useful when only default flows are required initially</li>
</ul>
</li>
</ol>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Progressive fallback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_CHANNEL,        // Try without channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_ENVIRONMENT,    // Try without environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,   // Try ignoring time window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Invalid steps are ignored</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;invalid_step&#x27;,                              // Ignored</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FlowPickerBuilder::FB_DROP_CHANNEL,         // Used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Graceful degradation when exact match not found</li>
<li class="">Flexible flow selection</li>
<li class="">Fallback to less specific flows</li>
<li class="">Ensuring a flow is always found when possible</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="force-flow-id">Force Flow ID<a href="#force-flow-id" class="hash-link" aria-label="Direct link to Force Flow ID" title="Direct link to Force Flow ID" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="forceflowidresolver">forceFlowIdResolver()<a href="#forceflowidresolver" class="hash-link" aria-label="Direct link to forceFlowIdResolver()" title="Direct link to forceFlowIdResolver()" translate="no">​</a></h3>
<p>Provide a resolver that can force a specific Flow ID from the model. When set, this bypasses all complex selection logic and directly resolves the Flow by ID.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;forceFlowIdResolver(function (Model $model): ?int {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $model-&gt;flowId(); // Direct Flow ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>callable(Model):(?int) $resolver</code>: Callback returning a Flow ID or null</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class=""><strong>Bypasses all selection logic</strong> (subject, environment, channel, rollout, etc.)</li>
<li class="">Directly loads Flow by ID from database</li>
<li class="">Still validates active constraints if <code>onlyActive(true)</code> is set</li>
<li class="">When resolver returns <code>null</code>, normal selection logic is used</li>
<li class=""><strong>Disables request caching</strong> (dynamic resolver prevents safe caching)</li>
</ul>
<p><strong>Used by:</strong> <code>HasFlow</code> trait for direct ID binding</p>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Direct Flow ID from model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;forceFlowIdResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $model-&gt;flow_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// From method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;forceFlowIdResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $model-&gt;resolveFlowId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// From config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;forceFlowIdResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return config(&#x27;flows.order_flow_id&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Direct Flow ID binding (HasFlow trait)</li>
<li class="">Simplified flow selection</li>
<li class="">Explicit flow assignment</li>
<li class="">Bypassing complex selection logic</li>
</ul>
<p><strong>Important:</strong> When <code>forceFlowIdResolver</code> is set, all other selection criteria are ignored. Only active constraints (if enabled) are still validated.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="default-requirement">Default Requirement<a href="#default-requirement" class="hash-link" aria-label="Direct link to Default Requirement" title="Direct link to Default Requirement" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="requiredefault">requireDefault()<a href="#requiredefault" class="hash-link" aria-label="Direct link to requireDefault()" title="Direct link to requireDefault()" translate="no">​</a></h3>
<p>Require flows with <code>is_default=true</code>. When enabled, only flows marked as default are eligible for selection.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;requireDefault(true);  // Only default flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;requireDefault(false); // Any flow</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>bool $required = true</code>: Whether to require is_default=true</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">When <code>true</code>: Filters flows where <code>is_default = true</code></li>
<li class="">When <code>false</code>: No default requirement (any flow eligible)</li>
<li class="">Useful for enforcing a single default flow per scope</li>
<li class="">Can be relaxed in fallback cascade with <code>FB_DROP_REQUIRE_DEFAULT</code></li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Only default flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;requireDefault(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Any flow (default or not)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;requireDefault(false);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Enforcing single default flow</li>
<li class="">Default flow selection</li>
<li class="">Fallback to default when specific flows unavailable</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="candidates-configuration">Candidates Configuration<a href="#candidates-configuration" class="hash-link" aria-label="Direct link to Candidates Configuration" title="Direct link to Candidates Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="returncandidates">returnCandidates()<a href="#returncandidates" class="hash-link" aria-label="Direct link to returnCandidates()" title="Direct link to returnCandidates()" translate="no">​</a></h3>
<p>Hint that the consumer intends to fetch candidates (for diagnostics or insight). This is a hint only; <code>pick()</code> still returns a single Flow.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;returnCandidates(true);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>bool $on = true</code>: Whether to enable the hint</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class=""><strong>Hint only</strong> - doesn&#x27;t change <code>pick()</code> behavior</li>
<li class=""><code>pick()</code> still returns single Flow (first match)</li>
<li class="">Use <code>FlowPicker::candidates()</code> to get full list</li>
<li class="">Useful for debugging and diagnostics</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Hint for candidate fetching</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;returnCandidates(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get candidates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$candidates = $picker-&gt;candidates($model, $builder);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Debugging flow selection</li>
<li class="">Displaying available flows</li>
<li class="">Diagnostics and insight</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="candidateslimit">candidatesLimit()<a href="#candidateslimit" class="hash-link" aria-label="Direct link to candidatesLimit()" title="Direct link to candidatesLimit()" translate="no">​</a></h3>
<p>Limit the number of candidates returned by <code>FlowPicker::candidates()</code>. This helps with performance when fetching candidate lists.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;candidatesLimit(10); // Max 10 candidates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;candidatesLimit(null); // No limit</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>?int $limit</code>: Positive integer for limit or null for no limit</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Applies <code>LIMIT</code> clause to candidate query</li>
<li class="">Only affects <code>FlowPicker::candidates()</code>, not <code>pick()</code></li>
<li class="">When <code>null</code>, no limit is applied</li>
<li class="">When <code>0</code> or negative, limit is ignored</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Limit to 10 candidates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;candidatesLimit(10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// No limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;candidatesLimit(null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get top 5 candidates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;candidatesLimit(5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$candidates = $picker-&gt;candidates($model, $builder);</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Performance optimization</li>
<li class="">Limiting candidate lists</li>
<li class="">Top N flow selection</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cacheinrequest">cacheInRequest()<a href="#cacheinrequest" class="hash-link" aria-label="Direct link to cacheInRequest()" title="Direct link to cacheInRequest()" translate="no">​</a></h3>
<p>Enable simple per-request memoization when no dynamic callbacks are present. This caches flow selection results within a single request for better performance.</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;cacheInRequest(true);</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>bool $on = true</code>: Whether to enable memoization</li>
</ul>
<p><strong>Returns:</strong> <code>$this</code> (fluent interface)</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Caches flow selection results per request</li>
<li class="">Cache key is computed from builder configuration and model</li>
<li class=""><strong>Automatically disabled</strong> if unsafe conditions detected:<!-- -->
<ul>
<li class="">Custom WHERE callbacks exist</li>
<li class="">Custom ordering callback exists</li>
<li class=""><code>forceFlowIdResolver</code> is set</li>
</ul>
</li>
<li class="">Cache is cleared at end of request</li>
</ul>
<p><strong>When Safe to Enable:</strong></p>
<ul>
<li class="">✅ No custom WHERE callbacks</li>
<li class="">✅ No custom ordering callback</li>
<li class="">✅ No forceFlowIdResolver</li>
<li class="">✅ Static configuration only</li>
</ul>
<p><strong>When NOT Safe (automatically disabled):</strong></p>
<ul>
<li class="">❌ Custom WHERE callbacks (dynamic)</li>
<li class="">❌ Custom ordering callback (dynamic)</li>
<li class="">❌ forceFlowIdResolver (dynamic)</li>
<li class="">❌ Request-dependent logic</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Safe: Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;environment(&#x27;production&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;cacheInRequest(true); // ✅ Safe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Unsafe: Dynamic callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $query-&gt;where(&#x27;field&#x27;, $model-&gt;attr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-&gt;cacheInRequest(true); // ❌ Automatically disabled</span><br></span></code></pre></div></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li class="">Performance optimization</li>
<li class="">Repeated flow selection in same request</li>
<li class="">Reducing database queries</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-examples">Complete Examples<a href="#complete-examples" class="hash-link" aria-label="Direct link to Complete Examples" title="Direct link to Complete Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-1-basic-configuration">Example 1: Basic Configuration<a href="#example-1-basic-configuration" class="hash-link" aria-label="Direct link to Example 1: Basic Configuration" title="Direct link to Example 1: Basic Configuration" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder = new FlowPickerBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;subjectScope((string)$order-&gt;tenant_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;channel(&#x27;web&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;orderByDefault();</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-2-with-rollout">Example 2: With Rollout<a href="#example-2-with-rollout" class="hash-link" aria-label="Direct link to Example 2: With Rollout" title="Direct link to Example 2: With Rollout" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;environment(&#x27;production&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutNamespace(&#x27;order_v2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutSalt(&#x27;2024&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-3-with-fallback">Example 3: With Fallback<a href="#example-3-with-fallback" class="hash-link" aria-label="Direct link to Example 3: With Fallback" title="Direct link to Example 3: With Fallback" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;environment(&#x27;production&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;channel(&#x27;web&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-4-version-constraints">Example 4: Version Constraints<a href="#example-4-version-constraints" class="hash-link" aria-label="Direct link to Example 4: Version Constraints" title="Direct link to Example 4: Version Constraints" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtLeast(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtMost(3); // Versions 1-3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-5-includeexclude">Example 5: Include/Exclude<a href="#example-5-includeexclude" class="hash-link" aria-label="Direct link to Example 5: Include/Exclude" title="Direct link to Example 5: Include/Exclude" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;includeFlows([1, 2, 3])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;excludeFlows([4, 5])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;preferFlows([1, 2]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-6-custom-ordering">Example 6: Custom Ordering<a href="#example-6-custom-ordering" class="hash-link" aria-label="Direct link to Example 6: Custom Ordering" title="Direct link to Example 6: Custom Ordering" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;orderBy(function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $query-&gt;orderBy(&#x27;priority&#x27;, &#x27;desc&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              -&gt;orderBy(&#x27;created_at&#x27;, &#x27;asc&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-7-custom-filters">Example 7: Custom Filters<a href="#example-7-custom-filters" class="hash-link" aria-label="Direct link to Example 7: Custom Filters" title="Direct link to Example 7: Custom Filters" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($model-&gt;is_premium) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $query-&gt;where(&#x27;is_premium_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-8-complex-configuration">Example 8: Complex Configuration<a href="#example-8-complex-configuration" class="hash-link" aria-label="Direct link to Example 8: Complex Configuration" title="Direct link to Example 8: Complex Configuration" translate="no">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;subjectType(Order::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;subjectScope((string)$order-&gt;tenant_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;subjectCollection($order-&gt;collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;channel(request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;ignoreTimeWindow(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutNamespace(&#x27;order&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtLeast(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;versionAtMost(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;includeFlows([1, 2, 3])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;excludeFlows([4, 5])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;preferFlows([1, 2])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;orderByDefault()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;matchStrategy(FlowPickerBuilder::STRATEGY_BEST)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;requireDefault(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;cacheInRequest(true);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getter-methods">Getter Methods<a href="#getter-methods" class="hash-link" aria-label="Direct link to Getter Methods" title="Direct link to Getter Methods" translate="no">​</a></h2>
<p>All configuration values can be retrieved:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getSubjectType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getSubjectScope();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getSubjectCollection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getEnvironment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getChannel();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getPreferEnvironments();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getPreferChannels();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;isOnlyActive();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;shouldIgnoreTimeWindow();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getNowUtc();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;shouldEvaluateRollout();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getRolloutNamespace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getRolloutSalt();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getRolloutKeyResolver();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getVersionEquals();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getVersionMin();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getVersionMax();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getIncludeFlowIds();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getExcludeFlowIds();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getPreferFlowIds();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getMatchStrategy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;isRequireDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getFallbackCascade();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getForceFlowIdResolver();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;shouldReturnCandidates();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getCandidatesLimit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;shouldCacheInRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getWhereCallbacks();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$builder-&gt;getOrderingCallback();</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="integration-with-hasworkflow">Integration with HasWorkflow<a href="#integration-with-hasworkflow" class="hash-link" aria-label="Direct link to Integration with HasWorkflow" title="Direct link to Integration with HasWorkflow" translate="no">​</a></h2>
<p>The <code>HasWorkflow</code> trait uses <code>FlowPickerBuilder</code>:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;subjectType(static::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;subjectCollection($this-&gt;flowSubjectCollection())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;orderByDefault()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;rolloutKeyResolver(function (Model $model): ?string {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return $model-&gt;getKey() ? (string)$model-&gt;getKey() : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-world-system-implementation-examples">Real-World System Implementation Examples<a href="#real-world-system-implementation-examples" class="hash-link" aria-label="Direct link to Real-World System Implementation Examples" title="Direct link to Real-World System Implementation Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-1-complete-e-commerce-order-management-system">Example 1: Complete E-Commerce Order Management System<a href="#example-1-complete-e-commerce-order-management-system" class="hash-link" aria-label="Direct link to Example 1: Complete E-Commerce Order Management System" title="Direct link to Example 1: Complete E-Commerce Order Management System" translate="no">​</a></h3>
<p>A comprehensive order management system with multiple workflows based on order type, customer tier, and environment.</p>
<p><strong>Model:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Order extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;user_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;tenant_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;order_type&#x27;,      // &#x27;premium&#x27;, &#x27;standard&#x27;, &#x27;express&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;customer_tier&#x27;,   // &#x27;vip&#x27;, &#x27;regular&#x27;, &#x27;new&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;total&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Multi-tenant support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectScope((string)$this-&gt;tenant_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Collection-based workflows (order type)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectCollection($this-&gt;order_type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Environment-specific workflows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Channel-based workflows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $channel = request()-&gt;header(&#x27;X-Channel&#x27;, &#x27;web&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;channel($channel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prefer production, then staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prefer web, then API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;, &#x27;mobile&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Rollout for new workflow (A/B testing)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;order_processing_v2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutSalt(&#x27;2024-01&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;user_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Version constraints (only versions 1-3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;versionAtLeast(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;versionAtMost(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Fallback cascade for graceful degradation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DISABLE_ROLLOUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom filter for customer tier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $customerTier = $model-&gt;customer_tier;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($customerTier === &#x27;vip&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;is_vip_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } elseif ($customerTier === &#x27;new&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;is_new_customer_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Request caching for performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;cacheInRequest(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;order_type&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow Setup:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Facades\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Premium order flow - Production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;1&#x27;, // Tenant 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;premium&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;rollout_pct&#x27; =&gt; 50, // 50% rollout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Standard order flow - Production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;standard&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Express order flow - Production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Order::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;express&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<p><strong>Usage:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create order - flow automatically selected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$order = Order::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; 123,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;tenant_id&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;order_type&#x27; =&gt; &#x27;premium&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;customer_tier&#x27; =&gt; &#x27;vip&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;total&#x27; =&gt; 1000.00,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Flow is automatically bound based on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// - Tenant ID (subject_scope)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// - Order type (subject_collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// - Environment (production)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// - Channel (web)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// - Customer tier (custom filter)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// - Rollout percentage (user_id bucket)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-2-multi-tenant-saas-document-management-system">Example 2: Multi-Tenant SaaS Document Management System<a href="#example-2-multi-tenant-saas-document-management-system" class="hash-link" aria-label="Direct link to Example 2: Multi-Tenant SaaS Document Management System" title="Direct link to Example 2: Multi-Tenant SaaS Document Management System" translate="no">​</a></h3>
<p>A document management system where each tenant has different approval workflows, with environment-specific and time-based activation.</p>
<p><strong>Model:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Carbon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Document extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;tenant_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;document_type&#x27;,  // &#x27;contract&#x27;, &#x27;invoice&#x27;, &#x27;report&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;department&#x27;,     // &#x27;legal&#x27;, &#x27;finance&#x27;, &#x27;hr&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;priority&#x27;,        // &#x27;high&#x27;, &#x27;normal&#x27;, &#x27;low&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Tenant isolation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectScope((string)$this-&gt;tenant_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Document type as collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectCollection($this-&gt;document_type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Environment-specific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Active window enforcement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prefer production, allow staging fallback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Version management (only current versions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;versionAtLeast(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Exclude deprecated flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;excludeFlows([10, 11, 12]); // Old flow IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom filter for department</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $department = $model-&gt;department;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Department-specific flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($department === &#x27;legal&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;is_legal_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } elseif ($department === &#x27;finance&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;is_finance_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Fallback: drop environment, then ignore time window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;document_type&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow Setup:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Contract approval flow - Tenant 1, Production, Active Jan 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Document::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;contract&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_from&#x27; =&gt; &#x27;2024-01-01 00:00:00&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_to&#x27; =&gt; &#x27;2024-12-31 23:59:59&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Invoice approval flow - Tenant 1, Production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Document::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;invoice&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-3-content-management-system-with-ab-testing">Example 3: Content Management System with A/B Testing<a href="#example-3-content-management-system-with-ab-testing" class="hash-link" aria-label="Direct link to Example 3: Content Management System with A/B Testing" title="Direct link to Example 3: Content Management System with A/B Testing" translate="no">​</a></h3>
<p>A CMS with gradual rollout of new content approval workflows, supporting multiple content types and channels.</p>
<p><strong>Model:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Article extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;author_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;content_type&#x27;,  // &#x27;news&#x27;, &#x27;blog&#x27;, &#x27;press-release&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;category&#x27;,      // &#x27;tech&#x27;, &#x27;business&#x27;, &#x27;lifestyle&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Content type as collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectCollection($this-&gt;content_type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Channel (web vs admin)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $channel = request()-&gt;is(&#x27;admin/*&#x27;) ? &#x27;admin&#x27; : &#x27;web&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;channel($channel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // A/B Testing: Rollout new workflow to 30% of authors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;content_approval_v2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutSalt(&#x27;2024-Q1&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Consistent assignment by author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;author_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prefer new version, but allow old version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;preferFlows([5, 6]); // New flow IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;versionAtLeast(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Fallback: disable rollout if new workflow not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DISABLE_ROLLOUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom filter for category</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $category = $model-&gt;category;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Category-specific workflows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (in_array($category, [&#x27;tech&#x27;, &#x27;business&#x27;])) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;requires_technical_review&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;content_type&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow Setup:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// New approval workflow (30% rollout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Article::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;news&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;rollout_pct&#x27; =&gt; 30, // 30% of authors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Old approval workflow (70% of authors, or 100% if rollout disabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Article::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;news&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;rollout_pct&#x27; =&gt; null, // No rollout gate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-4-financial-transaction-processing-system">Example 4: Financial Transaction Processing System<a href="#example-4-financial-transaction-processing-system" class="hash-link" aria-label="Direct link to Example 4: Financial Transaction Processing System" title="Direct link to Example 4: Financial Transaction Processing System" translate="no">​</a></h3>
<p>A financial system with strict version control, environment isolation, and scheduled workflow activation.</p>
<p><strong>Model:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Carbon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Transaction extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;account_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;transaction_type&#x27;, // &#x27;payment&#x27;, &#x27;refund&#x27;, &#x27;transfer&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;amount&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;currency&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Transaction type as collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectCollection($this-&gt;transaction_type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Strict environment isolation (no fallback)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Active window enforcement (scheduled workflows)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Version pinning (exact version required)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $currentVersion = config(&#x27;flows.transaction_version&#x27;, 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;versionEquals($currentVersion);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Require default flows only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;requireDefault(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // No rollout (all transactions use same workflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;evaluateRollout(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom filter for currency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $currency = $model-&gt;currency;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Currency-specific workflows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($currency === &#x27;USD&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;supports_usd&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } elseif ($currency === &#x27;EUR&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;supports_eur&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // No fallback (strict matching required)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;fallbackCascade([]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;transaction_type&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow Setup:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Payment processing flow - Version 2, Production, Active Q1 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Transaction::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;payment&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_from&#x27; =&gt; &#x27;2024-01-01 00:00:00&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_to&#x27; =&gt; &#x27;2024-03-31 23:59:59&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;supports_usd&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;supports_eur&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-5-support-ticket-system-with-priority-based-workflows">Example 5: Support Ticket System with Priority-Based Workflows<a href="#example-5-support-ticket-system-with-priority-based-workflows" class="hash-link" aria-label="Direct link to Example 5: Support Ticket System with Priority-Based Workflows" title="Direct link to Example 5: Support Ticket System with Priority-Based Workflows" translate="no">​</a></h3>
<p>A support ticket system with different workflows based on ticket priority, customer tier, and channel.</p>
<p><strong>Model:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Ticket extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;customer_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;priority&#x27;,        // &#x27;critical&#x27;, &#x27;high&#x27;, &#x27;normal&#x27;, &#x27;low&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;category&#x27;,        // &#x27;technical&#x27;, &#x27;billing&#x27;, &#x27;general&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;channel&#x27;,         // &#x27;email&#x27;, &#x27;chat&#x27;, &#x27;phone&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;customer_tier&#x27;,   // &#x27;enterprise&#x27;, &#x27;business&#x27;, &#x27;standard&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Priority as collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectCollection($this-&gt;priority);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Channel-based workflows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;channel($this-&gt;channel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prefer critical priority flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;preferFlows([1, 2, 3]); // Critical flow IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Version constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;versionAtLeast(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;versionAtMost(2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Category-specific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($model-&gt;category === &#x27;technical&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;requires_technical_team&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Customer tier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($model-&gt;customer_tier === &#x27;enterprise&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;is_enterprise_flow&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Fallback: drop channel, then environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;priority&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow Setup:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Critical priority - Email channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Ticket::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;critical&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;email&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;requires_technical_team&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// High priority - Chat channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Ticket::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;high&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;chat&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-6-invoice-processing-with-time-based-activation">Example 6: Invoice Processing with Time-Based Activation<a href="#example-6-invoice-processing-with-time-based-activation" class="hash-link" aria-label="Direct link to Example 6: Invoice Processing with Time-Based Activation" title="Direct link to Example 6: Invoice Processing with Time-Based Activation" translate="no">​</a></h3>
<p>An invoice processing system with workflows that activate/deactivate at specific times, supporting multiple currencies and regions.</p>
<p><strong>Model:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Carbon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Invoice extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;tenant_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;region&#x27;,          // &#x27;us&#x27;, &#x27;eu&#x27;, &#x27;asia&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;currency&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;invoice_type&#x27;,    // &#x27;recurring&#x27;, &#x27;one-time&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Tenant isolation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectScope((string)$this-&gt;tenant_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Invoice type as collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectCollection($this-&gt;invoice_type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Strict time window enforcement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prefer current region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Version management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;versionAtLeast(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Region-specific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $query-&gt;where(&#x27;supported_regions&#x27;, &#x27;LIKE&#x27;, &quot;%{$model-&gt;region}%&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Currency support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($model-&gt;currency === &#x27;USD&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;supports_usd&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Fallback: ignore time window if outside active period</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;invoice_type&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Flow Setup:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Recurring invoice flow - Active during business quarter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; Invoice::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;recurring&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_from&#x27; =&gt; &#x27;2024-01-01 00:00:00&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_to&#x27; =&gt; &#x27;2024-03-31 23:59:59&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;supported_regions&#x27; =&gt; &#x27;us,eu,asia&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;supports_usd&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-7-complete-implementation-with-all-features">Example 7: Complete Implementation with All Features<a href="#example-7-complete-implementation-with-all-features" class="hash-link" aria-label="Direct link to Example 7: Complete Implementation with All Features" title="Direct link to Example 7: Complete Implementation with All Features" translate="no">​</a></h3>
<p>A comprehensive example using all FlowPickerBuilder features for a complex enterprise system.</p>
<p><strong>Model:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Database\Eloquent\Model;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Support\FlowPickerBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Support\Carbon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class EnterpriseOrder extends Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use HasWorkflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected $fillable = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;organization_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;department_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;order_category&#x27;,   // &#x27;procurement&#x27;, &#x27;it&#x27;, &#x27;hr&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;order_type&#x27;,       // &#x27;urgent&#x27;, &#x27;standard&#x27;, &#x27;planned&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;budget_tier&#x27;,      // &#x27;high&#x27;, &#x27;medium&#x27;, &#x27;low&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;region&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Organization scope (multi-tenant)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectScope((string)$this-&gt;organization_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Order category as collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;subjectCollection($this-&gt;order_category);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Environment with preference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferEnvironments([&#x27;production&#x27;, &#x27;staging&#x27;, &#x27;development&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $channel = $this-&gt;determineChannel();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;channel($channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;preferChannels([&#x27;web&#x27;, &#x27;api&#x27;, &#x27;mobile&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Active constraints with time window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;timeNow(Carbon::now(&#x27;UTC&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Rollout for new workflow (25% of organizations)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;evaluateRollout(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutNamespace(&#x27;enterprise_order_v3&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutSalt(&#x27;2024-Q2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;rolloutKeyResolver(function ($model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return (string)$model-&gt;organization_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Version constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;versionAtLeast(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;versionAtMost(4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Include only approved flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;includeFlows([10, 11, 12, 13]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Exclude deprecated flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;excludeFlows([1, 2, 3]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prefer newer flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;preferFlows([13, 12, 11, 10]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Require default flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;requireDefault(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom ordering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;orderBy(function ($query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $query-&gt;orderByDesc(&#x27;priority&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                -&gt;orderByDesc(&#x27;version&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                -&gt;orderByDesc(&#x27;is_default&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Match strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;matchStrategy(FlowPickerBuilder::STRATEGY_BEST);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Custom filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;where(function ($query, $model) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Department-specific</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($model-&gt;department_id === 5) { // IT Department</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;requires_it_approval&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Budget tier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($model-&gt;budget_tier === &#x27;high&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $query-&gt;where(&#x27;requires_executive_approval&#x27;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $query-&gt;where(&#x27;supported_regions&#x27;, &#x27;LIKE&#x27;, &quot;%{$model-&gt;region}%&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Comprehensive fallback cascade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_CHANNEL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DISABLE_ROLLOUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_REQUIRE_DEFAULT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Performance optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;cacheInRequest(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function flowSubjectCollection(): ?string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;getAttribute(&#x27;order_category&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected function determineChannel(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (request()-&gt;is(&#x27;api/*&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return &#x27;api&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } elseif (request()-&gt;is(&#x27;mobile/*&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return &#x27;mobile&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &#x27;web&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Complete Flow Setup:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use JobMetric\Flow\Facades\Flow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Procurement flow - Production, Version 3, 25% rollout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; EnterpriseOrder::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;100&#x27;, // Organization 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;procurement&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;rollout_pct&#x27; =&gt; 25,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_from&#x27; =&gt; &#x27;2024-04-01 00:00:00&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_to&#x27; =&gt; &#x27;2024-06-30 23:59:59&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;priority&#x27; =&gt; 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;requires_it_approval&#x27; =&gt; false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;requires_executive_approval&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;supported_regions&#x27; =&gt; &#x27;us,eu&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// IT flow - Production, Version 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow::store([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_type&#x27; =&gt; EnterpriseOrder::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_scope&#x27; =&gt; &#x27;100&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;subject_collection&#x27; =&gt; &#x27;it&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;environment&#x27; =&gt; &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;channel&#x27; =&gt; &#x27;web&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;rollout_pct&#x27; =&gt; 25,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_from&#x27; =&gt; &#x27;2024-04-01 00:00:00&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active_to&#x27; =&gt; &#x27;2024-06-30 23:59:59&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;is_default&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;priority&#x27; =&gt; 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;requires_it_approval&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;requires_executive_approval&#x27; =&gt; false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;supported_regions&#x27; =&gt; &#x27;us,eu,asia&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<p><strong>Usage in Controller:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace App\Http\Controllers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use App\Models\EnterpriseOrder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Illuminate\Http\Request;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class OrderController extends Controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function store(Request $request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Create order - flow automatically selected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $order = EnterpriseOrder::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;organization_id&#x27; =&gt; $request-&gt;organization_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;department_id&#x27; =&gt; $request-&gt;department_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;order_category&#x27; =&gt; $request-&gt;category,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;order_type&#x27; =&gt; $request-&gt;type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;budget_tier&#x27; =&gt; $request-&gt;budget_tier,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;region&#x27; =&gt; $request-&gt;region,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Flow is automatically bound with all criteria:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Organization scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Order category</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Active time window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Rollout percentage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Version constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // - Custom filters (department, budget, region)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return response()-&gt;json([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;order&#x27; =&gt; $order,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;flow&#x27; =&gt; $order-&gt;boundFlow(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-8-testing-and-development-scenarios">Example 8: Testing and Development Scenarios<a href="#example-8-testing-and-development-scenarios" class="hash-link" aria-label="Direct link to Example 8: Testing and Development Scenarios" title="Direct link to Example 8: Testing and Development Scenarios" translate="no">​</a></h3>
<p>Examples for testing and development environments.</p>
<p><strong>Test Configuration:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Testing: Include specific test flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (app()-&gt;environment(&#x27;testing&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;includeFlows([999, 998, 997]) // Test flow IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;evaluateRollout(false) // Disable rollout in tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;onlyActive(false) // Include inactive flows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;ignoreTimeWindow(true); // Ignore time windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Production configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $builder-&gt;environment(config(&#x27;app.env&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;onlyActive(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;evaluateRollout(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Development Configuration:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function buildFlowPicker(FlowPickerBuilder $builder): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::buildFlowPicker($builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Development: Allow any environment, prefer development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $builder-&gt;environment(null) // No environment filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;preferEnvironments([&#x27;development&#x27;, &#x27;staging&#x27;, &#x27;production&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;onlyActive(false) // Include inactive for testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;fallbackCascade([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_DROP_ENVIRONMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FlowPickerBuilder::FB_IGNORE_TIMEWINDOW,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related-documentation">Related Documentation<a href="#related-documentation" class="hash-link" aria-label="Direct link to Related Documentation" title="Direct link to Related Documentation" translate="no">​</a></h2>
<ul>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/support/flow-picker">FlowPicker</a> - Flow selection mechanism</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/has-workflow">HasWorkflow</a> - Workflow integration trait</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/services/flow">Flow Service</a> - Flow management</li>
<li class=""><a class="" href="/packages/laravel-flow/deep-diving/has-flow">HasFlow</a> - Simple flow binding</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/jobmetric/document/blob/master/packages/laravel-flow/deep-diving/support/flow-picker-builder.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/packages/laravel-flow/deep-diving/support/flow-picker"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">FlowPicker</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/packages/laravel-flow/deep-diving/support/flow-task-context"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FlowTaskContext</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#namespace" class="table-of-contents__link toc-highlight">Namespace</a></li><li><a href="#where-and-when-to-use-flowpickerbuilder" class="table-of-contents__link toc-highlight">Where and When to Use FlowPickerBuilder</a><ul><li><a href="#primary-use-cases" class="table-of-contents__link toc-highlight">Primary Use Cases</a></li><li><a href="#key-scenarios" class="table-of-contents__link toc-highlight">Key Scenarios</a></li><li><a href="#when-not-to-use-flowpickerbuilder" class="table-of-contents__link toc-highlight">When NOT to Use FlowPickerBuilder</a></li></ul></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#constants" class="table-of-contents__link toc-highlight">Constants</a><ul><li><a href="#match-strategy" class="table-of-contents__link toc-highlight">Match Strategy</a></li><li><a href="#fallback-steps" class="table-of-contents__link toc-highlight">Fallback Steps</a></li></ul></li><li><a href="#subject-configuration" class="table-of-contents__link toc-highlight">Subject Configuration</a><ul><li><a href="#subjecttype" class="table-of-contents__link toc-highlight">subjectType()</a></li><li><a href="#subjectscope" class="table-of-contents__link toc-highlight">subjectScope()</a></li><li><a href="#subjectcollection" class="table-of-contents__link toc-highlight">subjectCollection()</a></li></ul></li><li><a href="#environment-and-channel" class="table-of-contents__link toc-highlight">Environment and Channel</a><ul><li><a href="#environment" class="table-of-contents__link toc-highlight">environment()</a></li><li><a href="#channel" class="table-of-contents__link toc-highlight">channel()</a></li><li><a href="#preferenvironments" class="table-of-contents__link toc-highlight">preferEnvironments()</a></li><li><a href="#preferchannels" class="table-of-contents__link toc-highlight">preferChannels()</a></li></ul></li><li><a href="#active-constraints" class="table-of-contents__link toc-highlight">Active Constraints</a><ul><li><a href="#onlyactive" class="table-of-contents__link toc-highlight">onlyActive()</a></li><li><a href="#ignoretimewindow" class="table-of-contents__link toc-highlight">ignoreTimeWindow()</a></li><li><a href="#timenow" class="table-of-contents__link toc-highlight">timeNow()</a></li></ul></li><li><a href="#rollout-configuration" class="table-of-contents__link toc-highlight">Rollout Configuration</a><ul><li><a href="#evaluaterollout" class="table-of-contents__link toc-highlight">evaluateRollout()</a></li><li><a href="#rolloutnamespace" class="table-of-contents__link toc-highlight">rolloutNamespace()</a></li><li><a href="#rolloutsalt" class="table-of-contents__link toc-highlight">rolloutSalt()</a></li><li><a href="#rolloutkeyresolver" class="table-of-contents__link toc-highlight">rolloutKeyResolver()</a></li></ul></li><li><a href="#version-constraints" class="table-of-contents__link toc-highlight">Version Constraints</a><ul><li><a href="#versionequals" class="table-of-contents__link toc-highlight">versionEquals()</a></li><li><a href="#versionatleast" class="table-of-contents__link toc-highlight">versionAtLeast()</a></li><li><a href="#versionatmost" class="table-of-contents__link toc-highlight">versionAtMost()</a></li><li><a href="#versionmin--versionmax" class="table-of-contents__link toc-highlight">versionMin() / versionMax()</a></li></ul></li><li><a href="#includeexcludeprefer" class="table-of-contents__link toc-highlight">Include/Exclude/Prefer</a><ul><li><a href="#includeflows" class="table-of-contents__link toc-highlight">includeFlows()</a></li><li><a href="#excludeflows" class="table-of-contents__link toc-highlight">excludeFlows()</a></li><li><a href="#preferflows" class="table-of-contents__link toc-highlight">preferFlows()</a></li></ul></li><li><a href="#ordering" class="table-of-contents__link toc-highlight">Ordering</a><ul><li><a href="#orderbydefault" class="table-of-contents__link toc-highlight">orderByDefault()</a></li><li><a href="#orderby" class="table-of-contents__link toc-highlight">orderBy()</a></li><li><a href="#matchstrategy" class="table-of-contents__link toc-highlight">matchStrategy()</a></li><li><a href="#pickfirstmatch" class="table-of-contents__link toc-highlight">pickFirstMatch()</a></li></ul></li><li><a href="#custom-filters" class="table-of-contents__link toc-highlight">Custom Filters</a><ul><li><a href="#where" class="table-of-contents__link toc-highlight">where()</a></li></ul></li><li><a href="#fallback-cascade" class="table-of-contents__link toc-highlight">Fallback Cascade</a><ul><li><a href="#fallbackcascade" class="table-of-contents__link toc-highlight">fallbackCascade()</a></li></ul></li><li><a href="#force-flow-id" class="table-of-contents__link toc-highlight">Force Flow ID</a><ul><li><a href="#forceflowidresolver" class="table-of-contents__link toc-highlight">forceFlowIdResolver()</a></li></ul></li><li><a href="#default-requirement" class="table-of-contents__link toc-highlight">Default Requirement</a><ul><li><a href="#requiredefault" class="table-of-contents__link toc-highlight">requireDefault()</a></li></ul></li><li><a href="#candidates-configuration" class="table-of-contents__link toc-highlight">Candidates Configuration</a><ul><li><a href="#returncandidates" class="table-of-contents__link toc-highlight">returnCandidates()</a></li><li><a href="#candidateslimit" class="table-of-contents__link toc-highlight">candidatesLimit()</a></li></ul></li><li><a href="#performance" class="table-of-contents__link toc-highlight">Performance</a><ul><li><a href="#cacheinrequest" class="table-of-contents__link toc-highlight">cacheInRequest()</a></li></ul></li><li><a href="#complete-examples" class="table-of-contents__link toc-highlight">Complete Examples</a><ul><li><a href="#example-1-basic-configuration" class="table-of-contents__link toc-highlight">Example 1: Basic Configuration</a></li><li><a href="#example-2-with-rollout" class="table-of-contents__link toc-highlight">Example 2: With Rollout</a></li><li><a href="#example-3-with-fallback" class="table-of-contents__link toc-highlight">Example 3: With Fallback</a></li><li><a href="#example-4-version-constraints" class="table-of-contents__link toc-highlight">Example 4: Version Constraints</a></li><li><a href="#example-5-includeexclude" class="table-of-contents__link toc-highlight">Example 5: Include/Exclude</a></li><li><a href="#example-6-custom-ordering" class="table-of-contents__link toc-highlight">Example 6: Custom Ordering</a></li><li><a href="#example-7-custom-filters" class="table-of-contents__link toc-highlight">Example 7: Custom Filters</a></li><li><a href="#example-8-complex-configuration" class="table-of-contents__link toc-highlight">Example 8: Complex Configuration</a></li></ul></li><li><a href="#getter-methods" class="table-of-contents__link toc-highlight">Getter Methods</a></li><li><a href="#integration-with-hasworkflow" class="table-of-contents__link toc-highlight">Integration with HasWorkflow</a></li><li><a href="#real-world-system-implementation-examples" class="table-of-contents__link toc-highlight">Real-World System Implementation Examples</a><ul><li><a href="#example-1-complete-e-commerce-order-management-system" class="table-of-contents__link toc-highlight">Example 1: Complete E-Commerce Order Management System</a></li><li><a href="#example-2-multi-tenant-saas-document-management-system" class="table-of-contents__link toc-highlight">Example 2: Multi-Tenant SaaS Document Management System</a></li><li><a href="#example-3-content-management-system-with-ab-testing" class="table-of-contents__link toc-highlight">Example 3: Content Management System with A/B Testing</a></li><li><a href="#example-4-financial-transaction-processing-system" class="table-of-contents__link toc-highlight">Example 4: Financial Transaction Processing System</a></li><li><a href="#example-5-support-ticket-system-with-priority-based-workflows" class="table-of-contents__link toc-highlight">Example 5: Support Ticket System with Priority-Based Workflows</a></li><li><a href="#example-6-invoice-processing-with-time-based-activation" class="table-of-contents__link toc-highlight">Example 6: Invoice Processing with Time-Based Activation</a></li><li><a href="#example-7-complete-implementation-with-all-features" class="table-of-contents__link toc-highlight">Example 7: Complete Implementation with All Features</a></li><li><a href="#example-8-testing-and-development-scenarios" class="table-of-contents__link toc-highlight">Example 8: Testing and Development Scenarios</a></li></ul></li><li><a href="#related-documentation" class="table-of-contents__link toc-highlight">Related Documentation</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 JobMetric.</div></div></div></footer></div>
</body>
</html>